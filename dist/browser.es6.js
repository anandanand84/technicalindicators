(function(e,t){'use strict';function a(e,t){In[e]=t}function r(e){return In[e]}function o(e){let t=r('precision');return t?parseFloat(e.toPrecision(t)):e}function n(e){Rn.reverseInputs(e);var t=new An(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function i(e){Rn.reverseInputs(e);var t=new Ln(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function s(e){Rn.reverseInputs(e);var t=new jn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function u(e){Rn.reverseInputs(e);var t=new zn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function l(e){Rn.reverseInputs(e);var t=new Gn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function p(e){Rn.reverseInputs(e);var t=new On(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function d(e){Rn.reverseInputs(e);var t=new qn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function c(e){Rn.reverseInputs(e);var t=new Un(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function h(e){Rn.reverseInputs(e);var t=new Nn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function g(e){Rn.reverseInputs(e);var t=new Bn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function f(e){Rn.reverseInputs(e);var t=new Vn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function m(e){Rn.reverseInputs(e);var t=new Xn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function _(e){Rn.reverseInputs(e);var t=new Kn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function x(e){Rn.reverseInputs(e);var t=new Qn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function y(e){Rn.reverseInputs(e);var t=new Zn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function v(e){Rn.reverseInputs(e);var t=new Yn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function b(e){Rn.reverseInputs(e);var t=new Jn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function S(e){Rn.reverseInputs(e);var t=new ei(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function T(e){Rn.reverseInputs(e);var t=new ti(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function P(e){Rn.reverseInputs(e);var t=new ai(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function w(e){Rn.reverseInputs(e);var t=new ri(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function C(e){Rn.reverseInputs(e);var t=new oi(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function k(e){Rn.reverseInputs(e);var t=new ni(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function F(e){Rn.reverseInputs(e);var t=new ii(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function M(e){Rn.reverseInputs(e);var t=new si(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function D(e){Rn.reverseInputs(e);var t=new ui(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function I(e,t,a,r){return e<=a&&t>=a||a<=e&&r>=e}function R(e){Rn.reverseInputs(e);var t=new li(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function A(e){Rn.reverseInputs(e);var t=new pi(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function L(e){Rn.reverseInputs(e);var t=new di(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function j(e){Rn.reverseInputs(e);var t=new ci(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function z(e){Rn.reverseInputs(e);var t=new hi(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function G(e){Rn.reverseInputs(e);var t=new gi(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function O(e){Rn.reverseInputs(e);var t=new fi(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}function q(e){Rn.reverseInputs(e);var t=new mi(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),Rn.reverseInputs(e),t}function U(e){Rn.reverseInputs(e);var t=new _i(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),Rn.reverseInputs(e),t}function N(e){return new yi().hasPattern(e)}function B(e){return new vi().hasPattern(e)}function V(e){return new bi().hasPattern(e)}function H(e){return new Si().hasPattern(e)}function W(e){return new Ti().hasPattern(e)}function X(e){return new Pi().hasPattern(e)}function $(e){return new wi().hasPattern(e)}function K(e){return new Ci().hasPattern(e)}function Q(e){return new ki().hasPattern(e)}function Z(e){return new Fi().hasPattern(e)}function Y(e){return new Di().hasPattern(e)}function J(e){return new Ii().hasPattern(e)}function ee(e){return new Ei().hasPattern(e)}function te(e){return new Ri().hasPattern(e)}function ae(e){return new Ai().hasPattern(e)}function re(e){return new Li().hasPattern(e)}function oe(e){return new ji().hasPattern(e)}function ne(e){return new zi().hasPattern(e)}function ie(e){return new Oi().hasPattern(e)}function se(e){return new qi().hasPattern(e)}function ue(e){return new Ui().hasPattern(e)}function le(e){return new Ni().hasPattern(e)}function pe(e){return new Bi().hasPattern(e)}function de(e){return new Vi().hasPattern(e)}function ce(e){return new Hi().hasPattern(e)}function he(e,t){let a=[0,23.6,38.2,50,61.8,78.6,100,127.2,161.8,261.8,423.6],r;return r=e<t?a.map(function(a){let r=t-Tn(e-t)*a/100;return 0<r?r:0}):a.map(function(a){let r=t+Tn(e-t)*a/100;return 0<r?r:0}),r}function ge(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e['default']:e}function fe(e,t){return t={exports:{}},e(t,t.exports),t.exports}function me(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}function _e(e){var t=as.call(e,os),a=e[os];try{e[os]=void 0}catch(t){}var r=rs.call(e);return t?e[os]=a:delete e[os],r}function xe(e){return ss.call(e)}function ye(e){return null==e?void 0===e?ps:ls:ds&&ds in Object(e)?ns(e):us(e)}function ve(e){return null!=e&&'object'==typeof e}function be(e){return hs(e)&&cs(e)==gs}function Se(){return!1}function Te(e,t){var a=typeof e;return t=null==t?ws:t,!!t&&('number'==a||'symbol'!=a&&Cs.test(e))&&-1<e&&0==e%1&&e<t}function Pe(e){return'number'==typeof e&&-1<e&&0==e%1&&e<=Fs}function we(e){return hs(e)&&Ms(e.length)&&!!eu[cs(e)]}function Ce(e){return function(t){return e(t)}}function ke(e,t){var a=Ss(e),r=!a&&vs(e),o=!a&&!r&&Ps(e),n=!a&&!r&&!o&&iu(e),i=a||r||o||n,s=i?Xi(e.length,String):[],u=s.length;for(var l in e)(t||uu.call(e,l))&&!(i&&('length'==l||o&&('offset'==l||'parent'==l)||n&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||ks(l,u)))&&s.push(l);return s}function Fe(e){var t=e&&e.constructor,a='function'==typeof t&&t.prototype||pu;return e===a}function Me(e,t){return function(a){return e(t(a))}}function De(e){if(!du(e))return gu(e);var t=[];for(var a in Object(e))mu.call(e,a)&&'constructor'!=a&&t.push(a);return t}function Ie(e){var t=typeof e;return null!=e&&('object'==t||'function'==t)}function Ee(e){if(!xu(e))return!1;var t=cs(e);return t==vu||t==bu||t==yu||t==Su}function Re(e){return null!=e&&Ms(e.length)&&!Tu(e)}function Ae(e){return Pu(e)?lu(e):_u(e)}function Le(){this.__data__=[],this.size=0}function je(e,t){return e===t||e!==e&&t!==t}function ze(e,t){for(var a=e.length;a--;)if(ku(e[a][0],t))return a;return-1}function Ge(e){var t=this.__data__,a=Fu(t,e);if(0>a)return!1;var r=t.length-1;return a==r?t.pop():Du.call(t,a,1),--this.size,!0}function Oe(e){var t=this.__data__,a=Fu(t,e);return 0>a?void 0:t[a][1]}function qe(e){return-1<Fu(this.__data__,e)}function Ue(e,t){var a=this.__data__,r=Fu(a,e);return 0>r?(++this.size,a.push([e,t])):a[r][1]=t,this}function Ne(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function Be(){this.__data__=new Lu,this.size=0}function Ve(e){var t=this.__data__,a=t['delete'](e);return this.size=t.size,a}function He(e){return this.__data__.get(e)}function We(e){return this.__data__.has(e)}function Xe(e){return!!Nu&&Nu in e}function $e(e){if(null!=e){try{return Hu.call(e)}catch(t){}try{return e+''}catch(t){}}return''}function Ke(e){if(!xu(e)||Bu(e))return!1;var t=Tu(e)?Ju:$u;return t.test(Wu(e))}function Qe(e,t){return null==e?void 0:e[t]}function Ze(e,t){var a=tl(e,t);return el(a)?a:void 0}function Ye(){this.__data__=il?il(null):{},this.size=0}function Je(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function et(e){var t=this.__data__;if(il){var a=t[e];return a===ll?void 0:a}return dl.call(t,e)?t[e]:void 0}function tt(e){var t=this.__data__;return il?t[e]!==void 0:gl.call(t,e)}function at(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=il&&void 0===t?ml:t,this}function rt(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ot(){this.size=0,this.__data__={hash:new xl,map:new(ol||Lu),string:new xl}}function nt(e){var t=typeof e;return'string'==t||'number'==t||'symbol'==t||'boolean'==t?'__proto__'!==e:null===e}function it(e,t){var a=e.__data__;return vl(t)?a['string'==typeof t?'string':'hash']:a.map}function st(e){var t=bl(this,e)['delete'](e);return this.size-=t?1:0,t}function ut(e){return bl(this,e).get(e)}function lt(e){return bl(this,e).has(e)}function pt(e,t){var a=bl(this,e),r=a.size;return a.set(e,t),this.size+=a.size==r?0:1,this}function dt(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ct(e,t){var a=this.__data__;if(a instanceof Lu){var r=a.__data__;if(!ol||r.length<kl-1)return r.push([e,t]),this.size=++a.size,this;a=this.__data__=new Cl(r)}return a.set(e,t),this.size=a.size,this}function ht(e){var t=this.__data__=new Lu(e);this.size=t.size}function gt(e){return this.__data__.set(e,Dl),this}function ft(e){return this.__data__.has(e)}function mt(e){var t=-1,a=null==e?0:e.length;for(this.__data__=new Cl;++t<a;)this.add(e[t])}function _t(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(t(e[a],a,e))return!0;return!1}function xt(e,t){return e.has(t)}function yt(e,t,a,r,o,n){var i=a&jl,s=e.length,u=t.length;if(s!=u&&!(i&&u>s))return!1;var l=n.get(e);if(l&&n.get(t))return l==t;var p=-1,d=!0,c=a&zl?new Rl:void 0;for(n.set(e,t),n.set(t,e);++p<s;){var h=e[p],g=t[p];if(r)var f=i?r(g,h,p,t,e,n):r(h,g,p,e,t,n);if(void 0!==f){if(f)continue;d=!1;break}if(c){if(!Al(t,function(e,t){if(!Ll(c,t)&&(h===e||o(h,e,a,r,n)))return c.push(t)})){d=!1;break}}else if(!(h===g||o(h,g,a,r,n))){d=!1;break}}return n['delete'](e),n['delete'](t),d}function vt(e){var t=-1,a=Array(e.size);return e.forEach(function(e,r){a[++t]=[r,e]}),a}function bt(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=e}),a}function St(e,t,a,r,o,n,i){switch(a){case tp:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ep:return e.byteLength==t.byteLength&&n(new ql(e),new ql(t));case Hl:case Wl:case Kl:return ku(+e,+t);case Xl:return e.name==t.name&&e.message==t.message;case Ql:case Yl:return e==t+'';case $l:var s=Ul;case Zl:var u=r&Bl;if(s||(s=Nl),e.size!=t.size&&!u)return!1;var l=i.get(e);if(l)return l==t;r|=Vl,i.set(e,t);var p=Gl(s(e),s(t),r,o,n,i);return i['delete'](e),p;case Jl:if(rp)return rp.call(e)==rp.call(t);}return!1}function Tt(e,t){for(var a=-1,r=t.length,o=e.length;++a<r;)e[o+a]=t[a];return e}function Pt(e,t,a){var r=t(e);return Ss(e)?r:np(r,a(e))}function wt(e,t){for(var a=-1,r=null==e?0:e.length,o=0,n=[];++a<r;){var i=e[a];t(i,a,e)&&(n[o++]=i)}return n}function Ct(){return[]}function kt(e){return ip(e,wu,hp)}function Ft(e,t,a,r,o,n){var i=a&fp,s=gp(e),u=s.length,l=gp(t),p=l.length;if(u!=p&&!i)return!1;for(var d=u,c;d--;)if(c=s[d],i?!(c in t):!_p.call(t,c))return!1;var h=n.get(e);if(h&&n.get(t))return h==t;var g=!0;n.set(e,t),n.set(t,e);for(var f=i;++d<u;){c=s[d];var m=e[c],_=t[c];if(r)var x=i?r(_,m,c,t,e,n):r(m,_,c,e,t,n);if(void 0===x?!(m===_||o(m,_,a,r,n)):!x){g=!1;break}f||(f='constructor'==c)}if(g&&!f){var y=e.constructor,v=t.constructor;y!=v&&'constructor'in e&&'constructor'in t&&!('function'==typeof y&&y instanceof y&&'function'==typeof v&&v instanceof v)&&(g=!1)}return n['delete'](e),n['delete'](t),g}function Mt(e,t,a,r,o,n){var i=Ss(e),s=Ss(t),u=i?Np:Op(e),l=s?Np:Op(t);u=u==Up?Bp:u,l=l==Up?Bp:l;var p=u==Bp,d=l==Bp,c=u==l;if(c&&Ps(e)){if(!Ps(t))return!1;i=!0,p=!1}if(c&&!p)return n||(n=new Ml),i||iu(e)?Gl(e,t,a,r,o,n):op(e,t,u,a,r,o,n);if(!(a&qp)){var h=p&&Hp.call(e,'__wrapped__'),g=d&&Hp.call(t,'__wrapped__');if(h||g){var f=h?e.value():e,m=g?t.value():t;return n||(n=new Ml),o(f,m,a,r,n)}}return!!c&&(n||(n=new Ml),xp(e,t,a,r,o,n))}function Dt(e,t,a,r,o){return!(e!==t)||(null!=e&&null!=t&&(hs(e)||hs(t))?Wp(e,t,a,r,Dt,o):e!==e&&t!==t)}function It(e,t){return Xp(e,t)}function Et(e,t){for(var a=-1,r=null==e?0:e.length,o=Array(r);++a<r;)o[a]=t(e[a],a,e);return o}function Rt(e,t,a,r){var o=a.length,n=o,i=!r;if(null==e)return!n;for(e=Object(e);o--;){var s=a[o];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<n;){s=a[o];var u=s[0],l=e[u],p=s[1];if(!(i&&s[2])){var d=new Ml;if(r)var c=r(l,p,u,e,t,d);if(void 0===c?!Xp(p,l,Qp|Zp,r,d):!c)return!1}else if(void 0===l&&!(u in e))return!1}return!0}function At(e){return e===e&&!xu(e)}function Lt(e){for(var t=wu(e),a=t.length;a--;){var r=t[a],o=e[r];t[a]=[r,o,Jp(o)]}return t}function jt(e,t){return function(a){return null!=a&&a[e]===t&&(t!==void 0||e in Object(a))}}function zt(e){var t=ed(e);return 1==t.length&&t[0][2]?td(t[0][0],t[0][1]):function(a){return a===e||Yp(a,e,t)}}function Gt(e){return'symbol'==typeof e||hs(e)&&cs(e)==rd}function Ot(e,t){if(Ss(e))return!1;var a=typeof e;return'number'==a||'symbol'==a||'boolean'==a||null==e||od(e)||id.test(e)||!nd.test(e)||null!=t&&e in Object(t)}function qt(e,t){if('function'!=typeof e||null!=t&&'function'!=typeof t)throw new TypeError(ud);var a=function(){var r=arguments,o=t?t.apply(this,r):r[0],n=a.cache;if(n.has(o))return n.get(o);var i=e.apply(this,r);return a.cache=n.set(o,i)||n,i};return a.cache=new(qt.Cache||Cl),a}function Ut(e){var t=ld(e,function(e){return a.size===pd&&a.clear(),e}),a=t.cache;return t}function Nt(e){if('string'==typeof e)return e;if(Ss(e))return Kp(e,Nt)+'';if(od(e))return xd?xd.call(e):'';var t=e+'';return'0'==t&&1/e==-md?'-0':t}function Bt(e){return null==e?'':yd(e)}function Vt(e,t){return Ss(e)?e:sd(e,t)?[e]:fd(vd(e))}function Ht(e){if('string'==typeof e||od(e))return e;var t=e+'';return'0'==t&&1/e==-Sd?'-0':t}function Wt(e,t){t=bd(t,e);for(var a=0,r=t.length;null!=e&&a<r;)e=e[Td(t[a++])];return a&&a==r?e:void 0}function Xt(e,t,a){var r=null==e?void 0:Pd(e,t);return r===void 0?a:r}function $t(e,t){return null!=e&&t in Object(e)}function Kt(e,t,a){t=bd(t,e);for(var r=-1,o=t.length,n=!1,i;++r<o&&(i=Td(t[r]),!!(n=null!=e&&a(e,i)));)e=e[i];return n||++r!=o?n:(o=null==e?0:e.length,!!o&&Ms(o)&&ks(i,o)&&(Ss(e)||vs(e)))}function Qt(e,t){return null!=e&&kd(e,t,Cd)}function Zt(e,t){return sd(e)&&Jp(t)?td(Td(e),t):function(a){var r=wd(a,e);return r===void 0&&r===t?Fd(a,e):Xp(t,r,Md|Dd)}}function Yt(e){return e}function Jt(e){return function(t){return null==t?void 0:t[e]}}function ea(e){return function(t){return Pd(t,e)}}function ta(e){return sd(e)?Rd(Td(e)):Ad(e)}function aa(e){return'function'==typeof e?e:null==e?Ed:'object'==typeof e?Ss(e)?Id(e[0],e[1]):ad(e):Ld(e)}function ra(e){return function(t,a,r){for(var o=-1,n=Object(t),i=r(t),s=i.length;s--;){var u=i[e?s:++o];if(!1===a(n[u],u,n))break}return t}}function oa(e,t){return e&&Od(e,t,wu)}function na(e,t){return function(a,r){if(null==a)return a;if(!Pu(a))return e(a,r);for(var o=a.length,n=t?o:-1,i=Object(a);(t?n--:++n<o)&&!(!1===r(i[n],n,i)););return a}}function ia(e,t){var a=-1,r=Pu(e)?Array(e.length):[];return Bd(e,function(e,o,n){r[++a]=t(e,o,n)}),r}function sa(e,t){var a=Ss(e)?Kp:Vd;return a(e,jd(t,3))}function ua(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(!t(e[a],a,e))return!1;return!0}function la(e,t){var a=!0;return Bd(e,function(e,r,o){return a=!!t(e,r,o),a}),a}function pa(e,t,a){if(!xu(a))return!1;var r=typeof t;return!('number'==r?!(Pu(a)&&ks(t,a.length)):!('string'==r&&t in a))&&ku(a[t],e)}function da(e,t,a){var r=Ss(e)?Wd:Xd;return a&&$d(e,t,a)&&(t=void 0),r(e,jd(t,3))}function ca(e){return function(t,a,r){var o=Object(t);if(!Pu(t)){var n=jd(a,3);t=wu(t),a=function(e){return n(o[e],e,o)}}var i=e(t,a,r);return-1<i?o[n?t[i]:i]:void 0}}function ha(e,t,a,r){for(var o=e.length,n=a+(r?1:-1);r?n--:++n<o;)if(t(e[n],n,e))return n;return-1}function ga(e){if('number'==typeof e)return e;if(od(e))return Yd;if(xu(e)){var t='function'==typeof e.valueOf?e.valueOf():e;e=xu(t)?t+'':t}if('string'!=typeof e)return 0===e?e:+e;e=e.replace(Jd,'');var a=tc.test(e);return a||ac.test(e)?rc(e.slice(2),a?2:8):ec.test(e)?Yd:+e}function fa(e){if(!e)return 0===e?e:0;if(e=oc(e),e===nc||e===-nc){var t=0>e?-1:1;return t*ic}return e===e?e:0}function ma(e){var t=sc(e),a=t%1;return t===t?a?t-a:t:0}function _a(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var o=null==a?0:uc(a);return 0>o&&(o=lc(r+o,0)),Zd(e,jd(t,3),o)}function xa(e,t,a){'__proto__'==t&&gc?gc(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function ya(e,t,a){var r=e[t];_c.call(e,t)&&ku(r,a)&&(a!==void 0||t in e)||fc(e,t,a)}function va(e,t,a,r){if(!xu(e))return e;t=bd(t,e);for(var o=-1,n=t.length,i=e;null!=i&&++o<n;){var s=Td(t[o]),u=a;if(o!=n-1){var l=i[s];u=r?r(l,s,i):void 0,u===void 0&&(u=xu(l)?l:ks(t[o+1])?[]:{})}xc(i,s,u),i=i[s]}return e}function ba(e,t,a){for(var r=-1,o=t.length,n={};++r<o;){var i=t[r],s=Pd(e,i);a(s,i)&&yc(n,bd(i,e),s)}return n}function Sa(e,t){return vc(e,t,function(t,a){return Fd(e,a)})}function Ta(e){return Ss(e)||vs(e)||!!(Sc&&e&&e[Sc])}function Pa(e,t,a,r,o){var n=-1,i=e.length;for(a||(a=Tc),o||(o=[]);++n<i;){var s=e[n];0<t&&a(s)?1<t?Pa(s,t-1,a,r,o):np(o,s):!r&&(o[o.length]=s)}return o}function wa(e){var t=null==e?0:e.length;return t?Pc(e,1):[]}function Ca(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2]);}return e.apply(t,a)}function ka(e,t,a){return t=kc(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,n=kc(r.length-t,0),i=Array(n);++o<n;)i[o]=r[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=r[o];return s[t]=a(i),Cc(e,this,s)}}function Fa(e){return function(){return e}}function Ma(e){var t=0,a=0;return function(){var r=Ac(),o=Rc-(r-a);if(a=r,!(0<o))t=0;else if(++t>=Ec)return arguments[0];return e.apply(void 0,arguments)}}function Da(e){return zc(Fc(e,void 0,wc),e+'')}function Ia(e){return!!e.constructor&&'function'==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Ea(e){return'function'==typeof e.readFloatLE&&'function'==typeof e.slice&&Ia(e.slice(0,0))}function Ra(e){return'[object Array]'===Vc.call(e)}function Aa(e){return'[object ArrayBuffer]'===Vc.call(e)}function La(e){return'undefined'!=typeof FormData&&e instanceof FormData}function ja(e){var t;return t='undefined'!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer,t}function za(e){return'string'==typeof e}function Ga(e){return'number'==typeof e}function Oa(e){return'undefined'==typeof e}function qa(e){return null!==e&&'object'==typeof e}function Ua(e){return'[object Date]'===Vc.call(e)}function Na(e){return'[object File]'===Vc.call(e)}function Ba(e){return'[object Blob]'===Vc.call(e)}function Va(e){return'[object Function]'===Vc.call(e)}function Ha(e){return qa(e)&&Va(e.pipe)}function Wa(e){return'undefined'!=typeof URLSearchParams&&e instanceof URLSearchParams}function Xa(e){return e.replace(/^\s*/,'').replace(/\s*$/,'')}function $a(){return'undefined'!=typeof navigator&&'ReactNative'===navigator.product?!1:'undefined'!=typeof window&&'undefined'!=typeof document}function Ka(e,t){if(null!==e&&'undefined'!=typeof e)if('object'!=typeof e&&(e=[e]),Ra(e))for(var a=0,r=e.length;a<r;a++)t.call(null,e[a],a,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function Qa(){function e(e,a){t[a]='object'==typeof t[a]&&'object'==typeof e?Qa(t[a],e):e}for(var t={},a=0,r=arguments.length;a<r;a++)Ka(arguments[a],e);return t}function Za(e,t,a){return Ka(t,function(t,r){e[r]=a&&'function'==typeof t?Nc(t,a):t}),e}function Ya(e){return encodeURIComponent(e).replace(/%40/gi,'@').replace(/%3A/gi,':').replace(/%24/g,'$').replace(/%2C/gi,',').replace(/%20/g,'+').replace(/%5B/gi,'[').replace(/%5D/gi,']')}function Ja(){this.message='String contains an invalid character'}function E(e){for(var t=e+'',a='',r=0,o=eh,n,i;t.charAt(0|r)||(o='=',r%1);a+=o.charAt(63&n>>8-8*(r%1))){if(i=t.charCodeAt(r+=3/4),255<i)throw new Ja;n=n<<8|i}return a}function er(e,t){!Hc.isUndefined(e)&&Hc.isUndefined(e['Content-Type'])&&(e['Content-Type']=t)}function tr(){var e;return'undefined'==typeof XMLHttpRequest?'undefined'!=typeof process&&(e=oh):e=oh,e}function ar(){this.handlers=[]}function rr(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function or(e){this.defaults=e,this.interceptors={request:new uh,response:new uh}}function nr(e){this.message=e}function ir(e){if('function'!=typeof e)throw new TypeError('executor must be a function.');var t;this.promise=new Promise(function(e){t=e});var a=this;e(function(e){a.reason||(a.reason=new fh(e),t(a.reason))})}function sr(e){var t=new gh(e),a=Nc(gh.prototype.request,t);return Hc.extend(a,gh.prototype,t),Hc.extend(a,t),a}function ur(e,t,a,r){for(var o=-1,n=kh(Ch((t-e)/(a||1)),0),i=Array(n);n--;)i[r?n:++o]=e,e+=a;return i}function lr(e){return function(t,a,r){return r&&'number'!=typeof r&&$d(t,a,r)&&(a=r=void 0),t=sc(t),void 0===a?(a=t,t=0):a=sc(a),r=void 0===r?t<a?1:-1:sc(r),Fh(t,a,r,e)}}function pr(e){for(var t=Array(e),a=0;a<e;++a)t[a]=a;return t}function dr(e,t){return e[0]-t[0]}function cr(){var e=this.stride,t=Array(e.length),a;for(a=0;a<t.length;++a)t[a]=[Tn(e[a]),a];t.sort(dr);var r=Array(t.length);for(a=0;a<r.length;++a)r[a]=t[a][1];return r}function hr(e,t){var a=['View',t,'d',e].join('');0>t&&(a='View_Nil'+e);var r='generic'===e;if(-1===t){var o='function '+a+'(a){this.data=a;};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new '+a+'(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_'+a+'(a){return new '+a+'(a);}',n=new Function(o);return n()}if(0===t){var o='function '+a+'(a,d) {this.data = a;this.offset = d};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function '+a+'_copy() {return new '+a+'(this.data,this.offset)};proto.pick=function '+a+'_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function '+a+'_get(){return '+(r?'this.data.get(this.offset)':'this.data[this.offset]')+'};proto.set=function '+a+'_set(v){return '+(r?'this.data.set(this.offset,v)':'this.data[this.offset]=v')+'};return function construct_'+a+'(a,b,c,d){return new '+a+'(a,d)}',n=new Function('TrivialArray',o);return n(Ah[e][0])}var o=['\'use strict\''],s=Eh(t),u=s.map(function(e){return'i'+e}),l='this.offset+'+s.map(function(e){return'this.stride['+e+']*i'+e}).join('+'),p=s.map(function(e){return'b'+e}).join(','),d=s.map(function(e){return'c'+e}).join(',');o.push('function '+a+'(a,'+p+','+d+',d){this.data=a','this.shape=['+p+']','this.stride=['+d+']','this.offset=d|0}','var proto='+a+'.prototype','proto.dtype=\''+e+'\'','proto.dimension='+t),o.push('Object.defineProperty(proto,\'size\',{get:function '+a+'_size(){return '+s.map(function(e){return'this.shape['+e+']'}).join('*'),'}})'),1===t?o.push('proto.order=[0]'):(o.push('Object.defineProperty(proto,\'order\',{get:'),4>t?(o.push('function '+a+'_order(){'),2===t?o.push('return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})'):3===t&&o.push('var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})')):o.push('ORDER})')),o.push('proto.set=function '+a+'_set('+u.join(',')+',v){'),r?o.push('return this.data.set('+l+',v)}'):o.push('return this.data['+l+']=v}'),o.push('proto.get=function '+a+'_get('+u.join(',')+'){'),r?o.push('return this.data.get('+l+')}'):o.push('return this.data['+l+']}'),o.push('proto.index=function '+a+'_index(',u.join(),'){return '+l+'}'),o.push('proto.hi=function '+a+'_hi('+u.join(',')+'){return new '+a+'(this.data,'+s.map(function(e){return['(typeof i',e,'!==\'number\'||i',e,'<0)?this.shape[',e,']:i',e,'|0'].join('')}).join(',')+','+s.map(function(e){return'this.stride['+e+']'}).join(',')+',this.offset)}');var c=s.map(function(e){return'a'+e+'=this.shape['+e+']'}),h=s.map(function(e){return'c'+e+'=this.stride['+e+']'});o.push('proto.lo=function '+a+'_lo('+u.join(',')+'){var b=this.offset,d=0,'+c.join(',')+','+h.join(','));for(var g=0;g<t;++g)o.push('if(typeof i'+g+'===\'number\'&&i'+g+'>=0){d=i'+g+'|0;b+=c'+g+'*d;a'+g+'-=d}');o.push('return new '+a+'(this.data,'+s.map(function(e){return'a'+e}).join(',')+','+s.map(function(e){return'c'+e}).join(',')+',b)}'),o.push('proto.step=function '+a+'_step('+u.join(',')+'){var '+s.map(function(e){return'a'+e+'=this.shape['+e+']'}).join(',')+','+s.map(function(e){return'b'+e+'=this.stride['+e+']'}).join(',')+',c=this.offset,d=0,ceil=Math.ceil');for(var g=0;g<t;++g)o.push('if(typeof i'+g+'===\'number\'){d=i'+g+'|0;if(d<0){c+=b'+g+'*(a'+g+'-1);a'+g+'=ceil(-a'+g+'/d)}else{a'+g+'=ceil(a'+g+'/d)}b'+g+'*=d}');o.push('return new '+a+'(this.data,'+s.map(function(e){return'a'+e}).join(',')+','+s.map(function(e){return'b'+e}).join(',')+',c)}');for(var i=Array(t),f=Array(t),g=0;g<t;++g)i[g]='a[i'+g+']',f[g]='b[i'+g+']';o.push('proto.transpose=function '+a+'_transpose('+u+'){'+u.map(function(e,t){return e+'=('+e+'===undefined?'+t+':'+e+'|0)'}).join(';'),'var a=this.shape,b=this.stride;return new '+a+'(this.data,'+i.join(',')+','+f.join(',')+',this.offset)}'),o.push('proto.pick=function '+a+'_pick('+u+'){var a=[],b=[],c=this.offset');for(var g=0;g<t;++g)o.push('if(typeof i'+g+'===\'number\'&&i'+g+'>=0){c=(c+this.stride['+g+']*i'+g+')|0}else{a.push(this.shape['+g+']);b.push(this.stride['+g+'])}');o.push('var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}'),o.push('return function construct_'+a+'(data,shape,stride,offset){return new '+a+'(data,'+s.map(function(e){return'shape['+e+']'}).join(',')+','+s.map(function(e){return'stride['+e+']'}).join(',')+',offset)}');var n=new Function('CTOR_LIST','ORDER',o.join('\n'));return n(Ah[e],cr)}function gr(e){if(Bc(e))return'buffer';if(Rh)switch(Object.prototype.toString.call(e)){case'[object Float64Array]':return'float64';case'[object Float32Array]':return'float32';case'[object Int8Array]':return'int8';case'[object Int16Array]':return'int16';case'[object Int32Array]':return'int32';case'[object Uint8Array]':return'uint8';case'[object Uint16Array]':return'uint16';case'[object Uint32Array]':return'uint32';case'[object Uint8ClampedArray]':return'uint8_clamped';}return Array.isArray(e)?'array':'generic'}function fr(e,t,a,r){if(e===void 0){var o=Ah.array[0];return o([])}'number'==typeof e&&(e=[e]);t===void 0&&(t=[e.length]);var n=t.length;if(a===void 0){a=Array(n);for(var s=n-1,i=1;0<=s;--s)a[s]=i,i*=t[s]}if(void 0===r){r=0;for(var s=0;s<n;++s)0>a[s]&&(r-=(t[s]-1)*a[s])}for(var u=gr(e),l=Ah[u];l.length<=n+1;)l.push(hr(u,l.length-1));var o=l[n+1];return o(e,t,a,r)}function mr(e,t){for(var r=1,o=e.length,n=e[0],a=e[0],s=1;s<o;++s)if(a=n,n=e[s],t(n,a)){if(s===r){r++;continue}e[r++]=n}return e.length=r,e}function _r(e){for(var t=1,r=e.length,o=e[0],a=e[0],n=1;n<r;++n,a=o)if(a=o,o=e[n],o!==a){if(n===t){t++;continue}e[t++]=o}return e.length=t,e}function xr(e,t,a){return 0===e.length?e:t?(a||e.sort(t),mr(e,t)):(a||e.sort(),_r(e))}function yr(e,t,a){var r=e.length,o=t.arrayArgs.length,n=0<t.indexArgs.length,s=[],u=[],l=0,p=0,d,i;for(d=0;d<r;++d)u.push(['i',d,'=0'].join(''));for(i=0;i<o;++i)for(d=0;d<r;++d)p=l,l=e[d],0===d?u.push(['d',i,'s',d,'=t',i,'p',l].join('')):u.push(['d',i,'s',d,'=(t',i,'p',l,'-s',p,'*t',i,'p',p,')'].join(''));for(0<u.length&&s.push('var '+u.join(',')),d=r-1;0<=d;--d)l=e[d],s.push(['for(i',d,'=0;i',d,'<s',l,';++i',d,'){'].join(''));for(s.push(a),d=0;d<r;++d){for(p=l,l=e[d],i=0;i<o;++i)s.push(['p',i,'+=d',i,'s',d].join(''));n&&(0<d&&s.push(['index[',p,']-=s',p].join('')),s.push(['++index[',l,']'].join(''))),s.push('}')}return s.join('\n')}function vr(e,t,a,r){for(var o=t.length,n=a.arrayArgs.length,s=a.blockSize,u=0<a.indexArgs.length,l=[],p=0;p<n;++p)l.push(['var offset',p,'=p',p].join(''));for(var p=e;p<o;++p)l.push(['for(var j'+p+'=SS[',t[p],']|0;j',p,'>0;){'].join('')),l.push(['if(j',p,'<',s,'){'].join('')),l.push(['s',t[p],'=j',p].join('')),l.push(['j',p,'=0'].join('')),l.push(['}else{s',t[p],'=',s].join('')),l.push(['j',p,'-=',s,'}'].join('')),u&&l.push(['index[',t[p],']=j',p].join(''));for(var p=0,i;p<n;++p){i=['offset'+p];for(var d=e;d<o;++d)i.push(['j',d,'*t',p,'p',t[d]].join(''));l.push(['p',p,'=(',i.join('+'),')'].join(''))}l.push(yr(t,a,r));for(var p=e;p<o;++p)l.push('}');return l.join('\n')}function br(e){for(var t=0,a=e[0].length;t<a;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}function Sr(e,t,a){for(var r=e.body,o=[],n=[],s=0,i;s<e.args.length;++s)if(i=e.args[s],!(0>=i.count)){var u=new RegExp(i.name,'g'),l='',p=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case'offset':var d=t.offsetArgIndex.indexOf(s),c=t.offsetArgs[d];p=c.array,l='+q'+d;case'array':l='p'+p+l;var h='l'+s,g='a'+p;if(0===t.arrayBlockIndices[p])1===i.count?'generic'===a[p]?i.lvalue?(o.push(['var ',h,'=',g,'.get(',l,')'].join('')),r=r.replace(u,h),n.push([g,'.set(',l,',',h,')'].join(''))):r=r.replace(u,[g,'.get(',l,')'].join('')):r=r.replace(u,[g,'[',l,']'].join('')):'generic'===a[p]?(o.push(['var ',h,'=',g,'.get(',l,')'].join('')),r=r.replace(u,h),i.lvalue&&n.push([g,'.set(',l,',',h,')'].join(''))):(o.push(['var ',h,'=',g,'[',l,']'].join('')),r=r.replace(u,h),i.lvalue&&n.push([g,'[',l,']=',h].join('')));else{for(var f=[i.name],m=[l],_=0;_<Tn(t.arrayBlockIndices[p]);_++)f.push('\\s*\\[([^\\]]+)\\]'),m.push('$'+(_+1)+'*t'+p+'b'+_);if(u=new RegExp(f.join(''),'g'),l=m.join('+'),'generic'===a[p])throw new Error('cwise: Generic arrays not supported in combination with blocks!');else r=r.replace(u,[g,'[',l,']'].join(''))}break;case'scalar':r=r.replace(u,'Y'+t.scalarArgs.indexOf(s));break;case'index':r=r.replace(u,'index');break;case'shape':r=r.replace(u,'shape');}}return[o.join('\n'),r,n.join('\n')].join('\n').trim()}function Tr(e){for(var a=Array(e.length),r=!0,o=0;o<e.length;++o){var n=e[o],t=n.match(/\d+/);t=t?t[0]:'',a[o]=0===n.charAt(0)?'u'+n.charAt(1)+t:n.charAt(0)+t,0<o&&(r=r&&a[o]===a[o-1])}return r?a[0]:a.join('')}function Pr(e,t){for(var a=0|t[1].length-Tn(e.arrayBlockIndices[0]),r=Array(e.arrayArgs.length),o=Array(e.arrayArgs.length),n=0;n<e.arrayArgs.length;++n)o[n]=t[2*n],r[n]=t[2*n+1];for(var i=[],s=[],u=[],l=[],p=[],n=0;n<e.arrayArgs.length;++n){0>e.arrayBlockIndices[n]?(u.push(0),l.push(a),i.push(a),s.push(a+e.arrayBlockIndices[n])):(u.push(e.arrayBlockIndices[n]),l.push(e.arrayBlockIndices[n]+a),i.push(0),s.push(e.arrayBlockIndices[n]));for(var d=[],c=0;c<r[n].length;c++)u[n]<=r[n][c]&&r[n][c]<l[n]&&d.push(r[n][c]-u[n]);p.push(d)}for(var h=['SS'],g=['\'use strict\''],m=[],c=0;c<a;++c)m.push(['s',c,'=SS[',c,']'].join(''));for(var n=0;n<e.arrayArgs.length;++n){h.push('a'+n),h.push('t'+n),h.push('p'+n);for(var c=0;c<a;++c)m.push(['t',n,'p',c,'=t',n,'[',u[n]+c,']'].join(''));for(var c=0;c<Tn(e.arrayBlockIndices[n]);++c)m.push(['t',n,'b',c,'=t',n,'[',i[n]+c,']'].join(''))}for(var n=0;n<e.scalarArgs.length;++n)h.push('Y'+n);if(0<e.shapeArgs.length&&m.push('shape=SS.slice(0)'),0<e.indexArgs.length){for(var _=Array(a),n=0;n<a;++n)_[n]='0';m.push(['index=[',_.join(','),']'].join(''))}for(var n=0;n<e.offsetArgs.length;++n){for(var x=e.offsetArgs[n],y=[],c=0;c<x.offset.length;++c)if(0===x.offset[c])continue;else 1===x.offset[c]?y.push(['t',x.array,'p',c].join('')):y.push([x.offset[c],'*t',x.array,'p',c].join(''));0===y.length?m.push('q'+n+'=0'):m.push(['q',n,'=',y.join('+')].join(''))}var v=jh([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));m=m.concat(v),0<m.length&&g.push('var '+m.join(','));for(var n=0;n<e.arrayArgs.length;++n)g.push('p'+n+'|=0');3<e.pre.body.length&&g.push(Sr(e.pre,e,o));var b=Sr(e.body,e,o),S=br(p);S<a?g.push(vr(S,p[0],e,b)):g.push(yr(p[0],e,b)),3<e.post.body.length&&g.push(Sr(e.post,e,o)),e.debug&&console.log('-----Generated cwise routine for ',t,':\n'+g.join('\n')+'\n----------');var T=[e.funcName||'unnamed','_cwise_loop_',r[0].join('s'),'m',S,Tr(o)].join(''),P=new Function(['function ',T,'(',h.join(','),'){',g.join('\n'),'} return ',T].join(''));return P()}function wr(e){var t=['\'use strict\'','var CACHED={}'],a=[],r=e.funcName+'_cwise_thunk';t.push(['return function ',r,'(',e.shimArgs.join(','),'){'].join(''));for(var o=[],n=[],s=[['array',e.arrayArgs[0],'.shape.slice(',Sn(0,e.arrayBlockIndices[0]),0>e.arrayBlockIndices[0]?','+e.arrayBlockIndices[0]+')':')'].join('')],u=[],l=[],p=0,i;p<e.arrayArgs.length;++p)i=e.arrayArgs[p],a.push(['t',i,'=array',i,'.dtype,','r',i,'=array',i,'.order'].join('')),o.push('t'+i),o.push('r'+i),n.push('t'+i),n.push('r'+i+'.join()'),s.push('array'+i+'.data'),s.push('array'+i+'.stride'),s.push('array'+i+'.offset|0'),0<p&&(u.push('array'+e.arrayArgs[0]+'.shape.length===array'+i+'.shape.length+'+(Tn(e.arrayBlockIndices[0])-Tn(e.arrayBlockIndices[p]))),l.push('array'+e.arrayArgs[0]+'.shape[shapeIndex+'+Sn(0,e.arrayBlockIndices[0])+']===array'+i+'.shape[shapeIndex+'+Sn(0,e.arrayBlockIndices[p])+']'));1<e.arrayArgs.length&&(t.push('if (!('+u.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same dimensionality!\')'),t.push('for(var shapeIndex=array'+e.arrayArgs[0]+'.shape.length-'+Tn(e.arrayBlockIndices[0])+'; shapeIndex-->0;) {'),t.push('if (!('+l.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same shape!\')'),t.push('}'));for(var p=0;p<e.scalarArgs.length;++p)s.push('scalar'+e.scalarArgs[p]);a.push(['type=[',n.join(','),'].join()'].join('')),a.push('proc=CACHED[type]'),t.push('var '+a.join(',')),t.push(['if(!proc){','CACHED[type]=proc=compile([',o.join(','),'])}','return proc(',s.join(','),')}'].join('')),e.debug&&console.log('-----Generated thunk:\n'+t.join('\n')+'\n----------');var d=new Function('compile',t.join('\n'));return d(zh.bind(void 0,e))}function Cr(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName='',this.pre=null,this.body=null,this.post=null,this.debug=!1}function kr(e){var t=new Cr;t.pre=e.pre,t.body=e.body,t.post=e.post;var a=e.args.slice(0);t.argTypes=a;for(var r=0,o;r<a.length;++r)if(o=a[r],'array'===o||'object'==typeof o&&o.blockIndices){if(t.argTypes[r]='array',t.arrayArgs.push(r),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push('array'+r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array args');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array args')}else if('scalar'===o)t.scalarArgs.push(r),t.shimArgs.push('scalar'+r);else if('index'===o){if(t.indexArgs.push(r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array index');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array index');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array index')}else if('shape'===o){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error('cwise: pre() block may not write to array shape');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array shape');if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error('cwise: post() block may not write to array shape')}else if('object'==typeof o&&o.offset)t.argTypes[r]='offset',t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(r);else throw new Error('cwise: Unknown argument type '+a[r]);if(0>=t.arrayArgs.length)throw new Error('cwise: No array arguments specified');if(t.pre.args.length>a.length)throw new Error('cwise: Too many arguments in pre() block');if(t.body.args.length>a.length)throw new Error('cwise: Too many arguments in body() block');if(t.post.args.length>a.length)throw new Error('cwise: Too many arguments in post() block');return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||'cwise',t.blockSize=e.blockSize||64,Gh(t)}function Fr(e,t){var a=[],r=[],o;if(t!==void 0&&!Array.isArray(t))throw new Error('axes must be an Array list of dimensions to squeeze');for(o=0;o<e.shape.length;o++)(1!==e.shape[o]||void 0!==t&&-1===t.indexOf(o))&&(a.push(e.shape[o]),r.push(e.stride[o]));return Lh(e.data,a,r,e.offset)}function Mr(e,t,a){this.name=e,this.lvalue=t,this.rvalue=a,this.count=0}function Dr(e,t,a,r){this.body=e,this.args=t,this.thisVars=a,this.localVars=r}function Ir(e){if('eval'===e)throw new Error('cwise-parser: eval() not allowed');return'undefined'==typeof window?'undefined'==typeof Wi?'undefined'!=typeof self&&e in self:e in Wi:e in window}function Er(e){for(var t=e.body[0].expression.callee.params,a=Array(t.length),r=0;r<t.length;++r)a[r]=t[r].name;return a}function Rr(e){function t(e){var t=p+e.replace(/\_/g,'__');return n.push(t),t}function a(e){var t='this_'+e.replace(/\_/g,'__');return f.push(t),t}function r(e,t){for(var a=e.range[0],r=e.range[1],o=a+1;o<r;++o)g[o]='';g[a]=t}function o(e){return'\''+e.replace(/\_/g,'\\_').replace(/\'/g,'\'')+'\''}function s(e){return'AssignmentExpression'===e.parent.type&&e.parent.left===e?'='===e.parent.operator?m:m|_:'UpdateExpression'===e.parent.type?m|_:_}for(var u=['(',e,')()'].join(''),l=Wh.parse(u,{range:!0}),p='_inline_'+Xh++ +'_',d=Er(l),c=Array(d.length),h=0;h<d.length;++h)c[h]=new Mr([p,'arg',h,'_'].join(''),!1,!1);for(var g=Array(u.length),h=0,i=u.length;h<i;++h)g[h]=u.charAt(h);var n=[],f=[],m=1,_=2;(function e(u,l){if(u.parent=l,'MemberExpression'===u.type)u.computed?(e(u.object,u),e(u.property,u)):'ThisExpression'===u.object.type?r(u,a(u.property.name)):e(u.object,u);else if('ThisExpression'===u.type)throw new Error('cwise-parser: Computed this is not allowed');else if('Identifier'===u.type){var p=u.name,h=d.indexOf(p);if(0<=h){var g=c[h],f=s(u);f&m&&(g.lvalue=!0),f&_&&(g.rvalue=!0),++g.count,r(u,g.name)}else if(Ir(p));else r(u,t(p))}else if('Literal'===u.type)'string'==typeof u.value&&r(u,o(u.value));else if('WithStatement'===u.type)throw new Error('cwise-parser: with() statements not allowed');else for(var x=Object.keys(u),y=0,i=x.length;y<i;++y)if('parent'!==x[y]){var n=u[x[y]];if(n)if(n instanceof Array)for(var v=0;v<n.length;++v)n[v]&&'string'==typeof n[v].type&&e(n[v],u);else'string'==typeof n.type&&e(n,u)}})(l.body[0].expression.callee.body,void 0),jh(n),jh(f);var x=new Dr(function(e){return g.slice(e.range[0],e.range[1]).join('')}(l.body[0].expression.callee.body),c,f,n);return x}function Ar(e){for(var t in e)0>Kh.indexOf(t)&&0>Qh.indexOf(t)&&console.warn('cwise: Unknown argument \''+t+'\' passed to expression compiler');for(var a=0;a<Kh.length;++a)if(!e[Kh[a]])throw new Error('cwise: Missing argument: '+Kh[a]);return Oh({args:e.args,pre:$h(e.pre||function(){}),body:$h(e.body),post:$h(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||'cwise',blockSize:e.blockSize||64})}function Lr(e,t,a){var r=-1,o=e.length;0>t&&(t=-t>o?0:o+t),a=a>o?o:a,0>a&&(a+=o),o=t>a?0:a-t>>>0,t>>>=0;for(var n=Array(o);++r<o;)n[r]=e[r+t];return n}function jr(e,t,a){return e&&e.length?(t=a||void 0===t?1:uc(t),fg(e,0,0>t?0:t)):[]}function zr(e,t){for(var a=-1,r=e.length,o;++a<r;){var n=t(e[a]);n!==void 0&&(o=o==void 0?n:o+n)}return o}function Gr(e){return e&&e.length?_g(e,Ed):0}function Or(e,t){return'native'===t[1]?[e,'d0=',e,'.length,',e,'d1=',e,'[0].length,'].join(''):[e,'d0=',e,'.shape[0],',e,'d1=',e,'.shape[1],',e,'s0=',e,'.stride[0],',e,'s1=',e,'.stride[1],',e,'o=',e,'.offset,',e,'d=',e,'.data,'].join('')}function qr(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]&&(r?i.push('var ',t,'p=',t,'[',r,'];'):i.push('var ',t,'p=',t,'[0];')):r&&o?n?i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',n,',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):r?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0;'):o?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',t,'d',e[0],',',t,'p=',t,'o;'),i}function Ur(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]&&1===r&&n.push(t,'p=',t,'[',o,'+1]'):n.push(t,'p+=',t,'t',r,';'),n}function Nr(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]?i.push(t,'p[',o,']=',n,';'):i.push(t,'[',r,'][',o,']=',n,';'):'generic'===a[1]?i.push(t,'d.set(',t,'p,',n,');'):i.push(t,'d[',t,'p]=',n,';'),i}function Br(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]?n.push(t,'p[',o,']'):n.push(t,'[',r,'][',o,']'):'generic'===a[1]?n.push(t,'d.get(',t,'p)'):n.push(t,'d[',t,'p]'),n.join('')}function Vr(e,t,a,r,o){var n=[],i='r'===e[0]?[1,0]:[0,1],s=[1,0],u=[0,1],l=['i','j'];return n.push.apply(n,qr(i,'o',e)),i[1]?(n.push('for(j=0;j<od1;++j){'),n.push('for(i=0;i<od0;++i){')):(n.push('for(i=0;i<od0;++i){'),n.push('for(j=0;j<od1;++j){')),n.push.apply(n,qr(s,'a',t,'i')),n.push.apply(n,qr(u,'b',a,void 0,'j')),n.push('var r=0.0;','for(k=0;k<ad1;++k){','r+=',Br(s,'a',t,'i','k'),'*',Br(u,'b',a,'k','j'),';'),n.push.apply(n,Ur(s,'a',t,0,'k')),n.push.apply(n,Ur(u,'b',a,0,'k')),n.push('}'),r&&n.push('r*=A;'),o&&n.push('r+=B*',Br(i,'o',e,'i','j'),';'),n.push.apply(n,Nr(i,'o',e,'i','j','r')),n.push.apply(n,Ur(i,'o',e,0,l[1])),n.push('}'),n.push.apply(n,Ur(i,'o',e,1,l[0])),n.push('}'),n}function Hr(e,t){var a=[],r='r'===e[0]?[1,0]:[0,1],o;return t&&a.push('if(B!==1.0){'),a.push.apply(a,qr(r,'o',e)),r[0]?(a.push('for(i=0;i<od0;++i){for(j=0;j<od1;++j){'),o=['i','j']):(a.push('for(j=0;j<od1;++j){for(i=0;i<od0;++i){'),o=['j','i']),t?a.push.apply(a,Nr(r,'o',e,'i','j','B*'+Br(r,'o',e,'i','j'))):a.push.apply(a,Nr(r,'o',e,'i','j','0')),a.push.apply(a,Ur(r,'o',e,0,o[1])),a.push('}'),a.push.apply(a,Ur(r,'o',e,1,o[0])),a.push('}'),t&&a.push('}'),a}function Wr(e,t,a,r,o){var n=[],s=['od0','od1','ad1'],u=[1,0],l=[1,0],p=[0,1];n.push.apply(n,Hr(e,o));for(var d=0;3>d;++d)n.push('for(var i',d,'=',s[d],';i',d,'>0;){','var w',d,'=',Mg,';','if(i',d,'<',Mg,'){','w',d,'=i',d,';','i',d,'=0;','}else{','i',d,'-=',Mg,';','}');n.push.apply(n,qr(u,'o',e,'i0','i1','w1')),n.push('for(i=0;i<w0;++i){for(j=0;j<w1;++j){var r=0.0;'),n.push.apply(n,qr(l,'a',t,'(i0+i)','i2')),n.push.apply(n,qr(p,'b',a,'i2','(i1+j)')),n.push('for(k=0;k<w2;++k){'),n.push('r+=',Br(l,'a',t,'(i0+i)','(i2+k)'),'*',Br(p,'b',a,'(i2+k)','(i1+j)'),';'),n.push.apply(n,Ur(l,'a',t,0,'(i2+k)')),n.push.apply(n,Ur(p,'b',a,0,'(i2+k)')),n.push('}');var i='r';return r&&(i='A*r'),n.push.apply(n,Nr(u,'o',e,'(i0+i)','(i1+j)',i+'+'+Br(u,'o',e,'(i0+i)','(i1+j)'))),n.push.apply(n,Ur(u,'o',e,0,'(i1+j)')),n.push('}'),n.push.apply(n,Ur(u,'o',e,1,'(i0+i)')),n.push('}}}}'),n}function Xr(e,t,a,r,o){var n=['gemm',e[0],e[1],'a',t[0],t[1],'b',a[0],a[1],r?'alpha':'',o?'beta':''].join(''),i=['function ',n,'(o,a,b,A,B){','var ',Or('o',e),Or('a',t),Or('b',a),'i,j,k;'];'r'===t[0]&&'c'===a[0]?i.push.apply(i,Vr(e,t,a,r,o)):i.push.apply(i,Wr(e,t,a,r,o)),i.push('}return ',n);var s=new Function(i.join(''));return s()}function $r(e){return Array.isArray(e)?[e.length,e[0].length]:e.shape}function Kr(e,t,a){var r=$r(e),o=$r(t),n=$r(a);if(r[0]!==o[0]||r[1]!==n[1]||o[1]!==n[0])throw new Error('Mismatched array shapes for matrix product')}function Qr(e){if(Array.isArray(e)){if(Array.isArray(e))return['r','native'];}else if(e.shape&&2===e.shape.length)return e.order[0]?['r',e.dtype]:['c',e.dtype];throw new Error('Unrecognized data type')}function Zr(e,t,a,r,o){void 0===r&&(r=1),void 0===o&&(o=0);var n=1!==r,i=0!==o,s=Qr(e),u=Qr(t),l=Qr(a);Kr(e,t,a);var p=[s,u,l,n,i].join(':'),d=Ig[p];return d||(d=Ig[p]=Fg(s,u,l,n,i)),d(e,t,a,r,o)}function Yr(e,t){var a,r;if(void 0!==t&&(!Number.isFinite(t)||t%1!==t))throw new Error('axis of dimension to unsqueeze must be an integer');return t=void 0===t?e.shape.length:t,a=e.shape.slice(0),r=e.stride.slice(0),a.splice(t||0,0,1),r.splice(t||0,0,(r[t]||1)*(a[t+1]||1)),Lh(e.data,a,r,e.offset)}function Jr(e,t,a,r,o){for(var n=_f.dot,s=t.shape[0]-1;0<=s;s--)o.set(s,o.get(s)*r+e*n(t.pick(s,null),a));return!0}function eo(e,t,a,o,s,u,l){for(var p=0,r=0,i=0,d=0,c=0,h=e.shape[0],g=e.shape[1],n=bn(t,h-1),f=bn(a,g-1),m=void 0===u?1:u,_=void 0===l?0:l;p<=n;){d=0;var x=bn(p+f,g-1);for(i=0;i<=x;i++)d+=e.get(p,i)*o.get(i);s.set(p,d*m+_*s.get(p)),p++}if(p<h)for(r=0;p+f<g;){for(d=0,i=0;i<=n+f;i++)c=r+i+1,d+=e.get(p,c)*o.get(c);if(s.set(p,d*m+_*s.get(p)),p++,r++,p===h)break}if(p<h)for(r++;p-n<g;){for(d=0,i=r;i<g;i++)d+=e.get(p,i)*o.get(i);if(s.set(p,d*m+_*s.get(p)),p++,r++,p===h)break}return!0}function to(e,t,a,r,o,s){var u=e.shape[0],n=r||!0,l=o===void 0?1:o,p=s===void 0?0:s,d=0,i=0,c=0,h=0;if(0===p)for(d=0;d<a.shape[0];++d)a.set(d,0);else 1!==p&&_f.scal(p,a);if(0===l)return!0;if(1===l){if(n)for(i=0;i<u;++i){for(c=t.get(i),h=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<u;++d)a.set(d,a.get(d)+c*e.get(d,i)),h+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+h)}else for(i=0;i<u;++i){for(c=t.get(i),h=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),h+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+h)}}else if(n)for(i=0;i<u;++i){for(c=l*t.get(i),h=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<u;++d)a.set(d,a.get(d)+c*e.get(d,i)),h+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+l*h)}else for(i=0;i<u;++i){for(c=l*t.get(i),h=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),h+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+l*h)}return!0}function ao(){console.error('SBMV (symmetric banded matrix vector multiply) not yet implemented')}function ro(e,t,a){var r=_f.dot,o=e.shape[1],n=0;if(a)for(n=o-1;0<=n;n--)t.set(n,r(e.pick(n,null).hi(n+1),t.hi(n+1)));else for(n=0;n<o;n++)t.set(n,r(e.pick(n,null).lo(n),t.lo(n)));return!0}function oo(){console.error('TBMV (triangular banded matrix vector multiply) not yet implemented')}function no(e,t,a){var r=_f.dot,o=e.shape[1],n=0;if(a)for(t.set(0,t.get(0)/e.get(0,0)),n=1;n<o;n++)t.set(n,(t.get(n)-r(e.pick(n,null).hi(n),t.hi(n)))/e.get(n,n));else for(t.set(o-1,t.get(o-1)/e.get(o-1,o-1)),n=o-2;0<=n;n--)t.set(n,(t.get(n)-r(e.pick(n,null).lo(n+1),t.lo(n+1)))/e.get(n,n));return!0}function io(){console.error('TPSV (triangular packed matrix solver) not yet implemented')}function so(){console.error('GER (rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function uo(){console.error('SYR (symmetric rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function lo(){console.error('SPR (symmetric packed rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function po(){console.error('SYR (symmetric rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function co(){console.error('SPR (symmetric packed rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function ho(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function go(e){var t=32;return e&=-e,e&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function fo(e,t,a){var r=0|e[a];if(0>=r)return[];var o=Array(r),n;if(a===e.length-1)for(n=0;n<r;++n)o[n]=t;else for(n=0;n<r;++n)o[n]=fo(e,t,a+1);return o}function mo(e,t){var a,r;for(a=Array(e),r=0;r<e;++r)a[r]=t;return a}function _o(e,t){switch('undefined'==typeof t&&(t=0),typeof e){case'number':if(0<e)return mo(0|e,t);break;case'object':if('number'==typeof e.length)return fo(e,t,0);}return[]}function xo(e){var t=e.dtype;('generic'===t||'array'===t)&&(t='double');var a=fm.malloc(e.size,t),r=Lh(a,e.shape);return qh.assign(r,e),r}function yo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];return Lh(fm.malloc(a,t),e,r,0)}function vo(e){'generic'===e.dtype||'array'===e.dtype||fm.free(e.data)}function bo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=fm.malloc(a,t),o=0;o<a;++o)n[o]=0;return Lh(n,e,r,0)}function So(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=fm.malloc(a,t),o=0;o<a;++o)n[o]=1;return Lh(n,e,r,0)}function To(e,t){var a,r;t||(t='double');var o=1,n=Array(e.length);for(a=e.length-1;0<=a;--a)n[a]=o,o*=e[a];var i=fm.malloc(o,t);for(a=0;a<o;++a)i[a]=0;var s=Infinity,u=0;for(a=e.length-1;0<=a;a--)u+=n[a],s=bn(s,e[a]);for(a=0,r=0;a<s;a++,r+=u)i[r]=1;return Lh(i,e,n,0)}function Po(){var e,t,a,r;if(2===arguments.length?(t=arguments[0],r=arguments[1]):3===arguments.length&&(a=arguments[0],t=arguments[1],r=arguments[2]),!Array.isArray(r))throw new Error('second argument of tile must be an array of repetition counts for each dimension');var o=t.shape.slice(0),n=o.slice(0),i=Sn(n.length,r.length);for(e=0;e<i;e++)if(o[e]=void 0===o[e]?1:o[e],r[e]=void 0===r[e]?1:r[e],n[e]=(void 0===n[e]?1:n[e])*r[e],0===n[e])throw new Error('Number of tiles must be greater than zero');a||(a=Sm.zeros(n,t.dtype));var s=1;for(e=0;e<r.length;e++)s*=r[e];var u=Array(r.length);for(e=0;e<r.length;e++)u[e]=0;var l=n.slice(0);for(c=0;c<n.length;c++)l[c]=c<t.dimension?null:0;for(e=0;e<s;e++){for(c=t.dimension;c<n.length;c++)l[c]=u[c];var p=a.pick.apply(a,l);if(p=p.lo.apply(p,u),p=p.hi.apply(p,t.shape),qh.assign(p,t),e===s-1)break;for(var c=i-1;0<=c&&(u[c]+=o[c],u[c]===n[c]);)u[c]=0,c--}return a}function wo(e,t){if(!t||'object'!=typeof t)return e;for(var a=Object.keys(t),r=a.length;r--;)e[a[r]]=t[a[r]];return e}function Co(){var e,t,a,r,o,n,i,s,u,l;if(r=Lm({},zm),0===arguments.length)throw new Error('Array of ndarrays to concatenate must not be empty');if(Array.isArray(arguments[0])?(a=arguments[0],Lm(r,arguments[1]||{})):2===arguments.length&&(a=arguments[1],e=arguments[0],Lm(r,arguments[2]||{})),0===a.length)throw new Error('Array of ndarrays to concatenate must not be empty');for(o=0;o<a.length;o++)if(!i)i=a[o].shape.slice(0);else{if(a[o].dimension!==i.length)throw new Error('all arrays must have the same dimensionality');for(n=1;n<a[o].shape.length;n++)if(a[o].shape[n]!==i[n])throw new Error('last n-1 dimensions of concatenated rows must have the same size');i[0]+=a[o].shape[0]}if(!e)e=Sm.zeros(i,r.dtype);else if(i[0]!==e.shape[0])throw new Error('first dimension of output array must match the total number of concatenated rows');for(n=0,s=0;n<a.length;n++)t=a[n],u=t.shape[0],l=e.lo(s).hi(u),qh.assign(l,t),s+=u;return e}function ko(e,t){for(var a=Array(arguments.length-1),r=0,o=2,n=!0;o<arguments.length;)a[r++]=arguments[o++];return new Promise(function(o,i){a[r]=function(e){if(n)if(n=!1,e)i(e);else{for(var t=Array(arguments.length-1),a=0;a<t.length;)t[a++]=arguments[a];o.apply(null,t)}};try{e.apply(t||null,a)}catch(e){n&&(n=!1,i(e))}})}function Fo(){this._listeners={}}function Mo(e){var t=Math.LN2;return'undefined'==typeof Float32Array?function(){function a(e,a,r,o){var n=0>a?1:0;if(n&&(a=-a),0===a)e(0<1/a?0:2147483648,r,o);else if(isNaN(a))e(2143289344,r,o);else if(3.4028234663852886e38<a)e((2139095040|n<<31)>>>0,r,o);else if(1.1754943508222875e-38>a)e((n<<31|vn(a/1.401298464324817e-45))>>>0,r,o);else{var i=fn(mn(a)/t),s=8388607&vn(8388608*(a*wn(2,-i)));e((n<<31|i+127<<23|s)>>>0,r,o)}}function r(e,t,a){var r=e(t,a),o=2*(r>>31)+1,n=255&r>>>23,i=8388607&r;return 255==n?i?NaN:o*Infinity:0==n?1.401298464324817e-45*o*i:o*wn(2,n-150)*(i+8388608)}e.writeFloatLE=a.bind(null,Do),e.writeFloatBE=a.bind(null,Io),e.readFloatLE=r.bind(null,Eo),e.readFloatBE=r.bind(null,Ro)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3]}function a(e,t,a){n[0]=e,t[a]=i[3],t[a+1]=i[2],t[a+2]=i[1],t[a+3]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n[0]}function o(e,t){return i[3]=e[t],i[2]=e[t+1],i[1]=e[t+2],i[0]=e[t+3],n[0]}var n=new Float32Array([0]),i=new Uint8Array(n.buffer),s=128===i[3];e.writeFloatLE=s?t:a,e.writeFloatBE=s?a:t,e.readFloatLE=s?r:o,e.readFloatBE=s?o:r}(),'undefined'==typeof Float64Array?function(){function a(e,a,r,o,n,i){var s=0>o?1:0;if(s&&(o=-o),0===o)e(0,n,i+a),e(0<1/o?0:2147483648,n,i+r);else if(isNaN(o))e(0,n,i+a),e(2146959360,n,i+r);else if(1.7976931348623157e308<o)e(0,n,i+a),e((2146435072|s<<31)>>>0,n,i+r);else{var u;if(2.2250738585072014e-308>o)u=o/5e-324,e(u>>>0,n,i+a),e((s<<31|u/4294967296)>>>0,n,i+r);else{var l=fn(mn(o)/t);1024===l&&(l=1023),u=o*wn(2,-l),e(4503599627370496*u>>>0,n,i+a),e((s<<31|l+1023<<20|1048575&1048576*u)>>>0,n,i+r)}}}function r(e,t,a,r,o){var n=e(r,o+t),i=e(r,o+a),s=2*(i>>31)+1,u=2047&i>>>20,l=4294967296*(1048575&i)+n;return 2047==u?l?NaN:s*Infinity:0==u?5e-324*s*l:s*wn(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=a.bind(null,Do,0,4),e.writeDoubleBE=a.bind(null,Io,4,0),e.readDoubleLE=r.bind(null,Eo,0,4),e.readDoubleBE=r.bind(null,Ro,4,0)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3],t[a+4]=i[4],t[a+5]=i[5],t[a+6]=i[6],t[a+7]=i[7]}function a(e,t,a){n[0]=e,t[a]=i[7],t[a+1]=i[6],t[a+2]=i[5],t[a+3]=i[4],t[a+4]=i[3],t[a+5]=i[2],t[a+6]=i[1],t[a+7]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i[4]=e[t+4],i[5]=e[t+5],i[6]=e[t+6],i[7]=e[t+7],n[0]}function o(e,t){return i[7]=e[t],i[6]=e[t+1],i[5]=e[t+2],i[4]=e[t+3],i[3]=e[t+4],i[2]=e[t+5],i[1]=e[t+6],i[0]=e[t+7],n[0]}var n=new Float64Array([0]),i=new Uint8Array(n.buffer),s=128===i[7];e.writeDoubleLE=s?t:a,e.writeDoubleBE=s?a:t,e.readDoubleLE=s?r:o,e.readDoubleBE=s?o:r}(),e}function Do(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function Io(e,t,a){t[a]=e>>>24,t[a+1]=255&e>>>16,t[a+2]=255&e>>>8,t[a+3]=255&e}function Eo(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Ro(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Ao(e){try{var t=eval('quire'.replace(/^/,'re'))(e);if(t&&(t.length||Object.keys(t).length))return t}catch(t){}return null}function Lo(e,t,a){var r=a||8192,o=null,n=r;return function(a){if(1>a||a>r>>>1)return e(a);n+a>r&&(o=e(r),n=0);var i=t.call(o,n,n+=a);return 7&n&&(n=(7|n)+1),i}}function jo(e,t){this.lo=e>>>0,this.hi=t>>>0}function zo(e,t,a){this.fn=e,this.len=t,this.next=void 0,this.val=a}function Go(){}function Oo(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function qo(){this.len=0,this.head=new zo(Go,0,0),this.tail=this.head,this.states=null}function Uo(e,t,a){t[a]=255&e}function No(e,t,a){for(;127<e;)t[a++]=128|127&e,e>>>=7;t[a]=e}function Bo(e,t){this.len=e,this.next=void 0,this.val=t}function Vo(e,t,a){for(;e.hi;)t[a++]=128|127&e.lo,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[a++]=128|127&e.lo,e.lo>>>=7;t[a++]=e.lo}function Ho(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function Wo(){R_.call(this)}function Xo(e,t,a){40>e.length?E_.utf8.write(e,t,a):t.utf8Write(e,a)}function $o(e,t){return RangeError('index out of range: '+e.pos+' + '+(t||1)+' > '+e.len)}function Ko(e){this.buf=e,this.pos=0,this.len=e.length}function Qo(){var e=new B_(0,0),t=0;if(4<this.len-this.pos){for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;t=0}else{for(;3>t;++t){if(this.pos>=this.len)throw $o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e;}else for(;5>t;++t){if(this.pos>=this.len)throw $o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error('invalid varint encoding')}function Zo(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Yo(){if(this.pos+8>this.len)throw $o(this,8);return new B_(Zo(this.buf,this.pos+=4),Zo(this.buf,this.pos+=4))}function Jo(e){N_.call(this,e)}function en(e,t,a){if('function'!=typeof e)throw TypeError('rpcImpl must be a function');E_.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!a}function tn(e){return'number'==typeof e&&ox(e)}function an(e){var t=null==e?0:e.length;return t?Pc(e,ix):[]}function rn(e,t){var a=function(e,t,a){return e+(t-e)*a},r=[],o=new Number((e.length-1)/(t-1));r[0]=e[0];for(var n=1;n<t-1;n++){var i=n*o,s=new Number(fn(i)).toFixed(),u=new Number(yn(i)).toFixed();r[n]=a(e[s],e[u],i-s)}return r[t-1]=e[e.length-1],r}function on(e){var t=e.reduce((e,t)=>e+t*t,0),a=Pn(t);return e.map((e)=>e/a)}function nn(t){return hx(this,void 0,void 0,function*(){200>t.values.length&&console.warn('Pattern detector requires atleast 250 data for a reliable prediction, received just ',t.values.length),yield mx.ready(),Rn.reverseInputs(t);var a=t.values,r=on(rn(a,400));let o=yield mx.predict({input:new Float32Array(r)});var n=o.output.indexOf(Sn(...o.output));return Rn.reverseInputs(t),{pattern:e.AvailablePatterns[n],patternId:n,probability:100*o.output[n]}})}function sn(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.DB&&75<a.probability})}function un(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.DT&&75<a.probability})}function ln(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.HS&&75<a.probability})}function pn(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.IHS&&75<a.probability})}function dn(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.TU&&75<a.probability})}function cn(t){return hx(this,void 0,void 0,function*(){var a=yield nn(t);return a.patternId===e.AvailablePatterns.TD&&75<a.probability})}function hn(){return['sma','ema','wma','wema','macd','rsi','bollingerbands','adx','atr','truerange','roc','kst','psar','stochastic','williamsr','adl','obv','trix','cci','awesomeoscillator','forceindex','vwap','volumeprofile','renko','heikinashi','stochasticrsi','mfi','averagegain','averageloss','highest','lowest','sum','FixedSizeLinkedList','sd','bullish','bearish','abandonedbaby','doji','bearishengulfingpattern','bullishengulfingpattern','darkcloudcover','downsidetasukigap','dragonflydoji','gravestonedoji','bullishharami','bearishharami','bullishharamicross','bearishharamicross','eveningdojistar','eveningstar','morningdojistar','morningstar','bullishmarubozu','bearishmarubozu','piercingline','bullishspinningtop','bearishspinningtop','threeblackcrows','threewhitesoldiers','bullishhammerstick','bearishhammerstick','bullishinvertedhammerstick','bearishinvertedhammerstick','hammerpattern','hammerpatternunconfirmed','hangingman','hangingmanunconfirmed','shootingstar','shootingstarunconfirmed','predictPattern','hasDoubleBottom','hasDoubleTop','hasHeadAndShoulder','hasInverseHeadAndShoulder','isTrendingUp','isTrendingDown']}var gn=Math.sign,fn=Math.floor,mn=Math.log,_n=Math.exp,xn=String.fromCharCode,yn=Math.ceil,vn=Math.round,bn=Math.min,Sn=Math.max,Tn=Math.abs,Pn=Math.sqrt,wn=Math.pow;t='default'in t?t['default']:t;class Cn{constructor(e,t,a){this.next=a,a&&(a.prev=this),this.prev=t,t&&(t.next=this),this.data=e}}class kn{constructor(){this._length=0}get head(){return this._head&&this._head.data}get tail(){return this._tail&&this._tail.data}get current(){return this._current&&this._current.data}get length(){return this._length}push(e){this._tail=new Cn(e,this._tail),0===this._length&&(this._head=this._tail,this._current=this._head,this._next=this._head),this._length++}pop(){var e=this._tail;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._tail=e.prev,this._tail.next=void 0,this._current===e&&(this._current=this._tail,this._next=void 0),e.data)}shift(){var e=this._head;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._head=this._head.next,this._current===e&&(this._current=this._head,this._next=this._current.next),e.data)}unshift(e){this._head=new Cn(e,void 0,this._head),0===this._length&&(this._tail=this._head,this._next=this._head),this._length++}unshiftCurrent(){var e=this._current;return e===this._head||2>this._length?e&&e.data:(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.next=this._head,e.prev=void 0,this._head.prev=e,this._head=e,e.data)}removeCurrent(){var e=this._current;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):e===this._head?(this._head=e.next,this._head.prev=void 0,this._current=this._head):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.data)}resetCursor(){return this._current=this._next=this._head,this}next(){var e=this._next;if(void 0!==e)return this._next=e.next,this._current=e,e.data}}class Fn extends kn{constructor(e,t,a,r){if(super(),this.size=e,this.maintainHigh=t,this.maintainLow=a,this.maintainSum=r,this.totalPushed=0,this.periodHigh=0,this.periodLow=Infinity,this.periodSum=0,!e||'number'!=typeof e)throw'Size required and should be a number.';this._push=this.push,this.push=function(e){this.add(e),this.totalPushed++}}add(e){this.length===this.size?(this.lastShift=this.shift(),this._push(e),this.maintainHigh&&this.lastShift==this.periodHigh&&this.calculatePeriodHigh(),this.maintainLow&&this.lastShift==this.periodLow&&this.calculatePeriodLow(),this.maintainSum&&(this.periodSum-=this.lastShift)):this._push(e),this.maintainHigh&&this.periodHigh<=e&&(this.periodHigh=e),this.maintainLow&&this.periodLow>=e&&(this.periodLow=e),this.maintainSum&&(this.periodSum+=e)}*iterator(){for(this.resetCursor();this.next();)yield this.current}calculatePeriodHigh(){for(this.resetCursor(),this.next()&&(this.periodHigh=this.current);this.next();)this.periodHigh<=this.current&&(this.periodHigh=this.current)}calculatePeriodLow(){for(this.resetCursor(),this.next()&&(this.periodLow=this.current);this.next();)this.periodLow>=this.current&&(this.periodLow=this.current)}}class Mn{}class Dn{constructor(){this.open=[],this.high=[],this.low=[],this.close=[],this.volume=[],this.timestamp=[]}}let In={};class En{}class Rn{constructor(e){this.format=e.format||o}static reverseInputs(e){e.reversedInput&&(e.values?e.values.reverse():void 0,e.open?e.open.reverse():void 0,e.high?e.high.reverse():void 0,e.low?e.low.reverse():void 0,e.close?e.close.reverse():void 0,e.volume?e.volume.reverse():void 0,e.timestamp?e.timestamp.reverse():void 0)}getResult(){return this.result}}class An extends Rn{constructor(e){super(e),this.period=e.period,this.price=e.values;this.generator=function*(e){var t=new kn,a=0,r=1,o=yield,n;for(t.push(0);;)r<e?(r++,t.push(o),a+=o):(a=a-t.shift()+o,n=a/e,t.push(o)),o=yield n}(this.period),this.generator.next(),this.result=[],this.price.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}An.calculate=n;class Ln extends Rn{constructor(e){super(e);var t=e.period,a=e.values,r;this.result=[],r=new An({period:t,values:[]});this.generator=function*(){for(var e=yield,a;;)void 0!=a&&void 0!==e?(a=(e-a)*(2/(t+1))+a,e=yield a):(e=yield,a=r.nextValue(e),a&&(e=yield a))}(),this.generator.next(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}Ln.calculate=i;class jn extends Rn{constructor(e){super(e);var t=e.period,a=e.values;this.result=[],this.generator=function*(){for(let a=new kn;;)if(a.length<t)a.push((yield));else{a.resetCursor();let r=0;for(let e=1;e<=t;e++)r+=a.next()*e/(t*(t+1)/2);var e=yield r;a.shift(),a.push(e)}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}jn.calculate=s;class zn extends Rn{constructor(e){super(e);var t=e.period,a=e.values,r;this.result=[],r=new An({period:t,values:[]});this.generator=function*(){for(var e=yield,a;;)void 0!=a&&void 0!==e?(a=(e-a)*(1/t)+a,e=yield a):(e=yield,a=r.nextValue(e),void 0!==a&&(e=yield a))}(),this.generator.next(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}zn.calculate=u;class Gn extends Rn{constructor(e){super(e);var t=e.SimpleMAOscillator?An:Ln,a=e.SimpleMASignal?An:Ln,r=new t({period:e.fastPeriod,values:[],format:(e)=>e}),o=new t({period:e.slowPeriod,values:[],format:(e)=>e}),n=new a({period:e.signalPeriod,values:[],format:(e)=>e}),i=this.format;this.result=[],this.generator=function*(){for(var t=0,a,s,u,l,p,d;;){if(t<e.slowPeriod){a=yield,p=r.nextValue(a),d=o.nextValue(a),t++;continue}p&&d&&(s=p-d,u=n.nextValue(s)),l=s-u,a=yield{MACD:i(s),signal:u?i(u):void 0,histogram:isNaN(l)?void 0:i(l)},p=r.nextValue(a),d=o.nextValue(a)}}(),this.generator.next(),e.values.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){var t=this.generator.next(e).value;return t}}Gn.calculate=l;class On extends Rn{constructor(e){super(e);let t=e.values,a=e.period,r=this.format;this.generator=function*(e){var t=yield,a=1,o=0,n=t,i,s;for(t=yield;;)s=t-n,s=0<s?s:0,0<s&&(o+=s),a<e?a++:void 0==i?i=o/e:i=(i*(e-1)+s)/e,n=t,i=void 0===i?void 0:r(i),t=yield i}(a),this.generator.next(),this.result=[],t.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}On.calculate=p;class qn extends Rn{constructor(e){super(e);let t=e.values,a=e.period,r=this.format;this.generator=function*(e){var t=yield,a=1,o=0,n=t,i,s;for(t=yield;;)s=n-t,s=0<s?s:0,0<s&&(o+=s),a<e?a++:void 0==i?i=o/e:i=(i*(e-1)+s)/e,n=t,i=void 0===i?void 0:r(i),t=yield i}(a),this.generator.next(),this.result=[],t.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}qn.calculate=d;class Un extends Rn{constructor(e){super(e);var t=e.period,a=e.values,r=new On({period:t,values:[]}),o=new qn({period:t,values:[]});let n=1;this.generator=function*(){for(var e=yield,t,a,i,s;;)t=r.nextValue(e),a=o.nextValue(e),void 0!==t&&void 0!==a&&(0===a?s=100:0===t?s=0:(i=t/a,i=isNaN(i)?0:i,s=parseFloat((100-100/(1+i)).toFixed(2)))),n++,e=yield s}(t),this.generator.next(),this.result=[],a.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}Un.calculate=c;class Nn extends Rn{constructor(e){super(e);var t=e.period,a=e.values,r=new An({period:t,values:[],format:(e)=>e});this.result=[],this.generator=function*(){var e=new Fn(t),a,o;a=yield;for(var n;;){if(e.push(a),o=r.nextValue(a),o){let a=0;for(let t of e.iterator())a+=wn(t-o,2);n=Pn(a/t)}a=yield n}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return this.format(t.value)}}Nn.calculate=h;class Bn extends Rn{constructor(e){super(e);var t=e.period,a=e.values,r=e.stdDev,o=this.format,n,i;this.result=[],n=new An({period:t,values:[],format:(e)=>e}),i=new Nn({period:t,values:[],format:(e)=>e}),this.generator=function*(){var e,t,a,s;for(t=yield;;){if(a=n.nextValue(t),s=i.nextValue(t),a){let n=o(a),i=o(a+s*r),u=o(a-s*r),l=o((t-u)/(i-u));e={middle:n,upper:i,lower:u,pb:l}}t=yield e}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}Bn.calculate=g;class Vn extends Rn{constructor(e){super(e),this.period=e.period,this.price=e.values;this.generator=function*(e){for(var t=new kn,a=0,r=1,o=yield,n=0;;)r<e?(r++,a+=o,n=void 0):r==e?(r++,a+=o,n=a):n=n-n/e+o,o=yield n}(this.period),this.generator.next(),this.result=[],this.price.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}Vn.calculate=f;class Hn extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;){if(a){let o=e.high-a.high,n=a.low-e.low;t=r(n>o&&0<n?n:0)}a=e,e=yield t}}(),this.generator.next(),t.forEach((e,r)=>{var o=this.generator.next({high:a[r],low:t[r]});o.value!==void 0&&this.result.push(o.value)})}static calculate(e){Rn.reverseInputs(e);var t=new Hn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}nextValue(e){return this.generator.next(e).value}}class Wn extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;){if(a){let o=e.high-a.high,n=a.low-e.low;t=r(o>n&&0<o?o:0)}a=e,e=yield t}}(),this.generator.next(),t.forEach((e,r)=>{var o=this.generator.next({high:a[r],low:t[r]});o.value!==void 0&&this.result.push(o.value)})}static calculate(e){Rn.reverseInputs(e);var t=new Wn(e).result;return e.reversedInput&&t.reverse(),Rn.reverseInputs(e),t}nextValue(e){return this.generator.next(e).value}}class Xn extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;)void 0==t&&(t=e.close,e=yield a),a=Sn(e.high-e.low,isNaN(Tn(e.high-t))?0:Tn(e.high-t),isNaN(Tn(e.low-t))?0:Tn(e.low-t)),t=e.close,void 0!=a&&(a=o(a)),e=yield a}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!=void 0&&this.result.push(n.value)})}nextValue(e){return this.generator.next(e).value}}Xn.calculate=m;class $n extends En{}class Kn extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format,i=new Wn({high:[],low:[]}),s=new Hn({high:[],low:[]}),u=new Vn({period:o,values:[],format:(e)=>e}),l=new Vn({period:o,values:[],format:(e)=>e}),p=new Vn({period:o,values:[],format:(e)=>e}),d=new zn({period:o,values:[],format:(e)=>e}),c=new Xn({low:[],high:[],close:[]});if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],$n,this.generator=function*(){var e=yield,t,a,r,o,n,h,g;for(t=0,a=0,r=0;;){let t=c.nextValue(e),a=i.nextValue(e),r=s.nextValue(e);if(t===void 0){e=yield;continue}let f=p.nextValue(t),m=u.nextValue(a),_=l.nextValue(r);if(f!=void 0&&m!=void 0&&_!=void 0){o=100*m/f,n=100*_/f;let e=Tn(o-n),t=o+n;h=100*(e/t),g=d.nextValue(h)}e=yield{adx:g,pdi:o,mdi:n}}}(),this.generator.next(),t.forEach((e,o)=>{var i=this.generator.next({high:a[o],low:t[o],close:r[o]});i.value!=void 0&&i.value.adx!=void 0&&this.result.push({adx:n(i.value.adx),pdi:n(i.value.pdi),mdi:n(i.value.mdi)})})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0&&t.adx!=void 0)return{adx:this.format(t.adx),pdi:this.format(t.pdi),mdi:this.format(t.mdi)}}}Kn.calculate=_;class Qn extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';var i=new Xn({low:[],high:[],close:[]}),s=new zn({period:o,values:[],format:(e)=>e});this.result=[],this.generator=function*(){for(var e=yield,t,a;;)a=i.nextValue({low:e.low,high:e.high,close:e.close}),t=void 0===a?void 0:s.nextValue(a),e=yield t}(),this.generator.next(),t.forEach((e,o)=>{var i=this.generator.next({high:a[o],low:t[o],close:r[o]});i.value!==void 0&&this.result.push(n(i.value))})}nextValue(e){return this.generator.next(e).value}}Qn.calculate=x;class Zn extends Rn{constructor(e){super(e);var t=e.period,a=e.values;this.result=[],this.generator=function*(){let e=1;for(var a=new Fn(t),r=yield,o;;)a.push(r),e<t?e++:o=100*((r-a.lastShift)/a.lastShift),r=yield o}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value==void 0||isNaN(t.value)||this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0&&!isNaN(t.value))return this.format(t.value)}}Zn.calculate=y;class Yn extends Rn{constructor(e){super(e);let t=e.values,a=e.ROCPer1,r=e.ROCPer2,o=e.ROCPer3,n=e.ROCPer4,i=e.SMAROCPer1,s=e.SMAROCPer2,u=e.SMAROCPer3,l=e.SMAROCPer4,p=e.signalPeriod,d=new Zn({period:a,values:[]}),c=new Zn({period:r,values:[]}),h=new Zn({period:o,values:[]}),g=new Zn({period:n,values:[]}),f=new An({period:i,values:[],format:(e)=>e}),m=new An({period:s,values:[],format:(e)=>e}),_=new An({period:u,values:[],format:(e)=>e}),x=new An({period:l,values:[],format:(e)=>e}),y=new An({period:p,values:[],format:(e)=>e});var v=this.format;this.result=[];let b=Sn(a+i,r+s,o+u,n+l);this.generator=function*(){for(let e=1,t=yield,a,r,o,n,i,s,u;;){let l=d.nextValue(t),p=c.nextValue(t),S=h.nextValue(t),T=g.nextValue(t);r=l===void 0?void 0:f.nextValue(l),o=p===void 0?void 0:m.nextValue(p),n=S===void 0?void 0:_.nextValue(S),i=T===void 0?void 0:x.nextValue(T),e<b?e++:a=1*r+2*o+3*n+4*i,s=a===void 0?void 0:y.nextValue(a),u=a===void 0?void 0:{kst:v(a),signal:s?v(s):void 0},t=yield u}}(),this.generator.next(),t.forEach((e)=>{let t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!=void 0)return t.value}}Yn.calculate=v;class Jn extends Rn{constructor(e){super(e);let t=e.high||[],a=e.low||[];this.result=[],this.generator=function*(e,t){for(let a=!0,r=e,o=yield,n,i,s,u;;)n?(s+=r*(i-s),a?(s=bn(s,u.low,o.low),n.high>i&&(i=n.high,r=bn(r+e,t))):(s=Sn(s,u.high,o.high),n.low<i&&(i=n.low,r=bn(r+e,t))),(a&&n.low<s||!a&&n.high>s)&&(r=e,s=i,a=!a,i=a?n.high:n.low)):(s=o.low,i=o.high),u=o,n&&(o=n),n=yield s}(e.step,e.max),this.generator.next(),a.forEach((e,r)=>{var o=this.generator.next({high:t[r],low:a[r]});o.value!==void 0&&this.result.push(o.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}Jn.calculate=b;class ei extends Rn{constructor(e){super(e);let t=e.low,a=e.high,r=e.close,o=e.period,n=e.signalPeriod,i=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){let e=1,t=new Fn(o,!0,!1),a=new Fn(o,!1,!0),r=new An({period:n,values:[],format:(e)=>e}),s,u;for(var l=yield;;){if(t.push(l.high),a.push(l.low),e<o){e++,l=yield;continue}let n=a.periodLow;s=100*((l.close-n)/(t.periodHigh-n)),s=isNaN(s)?0:s,u=r.nextValue(s),l=yield{k:i(s),d:void 0===u?void 0:i(u)}}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!==void 0&&this.result.push(n.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}ei.calculate=S;class ti extends Rn{constructor(e){super(e);let t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){let e=1,t=new Fn(o,!0,!1),a=new Fn(o,!1,!0),r,i;var s=yield;for(let u;;){if(t.push(s.high),a.push(s.low),e<o){e++,s=yield;continue}r=a.periodLow,i=t.periodHigh,u=n(-100*((i-s.close)/(i-r))),s=yield u}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!==void 0&&this.result.push(n.value)})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return this.format(t.value)}}ti.calculate=T;class ai extends Rn{constructor(e){super(e);var t=e.high,a=e.low,r=e.close,o=e.volume;if(a.length!==t.length||t.length!==r.length||t.length!==o.length)throw'Inputs(low,high, close, volumes) not of equal size';this.result=[],this.generator=function*(){var e=0,t;for(t=yield;;){let a=(t.close-t.low-(t.high-t.close))/(t.high-t.low);a=isNaN(a)?1:a;let r=a*t.volume;e+=r,t=yield vn(e)}}(),this.generator.next(),t.forEach((e,t)=>{var n={high:e,low:a[t],close:r[t],volume:o[t]},i=this.generator.next(n);i.value!=void 0&&this.result.push(i.value)})}nextValue(e){return this.generator.next(e).value}}ai.calculate=P;class ri extends Rn{constructor(e){super(e);var t=e.close,a=e.volume;this.result=[],this.generator=function*(){var e=0,t,a;for(t=yield,t.close&&'number'==typeof t.close&&(a=t.close,t=yield);;)a<t.close?e+=t.volume:t.close<a&&(e-=t.volume),a=t.close,t=yield e}(),this.generator.next(),t.forEach((e,r)=>{let o={close:t[r],volume:a[r]},n=this.generator.next(o);n.value!=void 0&&this.result.push(n.value)})}nextValue(e){return this.generator.next(e).value}}ri.calculate=w;class oi extends Rn{constructor(e){super(e);let t=e.values,a=e.period,r=this.format,o=new Ln({period:a,values:[],format:(e)=>e}),n=new Ln({period:a,values:[],format:(e)=>e}),i=new Ln({period:a,values:[],format:(e)=>e}),s=new Zn({period:1,values:[],format:(e)=>e});this.result=[],this.generator=function*(){for(let e=yield;;){let t=o.nextValue(e),a=t?n.nextValue(t):void 0,u=a?i.nextValue(a):void 0,l=u?s.nextValue(u):void 0;e=yield l?r(l):void 0}}(),this.generator.next(),t.forEach((e)=>{let t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}oi.calculate=C;class ni extends Rn{constructor(e){super(e);var t=e.close,a=e.volume,r=e.period||1;if(a.length!==t.length)throw'Inputs(volume, close) not of equal size';let o=new Ln({values:[],period:r});this.result=[],this.generator=function*(){var e=yield,t=yield;for(let a;;)a=(t.close-e.close)*t.volume,e=t,t=yield o.nextValue(a)}(),this.generator.next(),a.forEach((e,r)=>{var o=this.generator.next({close:t[r],volume:a[r]});o.value!=void 0&&this.result.push(o.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}ni.calculate=k;class ii extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;var i=new Fn(o),s=new An({period:o,values:[],format:(e)=>e});if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){for(var e=yield;;){let t=(e.high+e.low+e.close)/3;i.push(t);let a=s.nextValue(t),r=null,o=0,n;if(a!=void 0){for(let e of i.iterator())o+=Tn(e-a);r=o/20,n=(t-a)/(.015*r)}e=yield n}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!=void 0&&this.result.push(n.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}ii.calculate=F;class si extends Rn{constructor(e){super(e);var t=e.high,a=e.low,r=e.fastPeriod,o=e.slowPeriod,n=new An({values:[],period:o}),i=new An({values:[],period:r});this.result=[],this.generator=function*(){var e,t,a,r,o;for(t=yield;;)a=(t.high+t.low)/2,r=n.nextValue(a),o=i.nextValue(a),void 0!==r&&void 0!==o&&(e=o-r),t=yield e}(),this.generator.next(),t.forEach((e,t)=>{var r={high:e,low:a[t]},o=this.generator.next(r);o.value!=void 0&&this.result.push(this.format(o.value))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return this.format(t.value)}}si.calculate=M;class ui extends Rn{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.volume,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){var e=yield;for(let t=0,a=0;;){let r=(e.high+e.low+e.close)/3,o=e.volume*r;t+=o,a+=e.volume,e=yield t/a}}(),this.generator.next(),t.forEach((e,n)=>{var i=this.generator.next({high:a[n],low:t[n],close:r[n],volume:o[n]});i.value!=void 0&&this.result.push(i.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}ui.calculate=D;class li extends Rn{constructor(e){super(e);var t=e.high,a=e.low,r=e.close,o=e.open,n=e.volume,s=e.noOfBars;if(a.length!==t.length||t.length!==r.length||t.length!==n.length)throw'Inputs(low,high, close, volumes) not of equal size';this.result=[];var i=Sn(...t,...a,...r,...o),u=bn(...t,...a,...r,...o),l=u;for(let p=0;p<s;p++){let e=l,p=e+(i-u)/s;l=p;let d=0,c=0,h=0;for(let i=0;i<t.length;i++){let s=a[i],u=t[i],l=o[i],g=r[i],f=n[i];I(e,p,s,u)&&(h+=f,l>g?c+=f:d+=f)}this.result.push({rangeStart:e,rangeEnd:p,bullishVolume:d,bearishVolume:c,totalVolume:h})}}nextValue(){throw'Next value not supported for volume profile'}}li.calculate=R;class pi extends Rn{constructor(e){super(e),this.result=[],this.generator=function*(){for(let e=yield;;)e=yield(e.high+e.low+e.close)/3}(),this.generator.next(),e.low.forEach((t,a)=>{var r=this.generator.next({high:e.high[a],low:e.low[a],close:e.close[a]});this.result.push(r.value)})}nextValue(e){var t=this.generator.next(e).value;return t}}pi.calculate=A;class di extends Rn{constructor(e){super(e);var t=e.high,a=e.low,r=e.close,o=e.volume,n=e.period,i=new pi({low:[],high:[],close:[]}),s=new Fn(n,!1,!1,!0),u=new Fn(n,!1,!1,!0);if(a.length!==t.length||t.length!==r.length||t.length!==o.length)throw'Inputs(low,high, close, volumes) not of equal size';this.result=[],this.generator=function*(){var e=0,t,a,r,o,l,p;let d=null,c=null;for(a=yield,r=a.close,a=yield;;){var{high:h,low:g,close:f,volume:m}=a,_=0,x=0;d=i.nextValue({high:h,low:g,close:f}),e=d*m,null!=d&&null!=c&&(d>c?_=e:x=e,s.push(_),u.push(x),o=s.periodSum,p=u.periodSum,s.totalPushed>=n&&s.totalPushed>=n&&(l=o/p,t=100-100/(1+l))),c=d,a=yield t}}(),this.generator.next(),t.forEach((e,t)=>{var n={high:e,low:a[t],close:r[t],volume:o[t]},i=this.generator.next(n);i.value!=void 0&&this.result.push(parseFloat(i.value.toFixed(2)))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return parseFloat(t.value.toFixed(2))}}di.calculate=L;class ci extends Rn{constructor(e){super(e);let t=e.values,a=e.rsiPeriod,r=e.stochasticPeriod,o=e.kPeriod,n=e.dPeriod,i=this.format;this.result=[],this.generator=function*(){let e=new Un({period:a,values:[]}),t=new ei({period:r,high:[],low:[],close:[],signalPeriod:o}),i=new An({period:n,values:[],format:(e)=>e}),s,u,l,p;for(var c=yield;;){if(s=e.nextValue(c),void 0!==s){var h={high:s,low:s,close:s};u=t.nextValue(h),void 0!==u&&void 0!==u.d&&(l=i.nextValue(u.d),void 0!==l&&(p={stochRSI:u.k,k:u.d,d:l}))}c=yield p}}(),this.generator.next(),t.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}ci.calculate=j;class hi extends Rn{constructor(e){super(e);var t=e.values,a=e.period;this.result=[];var r=new Fn(a,!0,!1,!1);this.generator=function*(){var e,t;for(e=yield;;)r.push(e),r.totalPushed>=a&&(t=r.periodHigh),e=yield t}(),this.generator.next(),t.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return t.value}}hi.calculate=z;class gi extends Rn{constructor(e){super(e);var t=e.values,a=e.period;this.result=[];var r=new Fn(a,!1,!0,!1);this.generator=function*(){var e,t;for(e=yield;;)r.push(e),r.totalPushed>=a&&(t=r.periodLow),e=yield t}(),this.generator.next(),t.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return t.value}}gi.calculate=G;class fi extends Rn{constructor(e){super(e);var t=e.values,a=e.period;this.result=[];var r=new Fn(a,!1,!1,!0);this.generator=function*(){var e,t;for(e=yield;;)r.push(e),r.totalPushed>=a&&(t=r.periodSum),e=yield t}(),this.generator.next(),t.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return t.value}}fi.calculate=O;class mi extends Rn{constructor(e){super(e);this.format;let t=e.useATR,a=e.brickSize||0;if(t){let t=x(Object.assign({},e));a=t[t.length-1]}if(this.result=new Dn,0===a)return void console.error('Not enough data to calculate brickSize for renko when using ATR');let r=0,o=0,n=Infinity,i=0,s=0,u=0;this.generator=function*(){for(let e=yield;;){if(0==r){r=e.close,o=e.high,n=e.low,i=e.close,s=e.volume,u=e.timestamp,e=yield;continue}let t=Tn(e.close-i),l=Tn(e.close-r);if(t>=a&&l>=a){let u=t>l?r:i,p={open:u,high:o>e.high?o:e.high,low:n<e.Low?n:e.low,close:u>e.close?u-a:u+a,volume:s+e.volume,timestamp:e.timestamp};r=p.open,o=p.close,n=p.close,i=p.close,s=0,e=yield p}else o=o>e.high?o:e.high,n=n<e.Low?n:e.low,s+=e.volume,u=e.timestamp,e=yield}}(),this.generator.next(),e.low.forEach((t,a)=>{var r=this.generator.next({open:e.open[a],high:e.high[a],low:e.low[a],close:e.close[a],volume:e.volume[a],timestamp:e.timestamp[a]});r.value&&(this.result.open.push(r.value.open),this.result.high.push(r.value.high),this.result.low.push(r.value.low),this.result.close.push(r.value.close),this.result.volume.push(r.value.volume),this.result.timestamp.push(r.value.timestamp))})}nextValue(){return console.error('Cannot calculate next value on Renko, Every value has to be recomputed for every change, use calcualte method'),null}}mi.calculate=q;class _i extends Rn{constructor(e){super(e);this.format;this.result=new Dn;let t=null,a=0,r=Infinity,o=0,n=0,i=0;this.generator=function*(){for(let e=yield,s=null;;){if(null==t)t=(e.close+e.open)/2,a=e.high,r=e.low,o=(e.close+e.open+e.high+e.low)/4,n=e.volume||0,i=e.timestamp||0,s={open:t,high:a,low:r,close:o,volume:e.volume||0,timestamp:e.timestamp||0};else{let n=(e.close+e.open+e.high+e.low)/4,i=(t+o)/2,u=Sn(i,n,e.high),l=bn(e.low,i,n);s={close:n,open:i,high:u,low:l,volume:e.volume||0,timestamp:e.timestamp||0},o=n,t=i,a=u,r=l}e=yield s}}(),this.generator.next(),e.low.forEach((t,a)=>{var r=this.generator.next({open:e.open[a],high:e.high[a],low:e.low[a],close:e.close[a],volume:e.volume?e.volume[a]:e.volume,timestamp:e.timestamp?e.timestamp[a]:e.timestamp});r.value&&(this.result.open.push(r.value.open),this.result.high.push(r.value.high),this.result.low.push(r.value.low),this.result.close.push(r.value.close),this.result.volume.push(r.value.volume),this.result.timestamp.push(r.value.timestamp))})}nextValue(e){var t=this.generator.next(e).value;return t}}_i.calculate=U;class xi{constructor(){}approximateEqual(e,t){let a=1*parseFloat(Tn(e-t).toPrecision(4)),r=1*parseFloat((1e-3*e).toPrecision(4));return a<=r}logic(){throw'this has to be implemented'}getAllPatternIndex(e){if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),[];e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());let t=this.logic;return this._generateDataForCandleStick(e).map((e,a)=>t.call(this,e)?a:void 0).filter((e)=>e)}hasPattern(e){if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),!1;e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());let t=this.logic;return t.call(this,this._getLastDataForCandleStick(e))}_getLastDataForCandleStick(e){let t=this.requiredCount;if(e.close.length===t)return e;else{let a={open:[],high:[],low:[],close:[]},r=0,o=e.close.length-t;for(;r<t;)a.open.push(e.open[o+r]),a.high.push(e.high[o+r]),a.low.push(e.low[o+r]),a.close.push(e.close[o+r]),r++;return a}}_generateDataForCandleStick(e){let t=this.requiredCount,a=e.close.map(function(a,r){let o=0,n={open:[],high:[],low:[],close:[]};for(;o<t;)n.open.push(e.open[r+o]),n.high.push(e.high[r+o]),n.low.push(e.low[r+o]),n.close.push(e.close[r+o]),o++;return n}).filter((a,r)=>r<=e.close.length-t);return a}}class yi extends xi{constructor(){super(),this.name='MorningStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&o>u&&o>s&&s<o&&u<o&&l>s&&i<l&&l<p&&p>(t+a)/2}}class vi extends xi{constructor(){super(),this.name='BullishEngulfingPattern',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a<t&&t>n&&a>n&&t<i}}class bi extends xi{constructor(){super(),this.requiredCount=2,this.name='BullishHarami'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return t>n&&a<n&&a<i&&t>u&&r>s}}class Si extends xi{constructor(){super(),this.requiredCount=2,this.name='BullishHaramiCross'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=this.approximateEqual(n,i);return t>n&&a<n&&a<i&&t>u&&r>s&&l}}class Ti extends xi{constructor(){super(),this.name='Doji',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,a),i=n&&this.approximateEqual(t,r),s=n&&this.approximateEqual(a,o);return n&&i==s}}class Pi extends xi{constructor(){super(),this.name='MorningDojiStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],h=new Ti().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a<t&&h&&l<p&&s<o&&u<o&&l>s&&i<l&&p>(t+a)/2}}class wi extends xi{constructor(){super(),this.requiredCount=3,this.name='DownsideTasukiGap'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&i<n&&p>l&&s<o&&n>l&&i<l&&p>n&&p<a}}class Ci extends xi{constructor(){super(),this.name='BullishMarubozu',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(a,r)&&this.approximateEqual(o,t)&&t<a&&t<r;return n}}class ki extends xi{constructor(){super(),this.requiredCount=2,this.name='PiercingLine'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return u<o&&a<t&&o>n&&i>(t+a)/2&&i>n}}class Fi extends xi{constructor(){super(),this.name='ThreeWhiteSoldiers',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return s>r&&d>s&&t<a&&n<i&&l<p&&a>n&&n<r&&s>l&&l<i}}let Mi=[new vi,new wi,new bi,new Si,new Pi,new yi,new Ci,new ki,new Fi];class Di extends xi{constructor(){super(),this.name='Bullish Candlesticks'}hasPattern(e){return Mi.reduce(function(t,a){let r=a.hasPattern(e);return t||r},!1)}}class Ii extends xi{constructor(){super(),this.name='BearishEngulfingPattern',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a>t&&t<n&&a<n&&t>i}}class Ei extends xi{constructor(){super(),this.requiredCount=2,this.name='BearishHarami'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return t<n&&a>n&&a>i&&t<u&&r>s}}class Ri extends xi{constructor(){super(),this.requiredCount=2,this.name='BearishHaramiCross'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=this.approximateEqual(n,i);return t<n&&a>n&&a>i&&t<u&&r>s&&l}}class Ai extends xi{constructor(){super(),this.name='EveningDojiStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],h=new Ti().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a>t&&h&&s>r&&u>r&&l<u&&i>l&&l>p&&p<(t+a)/2}}class Li extends xi{constructor(){super(),this.name='EveningStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a>t&&r<u&&r<s&&s>r&&u>r&&l<u&&i>l&&l>p&&p<(t+a)/2}}class ji extends xi{constructor(){super(),this.name='BearishMarubozu',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,r)&&this.approximateEqual(o,a)&&t>a&&t>o;return n}}class zi extends xi{constructor(){super(),this.name='ThreeBlackCrows',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return o>u&&u>c&&t>a&&n>i&&l>p&&t>n&&n>a&&n>l&&l>i}}let Gi=[new Ii,new Ei,new Ri,new Ai,new Li,new ji,new zi];class Oi extends xi{constructor(){super(),this.name='Bearish Candlesticks'}hasPattern(e){return Gi.reduce(function(t,a){return t||a.hasPattern(e)},!1)}}class qi extends xi{constructor(){super(),this.name='AbandonedBaby',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],h=new Ti().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a<t&&h&&s<o&&c>s&&p>l&&d<t}}class Ui extends xi{constructor(){super(),this.name='DarkCloudCover',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a>t&&i<n&&n>r&&i<(a+t)/2&&i>t}}class Ni extends xi{constructor(){super(),this.requiredCount=1,this.name='DragonFlyDoji'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,a),i=n&&this.approximateEqual(t,r),s=n&&this.approximateEqual(a,o);return n&&i&&!s}}class Bi extends xi{constructor(){super(),this.requiredCount=1,this.name='GraveStoneDoji'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,a),i=n&&this.approximateEqual(t,r),s=n&&this.approximateEqual(a,o);return n&&s&&!i}}class Vi extends xi{constructor(){super(),this.name='BullishSpinningTop',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Tn(a-t),i=Tn(r-a),s=Tn(t-o);return n<i&&n<s}}class Hi extends xi{constructor(){super(),this.name='BearishSpinningTop',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Tn(a-t),i=Tn(r-t),s=Tn(r-o);return n<i&&n<s}}var Wi='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,Xi=me,$i='object'==typeof Wi&&Wi&&Wi.Object===Object&&Wi,Ki=$i,Qi='object'==typeof self&&self&&self.Object===Object&&self,Zi=Ki||Qi||Function('return this')(),Yi=Zi,Ji=Yi.Symbol,es=Ji,ts=Object.prototype,as=ts.hasOwnProperty,rs=ts.toString,os=es?es.toStringTag:void 0,ns=_e,is=Object.prototype,ss=is.toString,us=xe,ls='[object Null]',ps='[object Undefined]',ds=es?es.toStringTag:void 0,cs=ye,hs=ve,gs='[object Arguments]',fs=be,ms=Object.prototype,_s=ms.hasOwnProperty,xs=ms.propertyIsEnumerable,ys=fs(function(){return arguments}())?fs:function(e){return hs(e)&&_s.call(e,'callee')&&!xs.call(e,'callee')},vs=ys,bs=Array.isArray,Ss=bs,Ts=Se,Ps=fe(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o?Yi.Buffer:void 0,i=n?n.isBuffer:void 0;e.exports=i||Ts}),ws=9007199254740991,Cs=/^(?:0|[1-9]\d*)$/,ks=Te,Fs=9007199254740991,Ms=Pe,Ds='[object Arguments]',Is='[object Array]',Es='[object Boolean]',Rs='[object Date]',As='[object Error]',Ls='[object Function]',js='[object Map]',zs='[object Number]',Gs='[object Object]',Os='[object RegExp]',qs='[object Set]',Us='[object String]',Ns='[object WeakMap]',Bs='[object ArrayBuffer]',Vs='[object DataView]',Hs='[object Float32Array]',Ws='[object Float64Array]',Xs='[object Int8Array]',$s='[object Int16Array]',Ks='[object Int32Array]',Qs='[object Uint8Array]',Zs='[object Uint8ClampedArray]',Ys='[object Uint16Array]',Js='[object Uint32Array]',eu={};eu[Hs]=eu[Ws]=eu[Xs]=eu[$s]=eu[Ks]=eu[Qs]=eu[Zs]=eu[Ys]=eu[Js]=!0,eu[Ds]=eu[Is]=eu[Bs]=eu[Es]=eu[Vs]=eu[Rs]=eu[As]=eu[Ls]=eu[js]=eu[zs]=eu[Gs]=eu[Os]=eu[qs]=eu[Us]=eu[Ns]=!1;var tu=we,au=Ce,ru=fe(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o&&Ki.process,i=function(){try{var e=r&&r.require&&r.require('util').types;return e?e:n&&n.binding&&n.binding('util')}catch(t){}}();e.exports=i}),ou=ru&&ru.isTypedArray,nu=ou?au(ou):tu,iu=nu,su=Object.prototype,uu=su.hasOwnProperty,lu=ke,pu=Object.prototype,du=Fe,cu=Me,hu=cu(Object.keys,Object),gu=hu,fu=Object.prototype,mu=fu.hasOwnProperty,_u=De,xu=Ie,yu='[object AsyncFunction]',vu='[object Function]',bu='[object GeneratorFunction]',Su='[object Proxy]',Tu=Ee,Pu=Re,wu=Ae,Cu=Le,ku=je,Fu=ze,Mu=Array.prototype,Du=Mu.splice,Iu=Ge,Eu=Oe,Ru=qe,Au=Ue;Ne.prototype.clear=Cu,Ne.prototype['delete']=Iu,Ne.prototype.get=Eu,Ne.prototype.has=Ru,Ne.prototype.set=Au;var Lu=Ne,ju=Be,zu=Ve,Gu=He,Ou=We,qu=Yi['__core-js_shared__'],Uu=qu,Nu=function(){var e=/[^.]+$/.exec(Uu&&Uu.keys&&Uu.keys.IE_PROTO||'');return e?'Symbol(src)_1.'+e:''}(),Bu=Xe,Vu=Function.prototype,Hu=Vu.toString,Wu=$e,Xu=/[\\^$.*+?()[\]{}|]/g,$u=/^\[object .+?Constructor\]$/,Ku=Function.prototype,Qu=Object.prototype,Zu=Ku.toString,Yu=Qu.hasOwnProperty,Ju=RegExp('^'+Zu.call(Yu).replace(Xu,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),el=Ke,tl=Qe,al=Ze,rl=al(Yi,'Map'),ol=rl,nl=al(Object,'create'),il=nl,sl=Ye,ul=Je,ll='__lodash_hash_undefined__',pl=Object.prototype,dl=pl.hasOwnProperty,cl=et,hl=Object.prototype,gl=hl.hasOwnProperty,fl=tt,ml='__lodash_hash_undefined__',_l=at;rt.prototype.clear=sl,rt.prototype['delete']=ul,rt.prototype.get=cl,rt.prototype.has=fl,rt.prototype.set=_l;var xl=rt,yl=ot,vl=nt,bl=it,Sl=st,Tl=ut,Pl=lt,wl=pt;dt.prototype.clear=yl,dt.prototype['delete']=Sl,dt.prototype.get=Tl,dt.prototype.has=Pl,dt.prototype.set=wl;var Cl=dt,kl=200,Fl=ct;ht.prototype.clear=ju,ht.prototype['delete']=zu,ht.prototype.get=Gu,ht.prototype.has=Ou,ht.prototype.set=Fl;var Ml=ht,Dl='__lodash_hash_undefined__',Il=gt,El=ft;mt.prototype.add=mt.prototype.push=Il,mt.prototype.has=El;var Rl=mt,Al=_t,Ll=xt,jl=1,zl=2,Gl=yt,Ol=Yi.Uint8Array,ql=Ol,Ul=vt,Nl=bt,Bl=1,Vl=2,Hl='[object Boolean]',Wl='[object Date]',Xl='[object Error]',$l='[object Map]',Kl='[object Number]',Ql='[object RegExp]',Zl='[object Set]',Yl='[object String]',Jl='[object Symbol]',ep='[object ArrayBuffer]',tp='[object DataView]',ap=es?es.prototype:void 0,rp=ap?ap.valueOf:void 0,op=St,np=Tt,ip=Pt,sp=wt,up=Ct,lp=Object.prototype,pp=lp.propertyIsEnumerable,dp=Object.getOwnPropertySymbols,cp=dp?function(e){return null==e?[]:(e=Object(e),sp(dp(e),function(t){return pp.call(e,t)}))}:up,hp=cp,gp=kt,fp=1,mp=Object.prototype,_p=mp.hasOwnProperty,xp=Ft,yp=al(Yi,'DataView'),vp=yp,bp=al(Yi,'Promise'),Sp=bp,Tp=al(Yi,'Set'),Pp=Tp,wp=al(Yi,'WeakMap'),Cp=wp,kp='[object Map]',Fp='[object Object]',Mp='[object Promise]',Dp='[object Set]',Ip='[object WeakMap]',Ep='[object DataView]',Rp=Wu(vp),Ap=Wu(ol),Lp=Wu(Sp),jp=Wu(Pp),zp=Wu(Cp),Gp=cs;(vp&&Gp(new vp(new ArrayBuffer(1)))!=Ep||ol&&Gp(new ol)!=kp||Sp&&Gp(Sp.resolve())!=Mp||Pp&&Gp(new Pp)!=Dp||Cp&&Gp(new Cp)!=Ip)&&(Gp=function(e){var t=cs(e),a=t==Fp?e.constructor:void 0,r=a?Wu(a):'';if(r)switch(r){case Rp:return Ep;case Ap:return kp;case Lp:return Mp;case jp:return Dp;case zp:return Ip;}return t});var Op=Gp,qp=1,Up='[object Arguments]',Np='[object Array]',Bp='[object Object]',Vp=Object.prototype,Hp=Vp.hasOwnProperty,Wp=Mt,Xp=Dt,$p=It,Kp=Et,Qp=1,Zp=2,Yp=Rt,Jp=At,ed=Lt,td=jt,ad=zt,rd='[object Symbol]',od=Gt,nd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,id=/^\w*$/,sd=Ot,ud='Expected a function';qt.Cache=Cl;var ld=qt,pd=500,dd=Ut,cd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hd=/\\(\\)?/g,gd=dd(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(''),e.replace(cd,function(e,a,r,o){t.push(r?o.replace(hd,'$1'):a||e)}),t}),fd=gd,md=1/0,_d=es?es.prototype:void 0,xd=_d?_d.toString:void 0,yd=Nt,vd=Bt,bd=Vt,Sd=1/0,Td=Ht,Pd=Wt,wd=Xt,Cd=$t,kd=Kt,Fd=Qt,Md=1,Dd=2,Id=Zt,Ed=Yt,Rd=Jt,Ad=ea,Ld=ta,jd=aa,zd=ra,Gd=zd(),Od=Gd,qd=oa,Ud=na,Nd=Ud(qd),Bd=Nd,Vd=ia,Hd=sa,Wd=ua,Xd=la,$d=pa,Kd=da,Qd=ca,Zd=ha,Yd=0/0,Jd=/^\s+|\s+$/g,ec=/^[-+]0x[0-9a-f]+$/i,tc=/^0b[01]+$/i,ac=/^0o[0-7]+$/i,rc=parseInt,oc=ga,nc=1/0,ic=1.7976931348623157e308,sc=fa,uc=ma,lc=Sn,pc=_a,dc=Qd(pc),cc=dc,hc=function(){try{var e=al(Object,'defineProperty');return e({},'',{}),e}catch(t){}}(),gc=hc,fc=xa,mc=Object.prototype,_c=mc.hasOwnProperty,xc=ya,yc=va,vc=ba,bc=Sa,Sc=es?es.isConcatSpreadable:void 0,Tc=Ta,Pc=Pa,wc=wa,Cc=Ca,kc=Sn,Fc=ka,Mc=Fa,Dc=gc?function(e,t){return gc(e,'toString',{configurable:!0,enumerable:!1,value:Mc(t),writable:!0})}:Ed,Ic=Dc,Ec=800,Rc=16,Ac=Date.now,Lc=Ma,jc=Lc(Ic),zc=jc,Gc=Da,Oc=Gc(function(e,t){return null==e?{}:bc(e,t)}),qc=Oc,Uc=fe(function(t,e){!function(a){t.exports=a()}(function(){var e,t,a;return function p(d,e,t){function a(i,o){if(!e[i]){if(!d[i]){var n='function'==typeof _dereq_&&_dereq_;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error('Cannot find module \''+i+'\'');throw s.code='MODULE_NOT_FOUND',s}var c=e[i]={exports:{}};d[i][0].call(c.exports,function(t){var e=d[i][1][t];return a(e?e:t)},c,c.exports,p,d,e,t)}return e[i].exports}for(var r='function'==typeof _dereq_&&_dereq_,n=0;n<t.length;n++)a(t[n]);return a}({1:[function(e,t){t.exports=function(e){function t(e){var t=new a(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var a=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t){function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new u(16),this._normalQueue=new u(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=s}function r(e,t,a){this._lateQueue.push(e,t,a),this._queueTick()}function o(e,t,a){this._normalQueue.push(e,t,a),this._queueTick()}function n(e){this._normalQueue._pushOne(e),this._queueTick()}var i;try{throw new Error}catch(t){i=t}var s=e('./schedule'),u=e('./queue'),l=e('./util');a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},a.prototype.disableTrampolineIfNecessary=function(){l.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,e){e?(process.stderr.write('Fatal '+(t instanceof Error?t.stack:t)+'\n'),process.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),'undefined'!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(t){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}},l.hasDevTools?(a.prototype.invokeLater=function(e,t,a){this._trampolineEnabled?r.call(this,e,t,a):this._schedule(function(){setTimeout(function(){e.call(t,a)},100)})},a.prototype.invoke=function(e,t,a){this._trampolineEnabled?o.call(this,e,t,a):this._schedule(function(){e.call(t,a)})},a.prototype.settlePromises=function(e){this._trampolineEnabled?n.call(this,e):this._schedule(function(){e._settlePromises()})}):(a.prototype.invokeLater=r,a.prototype.invoke=o,a.prototype.settlePromises=n),a.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if('function'!=typeof t){t._settlePromises();continue}var a=e.shift(),r=e.shift();t.call(a,r)}},a.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=i},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t){t.exports=function(e,t,a,r){var o=!1,n=function(t,a){this._reject(a)},i=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(n,n,null,this,t)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(t,e){e.promiseRejectionQueued||this._reject(t)};e.prototype.bind=function(n){o||(o=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var l=a(n),p=new e(t);p._propagateFrom(this,1);var d=this._target();if(p._setBoundTo(l),l instanceof e){var c={promiseRejectionQueued:!1,promise:p,target:d,bindingPromise:l};d._then(t,i,void 0,p,c),l._then(s,u,void 0,p,c),p._setOnCancel(l)}else p._resolveCallback(d);return p},e.prototype._setBoundTo=function(e){e===void 0?this._bitField&=-2097153:(this._bitField|=2097152,this._boundTo=e)},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,a){return e.resolve(a).bind(t)}}},{}],4:[function(e,t){var a;'undefined'!=typeof Promise&&(a=Promise);var r=e('./promise')();r.noConflict=function(){try{Promise===r&&(Promise=a)}catch(t){}return r},t.exports=r},{"./promise":22}],5:[function(e,t){var a=Object.create;if(a){var r=a(null),o=a(null);r[' size']=o[' size']=0}t.exports=function(t){function a(e,a){var r;if(null!=e&&(r=e[a]),'function'!=typeof r){var o='Object '+i.classString(e)+' has no method \''+i.toString(a)+'\'';throw new t.TypeError(o)}return r}function r(e){var t=this.pop(),r=a(e,t);return r.apply(e,this)}function o(e){return e[this]}function n(e){var t=+this;return 0>t&&(t=Sn(0,t+e.length)),e[t]}var i=e('./util'),s=i.canEvaluate,u=i.isIdentifier,l;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if(!!('number'==typeof e))t=n;else if(s){var a=l(e);t=null===a?o:a}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t){t.exports=function(t,a,r,o){var n=e('./util'),i=n.tryCatch,s=n.errorObj,u=t._async;t.prototype['break']=t.prototype.cancel=function(){if(!o.cancellation())return this._warn('cancellation is disabled');for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var a=e._cancellationParent;if(null==a||!a._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}else e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=a}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||0>=this._branchesRemainingToCancel},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):!(this._branchHasCancelled(),!this._enoughBranchesHaveCancelled())&&(this._invokeOnCancel(),!0)},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,a){if(n.isArray(t))for(var r=0;r<t.length;++r)this._doInvokeOnCancel(t[r],a);else if(t!==void 0)if('function'!=typeof t)t._resultCancelled(this);else if(!a){var o=i(t).call(this._boundValue());o===s&&(this._attachExtraTrace(o.e),u.throwLater(o.e))}},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t){t.exports=function(t){var a=e('./util'),r=e('./es5').keys,o=a.tryCatch,n=a.errorObj;return function(s,u,l){return function(p){var e=l._boundValue();predicateLoop:for(var d=0,i;d<s.length;++d)if(i=s[d],i===Error||null!=i&&i.prototype instanceof Error){if(p instanceof i)return o(u).call(e,p);}else if('function'==typeof i){var c=o(i).call(e,p);if(c===n)return c;if(c)return o(u).call(e,p)}else if(a.isObject(p)){for(var h=r(i),g=0,f;g<h.length;++g)if(f=h[g],i[f]!=p[f])continue predicateLoop;return o(u).call(e,p)}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t){t.exports=function(e){function t(){this._trace=new t.CapturedTrace(a())}function a(){var e=o.length-1;return 0<=e?o[e]:void 0}var r=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=function(){if(r)return new t},t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var o=e.prototype._pushContext,n=e.prototype._popContext,i=e._peekContext,s=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=o,e.prototype._popContext=n,e._peekContext=i,e.prototype._peekContext=s,e.prototype._promiseCreated=u,r=!1},r=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=a,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t){t.exports=function(t,a){function r(e,t){return{promise:t}}function o(){return!1}function n(e,t,a){var r=this;try{e(t,a,function(e){if('function'!=typeof e)throw new TypeError('onCancel must be a function, got: '+I.toString(e));r._attachCancellationCallback(e)})}catch(t){return t}}function i(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0===t?this._setOnCancel(e):I.isArray(t)?t.push(e):this._setOnCancel([t,e])}function s(){return this._onCancelField}function u(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function p(e,t){if(0!=(1&t)){this._cancellationParent=e;var a=e._branchesRemainingToCancel;void 0===a&&(a=0),e._branchesRemainingToCancel=a+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function d(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function c(){this._trace=new k(this._peekContext())}function h(e,t){if(E(e)){var a=this._trace;if(void 0!==a&&t&&(a=a._parent),void 0!==a)a.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=v(e);I.notEnumerableProp(e,'stack',r.message+'\n'+r.stack.join('\n')),I.notEnumerableProp(e,'__stackCleaned__',!0)}}}function g(e,a,r){if(te.warnings){var o=new D(e),n;if(a)r._attachExtraTrace(o);else if(te.longStackTraces&&(n=t._peekContext()))n.attachExtraTrace(o);else{var i=v(o);o.stack=i.message+'\n'+i.stack.join('\n')}Q('warning',o)||b(o,'',!0)}}function f(e,t){for(var a=0;a<t.length-1;++a)t[a].push('From previous event:'),t[a]=t[a].join('\n');return a<t.length&&(t[a]=t[a].join('\n')),e+'\n'+t.join('\n')}function m(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function _(e){for(var t=e[0],a=1;a<e.length;++a){for(var r=e[a],o=t.length-1,n=t[o],i=-1,s=r.length-1;0<=s;--s)if(r[s]===n){i=s;break}for(var s=i,u;0<=s&&(u=r[s],t[o]===u);--s)t.pop(),o--;t=r}}function x(e){for(var t=[],a=0;a<e.length;++a){var r=e[a],o='    (No stack trace)'===r||j.test(r),n=o&&Y(r);o&&!n&&(G&&' '!==r.charAt(0)&&(r='    '+r),t.push(r))}return t}function y(e){for(var t=e.stack.replace(/\s+$/g,'').split('\n'),a=0,r;a<t.length&&(r=t[a],!('    (No stack trace)'===r||j.test(r)));++a);return 0<a&&'SyntaxError'!=e.name&&(t=t.slice(a)),t}function v(e){var t=e.stack,a=e.toString();return t='string'==typeof t&&0<t.length?y(e):['    (No stack trace)'],{message:a,stack:'SyntaxError'==e.name?t:x(t)}}function b(e,t,a){if('undefined'!=typeof console){var r;if(I.isObject(e)){var o=e.stack;r=t+z(o,e)}else r=t+(e+'');'function'==typeof H?H(r,a):('function'==typeof console.log||'object'==typeof console.log)&&console.log(r)}}function S(e,t,a,r){var o=!1;try{'function'==typeof t&&(o=!0,'rejectionHandled'===e?t(r):t(a,r))}catch(t){M.throwLater(t)}'unhandledRejection'===e?!Q(e,a,r)&&!o&&b(a,'Unhandled rejection '):Q(e,r)}function T(e){var t;if('function'==typeof e)t='[function '+(e.name||'anonymous')+']';else{t=e&&'function'==typeof e.toString?e.toString():I.toString(e);var a=/\[object [a-zA-Z0-9$_]+\]/;if(a.test(t))try{var r=JSON.stringify(e);t=r}catch(t){}0===t.length&&(t='(empty array)')}return'(<'+P(t)+'>, no stack trace)'}function P(e){var t=41;return e.length<t?e:e.substr(0,t-3)+'...'}function w(){return'function'==typeof ee}function C(e){var t=e.match(J);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function k(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ee(this,k),32<t&&this.uncycle()}var F=t._getDomain,M=t._async,D=e('./errors').Warning,I=e('./util'),E=I.canAttachTrace,R=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,A=/\((?:timers\.js):\d+:\d+\)/,L=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,j=null,z=null,G=!1,O=!(0==I.env('BLUEBIRD_DEBUG')||0),q=!!(0!=I.env('BLUEBIRD_WARNINGS')&&(O||I.env('BLUEBIRD_WARNINGS'))),U=!!(0!=I.env('BLUEBIRD_LONG_STACK_TRACES')&&(O||I.env('BLUEBIRD_LONG_STACK_TRACES'))),N=0!=I.env('BLUEBIRD_W_FORGOTTEN_RETURN')&&(q||!!I.env('BLUEBIRD_W_FORGOTTEN_RETURN')),B,V,H;t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=524288|-1048577&e._bitField},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){S('rejectionHandled',B,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField|=268435456},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),S('unhandledRejection',V,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField|=262144},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField&=-262145},t.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},t.prototype._setRejectionIsUnhandled=function(){this._bitField|=1048576},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField&=-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},t.prototype._warn=function(e,t,a){return g(e,t,a||this)},t.onPossiblyUnhandledRejection=function(e){var t=F();V='function'==typeof e?null===t?e:I.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=F();B='function'==typeof e?null===t?e:I.domainBind(t,e):void 0};var W=function(){};t.longStackTraces=function(){if(M.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');if(!te.longStackTraces&&w()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;te.longStackTraces=!0,W=function(){if(M.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,a.deactivateLongStackTraces(),M.enableTrampoline(),te.longStackTraces=!1},t.prototype._captureStackTrace=c,t.prototype._attachExtraTrace=h,a.activateLongStackTraces(),M.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return te.longStackTraces&&w()};var X=function(){try{if('function'==typeof CustomEvent){var e=new CustomEvent('CustomEvent');return I.global.dispatchEvent(e),function(e,t){var a=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!I.global.dispatchEvent(a)}}if('function'==typeof Event){var e=new Event('CustomEvent');return I.global.dispatchEvent(e),function(e,t){var a=new Event(e.toLowerCase(),{cancelable:!0});return a.detail=t,!I.global.dispatchEvent(a)}}var e=document.createEvent('CustomEvent');return e.initCustomEvent('testingtheevent',!1,!0,{}),I.global.dispatchEvent(e),function(e,t){var a=document.createEvent('CustomEvent');return a.initCustomEvent(e.toLowerCase(),!1,!0,t),!I.global.dispatchEvent(a)}}catch(t){}return function(){return!1}}(),$=function(){return I.isNode?function(){return process.emit.apply(process,arguments)}:I.global?function(e){var t='on'+e.toLowerCase(),a=I.global[t];return!!a&&(a.apply(I.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),K={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(e,t,a){return{promise:t,child:a}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,a){return{reason:t,promise:a}},rejectionHandled:r},Q=function(e){var t=!1;try{t=$.apply(null,arguments)}catch(a){M.throwLater(a),t=!0}var a=!1;try{a=X(e,K[e].apply(null,arguments))}catch(t){M.throwLater(t),a=!0}return a||t};t.config=function(e){if(e=Object(e),'longStackTraces'in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&W()),'warnings'in e){var a=e.warnings;te.warnings=!!a,N=te.warnings,I.isObject(a)&&'wForgottenReturn'in a&&(N=!!a.wForgottenReturn)}if('cancellation'in e&&e.cancellation&&!te.cancellation){if(M.haveItemsQueued())throw new Error('cannot enable cancellation after promises are in use');t.prototype._clearCancellationData=l,t.prototype._propagateFrom=p,t.prototype._onCancel=s,t.prototype._setOnCancel=u,t.prototype._attachCancellationCallback=i,t.prototype._execute=n,Z=p,te.cancellation=!0}return'monitoring'in e&&(e.monitoring&&!te.monitoring?(te.monitoring=!0,t.prototype._fireEvent=Q):!e.monitoring&&te.monitoring&&(te.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,a){try{e(t,a)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(){},t.prototype._attachCancellationCallback=function(){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(){};var Z=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},Y=function(){return!1},J=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;I.inherits(k,Error),a.CapturedTrace=k,k.prototype.uncycle=function(){var e=this._length;if(!(2>e)){for(var t=[],a={},r=0,o=this;void 0!==o;++r)t.push(o),o=o._parent;e=this._length=r;for(var r=e-1,n;0<=r;--r)n=t[r].stack,void 0===a[n]&&(a[n]=r);for(var r=0;r<e;++r){var i=t[r].stack,s=a[i];if(void 0!==s&&s!==r){0<s&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var u=0<r?t[r-1]:this;s<e-1?(u._parent=t[s+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var l=u._length+1,p=r-2;0<=p;--p)t[p]._length=l,l++;return}}}},k.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=v(e),a=t.message,r=[t.stack],o=this;void 0!==o;)r.push(x(o.stack.split('\n'))),o=o._parent;_(r),m(r),I.notEnumerableProp(e,'stack',f(a,r)),I.notEnumerableProp(e,'__stackCleaned__',!0)}};var ee=function(){var e=/^\s*at\s*/,t=function(e,t){return'string'==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():T(t)};if('number'==typeof Error.stackTraceLimit&&'function'==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,j=e,z=t;var a=Error.captureStackTrace;return Y=function(e){return R.test(e)},function(e,t){Error.stackTraceLimit+=6,a(e,t),Error.stackTraceLimit-=6}}var r=new Error;if('string'==typeof r.stack&&0<=r.stack.split('\n')[0].indexOf('stackDetection@'))return j=/@/,z=t,G=!0,function(e){e.stack=new Error().stack};var o;try{throw new Error}catch(t){o='stack'in t}return!('stack'in r)&&o&&'number'==typeof Error.stackTraceLimit?(j=e,z=t,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(a){t.stack=a.stack}Error.stackTraceLimit-=6}):(z=function(e,t){return'string'==typeof e?e:('object'==typeof t||'function'==typeof t)&&void 0!==t.name&&void 0!==t.message?t.toString():T(t)},null)}([]);'undefined'!=typeof console&&'undefined'!=typeof console.warn&&(H=function(e){console.warn(e)},I.isNode&&process.stderr.isTTY?H=function(e,t){var a=t?'\x1B[33m':'\x1B[31m';console.warn(a+e+'\x1B[0m\n')}:!I.isNode&&'string'==typeof new Error().stack&&(H=function(e,t){console.warn('%c'+e,t?'color: darkorange':'color: red')}));var te={warnings:q,longStackTraces:!1,cancellation:!1,monitoring:!1};return U&&t.longStackTraces(),{longStackTraces:function(){return te.longStackTraces},warnings:function(){return te.warnings},cancellation:function(){return te.cancellation},monitoring:function(){return te.monitoring},propagateFromFunction:function(){return Z},boundValueFunction:function(){return d},checkForgottenReturns:function(e,t,a,r,o){if(void 0===e&&null!==t&&N){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&r._bitField))return;a&&(a+=' ');var n='',s='';if(t._trace){for(var u=t._trace.stack.split('\n'),l=x(u),p=l.length-1,i;0<=p;--p)if(i=l[p],!A.test(i)){var d=i.match(L);d&&(n='at '+d[1]+':'+d[2]+':'+d[3]+' ');break}if(0<l.length)for(var c=l[0],p=0;p<u.length;++p)if(u[p]===c){0<p&&(s='\n'+u[p-1]);break}}var h='a promise was created in a '+a+'handler '+n+'but was not returned from it, see http://goo.gl/rRqMUw'+s;r._warn(h,!0,t)}},setBounds:function(e,t){if(w()){for(var a=e.stack.split('\n'),r=t.stack.split('\n'),o=-1,n=-1,s=0,i,u,l;s<a.length;++s)if(l=C(a[s]),l){i=l.fileName,o=l.line;break}for(var s=0,l;s<r.length;++s)if(l=C(r[s]),l){u=l.fileName,n=l.line;break}0>o||0>n||!i||!u||i!==u||o>=n||(Y=function(e){if(R.test(e))return!0;var t=C(e);return t&&t.fileName===i&&o<=t.line&&t.line<=n})}},warn:g,deprecated:function(e,t){var a=e+' is deprecated and will be removed in a future version.';return t&&(a+=' Use '+t+' instead.'),g(a)},CapturedTrace:k,fireDomEvent:X,fireGlobalEvent:$}}},{"./errors":12,"./util":36}],10:[function(e,t){t.exports=function(e){function t(){return this.value}function a(){throw this.reason}e.prototype['return']=e.prototype.thenReturn=function(a){return a instanceof e&&a.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:a},void 0)},e.prototype['throw']=e.prototype.thenThrow=function(e){return this._then(a,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(1>=arguments.length)return this._then(void 0,a,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},e.prototype.catchReturn=function(a){if(1>=arguments.length)return a instanceof e&&a.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:a},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();return this.caught(a,function(){return r})}}},{}],11:[function(e,t){t.exports=function(e,t){function a(){return o(this)}var r=e.reduce,o=e.all;e.prototype.each=function(e){return r(this,e,t,0)._then(a,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,o){return r(e,o,t,0)._then(a,void 0,void 0,e,void 0)},e.mapSeries=function(e,a){return r(e,a,t,t)}}},{}],12:[function(e,t){function a(e,t){function a(r){return this instanceof a?void(l(this,'message','string'==typeof r?r:t),l(this,'name',e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)):new a(r)}return u(a,Error),a}function r(e){return this instanceof r?void(l(this,'name','OperationalError'),l(this,'message',e),this.cause=e,this.isOperational=!0,e instanceof Error?(l(this,'message',e.message),l(this,'stack',e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)):new r(e)}var o=e('./es5'),n=o.freeze,s=e('./util'),u=s.inherits,l=s.notEnumerableProp,p=a('Warning','warning'),d=a('CancellationError','cancellation error'),c=a('TimeoutError','timeout error'),h=a('AggregateError','aggregate error'),g,f;try{g=TypeError,f=RangeError}catch(t){g=a('TypeError','type error'),f=a('RangeError','range error')}for(var m='join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse'.split(' '),_=0;_<m.length;++_)'function'==typeof Array.prototype[m[_]]&&(h.prototype[m[_]]=Array.prototype[m[_]]);o.defineProperty(h.prototype,'length',{value:0,configurable:!1,writable:!0,enumerable:!0}),h.prototype.isOperational=!0;var x=0;h.prototype.toString=function(){var e=Array(4*x+1).join(' '),t='\n'+e+'AggregateError of:\n';x++,e=Array(4*x+1).join(' ');for(var a=0;a<this.length;++a){for(var r=this[a]===this?'[Circular AggregateError]':this[a]+'',o=r.split('\n'),n=0;n<o.length;++n)o[n]=e+o[n];r=o.join('\n'),t+=r+'\n'}return x--,t},u(r,Error);var i=Error.__BluebirdErrorTypes__;i||(i=n({CancellationError:d,TimeoutError:c,OperationalError:r,RejectionError:r,AggregateError:h}),o.defineProperty(Error,'__BluebirdErrorTypes__',{value:i,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:g,RangeError:f,CancellationError:i.CancellationError,OperationalError:i.OperationalError,TimeoutError:i.TimeoutError,AggregateError:i.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t){var a=function(){return this===void 0}();if(a)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(e,t){var a=Object.getOwnPropertyDescriptor(e,t);return!!(!a||a.writable||a.set)}};else{var r={}.hasOwnProperty,o={}.toString,n={}.constructor.prototype,i=function(e){var t=[];for(var a in e)r.call(e,a)&&t.push(a);return t},s=function(e,t){return{value:e[t]}},u=function(e,t,a){return e[t]=a.value,e},l=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(t){return n}},d=function(e){try{return'[object Array]'===o.call(e)}catch(t){return!1}};t.exports={isArray:d,keys:i,names:i,defineProperty:u,getDescriptor:s,freeze:l,getPrototypeOf:p,isES5:a,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t){t.exports=function(e,t){var a=e.map;e.prototype.filter=function(e,r){return a(this,e,r,t)},e.filter=function(e,r,o){return a(e,r,o,t)}}},{}],15:[function(e,t){t.exports=function(t,a,r){function o(e,t,a){this.promise=e,this.type=t,this.handler=a,this.called=!1,this.cancelPromise=null}function n(e){this.finallyHandler=e}function i(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return l.call(this,this.promise._target()._settledValue())}function u(e){if(!i(this,e))return c.e=e,c}function l(e){var o=this.promise,l=this.handler;if(!this.called){this.called=!0;var p=this.isFinallyHandler()?l.call(o._boundValue()):l.call(o._boundValue(),e);if(p===r)return p;if(void 0!==p){o._setReturnedNonUndefined();var h=a(p,o);if(h instanceof t){if(null!=this.cancelPromise){if(h._isCancelled()){var g=new d('late cancellation observer');return o._attachExtraTrace(g),c.e=g,c}h.isPending()&&h._attachCancellationCallback(new n(this))}return h._then(s,u,void 0,this,void 0)}}}return o.isRejected()?(i(this),c.e=e,c):(i(this),e)}var p=e('./util'),d=t.CancellationError,c=p.errorObj,h=e('./catch_filter')(r);return o.prototype.isFinallyHandler=function(){return 0===this.type},n.prototype._resultCancelled=function(){i(this.finallyHandler)},t.prototype._passThrough=function(e,t,a,r){return'function'==typeof e?this._then(a,r,void 0,new o(this,t,e),void 0):this.then()},t.prototype.lastly=t.prototype['finally']=function(e){return this._passThrough(e,0,l,l)},t.prototype.tap=function(e){return this._passThrough(e,1,l)},t.prototype.tapCatch=function(e){var a=arguments.length;if(1===a)return this._passThrough(e,1,void 0,l);var r=Array(a-1),o=0,n;for(n=0;n<a-1;++n){var i=arguments[n];if(p.isObject(i))r[o++]=i;else return t.reject(new TypeError('tapCatch statement predicate: expecting an object but got '+p.classString(i)))}r.length=o;var s=arguments[n];return this._passThrough(h(r,s,this),1,void 0,l)},o}},{"./catch_filter":7,"./util":36}],16:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,a,r){for(var n=0;n<a.length;++n){r._pushContext();var i=h(a[n])(e);if(r._popContext(),i===c){r._pushContext();var s=t.reject(c.e);return r._popContext(),s}var u=o(i,r);if(u instanceof t)return u}return null}function u(e,a,o,n){if(i.cancellation()){var s=new t(r),u=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return u}),s._captureStackTrace(),s._setOnCancel(this)}else{var l=this._promise=new t(r);l._captureStackTrace()}this._stack=n,this._generatorFunction=e,this._receiver=a,this._generator=void 0,this._yieldHandlers='function'==typeof o?[o].concat(g):g,this._yieldedPromise=null,this._cancellationPhase=!1}var l=e('./errors'),p=l.TypeError,d=e('./util'),c=d.errorObj,h=d.tryCatch,g=[];d.inherits(u,n),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,i.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e='undefined'!=typeof this._generator['return'],a;if(!e){var r=new t.CancellationError('generator .return() sentinel');t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),a=h(this._generator['throw']).call(this._generator,r),this._promise._popContext()}else this._promise._pushContext(),a=h(this._generator['return']).call(this._generator,void 0),this._promise._popContext();this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(a)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator['throw']).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var a=this._promise;if(e===c)return this._cleanup(),this._cancellationPhase?a.cancel():a._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?a.cancel():a._resolveCallback(r);var n=o(r,this._promise);if(!(n instanceof t)&&(n=s(n,this._yieldHandlers,this._promise),null===n))return void this._promiseRejected(new p('A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n'.replace('%s',r+'')+'From coroutine:\n'+this._stack.split('\n').slice(1,-7).join('\n')));n=n._target();var i=n._bitField;0==(50397184&i)?(this._yieldedPromise=n,n._proxy(this,null)):0==(33554432&i)?0==(16777216&i)?this._promiseCancelled():t._async.invoke(this._promiseRejected,this,n._reason()):t._async.invoke(this._promiseFulfilled,this,n._value())},t.coroutine=function(e,t){if('function'!=typeof e)throw new p('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var a=Object(t).yieldHandler,r=new Error().stack;return function(){var t=e.apply(this,arguments),o=new u(void 0,void 0,a,r),n=o.promise();return o._generator=t,o._promiseFulfilled(void 0),n}},t.coroutine.addYieldHandler=function(e){if('function'!=typeof e)throw new p('expecting a function but got '+d.classString(e));g.push(e)},t.spawn=function(e){if(i.deprecated('Promise.spawn()','Promise.coroutine()'),'function'!=typeof e)return a('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var r=new u(e,this),o=r.promise();return r._run(t.spawn),o}}},{"./errors":12,"./util":36}],17:[function(e,t){t.exports=function(t,a){var r=e('./util'),o=r.canEvaluate,n=r.tryCatch,i=r.errorObj;t.join=function(){var e=arguments.length-1,t;if(0<e&&'function'==typeof arguments[e]){t=arguments[e];var r}var o=[].slice.call(arguments);t&&o.pop();var r=new a(o).promise();return t===void 0?r:r.spread(t)}}},{"./util":36}],18:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,t,a,r){this.constructor$(e),this._promise._captureStackTrace();var o=l();this._callback=null===o?t:p.domainBind(o,t),this._preservedValues=r===n?Array(this.length()):null,this._limit=a,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function u(e,a,o,n){if('function'!=typeof a)return r('expecting a function but got '+p.classString(a));var i=0;if(void 0!==o)if('object'==typeof o&&null!==o){if('number'!=typeof o.concurrency)return t.reject(new TypeError('\'concurrency\' must be a number but it is '+p.classString(o.concurrency)));i=o.concurrency}else return t.reject(new TypeError('options argument must be an object but it is '+p.classString(o)));return i='number'==typeof i&&isFinite(i)&&1<=i?i:0,new s(e,a,i,n).promise()}var l=t._getDomain,p=e('./util'),d=p.tryCatch,c=p.errorObj,h=t._async;p.inherits(s,a),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,a){var r=this._values,n=this.length(),s=this._preservedValues,u=this._limit;if(!(0>a)){if(1<=u&&this._inFlight>=u)return r[a]=e,this._queue.push(a),!1;null!==s&&(s[a]=e);var l=this._promise,p=this._callback,h=l._boundValue();l._pushContext();var g=d(p).call(h,e,a,n),f=l._popContext();if(i.checkForgottenReturns(g,f,null===s?'Promise.map':'Promise.filter',l),g===c)return this._reject(g.e),!0;var m=o(g,this._promise);if(m instanceof t){m=m._target();var _=m._bitField;if(0==(50397184&_))return 1<=u&&this._inFlight++,r[a]=m,m._proxy(this,-1*(a+1)),!1;if(0!=(33554432&_))g=m._value();else return 0==(16777216&_)?(this._cancel(),!0):(this._reject(m._reason()),!0)}r[a]=g}else if(a=-1*a-1,r[a]=e,1<=u&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0;var x=++this._totalResolved;return!!(x>=n)&&(null===s?this._resolve(r):this._filter(r,s),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,a=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(a[r],r)}},s.prototype._filter=function(e,t){for(var a=t.length,r=Array(a),o=0,n=0;n<a;++n)e[n]&&(r[o++]=t[n]);r.length=o,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,a,r){return u(e,t,a,r)}}},{"./util":36}],19:[function(e,t){t.exports=function(t,a,r,o,n){var i=e('./util'),s=i.tryCatch;t.method=function(e){if('function'!=typeof e)throw new t.TypeError('expecting a function but got '+i.classString(e));return function(){var r=new t(a);r._captureStackTrace(),r._pushContext();var o=s(e).apply(this,arguments),i=r._popContext();return n.checkForgottenReturns(o,i,'Promise.method',r),r._resolveFromSyncValue(o),r}},t.attempt=t['try']=function(e){if('function'!=typeof e)return o('expecting a function but got '+i.classString(e));var r=new t(a);r._captureStackTrace(),r._pushContext();var u;if(1<arguments.length){n.deprecated('calling Promise.try with more than 1 argument');var l=arguments[1],p=arguments[2];u=i.isArray(l)?s(e).apply(p,l):s(e).call(p,l)}else u=s(e)();var d=r._popContext();return n.checkForgottenReturns(u,d,'Promise.try',r),r._resolveFromSyncValue(u),r},t.prototype._resolveFromSyncValue=function(e){e===i.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t){function a(e){return e instanceof Error&&u.getPrototypeOf(e)===Error.prototype}function r(e){var t;if(a(e)){t=new s(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=u.keys(e),n=0,i;n<r.length;++n)i=r[n],l.test(i)||(t[i]=e[i]);return t}return o.markAsOriginatingFromRejection(e),e}var o=e('./util'),n=o.maybeWrapAsError,i=e('./errors'),s=i.OperationalError,u=e('./es5'),l=/^(?:name|message|stack|cause)$/;t.exports=function(e,t){return function(a,o){if(null!==e){if(a){var i=r(n(a));e._attachExtraTrace(i),e._reject(i)}else if(!t)e._fulfill(o);else{var s=[].slice.call(arguments,1);e._fulfill(s)}e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t){t.exports=function(t){function a(e,t){var a=this;if(!n.isArray(e))return r.call(a,e,t);var o=s(t).apply(a._boundValue(),[null].concat(e));o===u&&i.throwLater(o.e)}function r(e,t){var a=this,r=a._boundValue(),o=e===void 0?s(t).call(r,null):s(t).call(r,null,e);o===u&&i.throwLater(o.e)}function o(e,t){var a=this;if(!e){var r=new Error(e+'');r.cause=e,e=r}var o=s(t).call(a._boundValue(),e);o===u&&i.throwLater(o.e)}var n=e('./util'),i=t._async,s=n.tryCatch,u=n.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if('function'==typeof e){var n=r;t!==void 0&&Object(t).spread&&(n=a),this._then(n,o,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t){t.exports=function(){function a(){}function r(e,t){if(null==e||e.constructor!==o)throw new y('the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n');if('function'!=typeof t)throw new y('expecting a function but got '+c.classString(t))}function o(e){e!==v&&r(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent('promiseCreated',this)}function n(e){this.promise._resolveCallback(e)}function i(e){this.promise._rejectCallback(e,!1)}function s(e){var t=new o(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u=function(){return new y('circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n')},l=function(){return new o.PromiseInspection(this._target())},p=function(e){return o.reject(new y(e))},d={},c=e('./util'),h;h=c.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},c.notEnumerableProp(o,'_getDomain',h);var g=e('./es5'),f=e('./async'),m=new f;g.defineProperty(o,'_async',{value:m});var _=e('./errors'),y=o.TypeError=_.TypeError;o.RangeError=_.RangeError;var x=o.CancellationError=_.CancellationError;o.TimeoutError=_.TimeoutError,o.OperationalError=_.OperationalError,o.RejectionError=_.OperationalError,o.AggregateError=_.AggregateError;var v=function(){},b={},S={},T=e('./thenables')(o,v),P=e('./promise_array')(o,v,T,p,a),w=e('./context')(o),C=w.create,k=e('./debuggability')(o,w),F=k.CapturedTrace,M=e('./finally')(o,T,S),D=e('./catch_filter')(S),I=e('./nodeback'),E=c.errorObj,R=c.tryCatch;return o.prototype.toString=function(){return'[object Promise]'},o.prototype.caught=o.prototype['catch']=function(e){var t=arguments.length;if(1<t){var a=Array(t-1),r=0,o;for(o=0;o<t-1;++o){var n=arguments[o];if(c.isObject(n))a[r++]=n;else return p('Catch statement predicate: expecting an object but got '+c.classString(n))}return a.length=r,e=arguments[o],this.then(void 0,D(a,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},o.prototype.then=function(e,t){if(k.warnings()&&0<arguments.length&&'function'!=typeof e&&'function'!=typeof t){var a='.then() only accepts functions but was passed: '+c.classString(e);1<arguments.length&&(a+=', '+c.classString(t)),this._warn(a)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){var a=this._then(e,t,void 0,void 0,void 0);a._setIsFinal()},o.prototype.spread=function(e){return'function'==typeof e?this.all()._then(e,void 0,void 0,b,void 0):p('expecting a function but got '+c.classString(e))},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return 0<arguments.length&&this._warn('.all() was passed arguments but it does not take any'),new P(this).promise()},o.prototype.error=function(e){return this.caught(c.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(v);t._captureStackTrace();var a=!!(1<arguments.length)&&!!Object(arguments[1]).multiArgs,r=R(e)(I(t,a));return r===E&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new P(e).promise()},o.cast=function(e){var t=T(e);return t instanceof o||(t=new o(v),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if('function'!=typeof e)throw new y('expecting a function but got '+c.classString(e));return m.setScheduler(e)},o.prototype._then=function(e,t,a,r,n){var i=void 0!==n,s=i?n:new o(v),u=this._target(),l=u._bitField;i||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(0==(50397184&l)?r=u===this?void 0:this._boundTo:r=this._boundValue()),this._fireEvent('promiseChained',this,s));var p=h();if(0!=(50397184&l)){var d=u._settlePromiseCtx,g,f;0==(33554432&l)?0==(16777216&l)?(d=u._settlePromiseLateCancellationObserver,f=new x('late cancellation observer'),u._attachExtraTrace(f),g=t):(f=u._fulfillmentHandler0,g=t,u._unsetRejectionIsUnhandled()):(f=u._rejectionHandler0,g=e),m.invoke(d,u,{handler:null===p?g:'function'==typeof g&&c.domainBind(p,g),promise:s,receiver:r,value:f})}else u._addCallbacks(e,t,s,r,p);return s},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField|=33554432,this._fireEvent('promiseFulfilled',this)},o.prototype._setRejected=function(){this._bitField|=16777216,this._fireEvent('promiseRejected',this)},o.prototype._setFollowing=function(){this._bitField|=67108864,this._fireEvent('promiseResolved',this)},o.prototype._setIsFinal=function(){this._bitField|=4194304},o.prototype._isFinal=function(){return 0<(4194304&this._bitField)},o.prototype._unsetCancelled=function(){this._bitField&=-65537},o.prototype._setCancelled=function(){this._bitField|=65536,this._fireEvent('promiseCancelled',this)},o.prototype._setWillBeCancelled=function(){this._bitField|=8388608},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField|=134217728)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==d)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=e._bitField,a=e._fulfillmentHandler0,r=e._rejectionHandler0,o=e._promise0,n=e._receiverAt(0);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._migrateCallbackAt=function(e,t){var a=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),o=e._promiseAt(t),n=e._receiverAt(t);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._addCallbacks=function(e,t,a,r,o){var n=this._length();if(65531<=n&&(n=0,this._setLength(0)),0===n)this._promise0=a,this._receiver0=r,'function'==typeof e&&(this._fulfillmentHandler0=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this._rejectionHandler0=null===o?t:c.domainBind(o,t));else{var i=4*n-4;this[i+2]=a,this[i+3]=r,'function'==typeof e&&(this[i+0]=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this[i+1]=null===o?t:c.domainBind(o,t))}return this._setLength(n+1),n},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(u(),!1);var a=T(e,this);if(!(a instanceof o))return this._fulfill(e);t&&this._propagateFrom(a,2);var r=a._target();if(r===this)return void this._reject(u());var n=r._bitField;if(0==(50397184&n)){var s=this._length();0<s&&r._migrateCallback0(this);for(var l=1;l<s;++l)r._migrateCallbackAt(this,l);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&n))this._fulfill(r._value());else if(0!=(16777216&n))this._reject(r._reason());else{var i=new x('late cancellation observer');r._attachExtraTrace(i),this._reject(i)}}},o.prototype._rejectCallback=function(e,t,a){var r=c.ensureErrorObject(e),o=r===e;if(!o&&!a&&k.warnings()){var n='a promise was rejected with a non-error: '+c.classString(e);this._warn(n,!0)}this._attachExtraTrace(r,!!t&&o),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==v){var t=this;this._captureStackTrace(),this._pushContext();var a=!0,o=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,a)});a=!1,this._popContext(),void 0!==o&&t._rejectCallback(o,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,a,r){var o=r._bitField;if(0==(65536&o)){r._pushContext();var n;t===b?a&&'number'==typeof a.length?n=R(e).apply(this._boundValue(),a):(n=E,n.e=new y('cannot .spread() a non-array: '+c.classString(a))):n=R(e).call(t,a);var i=r._popContext();o=r._bitField,0!=(65536&o)||(n===S?r._reject(a):n===E?r._rejectCallback(n.e,!1):(k.checkForgottenReturns(n,i,'',r,this),r._resolveCallback(n)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,r,n){var i=e instanceof o,s=this._bitField,u=0!=(134217728&s);0==(65536&s)?'function'==typeof t?i?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,n,e)):t.call(r,n,e):r instanceof a?!r._isResolved()&&(0==(33554432&s)?r._promiseRejected(n,e):r._promiseFulfilled(n,e)):i&&(u&&e._setAsyncGuaranteed(),0==(33554432&s)?e._reject(n):e._fulfill(n)):(i&&e._invokeInternalOnCancel(),r instanceof M&&r.isFinallyHandler()?(r.cancelPromise=e,R(t).call(r,n)===E&&e._reject(E.e)):t===l?e._fulfill(l.call(r)):r instanceof a?r._promiseCancelled(e):i||e instanceof P?e._cancel():r.cancel())},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,a=e.promise,r=e.receiver,n=e.value;'function'==typeof t?a instanceof o?this._settlePromiseFromHandler(t,r,n,a):t.call(r,n,a):a instanceof o&&a._reject(n)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t){var a=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(a,e,r,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var a=u();return this._attachExtraTrace(a),this._reject(a)}this._setFulfilled(),this._rejectionHandler0=e,0<(65535&t)&&(0==(134217728&t)?m.settlePromises(this):this._settlePromises())}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=e,this._isFinal()?m.fatalError(e,c.isNode):void(0<(65535&t)?m.settlePromises(this):this._ensurePossibleRejectionHandled())},o.prototype._fulfillPromises=function(e,t){for(var a=1;a<e;a++){var r=this._fulfillmentHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._rejectPromises=function(e,t){for(var a=1;a<e;a++){var r=this._rejectionHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(0<t){if(0!=(16842752&e)){var a=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,a,e),this._rejectPromises(t,a)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0==(33554432&e)?0==(16777216&e)?void 0:this._fulfillmentHandler0:this._rejectionHandler0},o.defer=o.pending=function(){k.deprecated('Promise.defer','new Promise');var e=new o(v);return{promise:e,resolve:n,reject:i}},c.notEnumerableProp(o,'_makeSelfResolutionError',u),e('./method')(o,v,T,p,k),e('./bind')(o,v,T,k),e('./cancel')(o,P,p,k),e('./direct_resolve')(o),e('./synchronous_inspection')(o),e('./join')(o,P,T,v,m,h),o.Promise=o,o.version='3.5.1',e('./map.js')(o,P,p,T,v,k),e('./call_get.js')(o),e('./using.js')(o,p,T,C,v,k),e('./timers.js')(o,v,k),e('./generators.js')(o,p,v,T,a,k),e('./nodeify.js')(o),e('./promisify.js')(o,v),e('./props.js')(o,P,T,p),e('./race.js')(o,v,T,p),e('./reduce.js')(o,P,p,T,v,k),e('./settle.js')(o,P,k),e('./some.js')(o,P,p),e('./filter.js')(o,v),e('./each.js')(o,v),e('./any.js')(o),c.toFastProperties(o),c.toFastProperties(o.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new o(v)),k.setBounds(f.firstLineError,c.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t){t.exports=function(t,a,r,o,n){function i(e){return-2===e?[]:-3===e?{}:-6===e?new Map:void 0}function s(e){var r=this._promise=new t(a);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e('./util'),l=u.isArray;return u.inherits(s,n),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(a,n){var s=r(this._values,this._promise);if(s instanceof t){s=s._target();var l=s._bitField;if(this._values=s,0==(50397184&l))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,n);if(0!=(33554432&l))s=s._value();else return 0==(16777216&l)?this._cancel():this._reject(s._reason())}if(s=u.asArray(s),null===s){var p=o('expecting an array or an iterable object but got '+u.classString(s)).reason();return void this._promise._rejectCallback(p,!1)}return 0===s.length?void(-5===n?this._resolveEmptyArray():this._resolve(i(n))):void this._iterate(s)},s.prototype._iterate=function(e){var a=this.getActualLength(e.length);this._length=a,this._values=this.shouldCopyValues()?Array(a):this._values;for(var o=this._promise,n=!1,s=null,u=0,i;u<a;++u)i=r(e[u],o),i instanceof t?(i=i._target(),s=i._bitField):s=null,n?null!==s&&i.suppressUnhandledRejections():null===s?n=this._promiseFulfilled(i,u):0==(50397184&s)?(i._proxy(this,u),this._values[u]=i):0==(33554432&s)?0==(16777216&s)?n=this._promiseCancelled(u):n=this._promiseRejected(i._reason(),u):n=this._promiseFulfilled(i._value(),u);n||o._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){this._isResolved()||!this._promise._isCancellable()||(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var a=0;a<e.length;++a)e[a]instanceof t&&e[a].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t){t.exports=function(t,a){function r(e){return!x.test(e)}function o(e){try{return!0===e.__isPromisified__}catch(t){return!1}}function n(e,t,a){var r=d.getDataPropertyOrDefault(e,t+a,_);return!!r&&o(r)}function s(e,t,a){for(var r=0,o;r<e.length;r+=2)if(o=e[r],a.test(o))for(var n=o.replace(a,''),i=0;i<e.length;i+=2)if(e[i]===n)throw new m('Cannot promisify an API that has normal methods with \'%s\'-suffix\n\n    See http://goo.gl/MqrFmX\n'.replace('%s',t))}function u(e,t,a,r){for(var u=d.inheritedDataKeys(e),l=[],p=0;p<u.length;++p){var i=u[p],c=e[i],h=r===y||y(i,c,e);'function'!=typeof c||o(c)||n(e,i,t)||!r(i,c,e,h)||l.push(i,c)}return s(l,t,a),l}function l(e,t,a,r,o){for(var n=new RegExp(v(t)+'$'),s=u(e,t,n,a),l=0,i=s.length;l<i;l+=2){var c=s[l],h=s[l+1],g=c+t;if(r===b)e[g]=b(c,p,c,h,t,o);else{var f=r(h,function(){return b(c,p,c,h,t,o)});d.notEnumerableProp(f,'__isPromisified__',!0),e[g]=f}}return d.toFastProperties(e),e}function i(e,t,a){return b(e,t,void 0,e,null,a)}var p={},d=e('./util'),c=e('./nodeback'),h=d.withAppended,g=d.maybeWrapAsError,f=d.canEvaluate,m=e('./errors').TypeError,_={__isPromisified__:!0},x=new RegExp('^(?:'+['arity','length','name','arguments','caller','callee','prototype','__isPromisified__'].join('|')+')$'),y=function(e){return d.isIdentifier(e)&&'_'!==e.charAt(0)&&'constructor'!==e},v=function(e){return e.replace(/([$])/,'\\$')},b=f?S:function(e,r,o,n,i,s){function u(){var o=r;r===p&&(o=this);var n=new t(a);n._captureStackTrace();var i='string'==typeof f&&this!==l?this[f]:e,u=c(n,s);try{i.apply(o,h(arguments,u))}catch(t){n._rejectCallback(g(t),!0,!0)}return n._isFateSealed()||n._setAsyncGuaranteed(),n}var l=function(){return this}(),f=e;return'string'==typeof f&&(e=n),d.notEnumerableProp(u,'__isPromisified__',!0),u},S;t.promisify=function(e,t){if('function'!=typeof e)throw new m('expecting a function but got '+d.classString(e));if(o(e))return e;t=Object(t);var a=void 0===t.context?p:t.context,n=!!t.multiArgs,s=i(e,a,n);return d.copyDescriptors(e,s,r),s},t.promisifyAll=function(e,t){if('function'!=typeof e&&'object'!=typeof e)throw new m('the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n');t=Object(t);var a=!!t.multiArgs,r=t.suffix;'string'!=typeof r&&(r='Async');var o=t.filter;'function'!=typeof o&&(o=y);var n=t.promisifier;if('function'!=typeof n&&(n=b),!d.isIdentifier(r))throw new RangeError('suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n');for(var s=d.inheritedDataKeys(e),u=0,i;u<s.length;++u)i=e[s[u]],'constructor'!==s[u]&&d.isClass(i)&&(l(i.prototype,r,o,n,a),l(i,r,o,n,a));return l(e,r,o,n,a)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t){t.exports=function(t,a,r,o){function n(e){var t=!1,a;if(p!==void 0&&e instanceof p)a=d(e),t=!0;else{var r=l.keys(e),o=r.length;a=Array(2*o);for(var n=0,i;n<o;++n)i=r[n],a[n]=e[i],a[n+o]=i}this.constructor$(a),this._isMap=t,this._init$(void 0,t?-6:-3)}function i(e){var a=r(e),i;return u(a)?(i=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new n(a).promise(),a instanceof t&&i._propagateFrom(a,2),i):o('cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n')}var s=e('./util'),u=s.isObject,l=e('./es5'),p;'function'==typeof Map&&(p=Map);var d=function(){function e(e,r){this[t]=e,this[t+a]=r,t++}var t=0,a=0;return function(r){a=r.size,t=0;var o=Array(2*r.size);return r.forEach(e,o),o}}(),c=function(e){for(var t=new p,a=0|e.length/2,r=0;r<a;++r){var o=e[a+r],n=e[r];t.set(o,n)}return t};s.inherits(n,a),n.prototype._init=function(){},n.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;if(a>=this._length){var r;if(this._isMap)r=c(this._values);else{r={};for(var o=this.length(),n=0,i=this.length();n<i;++n)r[this._values[n+o]]=this._values[n]}return this._resolve(r),!0}return!1},n.prototype.shouldCopyValues=function(){return!1},n.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return i(this)},t.props=function(e){return i(e)}}},{"./es5":13,"./util":36}],26:[function(e,t){function a(e,t,a,r,o){for(var n=0;n<o;++n)a[n+r]=e[n+t],e[n+t]=void 0}function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var a=this._front+t&this._capacity-1;this[a]=e,this._length=t+1},r.prototype.push=function(e,t,a){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(a);var o=this._front+r-3;this._checkCapacity(r);var n=this._capacity-1;this[o+0&n]=e,this[o+1&n]=t,this[o+2&n]=a,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,o=this._length;a(this,0,this,t,r+o&t-1)},t.exports=r},{}],27:[function(e,t){t.exports=function(t,a,r,o){function n(e,n){var l=r(e);if(l instanceof t)return u(l);if(e=s.asArray(e),null===e)return o('expecting an array or an iterable object but got '+s.classString(e));var p=new t(a);n!==void 0&&p._propagateFrom(n,3);for(var d=p._fulfill,c=p._reject,h=0,i=e.length,g;h<i;++h)(g=e[h],void 0!==g||h in e)&&t.cast(g)._then(d,c,void 0,p,null);return p}var s=e('./util'),u=function(e){return e.then(function(t){return n(t,e)})};t.race=function(e){return n(e,void 0)},t.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,a,r,o){this.constructor$(e);var i=c();this._fn=null===i?a:h.domainBind(i,a),r!==void 0&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===n?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function l(e,t,a,o){if('function'!=typeof t)return r('expecting a function but got '+h.classString(t));var n=new s(e,t,a,o);return n.promise()}function p(e){this.accum=e,this.array._gotAccum(e);var a=o(this.value,this.array._promise);return a instanceof t?(this.array._currentCancellable=a,a._then(d,void 0,void 0,this,void 0)):d.call(this,a)}function d(e){var a=this.array,r=a._promise,o=g(a._fn);r._pushContext();var n;n=void 0===a._eachValues?o.call(r._boundValue(),this.accum,e,this.index,this.length):o.call(r._boundValue(),e,this.index,this.length),n instanceof t&&(a._currentCancellable=n);var s=r._popContext();return i.checkForgottenReturns(n,s,void 0===a._eachValues?'Promise.reduce':'Promise.each',r),n}var c=t._getDomain,h=e('./util'),g=h.tryCatch;h.inherits(s,a),s.prototype._gotAccum=function(e){this._eachValues!==void 0&&null!==this._eachValues&&e!==n&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues===void 0?this._initialValue:this._eachValues)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},s.prototype._iterate=function(e){this._values=e;var a=e.length,r,o;if(void 0===this._initialValue?(r=t.resolve(e[0]),o=1):(r=this._initialValue,o=0),this._currentCancellable=r,!r.isRejected())for(;o<a;++o){var n={accum:null,value:e[o],index:o,length:a,array:this};r=r._then(p,void 0,void 0,n,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return l(this,e,t,null)},t.reduce=function(e,t,a,r){return l(e,t,a,r)}}},{"./util":36}],29:[function(e,t){var a=e('./util'),r=a.getNativePromise(),o;if(a.isNode&&'undefined'==typeof MutationObserver){var n=Wi.setImmediate,i=process.nextTick;o=a.isRecentNode?function(e){n.call(Wi,e)}:function(e){i.call(process,e)}}else if('function'==typeof r&&'function'==typeof r.resolve){var s=r.resolve();o=function(e){s.then(e)}}else o='undefined'==typeof MutationObserver||'undefined'!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?'undefined'==typeof setImmediate?'undefined'==typeof setTimeout?function(){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}:function(e){setTimeout(e,0)}:function(e){setImmediate(e)}:function(){var e=document.createElement('div'),t={attributes:!0},a=!1,r=document.createElement('div'),o=new MutationObserver(function(){e.classList.toggle('foo'),a=!1});o.observe(r,t);var n=function(){a||(a=!0,r.classList.toggle('foo'))};return function(a){var r=new MutationObserver(function(){r.disconnect(),a()});r.observe(e,t),n()}}();t.exports=o},{"./util":36}],30:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e)}var n=t.PromiseInspection,i=e('./util');i.inherits(o,a),o.prototype._promiseResolved=function(e,t){this._values[e]=t;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var a=new n;return a._bitField=33554432,a._settledValueField=e,this._promiseResolved(t,a)},o.prototype._promiseRejected=function(e,t){var a=new n;return a._bitField=16777216,a._settledValueField=e,this._promiseResolved(t,a)},t.settle=function(e){return r.deprecated('.settle()','.reflect()'),new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function n(e,t){if((0|t)!==t||0>t)return r('expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n');var a=new o(e),n=a.promise();return a.setHowMany(t),a.init(),n}var i=e('./util'),s=e('./errors').RangeError,u=e('./errors').AggregateError,l=i.isArray,p={};i.inherits(o,a),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=l(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},o.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},o.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(p),this._checkOutcome())},o.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new u,e=this.length();e<this._values.length;++e)this._values[e]!==p&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t='Input array must contain at least '+this._howMany+' items but contains only '+e+' items';return new s(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return n(e,t)},t.prototype.some=function(e){return n(this,e)},t._SomePromiseArray=o}},{"./errors":12,"./util":36}],32:[function(e,t){t.exports=function(e){function t(e){e===void 0?(this._bitField=0,this._settledValueField=void 0):(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0)}t.prototype._settledValue=function(){return this._settledValueField};var a=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError('cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError('cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},o=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},n=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},i=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return i.call(this._target())},e.prototype.isRejected=function(){return n.call(this._target())},e.prototype.isFulfilled=function(){return o.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return a.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t){t.exports=function(t,a){function r(e){return e.then}function o(e){try{return r(e)}catch(t){return u.e=t,u}}function n(e){try{return p.call(e,'_promise0')}catch(t){return!1}}function i(e,r,o){var n=new t(a),i=n;o&&o._pushContext(),n._captureStackTrace(),o&&o._popContext();var l=!0,p=s.tryCatch(r).call(e,function(e){n&&(n._resolveCallback(e),n=null)},function(e){n&&(n._rejectCallback(e,l,!0),n=null)});return l=!1,n&&p===u&&(n._rejectCallback(p.e,!0,!0),n=null),i}var s=e('./util'),u=s.errorObj,l=s.isObject,p={}.hasOwnProperty;return function(e,r){if(l(e)){if(e instanceof t)return e;var s=o(e);if(s===u){r&&r._pushContext();var p=t.reject(s.e);return r&&r._popContext(),p}if('function'==typeof s){if(n(e)){var p=new t(a);return e._then(p._fulfill,p._reject,void 0,p,null),p}return i(e,s,r)}}return e}}},{"./util":36}],34:[function(e,t){t.exports=function(t,a,r){function o(e){this.handle=e}function n(e){return clearTimeout(this.handle),e}function i(e){throw clearTimeout(this.handle),e}var s=e('./util'),u=t.TimeoutError;o.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(e){return p(+this).thenReturn(e)},p=t.delay=function(e,n){var i,s;return void 0===n?(i=new t(a),s=setTimeout(function(){i._fulfill()},+e),r.cancellation()&&i._setOnCancel(new o(s)),i._captureStackTrace()):(i=t.resolve(n)._then(l,null,null,e,void 0),r.cancellation()&&n instanceof t&&i._setOnCancel(n)),i._setAsyncGuaranteed(),i};t.prototype.delay=function(e){return p(e,this)};var d=function(e,t,a){var r;r='string'==typeof t?new u(t):t instanceof Error?t:new u('operation timed out'),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=a&&a.cancel()};t.prototype.timeout=function(e,t){e=+e;var a=new o(setTimeout(function(){s.isPending()&&d(s,t,u)},e)),s,u;return r.cancellation()?(u=this.then(),s=u._then(n,i,void 0,a,void 0),s._setOnCancel(a)):s=this._then(n,i,void 0,a,void 0),s}}},{"./util":36}],35:[function(e,t){t.exports=function(t,a,r,o,n,s){function i(t){setTimeout(function(){throw t},0)}function u(e){var t=r(e);return t!==e&&'function'==typeof e._isDisposable&&'function'==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(e,a){function o(){if(s>=l)return p._fulfill();var n=u(e[s++]);if(n instanceof t&&n._isDisposable()){try{n=r(n._getDisposer().tryDispose(a),e.promise)}catch(t){return i(t)}if(n instanceof t)return n._then(o,i,null,null,null)}o()}var s=0,l=e.length,p=new t(n);return o(),p}function p(e,t,a){this._data=e,this._promise=t,this._context=a}function d(e,t,a){this.constructor$(e,t,a)}function c(e){return p.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function h(e){this.length=e,this.promise=null,this[e-1]=null}var g=e('./util'),f=e('./errors').TypeError,m=e('./util').inherits,_=g.errorObj,x=g.tryCatch,y={};p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():y},p.prototype.tryDispose=function(e){var t=this.resource(),a=this._context;void 0!==a&&a._pushContext();var r=t===y?null:this.doDispose(t,e);return void 0!==a&&a._popContext(),this._promise._unsetDisposable(),this._data=null,r},p.isDisposer=function(e){return null!=e&&'function'==typeof e.resource&&'function'==typeof e.tryDispose},m(d,p),d.prototype.doDispose=function(e,t){var a=this.data();return a.call(e,e,t)},h.prototype._resultCancelled=function(){for(var e=this.length,a=0,r;a<e;++a)r=this[a],r instanceof t&&r.cancel()},t.using=function(){var e=arguments.length;if(2>e)return a('you must pass at least 2 arguments to Promise.using');var o=arguments[e-1];if('function'!=typeof o)return a('expecting a function but got '+g.classString(o));var n=!0,u;2===e&&Array.isArray(arguments[0])?(u=arguments[0],e=u.length,n=!1):(u=arguments,e--);for(var d=new h(e),f=0,m;f<e;++f){if(m=u[f],p.isDisposer(m)){var y=m;m=m.promise(),m._setDisposable(y)}else{var v=r(m);v instanceof t&&(m=v._then(c,null,null,{resources:d,index:f},void 0))}d[f]=m}for(var b=Array(d.length),f=0;f<b.length;++f)b[f]=t.resolve(d[f]).reflect();var S=t.all(b).then(function(e){for(var t=0,a;t<e.length;++t){if(a=e[t],a.isRejected())return _.e=a.error(),_;if(!a.isFulfilled())return void S.cancel();e[t]=a.value()}T._pushContext(),o=x(o);var r=n?o.apply(void 0,e):o(e),i=T._popContext();return s.checkForgottenReturns(r,i,'Promise.using',T),r}),T=S.lastly(function(){var e=new t.PromiseInspection(S);return l(d,e)});return d.promise=T,T._setOnCancel(d),T},t.prototype._setDisposable=function(e){this._bitField|=131072,this._disposer=e},t.prototype._isDisposable=function(){return 0<(131072&this._bitField)},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField&=-131073,this._disposer=void 0},t.prototype.disposer=function(e){if('function'==typeof e)return new d(e,this,o());throw new f}}},{"./errors":12,"./util":36}],36:[function(e,t,a){function r(){try{var e=j;return j=null,e.apply(this,arguments)}catch(t){return F.e=t,F}}function o(e){return j=e,r}function n(e){return null==e||!0===e||!1===e||'string'==typeof e||'number'==typeof e}function i(e){return'function'==typeof e||'object'==typeof e&&null!==e}function s(e){return n(e)?new Error(m(e)):e}function u(e,t){var a=e.length,r=Array(a+1),o;for(o=0;o<a;++o)r[o]=e[o];return r[o]=t,r}function l(e,t,a){if(C.isES5){var r=Object.getOwnPropertyDescriptor(e,t);if(null!=r)return null==r.get&&null==r.set?r.value:a}else return{}.hasOwnProperty.call(e,t)?e[t]:void 0}function p(e,t,a){if(n(e))return e;return C.defineProperty(e,t,{value:a,configurable:!0,enumerable:!1,writable:!0}),e}function d(e){throw e}function c(e){try{if('function'==typeof e){var t=C.names(e.prototype),a=C.isES5&&1<t.length,r=0<t.length&&(1!==t.length||'constructor'!==t[0]),o=E.test(e+'')&&0<C.names(e).length;if(a||r||o)return!0}return!1}catch(t){return!1}}function h(e){function t(){}t.prototype=e;for(var a=8;a--;)new t;return e}function g(e){return R.test(e)}function f(e,t,a){for(var r=Array(e),o=0;o<e;++o)r[o]=t+o+a;return r}function m(e){try{return e+''}catch(t){return'[no string representation]'}}function _(e){return e instanceof Error||null!==e&&'object'==typeof e&&'string'==typeof e.message&&'string'==typeof e.name}function x(t){try{p(t,'isOperational',!0)}catch(e){}}function y(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function v(e){return _(e)&&C.propertyIsWritable(e,'stack')}function b(e){return{}.toString.call(e)}function S(e,t,a){for(var r=C.names(e),o=0,n;o<r.length;++o)if(n=r[o],a(n))try{C.defineProperty(t,n,C.getDescriptor(e,n))}catch(e){}}function T(e){return O?process.env[e]:void 0}function P(){if('function'==typeof Promise)try{var e=new Promise(function(){});if('[object Promise]'==={}.toString.call(e))return Promise}catch(t){}}function w(e,t){return e.bind(t)}var C=e('./es5'),k='undefined'==typeof navigator,F={e:{}},M='undefined'==typeof self?'undefined'==typeof window?'undefined'==typeof Wi?this===void 0?null:this:Wi:window:self,D=function(e,t){function a(){for(var a in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,a)&&'$'!==a.charAt(a.length-1)&&(this[a+'$']=t.prototype[a])}var r={}.hasOwnProperty;return a.prototype=t.prototype,e.prototype=new a,e.prototype},I=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var a=0;a<e.length;++a)if(e[a]===t)return!0;return!1};if(C.isES5){var a=Object.getOwnPropertyNames;return function(e){for(var r=[],o=Object.create(null);null!=e&&!t(e);){var n;try{n=a(e)}catch(t){return r}for(var s=0,i;s<n.length;++s)if(i=n[s],!o[i]){o[i]=!0;var u=Object.getOwnPropertyDescriptor(e,i);null!=u&&null==u.get&&null==u.set&&r.push(i)}e=C.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(a){if(t(a))return[];var o=[];enumeration:for(var n in a)if(r.call(a,n))o.push(n);else{for(var s=0;s<e.length;++s)if(r.call(e[s],n))continue enumeration;o.push(n)}return o}}(),E=/this\s*\.\s*\S+\s*=/,R=/^[a-z$_][a-z$_0-9]*$/i,A=function(){return'stack'in new Error?function(e){return v(e)?e:new Error(m(e))}:function(e){if(v(e))return e;try{throw new Error(m(e))}catch(e){return e}}}(),L=function(e){return C.isArray(e)?e:null},j;if('undefined'!=typeof Symbol&&Symbol.iterator){var z='function'==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t=[],a=e[Symbol.iterator](),r;!(r=a.next()).done;)t.push(r.value);return t};L=function(e){if(C.isArray(e))return e;return null!=e&&'function'==typeof e[Symbol.iterator]?z(e):null}}var G='undefined'!=typeof process&&'[object process]'===b(process).toLowerCase(),O='undefined'!=typeof process&&'undefined'!=typeof process.env,q={isClass:c,isIdentifier:g,inheritedDataKeys:I,getDataPropertyOrDefault:l,thrower:d,isArray:C.isArray,asArray:L,notEnumerableProp:p,isPrimitive:n,isObject:i,isError:_,canEvaluate:k,errorObj:F,tryCatch:o,inherits:D,withAppended:u,maybeWrapAsError:s,toFastProperties:h,filledRange:f,toString:m,canAttachTrace:v,ensureErrorObject:A,originatesFromRejection:y,markAsOriginatingFromRejection:x,classString:b,copyDescriptors:S,hasDevTools:'undefined'!=typeof chrome&&chrome&&'function'==typeof chrome.loadTimes,isNode:G,hasEnvVariables:O,env:T,global:M,getNativePromise:P,domainBind:w};q.isRecentNode=q.isNode&&function(){var e=process.versions.node.split('.').map(Number);return 0===e[0]&&10<e[1]||0<e[0]}(),q.isNode&&q.toFastProperties(process);try{throw new Error}catch(t){q.lastLineError=t}t.exports=q},{"./es5":13}]},{},[4])(4)}),'undefined'!=typeof window&&null!==window?window.P=window.Promise:'undefined'!=typeof self&&null!==self&&(self.P=self.Promise)}),Nc=function(e,t){return function(){for(var a=Array(arguments.length),r=0;r<a.length;r++)a[r]=arguments[r];return e.apply(t,a)}},Bc=function(e){return null!=e&&(Ia(e)||Ea(e)||!!e._isBuffer)},Vc=Object.prototype.toString,Hc={isArray:Ra,isArrayBuffer:Aa,isBuffer:Bc,isFormData:La,isArrayBufferView:ja,isString:za,isNumber:Ga,isObject:qa,isUndefined:Oa,isDate:Ua,isFile:Na,isBlob:Ba,isFunction:Va,isStream:Ha,isURLSearchParams:Wa,isStandardBrowserEnv:$a,forEach:Ka,merge:Qa,extend:Za,trim:Xa},Wc=function(e,t){Hc.forEach(e,function(a,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=a,delete e[r])})},Xc=function(e,t,a,r,o){return e.config=t,a&&(e.code=a),e.request=r,e.response=o,e},$c=function(e,t,a,r,o){var n=new Error(e);return Xc(n,t,a,r,o)},Kc=function(e,t,a){var r=a.config.validateStatus;a.status&&r&&!r(a.status)?t($c('Request failed with status code '+a.status,a.config,null,a.request,a)):e(a)},Qc=function(e,t,a){if(!t)return e;var r;if(a)r=a(t);else if(Hc.isURLSearchParams(t))r=t.toString();else{var o=[];Hc.forEach(t,function(e,t){null===e||'undefined'==typeof e||(Hc.isArray(e)&&(t+='[]'),!Hc.isArray(e)&&(e=[e]),Hc.forEach(e,function(e){Hc.isDate(e)?e=e.toISOString():Hc.isObject(e)&&(e=JSON.stringify(e)),o.push(Ya(t)+'='+Ya(e))}))}),r=o.join('&')}return r&&(e+=(-1===e.indexOf('?')?'?':'&')+r),e},Zc=['age','authorization','content-length','content-type','etag','expires','from','host','if-modified-since','if-unmodified-since','last-modified','location','max-forwards','proxy-authorization','referer','retry-after','user-agent'],Yc=function(e){var t={},a,r,o;return e?(Hc.forEach(e.split('\n'),function(e){if(o=e.indexOf(':'),a=Hc.trim(e.substr(0,o)).toLowerCase(),r=Hc.trim(e.substr(o+1)),a){if(t[a]&&0<=Zc.indexOf(a))return;t[a]='set-cookie'===a?(t[a]?t[a]:[]).concat([r]):t[a]?t[a]+', '+r:r}}),t):t},Jc=Hc.isStandardBrowserEnv()?function(){function e(e){var r=e;return t&&(a.setAttribute('href',r),r=a.href),a.setAttribute('href',r),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,''):'',host:a.host,search:a.search?a.search.replace(/^\?/,''):'',hash:a.hash?a.hash.replace(/^#/,''):'',hostname:a.hostname,port:a.port,pathname:'/'===a.pathname.charAt(0)?a.pathname:'/'+a.pathname}}var t=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement('a'),r;return r=e(window.location.href),function(t){var a=Hc.isString(t)?e(t):t;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),eh='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';Ja.prototype=new Error,Ja.prototype.code=5,Ja.prototype.name='InvalidCharacterError';var th=E,ah=Hc.isStandardBrowserEnv()?function(){return{write:function(e,t,a,r,o,n){var i=[];i.push(e+'='+encodeURIComponent(t)),Hc.isNumber(a)&&i.push('expires='+new Date(a).toGMTString()),Hc.isString(r)&&i.push('path='+r),Hc.isString(o)&&i.push('domain='+o),!0===n&&i.push('secure'),document.cookie=i.join('; ')},read:function(e){var t=document.cookie.match(new RegExp('(^|;\\s*)('+e+')=([^;]*)'));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,'',Date.now()-8.64e7)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),rh='undefined'!=typeof window&&window.btoa&&window.btoa.bind(window)||th,oh=function(t){return new Promise(function(e,a){var r=t.data,o=t.headers;Hc.isFormData(r)&&delete o['Content-Type'];var n=new XMLHttpRequest,i='onreadystatechange',s=!1;if('undefined'==typeof window||!window.XDomainRequest||'withCredentials'in n||Jc(t.url)||(n=new window.XDomainRequest,i='onload',s=!0,n.onprogress=function(){},n.ontimeout=function(){}),t.auth){var u=t.auth.username||'',l=t.auth.password||'';o.Authorization='Basic '+rh(u+':'+l)}if(n.open(t.method.toUpperCase(),Qc(t.url,t.params,t.paramsSerializer),!0),n.timeout=t.timeout,n[i]=function(){if(n&&(4===n.readyState||s)&&(0!==n.status||n.responseURL&&0===n.responseURL.indexOf('file:'))){var r='getAllResponseHeaders'in n?Yc(n.getAllResponseHeaders()):null,o=t.responseType&&'text'!==t.responseType?n.response:n.responseText,i={data:o,status:1223===n.status?204:n.status,statusText:1223===n.status?'No Content':n.statusText,headers:r,config:t,request:n};Kc(e,a,i),n=null}},n.onerror=function(){a($c('Network Error',t,null,n)),n=null},n.ontimeout=function(){a($c('timeout of '+t.timeout+'ms exceeded',t,'ECONNABORTED',n)),n=null},Hc.isStandardBrowserEnv()){var p=(t.withCredentials||Jc(t.url))&&t.xsrfCookieName?ah.read(t.xsrfCookieName):void 0;p&&(o[t.xsrfHeaderName]=p)}if('setRequestHeader'in n&&Hc.forEach(o,function(e,t){'undefined'==typeof r&&'content-type'===t.toLowerCase()?delete o[t]:n.setRequestHeader(t,e)}),t.withCredentials&&(n.withCredentials=!0),t.responseType)try{n.responseType=t.responseType}catch(a){if('json'!==t.responseType)throw a}'function'==typeof t.onDownloadProgress&&n.addEventListener('progress',t.onDownloadProgress),'function'==typeof t.onUploadProgress&&n.upload&&n.upload.addEventListener('progress',t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(e){n&&(n.abort(),a(e),n=null)}),void 0===r&&(r=null),n.send(r)})},nh={"Content-Type":'application/x-www-form-urlencoded'},ih={adapter:tr(),transformRequest:[function(e,t){return Wc(t,'Content-Type'),Hc.isFormData(e)||Hc.isArrayBuffer(e)||Hc.isBuffer(e)||Hc.isStream(e)||Hc.isFile(e)||Hc.isBlob(e)?e:Hc.isArrayBufferView(e)?e.buffer:Hc.isURLSearchParams(e)?(er(t,'application/x-www-form-urlencoded;charset=utf-8'),e.toString()):Hc.isObject(e)?(er(t,'application/json;charset=utf-8'),JSON.stringify(e)):e}],transformResponse:[function(e){if('string'==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:'XSRF-TOKEN',xsrfHeaderName:'X-XSRF-TOKEN',maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e}};ih.headers={common:{Accept:'application/json, text/plain, */*'}},Hc.forEach(['delete','get','head'],function(e){ih.headers[e]={}}),Hc.forEach(['post','put','patch'],function(e){ih.headers[e]=Hc.merge(nh)});var sh=ih;ar.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},ar.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ar.prototype.forEach=function(e){Hc.forEach(this.handlers,function(t){null!==t&&e(t)})};var uh=ar,lh=function(e,t,a){return Hc.forEach(a,function(a){e=a(e,t)}),e},ph=function(e){return!!(e&&e.__CANCEL__)},dh=function(e){return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},ch=function(e,t){return t?e.replace(/\/+$/,'')+'/'+t.replace(/^\/+/,''):e},hh=function(e){rr(e),e.baseURL&&!dh(e.url)&&(e.url=ch(e.baseURL,e.url)),e.headers=e.headers||{},e.data=lh(e.data,e.headers,e.transformRequest),e.headers=Hc.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),Hc.forEach(['delete','get','head','post','put','patch','common'],function(t){delete e.headers[t]});var t=e.adapter||sh.adapter;return t(e).then(function(t){return rr(e),t.data=lh(t.data,t.headers,e.transformResponse),t},function(t){return ph(t)||(rr(e),t&&t.response&&(t.response.data=lh(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};or.prototype.request=function(e){'string'==typeof e&&(e=Hc.merge({url:arguments[0]},arguments[1])),e=Hc.merge(sh,this.defaults,{method:'get'},e),e.method=e.method.toLowerCase();var t=[hh,void 0],a=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)a=a.then(t.shift(),t.shift());return a},Hc.forEach(['delete','get','head','options'],function(e){or.prototype[e]=function(t,a){return this.request(Hc.merge(a||{},{method:e,url:t}))}}),Hc.forEach(['post','put','patch'],function(e){or.prototype[e]=function(t,a,r){return this.request(Hc.merge(r||{},{method:e,url:t,data:a}))}});var gh=or;nr.prototype.toString=function(){return'Cancel'+(this.message?': '+this.message:'')},nr.prototype.__CANCEL__=!0;var fh=nr;ir.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ir.source=function(){var e=new ir(function(e){t=e}),t;return{token:e,cancel:t}};var mh=ir,_h=function(e){return function(t){return e.apply(null,t)}},xh=sr(sh);xh.Axios=gh,xh.create=function(e){return sr(Hc.merge(sh,e))},xh.Cancel=fh,xh.CancelToken=mh,xh.isCancel=ph,xh.all=function(e){return Promise.all(e)},xh.spread=_h;var yh=xh,vh=xh;yh.default=vh;var bh=yh,Sh=fe(function(e){(function(){var t,a,r,o,n,i;'undefined'!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:'undefined'!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-n)/1e6},a=process.hrtime,t=function(){var e;return e=a(),1e9*e[0]+e[1]},o=t(),i=1e9*process.uptime(),n=o-i):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return new Date().getTime()-r},r=new Date().getTime())}).call(Wi)}),Th=fe(function(e){function t(){}function a(e,t,a){this.fn=e,this.context=t,this.once=a||!1}function r(e,t,r,o,n){if('function'!=typeof r)throw new TypeError('The listener must be a function');var i=new a(r,o||e,n),u=s?s+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],i]:e._events[u].push(i):(e._events[u]=i,e._eventsCount++),e}function o(e,a){0==--e._eventsCount?e._events=new t:delete e._events[a]}function n(){this._events=new t,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,s='~';Object.create&&(t.prototype=Object.create(null),!new t().__proto__&&(s=!1)),n.prototype.eventNames=function(){var e=[],t,a;if(0===this._eventsCount)return e;for(a in t=this._events)i.call(t,a)&&e.push(s?a.slice(1):a);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},n.prototype.listeners=function(e){var t=s?s+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,n=Array(o);r<o;r++)n[r]=a[r].fn;return n},n.prototype.listenerCount=function(e){var t=s?s+e:e,a=this._events[t];return a?a.fn?1:a.length:0},n.prototype.emit=function(e,t,a,r,o,n){var u=s?s+e:e;if(!this._events[u])return!1;var l=this._events[u],p=arguments.length,d,c;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,a),!0;case 4:return l.fn.call(l.context,t,a,r),!0;case 5:return l.fn.call(l.context,t,a,r,o),!0;case 6:return l.fn.call(l.context,t,a,r,o,n),!0;}for(c=1,d=Array(p-1);c<p;c++)d[c-1]=arguments[c];l.fn.apply(l.context,d)}else{var i=l.length,h;for(c=0;c<i;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),p){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,a);break;case 4:l[c].fn.call(l[c].context,t,a,r);break;default:if(!d)for(h=1,d=Array(p-1);h<p;h++)d[h-1]=arguments[h];l[c].fn.apply(l[c].context,d);}}return!0},n.prototype.on=function(e,t,a){return r(this,e,t,a,!1)},n.prototype.once=function(e,t,a){return r(this,e,t,a,!0)},n.prototype.removeListener=function(e,t,a,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var u=this._events[n];if(u.fn)u.fn!==t||r&&!u.once||a&&u.context!==a||o(this,n);else{for(var l=0,i=[],p=u.length;l<p;l++)(u[l].fn!==t||r&&!u[l].once||a&&u[l].context!==a)&&i.push(u[l]);i.length?this._events[n]=1===i.length?i[0]:i:o(this,n)}return this},n.prototype.removeAllListeners=function(e){var a;return e?(a=s?s+e:e,this._events[a]&&o(this,a)):(this._events=new t,this._eventsCount=0),this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prefixed=s,n.EventEmitter=n,e.exports=n}),Ph=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_SIZE=t.webgl2=void 0;const a=new class{constructor(){if(this.isSupported=!1,this.vertexShader=null,'undefined'!=typeof window){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('webgl2');const e=this.context;e?(this.isSupported=!0,e.getExtension('EXT_color_buffer_float'),this.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),this.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.init()):console.log('Unable to initialize WebGL2 -- your browser may not support it.')}this._refs={textures:[],buffers:[]}}init(){this.createCommonVertexShader()}createCommonVertexShader(){const e=this.context,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,'#version 300 es\nprecision highp float;\n\nin vec3 position;\nin vec2 texcoord;\nout vec2 outTex;\n\nvoid main () {\n  gl_Position = vec4(position, 1.0);\n\toutTex = texcoord;\n}\n'),e.compileShader(t);const a=e.getShaderParameter(t,e.COMPILE_STATUS);a||(console.error(e.getShaderInfoLog(t)),e.deleteShader(t),this.isSupported=!1),this.vertexShader=t}compileProgram(e){const t=this.context,a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,e),t.compileShader(a);let r=t.getShaderParameter(a,t.COMPILE_STATUS);r||(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),this.isSupported=!1);const o=t.createProgram();return t.attachShader(o,this.vertexShader),t.attachShader(o,a),t.linkProgram(o),r=t.getProgramParameter(o,t.LINK_STATUS),r||(console.error(t.getProgramInfoLog(o)),this.isSupported=!1),this.setupVertices(o),o}setupVertices(e){const t=this.context,a=t.getAttribLocation(e,'position'),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),this.storeRef('buffer',r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.STATIC_DRAW),t.vertexAttribPointer(a,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);const o=t.getAttribLocation(e,'texcoord'),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),t.STATIC_DRAW),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),this.storeRef('buffer',n);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),t.STATIC_DRAW),this.storeRef('buffer',i)}selectProgram(e){const t=this.context;t.useProgram(e)}bindUniforms(e,t){const a=this.context;t.forEach(({value:t,type:r,name:o})=>{const n=a.getUniformLocation(e,o);'float'===r?a.uniform1f(n,t):('int'===r||'bool'===r)&&a.uniform1i(n,t)})}bindInputTextures(e,t,a){const r=this.context;t.forEach(({input:t,name:o},n)=>{if(r.activeTexture(r.TEXTURE0+n),!t.glTextureFragments){const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTexture)}else if(t.glTextureFragmentsAsColStack){const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTextureFragmentsAsColStack)}else{const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTextureFragments[a])}r.uniform1i(r.getUniformLocation(e,o),n)})}bindOutputTexture(e,t){const a=this.context;a.viewport(0,0,t[1],t[0]),this.framebuffer=this.framebuffer||a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0)}runProgram({program:e,output:t,inputs:a,uniforms:r,supportsTextureFragments:o=!1}){if(!e)throw new Error('[WebGL2] missing program');if(!t)throw new Error('[WebGL2] missing output');if(!a)throw new Error('[WebGL2] missing inputs');const n=this.context;if(this.selectProgram(e),r&&Array.isArray(r)&&this.bindUniforms(e,r),t.glTextureFragments){if(!o)throw new Error('[WebGL2] program does not support texture fragments');const r=a.filter((e)=>e.input.glTextureFragments&&!e.input.glTextureFragmentsAsColStack),i=t.glTextureFragments.length;if(r.some((e)=>e.input.glTextureFragments.length!==i))throw new Error('[WebGL2] number of texture fragments in inputs and output do not match');for(let r=0;r<i;r++)this.bindOutputTexture(t.glTextureFragments[r],t.glTextureFragmentShape),this.bindInputTextures(e,a,r),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}else this.bindOutputTexture(t.glTexture,t.glTextureShape),this.bindInputTextures(e,a),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}readData(e){const t=this.context,a=new ArrayBuffer(4*(4*(e[0]*e[1]))),r=new Float32Array(a);t.readPixels(0,0,e[1],e[0],t.RGBA,t.FLOAT,r);const o=[];for(let t=0;t<r.length;t+=4)o.push(r[t]);return new Float32Array(o)}getWebGLTextureOptions(e,t){const a=this.context,r={"2d":a.TEXTURE_2D,"2d_array":a.TEXTURE_2D_ARRAY,"3d":a.TEXTURE_3D},o={float:a.R32F,int:a.R32I},n={float:a.RED,int:a.RED_INTEGER},i={float:a.FLOAT,int:a.INT},s=r[e],u=o[t],l=n[t],p=i[t];return{textureTarget:s,textureInternalFormat:u,textureFormat:l,textureType:p}}storeRef(e,t){'texture'===e?this._refs.textures.push(t):'buffer'===e&&this._refs.buffers.push(t)}clearRefs(){const e=this.context;this._refs.textures.forEach((t)=>e.deleteTexture(t)),this._refs.buffers.forEach((t)=>e.deleteBuffer(t)),this._refs={textures:[],buffers:[]}}};t.webgl2=a;const r=a.MAX_TEXTURE_SIZE;t.MAX_TEXTURE_SIZE=r;const o=a.MAX_TEXTURE_IMAGE_UNITS;t.MAX_TEXTURE_IMAGE_UNITS=o});ge(Ph);var wh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;t.default=class{constructor(e={}){this.layerClass='Layer',this.name=e.name,this.description='',this.gpu=Ph.webgl2.isSupported&&e.gpu,this.params=[],this.weights={},this.inbound=[],this.outbound=[]}throwError(e){throw new Error(`[${this.layerClass} layer: ${this.name||''}] ${e}`)}toggleGPU(e){const t='undefined'==typeof e?!this.gpu:e;this.gpu=Ph.webgl2.isSupported&&t}setWeights(e,t=!0){this.params.forEach((a,r)=>{this.weights[a]=e[r],this.gpu&&t&&this.weights[a].createGLTexture({type:'2d',format:'float'})})}call(e){return this.output=e,this.output}}});ge(wh);var Ch=yn,kh=Sn,Fh=ur,Mh=lr,Dh=Mh(),Ih=Dh,Eh=pr,Rh='undefined'!=typeof Float64Array,Ah={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]},Lh=fr,jh=xr,zh=Pr,Gh=wr,Oh=kr,qh=fe(function(e,t){function a(e){if(!e)return n;for(var t=0,r;t<e.args.length;++t)r=e.args[t],e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1};return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function r(e){return Oh({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}function o(e){for(var t=[],a=0;a<e.args.length;++a)t.push('a'+a);var o=new Function('P',['return function ',e.funcName,'_ndarrayops(',t.join(','),') {P(',t.join(','),');return a0}'].join(''));return o(r(e))}var n={body:'',args:[],thisVars:[],localVars:[]},i={add:'+',sub:'-',mul:'*',div:'/',mod:'%',band:'&',bor:'|',bxor:'^',lshift:'<<',rshift:'>>',rrshift:'>>>'};(function(){for(var e in i){var a=i[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a'+a+'=b'},rvalue:!0,funcName:e+'eq'}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a'+a+'=s'},rvalue:!0,funcName:e+'seq'})}})();var s={not:'!',bnot:'~',neg:'-',recip:'1.0/'};(function(){for(var e in s){var a=s[e];t[e]=o({args:['array','array'],body:{args:['a','b'],body:'a='+a+'b'},funcName:e}),t[e+'eq']=o({args:['array'],body:{args:['a'],body:'a='+a+'a'},rvalue:!0,count:2,funcName:e+'eq'})}})();var u={and:'&&',or:'||',eq:'===',neq:'!==',lt:'<',gt:'>',leq:'<=',geq:'>='};(function(){for(var e in u){var a=u[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a=a'+a+'b'},rvalue:!0,count:2,funcName:e+'eq'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a=a'+a+'s'},rvalue:!0,count:2,funcName:e+'seq'})}})();var l=['abs','acos','asin','atan','ceil','cos','exp','floor','log','round','sin','sqrt','tan'];(function(){for(var e=0,a;e<l.length;++e)a=l[e],t[a]=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b)',thisVars:['this_f']},funcName:a}),t[a+'eq']=o({args:['array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a'],body:'a=this_f(a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'})})();var p=['max','min','atan2','pow'];(function(){for(var e=0,a;e<p.length;++e)a=p[e],t[a]=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a}),t[a+'s']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a+'s'}),t[a+'eq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'}),t[a+'seq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'seq'})})();var d=['atan2','pow'];(function(){for(var e=0,a;e<d.length;++e)a=d[e],t[a+'op']=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'op'}),t[a+'ops']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'ops'}),t[a+'opeq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opeq'}),t[a+'opseq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opseq'})})(),t.any=Oh({args:['array'],pre:n,body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'if(a){return true}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return false'},funcName:'any'}),t.all=Oh({args:['array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1}],body:'if(!x){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'all'}),t.sum=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s+=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'sum'}),t.prod=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=1'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s*=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'prod'}),t.norm2squared=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm2squared'}),t.norm2=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return Math.sqrt(this_s)'},funcName:'norm2'}),t.norminf=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:4}],body:'if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norminf'}),t.norm1=Oh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:3}],body:'this_s+=a<0?-a:a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm1'}),t.sup=Oh({args:['array'],pre:{body:'this_h=-Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.inf=Oh({args:['array'],pre:{body:'this_h=Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.argmin=Oh({args:['index','array','shape'],pre:{body:'{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.argmax=Oh({args:['index','array','shape'],pre:{body:'{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.random=o({args:['array'],pre:{args:[],body:'this_f=Math.random',thisVars:['this_f']},body:{args:['a'],body:'a=this_f()',thisVars:['this_f']},funcName:'random'}),t.assign=o({args:['array','array'],body:{args:['a','b'],body:'a=b'},funcName:'assign'}),t.assigns=o({args:['array','scalar'],body:{args:['a','b'],body:'a=b'},funcName:'assigns'}),t.equals=Oh({args:['array','array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1},{name:'y',lvalue:!1,rvalue:!0,count:1}],body:'if(x!==y){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'equals'})}),Uh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.checkShape=function(e,t){if(e.length&&t.length&&e.length!==t.reduce((e,t)=>e*t,1))throw new Error('[Tensor] specified shape incompatible with data.')},t.data3DLayoutForGL=function(e,t,a){const r=new e(t.data.length),n=(0,o.default)(new e(a[0]*a[1]),[a[0],a[1]]);let u=0;for(let o=0;o<a[2];o++)s.default.assign(n,t.pick(null,null,o)),r.set(n.data,u),u+=a[0]*a[1];return r},t.createIndicesFor2DReshaped=function(e,t=!1,a=-1){const n=e.reduce((e,t)=>e*t,1),i=(0,o.default)(new Int32Array(n),e);if(t){const e=yn(Pn(n)),t=(0,o.default)(new Int32Array(e**2),[e,e]),a=(0,o.default)(new Int32Array(e**2),[e,e]),r=(0,o.default)(new Int32Array(e**2),[e,e]);for(let a=0;a<e;a++)s.default.assigns(t.pick(a,null),a);for(let t=0;t<e;t++)s.default.assigns(a.pick(null,t),t);s.default.muls(r,t,e),s.default.addeq(r,a),i.data.set(r.data.subarray(0,i.size))}else{0>a&&(a=e.length+a);const t=e[a],u=(0,o.default)(new Int32Array(n),e),l=(0,o.default)(new Int32Array(n),e),p=[...e.slice(0,a),...e.slice(a+1)],d=p.reduce((e,t)=>e*t,1),c=(0,o.default)(new Int32Array((0,r.default)(d)),p),h=Array(e.length).fill(null);for(let e=0;e<t;e++)h[a]=e,s.default.assign(u.pick(...h),c),s.default.assigns(l.pick(...h),e);s.default.muls(i,u,t),s.default.addeq(i,l)}return i};var r=a(Ih),o=a(Lh),s=a(qh)});ge(Uh);var Nh=Fr,Bh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Uh),o=a(Lh),i=a(qh),n=a(Nh);t.default=class{constructor(e,t,a={}){this.arrayType=a.type||Float32Array,e&&e.length&&(e instanceof this.arrayType||e instanceof Array)?(r.checkShape(e,t),e instanceof this.arrayType?this.tensor=(0,o.default)(e,t):e instanceof Array&&(this.tensor=(0,o.default)(new this.arrayType(e),t))):!e.length&&t.length?this.tensor=(0,o.default)(new this.arrayType(t.reduce((e,t)=>e*t,1)),t):this.tensor=(0,o.default)(new this.arrayType([]),[])}createGLTexture({type:e='2d',format:t='float',supportsTextureFragments:a=!1}){let r=[];if(1===this.tensor.shape.length)r=[1,this.tensor.shape[0]],this.is1D=!0;else if(2===this.tensor.shape.length)r=this.tensor.shape;else if(3===this.tensor.shape.length&&('2d_array'===e||'3d'===e))r=this.tensor.shape;else throw new Error('[Tensor] cannot create WebGL2 texture.');if(this.glTextureShape=r,this.glTextureType=e,this.glTextureFormat=t,'2d'===e)this.glTextureShape[0]>Ph.MAX_TEXTURE_SIZE&&a?this._create2DRowFragmentedGLTexture():this._create2DGLTexture();else if('2d_array'===e||'3d'===e)this._create3DGLTexture();else throw new Error(`[Tensor] invalid type ${e}.`)}_create2DGLTexture(){const e=Ph.webgl2.context,t=Ph.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;this.glTexture=e.createTexture(),Ph.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);const i=this.glTextureShape,s=this.tensor.data;e.texImage2D(a,0,r,i[1],i[0],0,o,n,s),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}_create2DRowFragmentedGLTexture(){const e=Ph.webgl2.context,t=Ph.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;this.glTextureFragments=[],this.glTextureFragmentShape=[Ph.MAX_TEXTURE_SIZE,this.glTextureShape[1]];const i=this.glTextureFragmentShape,s=yn(this.glTextureShape[0]/Ph.MAX_TEXTURE_SIZE);let u=0;for(let t=0;t<s;t++){const l=e.createTexture();Ph.webgl2.storeRef('texture',l),e.bindTexture(a,l);let p;t===s-1?(p=new this.arrayType(i[0]*i[1]),p.set(this.tensor.data.slice(u,u+i[0]*i[1]),0)):p=this.tensor.data.slice(u,u+i[0]*i[1]),e.texImage2D(a,0,r,i[1],i[0],0,o,n,p),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST),this.glTextureFragments.push(l),u+=i[0]*i[1]}}_create3DGLTexture(){const e=Ph.webgl2.context,t=Ph.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:o,textureFormat:n,textureType:i}=t;this.glTexture=e.createTexture(),Ph.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);const s=this.glTextureShape,u=r.data3DLayoutForGL(this.arrayType,this.tensor,this.glTextureShape);e.texImage3D(a,0,o,s[1],s[0],s[2],0,n,i,u),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}convert2DRowFragmentedGLTextureToColStack(){if(!this.glTextureFragments||!this.glTextureFragmentShape)throw new Error('[Tensor] no glTextureFragments available.');const e=Ph.webgl2.context,t=Ph.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;if(!this.glTextureFragmentsAsColStack){this.glTextureFragmentsAsColStack=e.createTexture(),Ph.webgl2.storeRef('texture',this.glTextureFragmentsAsColStack),e.bindTexture(a,this.glTextureFragmentsAsColStack);const t=this.glTextureFragments.length;this.glTextureFragmentsAsColStackShape=[this.glTextureFragmentShape[0],this.glTextureFragmentShape[1]*t];const i=this.glTextureFragmentsAsColStackShape,s=new this.arrayType(i.reduce((e,t)=>e*t,1));e.texImage2D(a,0,r,i[1],i[0],0,o,n,s),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}else e.bindTexture(a,this.glTextureFragmentsAsColStack);const i=e.createFramebuffer();e.bindFramebuffer(e.READ_FRAMEBUFFER,i),this.glTextureFragments.forEach((t,r)=>{e.framebufferTexture2D(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.copyTexSubImage2D(a,0,r*this.glTextureFragmentShape[1],0,0,0,this.glTextureFragmentShape[1],this.glTextureFragmentShape[0])}),e.deleteFramebuffer(i)}removeGLTextureFragmentsAsColStack(){if(this.glTextureFragmentsAsColStack){const e=Ph.webgl2.context;e.deleteTexture(this.glTextureFragmentsAsColStack),delete this.glTextureFragmentsAsColStack,delete this.glTextureFragmentsAsColStackShape}}deleteGLTexture(){const e=Ph.webgl2.context;this.glTexture&&(e.deleteTexture(this.glTexture),delete this.glTexture),this.glTextureFragments&&(this.glTextureFragments.forEach((t)=>{e.deleteTexture(t)}),delete this.glTextureFragments)}replaceTensorData(e){if(e&&e.length&&e instanceof this.arrayType)this.tensor.data.set(e);else if(e&&e.length&&e instanceof Array)this.tensor.data.set(new this.arrayType(e));else throw new Error('[Tensor] invalid input for replaceTensorData method.');if(this.glTexture){const e=Ph.webgl2.context,t=Ph.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureFormat:o,textureType:n}=t;e.bindTexture(a,this.glTexture);const i=this.glTextureShape;if('2d'===this.glTextureType){const t=this.tensor.data;e.texSubImage2D(a,0,0,0,i[1],i[0],o,n,t,0)}else if('2d_array'===this.glTextureType||'3d'===this.glTextureType){const t=r.data3DLayoutForGL(this.arrayType,this.tensor,i);e.texSubImage3D(a,0,0,0,0,i[1],i[0],i[2],o,n,t,0)}}}transferFromGLTexture(){if(this.glTextureFragments){this.tensor=(0,o.default)(new this.arrayType(this.glTextureShape[0]*this.glTextureShape[1]),this.glTextureShape);let e=0;for(let t=0;t<this.glTextureFragments.length;t++){Ph.webgl2.bindOutputTexture(this.glTextureFragments[t],this.glTextureFragmentShape);const a=Ph.webgl2.readData(this.glTextureFragmentShape);if(t===this.glTextureFragments.length-1){const t=this.tensor.data.length-e;this.tensor.data.set(a.subarray(0,t),e)}else this.tensor.data.set(a,e);e+=a.length}}else Ph.webgl2.bindOutputTexture(this.glTexture,this.glTextureShape),this.tensor=(0,o.default)(new this.arrayType([]),this.glTextureShape),this.tensor.data=Ph.webgl2.readData(this.glTextureShape);this.is1D&&1===this.glTextureShape[0]&&(this.tensor=(0,n.default)(this.tensor,[0]))}reshapeTo2D(){const e=this.tensor.shape.length-1,t=this.tensor.shape[e],a=this.tensor.shape.slice(0,e),n=a.reduce((e,t)=>e*t,1),s=(0,o.default)(new this.arrayType(n*t),[n,t]),u=(0,o.default)(new this.arrayType(n),a),l=(0,o.default)(new this.arrayType(n),[n]),p=Array(this.tensor.shape.length).fill(null);for(let a=0;a<t;a++)p[e]=a,i.default.assign(u,this.tensor.pick(...p)),l.data=u.data,i.default.assign(s.pick(null,a),l);this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!1,e),this.tensor=s,this.is2DReshaped=!0}reshapeFrom2D(e=-1){if(!this.is2DReshaped)throw new Error('[Tensor] not in reshaped 2D representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');0>e&&(e=this.originalShape.length+e);const t=this.tensor.shape[0],a=this.tensor.shape[1],r=(0,o.default)(new this.arrayType(this.originalShape.reduce((e,t)=>e*t,1)),this.originalShape),s=(0,o.default)(new this.arrayType(t),[t]),n=[...this.originalShape.slice(0,e),...this.originalShape.slice(e+1)],u=(0,o.default)(new this.arrayType(n.reduce((e,t)=>e*t,1)),n),l=Array(this.originalShape.length).fill(null);for(let t=0;t<a;t++)i.default.assign(s,this.tensor.pick(null,t)),u.data=s.data,l[e]=t,i.default.assign(r.pick(...l),u);this.tensor=r}reshapeTo2DSquare(){const e=yn(Pn(this.tensor.size)),t=(0,o.default)(new this.arrayType(e**2),[e,e]);t.data.set(this.tensor.data),this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!0),this.tensor=t,this.is2DSquareReshaped=!0}reshapeFrom2DSquare(){if(!this.is2DSquareReshaped)throw new Error('[Tensor] not in reshaped 2D square representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');const e=this.originalShape.reduce((e,t)=>e*t,1),t=(0,o.default)(new this.arrayType(e),this.originalShape);t.data.set(this.tensor.data.subarray(0,e)),this.tensor=t}}});ge(Bh);var Vh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a($p),o=a(wh),n=a(Bh);class i extends o.default{constructor(e={}){super(e),this.layerClass='InputLayer';const{shape:t=[]}=e;this.shape=e.batch_input_shape&&e.batch_input_shape.length?e.batch_input_shape.slice(1):t,this.description=`shape: ${JSON.stringify(this.shape)}`}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError(`input tensor shape ${e.tensor.shape} does not match specified shape ${this.shape}.`),this.output=new n.default(e.tensor.data,e.tensor.shape)}_callGPU(e){this.inputShape=e.glTexture||e.glTextureFragments?e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape:e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError(`input tensor shape ${e.tensor.shape} does not match specified shape ${this.shape}.`),e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this.output=e}}t.default=i});ge(Vh);var Hh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){if(1===e.tensor.shape.length){const t=a.default.sup(e.tensor);a.default.subseq(e.tensor,t),a.default.expeq(e.tensor);const r=a.default.sum(e.tensor);a.default.divseq(e.tensor,r)}else if(2===e.tensor.shape.length)for(let t=0;t<e.tensor.shape[0];t++){const r=a.default.sup(e.tensor.pick(t,null));a.default.subseq(e.tensor.pick(t,null),r),a.default.expeq(e.tensor.pick(t,null));const o=a.default.sum(e.tensor.pick(t,null));a.default.divseq(e.tensor.pick(t,null),o)}else throw new Error(`[activations.softmax] tensor shape ${e.tensor.shape} not supported.`)};var a=function(e){return e&&e.__esModule?e:{default:e}}(qh)});ge(Hh);var Wh=fe(function(e,t){(function(e,a){a(t)})(Wi,function(e){function t(e,t){if(!e)throw new Error('ASSERT: '+t)}function a(e){return 48<=e&&57>=e}function r(e){return 0<='0123456789abcdefABCDEF'.indexOf(e)}function o(e){return 0<='01234567'.indexOf(e)}function n(e){return 32===e||9===e||11===e||12===e||160===e||5760<=e&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)}function i(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||92===e||128<=e&&rt.NonAsciiIdentifierStart.test(xn(e))}function u(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||48<=e&&57>=e||92===e||128<=e&&rt.NonAsciiIdentifierPart.test(xn(e))}function l(e){return'class'===e||'enum'===e||'export'===e||'extends'===e||'import'===e||'super'===e}function p(e){return'implements'===e||'interface'===e||'package'===e||'private'===e||'protected'===e||'public'===e||'static'===e||'yield'===e||'let'===e}function d(e){return'eval'===e||'arguments'===e}function c(e){if(it&&p(e))return!0;switch(e.length){case 2:return'if'===e||'in'===e||'do'===e;case 3:return'var'===e||'for'===e||'new'===e||'try'===e||'let'===e;case 4:return'this'===e||'else'===e||'case'===e||'void'===e||'with'===e||'enum'===e;case 5:return'while'===e||'break'===e||'catch'===e||'throw'===e||'const'===e||'yield'===e||'class'===e||'super'===e;case 6:return'return'===e||'typeof'===e||'delete'===e||'switch'===e||'export'===e||'import'===e;case 7:return'default'===e||'finally'===e||'extends'===e;case 8:return'function'===e||'continue'===e||'debugger'===e;case 10:return'instanceof'===e;default:return!1;}}function h(e,a,r,o,n){var i;t('number'==typeof r,'Comment must have valid position');ht.lastCommentStart>=r||(ht.lastCommentStart=r,i={type:e,value:a},gt.range&&(i.range=[r,o]),gt.loc&&(i.loc=n),gt.comments.push(i),gt.attachComment&&(gt.leadingComments.push(i),gt.trailingComments.push(i)))}function g(e){var t,a,r,o;for(t=st-e,a={start:{line:ut,column:st-lt-e}};st<pt;)if(r=nt.charCodeAt(st),++st,i(r))return gt.comments&&(o=nt.slice(t+e,st-1),a.end={line:ut,column:st-lt-1},h('Line',o,t,st-1,a)),13===r&&10===nt.charCodeAt(st)&&++st,++ut,void(lt=st);gt.comments&&(o=nt.slice(t+e,st),a.end={line:ut,column:st-lt},h('Line',o,t,st,a))}function f(){var e,t,a,r;for(gt.comments&&(e=st-2,t={start:{line:ut,column:st-lt-2}});st<pt;)if(a=nt.charCodeAt(st),i(a))13===a&&10===nt.charCodeAt(st+1)&&++st,++ut,++st,lt=st,st>=pt&&U({},at.UnexpectedToken,'ILLEGAL');else if(42===a){if(47===nt.charCodeAt(st+1))return++st,++st,void(gt.comments&&(r=nt.slice(e+2,st-2),t.end={line:ut,column:st-lt},h('Block',r,e,st,t)));++st}else++st;U({},at.UnexpectedToken,'ILLEGAL')}function m(){var e,t;for(t=0===st;st<pt;)if(e=nt.charCodeAt(st),n(e))++st;else if(i(e))++st,13===e&&10===nt.charCodeAt(st)&&++st,++ut,lt=st,t=!0;else if(47===e){if(e=nt.charCodeAt(st+1),47===e)++st,++st,g(2),t=!0;else if(42===e)++st,++st,f();else break;}else if(t&&45===e){if(45===nt.charCodeAt(st+1)&&62===nt.charCodeAt(st+2))st+=3,g(3);else break;}else if(60!==e)break;else if('!--'===nt.slice(st+1,st+4))++st,++st,++st,++st,g(4);else break}function _(e){var t=0,a,o,n;for(o='u'===e?4:2,a=0;a<o;++a)if(st<pt&&r(nt[st]))n=nt[st++],t=16*t+'0123456789abcdef'.indexOf(n.toLowerCase());else return'';return xn(t)}function x(){var e,t;for(e=nt.charCodeAt(st++),t=xn(e),92===e&&(117!==nt.charCodeAt(st)&&U({},at.UnexpectedToken,'ILLEGAL'),++st,e=_('u'),(!e||'\\'===e||!s(e.charCodeAt(0)))&&U({},at.UnexpectedToken,'ILLEGAL'),t=e);st<pt&&(e=nt.charCodeAt(st),!!u(e));)++st,t+=xn(e),92===e&&(t=t.substr(0,t.length-1),117!==nt.charCodeAt(st)&&U({},at.UnexpectedToken,'ILLEGAL'),++st,e=_('u'),(!e||'\\'===e||!u(e.charCodeAt(0)))&&U({},at.UnexpectedToken,'ILLEGAL'),t+=e);return t}function y(){var e,t;for(e=st++;st<pt;){if(t=nt.charCodeAt(st),92===t)return st=e,x();if(u(t))++st;else break}return nt.slice(e,st)}function v(){var e,t,a;return e=st,t=92===nt.charCodeAt(st)?x():y(),a=1===t.length?Ze.Identifier:c(t)?Ze.Keyword:'null'===t?Ze.NullLiteral:'true'===t||'false'===t?Ze.BooleanLiteral:Ze.Identifier,{type:a,value:t,lineNumber:ut,lineStart:lt,start:e,end:st}}function b(){var e=st,t=nt.charCodeAt(st),a=nt[st],r,o,n,i;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++st,gt.tokenize&&(40===t?gt.openParenToken=gt.tokens.length:123===t&&(gt.openCurlyToken=gt.tokens.length)),{type:Ze.Punctuator,value:xn(t),lineNumber:ut,lineStart:lt,start:e,end:st};default:if(r=nt.charCodeAt(st+1),61===r)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return st+=2,{type:Ze.Punctuator,value:xn(t)+xn(r),lineNumber:ut,lineStart:lt,start:e,end:st};case 33:case 61:return st+=2,61===nt.charCodeAt(st)&&++st,{type:Ze.Punctuator,value:nt.slice(e,st),lineNumber:ut,lineStart:lt,start:e,end:st};}}return(i=nt.substr(st,4),'>>>='===i)?(st+=4,{type:Ze.Punctuator,value:i,lineNumber:ut,lineStart:lt,start:e,end:st}):(n=i.substr(0,3),'>>>'===n||'<<='===n||'>>='===n)?(st+=3,{type:Ze.Punctuator,value:n,lineNumber:ut,lineStart:lt,start:e,end:st}):(o=n.substr(0,2),a===o[1]&&0<='+-<>&|'.indexOf(a)||'=>'===o?(st+=2,{type:Ze.Punctuator,value:o,lineNumber:ut,lineStart:lt,start:e,end:st}):0<='<>=!+-*%&|^/'.indexOf(a)?(++st,{type:Ze.Punctuator,value:a,lineNumber:ut,lineStart:lt,start:e,end:st}):void U({},at.UnexpectedToken,'ILLEGAL'))}function S(e){for(var t='';st<pt&&!!r(nt[st]);)t+=nt[st++];return 0===t.length&&U({},at.UnexpectedToken,'ILLEGAL'),s(nt.charCodeAt(st))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt('0x'+t,16),lineNumber:ut,lineStart:lt,start:e,end:st}}function T(e){for(var t='0'+nt[st++];st<pt&&!!o(nt[st]);)t+=nt[st++];return(s(nt.charCodeAt(st))||a(nt.charCodeAt(st)))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt(t,8),octal:!0,lineNumber:ut,lineStart:lt,start:e,end:st}}function P(){var e,t;for(e=st+1;e<pt;++e){if(t=nt[e],'8'===t||'9'===t)return!1;if(!o(t))return!0}return!0}function w(){var e,r,n;if(n=nt[st],t(a(n.charCodeAt(0))||'.'===n,'Numeric literal must start with a decimal digit or a decimal point'),r=st,e='','.'!==n){if(e=nt[st++],n=nt[st],'0'===e){if('x'===n||'X'===n)return++st,S(r);if(o(n)&&P())return T(r)}for(;a(nt.charCodeAt(st));)e+=nt[st++];n=nt[st]}if('.'===n){for(e+=nt[st++];a(nt.charCodeAt(st));)e+=nt[st++];n=nt[st]}if('e'===n||'E'===n)if(e+=nt[st++],n=nt[st],('+'===n||'-'===n)&&(e+=nt[st++]),a(nt.charCodeAt(st)))for(;a(nt.charCodeAt(st));)e+=nt[st++];else U({},at.UnexpectedToken,'ILLEGAL');return s(nt.charCodeAt(st))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseFloat(e),lineNumber:ut,lineStart:lt,start:r,end:st}}function C(){var e='',a=!1,r,n,s,u,l,p,d,c;for(d=ut,c=lt,r=nt[st],t('\''===r||'"'===r,'String literal must starts with a quote'),n=st,++st;st<pt;)if(s=nt[st++],s===r){r='';break}else if('\\'===s)s=nt[st++],s&&i(s.charCodeAt(0))?(++ut,'\r'===s&&'\n'===nt[st]&&++st,lt=st):'u'===s||'x'===s?(p=st,l=_(s),l?e+=l:(st=p,e+=s)):'n'===s?e+='\n':'r'===s?e+='\r':'t'===s?e+='\t':'b'===s?e+='\b':'f'===s?e+='\f':'v'===s?e+='\x0B':o(s)?(u='01234567'.indexOf(s),0!==u&&(a=!0),st<pt&&o(nt[st])&&(a=!0,u=8*u+'01234567'.indexOf(nt[st++]),0<='0123'.indexOf(s)&&st<pt&&o(nt[st])&&(u=8*u+'01234567'.indexOf(nt[st++]))),e+=xn(u)):e+=s;else if(i(s.charCodeAt(0)))break;else e+=s;return''!==r&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.StringLiteral,value:e,octal:a,startLineNumber:d,startLineStart:c,lineNumber:ut,lineStart:lt,start:n,end:st}}function k(e,t){var a;try{a=new RegExp(e,t)}catch(t){U({},at.InvalidRegExp)}return a}function F(){var e,a,r,o,n;for(e=nt[st],t('/'===e,'Regular expression literal must start with a slash'),a=nt[st++],r=!1,o=!1;st<pt;)if(e=nt[st++],a+=e,'\\'===e)e=nt[st++],i(e.charCodeAt(0))&&U({},at.UnterminatedRegExp),a+=e;else if(i(e.charCodeAt(0)))U({},at.UnterminatedRegExp);else if(r)']'===e&&(r=!1);else if('/'===e){o=!0;break}else'['===e&&(r=!0);return o||U({},at.UnterminatedRegExp),n=a.substr(1,a.length-2),{value:n,literal:a}}function M(){var e,t,a,r;for(t='',a='';st<pt&&(e=nt[st],!!u(e.charCodeAt(0)));)if(++st,!('\\'===e&&st<pt))a+=e,t+=e;else if(e=nt[st],'u'===e){if(++st,r=st,e=_('u'),e)for(a+=e,t+='\\u';r<st;++r)t+=nt[r];else st=r,a+='u',t+='\\u';N({},at.UnexpectedToken,'ILLEGAL')}else t+='\\',N({},at.UnexpectedToken,'ILLEGAL');return{value:a,literal:t}}function D(){var e,t,a,r;return ct=null,m(),e=st,t=F(),a=M(),r=k(t.value,a.value),gt.tokenize?{type:Ze.RegularExpression,value:r,lineNumber:ut,lineStart:lt,start:e,end:st}:{literal:t.literal+a.literal,value:r,start:e,end:st}}function I(){var e,t,a,r;return m(),e=st,t={start:{line:ut,column:st-lt}},a=D(),t.end={line:ut,column:st-lt},gt.tokenize||(0<gt.tokens.length&&(r=gt.tokens[gt.tokens.length-1],r.range[0]===e&&'Punctuator'===r.type&&('/'===r.value||'/='===r.value)&&gt.tokens.pop()),gt.tokens.push({type:'RegularExpression',value:a.literal,range:[e,st],loc:t})),a}function E(e){return e.type===Ze.Identifier||e.type===Ze.Keyword||e.type===Ze.BooleanLiteral||e.type===Ze.NullLiteral}function R(){var e,t;if(e=gt.tokens[gt.tokens.length-1],!e)return I();if('Punctuator'===e.type){if(']'===e.value)return b();if(')'===e.value)return t=gt.tokens[gt.openParenToken-1],t&&'Keyword'===t.type&&('if'===t.value||'while'===t.value||'for'===t.value||'with'===t.value)?I():b();if('}'===e.value){if(!(gt.tokens[gt.openCurlyToken-3]&&'Keyword'===gt.tokens[gt.openCurlyToken-3].type)){if(!(gt.tokens[gt.openCurlyToken-4]&&'Keyword'===gt.tokens[gt.openCurlyToken-4].type))return b();if(t=gt.tokens[gt.openCurlyToken-5],!t)return I()}else if(t=gt.tokens[gt.openCurlyToken-4],!t)return b();return 0<=Je.indexOf(t.value)?b():I()}return I()}return'Keyword'===e.type&&'this'!==e.value?I():b()}function A(){var e;return(m(),st>=pt)?{type:Ze.EOF,lineNumber:ut,lineStart:lt,start:st,end:st}:(e=nt.charCodeAt(st),s(e)?v():40===e||41===e||59===e?b():39===e||34===e?C():46===e?a(nt.charCodeAt(st+1))?w():b():a(e)?w():gt.tokenize&&47===e?R():b())}function L(){var e,t,a;return m(),e={start:{line:ut,column:st-lt}},t=A(),e.end={line:ut,column:st-lt},t.type!==Ze.EOF&&(a=nt.slice(t.start,t.end),gt.tokens.push({type:Ye[t.type],value:a,range:[t.start,t.end],loc:e})),t}function j(){var e;return e=ct,st=e.end,ut=e.lineNumber,lt=e.lineStart,ct='undefined'==typeof gt.tokens?A():L(),st=e.end,ut=e.lineNumber,lt=e.lineStart,e}function z(){var e,t,a;e=st,t=ut,a=lt,ct='undefined'==typeof gt.tokens?A():L(),st=e,ut=t,lt=a}function G(e,t){this.line=e,this.column=t}function O(e,t,a,r){this.start=new G(e,t),this.end=new G(a,r)}function q(){var e,t,a,r;return e=st,t=ut,a=lt,m(),r=ut!==t,st=e,ut=t,lt=a,r}function U(e,a){var r=Array.prototype.slice.call(arguments,2),o=a.replace(/%(\d)/g,function(e,a){return t(a<r.length,'Message reference must be in range'),r[a]}),n;throw'number'==typeof e.lineNumber?(n=new Error('Line '+e.lineNumber+': '+o),n.index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-lt+1):(n=new Error('Line '+ut+': '+o),n.index=st,n.lineNumber=ut,n.column=st-lt+1),n.description=o,n}function N(){try{U.apply(null,arguments)}catch(t){if(gt.errors)gt.errors.push(t);else throw t}}function B(e){if(e.type===Ze.EOF&&U(e,at.UnexpectedEOS),e.type===Ze.NumericLiteral&&U(e,at.UnexpectedNumber),e.type===Ze.StringLiteral&&U(e,at.UnexpectedString),e.type===Ze.Identifier&&U(e,at.UnexpectedIdentifier),e.type===Ze.Keyword){if(l(e.value))U(e,at.UnexpectedReserved);else if(it&&p(e.value))return void N(e,at.StrictReservedWord);U(e,at.UnexpectedToken,e.value)}U(e,at.UnexpectedToken,e.value)}function V(e){var t=j();(t.type!==Ze.Punctuator||t.value!==e)&&B(t)}function H(e){var t=j();(t.type!==Ze.Keyword||t.value!==e)&&B(t)}function W(e){return ct.type===Ze.Punctuator&&ct.value===e}function X(e){return ct.type===Ze.Keyword&&ct.value===e}function $(){var e;return!(ct.type!==Ze.Punctuator)&&(e=ct.value,'='===e||'*='===e||'/='===e||'%='===e||'+='===e||'-='===e||'<<='===e||'>>='===e||'>>>='===e||'&='===e||'^='===e||'|='===e)}function K(){var e=st,t=ut,a=lt,r=ct,o;return 59===nt.charCodeAt(st)||W(';')?void j():(o=ut,m(),ut===o?void(ct.type!==Ze.EOF&&!W('}')&&B(ct)):(st=e,ut=t,lt=a,void(ct=r)))}function Q(e){return e.type===et.Identifier||e.type===et.MemberExpression}function Z(){var e=[],t;for(t=ct,V('[');!W(']');)W(',')?(j(),e.push(null)):(e.push(me()),W(']')||V(','));return j(),dt.markEnd(dt.createArrayExpression(e),t)}function Y(e,t){var a,r,o;return a=it,o=ct,r=Be(),t&&it&&d(e[0].name)&&N(t,at.StrictParamName),it=a,dt.markEnd(dt.createFunctionExpression(null,e,[],r),o)}function J(){var e,t;return t=ct,e=j(),e.type===Ze.StringLiteral||e.type===Ze.NumericLiteral?(it&&e.octal&&N(e,at.StrictOctalLiteral),dt.markEnd(dt.createLiteral(e),t)):dt.markEnd(dt.createIdentifier(e.value),t)}function ee(){var e,t,a,r,o,n;return(e=ct,n=ct,e.type===Ze.Identifier)?(a=J(),'get'===e.value&&!W(':'))?(t=J(),V('('),V(')'),r=Y([]),dt.markEnd(dt.createProperty('get',t,r),n)):'set'!==e.value||W(':')?(V(':'),r=me(),dt.markEnd(dt.createProperty('init',a,r),n)):(t=J(),V('('),e=ct,e.type===Ze.Identifier?(o=[ve()],V(')'),r=Y(o,e)):(V(')'),N(e,at.UnexpectedToken,e.value),r=Y([])),dt.markEnd(dt.createProperty('set',t,r),n)):e.type===Ze.EOF||e.type===Ze.Punctuator?void B(e):(t=J(),V(':'),r=me(),dt.markEnd(dt.createProperty('init',t,r),n))}function te(){var e=[],t={},a=String,r,o,n,i,s;for(s=ct,V('{');!W('}');)r=ee(),o=r.key.type===et.Identifier?r.key.name:a(r.key.value),i='init'===r.kind?tt.Data:'get'===r.kind?tt.Get:tt.Set,n='$'+o,Object.prototype.hasOwnProperty.call(t,n)?(t[n]===tt.Data?it&&i===tt.Data?N({},at.StrictDuplicateProperty):i!==tt.Data&&N({},at.AccessorDataProperty):i===tt.Data?N({},at.AccessorDataProperty):t[n]&i&&N({},at.AccessorGetSet),t[n]|=i):t[n]=i,e.push(r),W('}')||V(',');return V('}'),dt.markEnd(dt.createObjectExpression(e),s)}function ae(){var e;return V('('),e=_e(),V(')'),e}function re(){var e,t,a,r;if(W('('))return ae();if(W('['))return Z();if(W('{'))return te();if(e=ct.type,r=ct,e===Ze.Identifier)a=dt.createIdentifier(j().value);else if(e===Ze.StringLiteral||e===Ze.NumericLiteral)it&&ct.octal&&N(ct,at.StrictOctalLiteral),a=dt.createLiteral(j());else if(e===Ze.Keyword){if(X('function'))return We();X('this')?(j(),a=dt.createThisExpression()):B(j())}else e===Ze.BooleanLiteral?(t=j(),t.value='true'===t.value,a=dt.createLiteral(t)):e===Ze.NullLiteral?(t=j(),t.value=null,a=dt.createLiteral(t)):W('/')||W('/=')?(a='undefined'==typeof gt.tokens?dt.createLiteral(D()):dt.createLiteral(I()),z()):B(j());return dt.markEnd(a,r)}function oe(){var e=[];if(V('('),!W(')'))for(;st<pt&&(e.push(me()),!W(')'));)V(',');return V(')'),e}function ne(){var e,t;return t=ct,e=j(),E(e)||B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function ie(){return V('.'),ne()}function se(){var e;return V('['),e=_e(),V(']'),e}function ue(){var e,t,a;return a=ct,H('new'),e=pe(),t=W('(')?oe():[],dt.markEnd(dt.createNewExpression(e,t),a)}function le(){var e=ht.allowIn,t,a,r,o;for(o=ct,ht.allowIn=!0,t=X('new')?ue():re();;){if(W('.'))r=ie(),t=dt.createMemberExpression('.',t,r);else if(W('('))a=oe(),t=dt.createCallExpression(t,a);else if(W('['))r=se(),t=dt.createMemberExpression('[',t,r);else break;dt.markEnd(t,o)}return ht.allowIn=e,t}function pe(){var e,a,r;for(t(ht.allowIn,'callee of new expression always allow in keyword.'),r=ct,e=X('new')?ue():re();W('.')||W('[');)W('[')?(a=se(),e=dt.createMemberExpression('[',e,a)):(a=ie(),e=dt.createMemberExpression('.',e,a)),dt.markEnd(e,r);return e}function de(){var e=ct,t,a;return t=le(),ct.type===Ze.Punctuator&&(W('++')||W('--'))&&!q()&&(it&&t.type===et.Identifier&&d(t.name)&&N({},at.StrictLHSPostfix),!Q(t)&&N({},at.InvalidLHSInAssignment),a=j(),t=dt.markEnd(dt.createPostfixExpression(a.value,t),e)),t}function ce(){var e,t,a;return ct.type!==Ze.Punctuator&&ct.type!==Ze.Keyword?t=de():W('++')||W('--')?(a=ct,e=j(),t=ce(),it&&t.type===et.Identifier&&d(t.name)&&N({},at.StrictLHSPrefix),!Q(t)&&N({},at.InvalidLHSInAssignment),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):W('+')||W('-')||W('~')||W('!')?(a=ct,e=j(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):X('delete')||X('void')||X('typeof')?(a=ct,e=j(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a),it&&'delete'===t.operator&&t.argument.type===et.Identifier&&N({},at.StrictDelete)):t=de(),t}function he(e,t){var a=0;if(e.type!==Ze.Punctuator&&e.type!==Ze.Keyword)return 0;switch(e.value){case'||':a=1;break;case'&&':a=2;break;case'|':a=3;break;case'^':a=4;break;case'&':a=5;break;case'==':case'!=':case'===':case'!==':a=6;break;case'<':case'>':case'<=':case'>=':case'instanceof':a=7;break;case'in':a=t?7:0;break;case'<<':case'>>':case'>>>':a=8;break;case'+':case'-':a=9;break;case'*':case'/':case'%':a=11;break;default:}return a}function ge(){var e,t,a,r,o,n,s,u,l,p;if(e=ct,l=ce(),r=ct,o=he(r,ht.allowIn),0===o)return l;for(r.prec=o,j(),t=[e,ct],s=ce(),n=[l,r,s];0<(o=he(ct,ht.allowIn));){for(;2<n.length&&o<=n[n.length-2].prec;)s=n.pop(),u=n.pop().value,l=n.pop(),a=dt.createBinaryExpression(u,l,s),t.pop(),e=t[t.length-1],dt.markEnd(a,e),n.push(a);r=j(),r.prec=o,n.push(r),t.push(ct),a=ce(),n.push(a)}for(p=n.length-1,a=n[p],t.pop();1<p;)a=dt.createBinaryExpression(n[p-1].value,n[p-2],a),p-=2,e=t.pop(),dt.markEnd(a,e);return a}function fe(){var e,t,a,r,o;return o=ct,e=ge(),W('?')&&(j(),t=ht.allowIn,ht.allowIn=!0,a=me(),ht.allowIn=t,V(':'),r=me(),e=dt.createConditionalExpression(e,a,r),dt.markEnd(e,o)),e}function me(){var e,t,a,r,o;return e=ct,o=ct,r=t=fe(),$()&&(!Q(t)&&N({},at.InvalidLHSInAssignment),it&&t.type===et.Identifier&&d(t.name)&&N(e,at.StrictLHSAssignment),e=j(),a=me(),r=dt.markEnd(dt.createAssignmentExpression(e.value,t,a),o)),r}function _e(){var e=ct,t;if(t=me(),W(',')){for(t=dt.createSequenceExpression([t]);st<pt&&!!W(',');)j(),t.expressions.push(me());dt.markEnd(t,e)}return t}function xe(){for(var e=[],t;st<pt&&!W('}')&&!(t=Xe(),'undefined'==typeof t);)e.push(t);return e}function ye(){var e,t;return t=ct,V('{'),e=xe(),V('}'),dt.markEnd(dt.createBlockStatement(e),t)}function ve(){var e,t;return t=ct,e=j(),e.type!==Ze.Identifier&&B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function be(e){var t=null,a,r;return r=ct,a=ve(),it&&d(a.name)&&N({},at.StrictVarName),'const'===e?(V('='),t=me()):W('=')&&(j(),t=me()),dt.markEnd(dt.createVariableDeclarator(a,t),r)}function Se(e){var t=[];do{if(t.push(be(e)),!W(','))break;j()}while(st<pt);return t}function Te(){var e;return H('var'),e=Se(),K(),dt.createVariableDeclaration(e,'var')}function Pe(e){var t,a;return a=ct,H(e),t=Se(e),K(),dt.markEnd(dt.createVariableDeclaration(t,e),a)}function we(){return V(';'),dt.createEmptyStatement()}function Ce(){var e=_e();return K(),dt.createExpressionStatement(e)}function ke(){var e,t,a;return H('if'),V('('),e=_e(),V(')'),t=Ne(),X('else')?(j(),a=Ne()):a=null,dt.createIfStatement(e,t,a)}function Fe(){var e,t,a;return H('do'),a=ht.inIteration,ht.inIteration=!0,e=Ne(),ht.inIteration=a,H('while'),V('('),t=_e(),V(')'),W(';')&&j(),dt.createDoWhileStatement(e,t)}function Me(){var e,t,a;return H('while'),V('('),e=_e(),V(')'),a=ht.inIteration,ht.inIteration=!0,t=Ne(),ht.inIteration=a,dt.createWhileStatement(e,t)}function De(){var e,t,a;return a=ct,e=j(),t=Se(),dt.markEnd(dt.createVariableDeclaration(t,e.value),a)}function Ie(){var e=ht.allowIn,t,a,r,o,n,i,s;return t=a=r=null,H('for'),V('('),W(';')?j():(X('var')||X('let')?(ht.allowIn=!1,t=De(),ht.allowIn=e,1===t.declarations.length&&X('in')&&(j(),o=t,n=_e(),t=null)):(ht.allowIn=!1,t=_e(),ht.allowIn=e,X('in')&&(!Q(t)&&N({},at.InvalidLHSInForIn),j(),o=t,n=_e(),t=null)),'undefined'==typeof o&&V(';')),'undefined'==typeof o&&(!W(';')&&(a=_e()),V(';'),!W(')')&&(r=_e())),V(')'),s=ht.inIteration,ht.inIteration=!0,i=Ne(),ht.inIteration=s,'undefined'==typeof o?dt.createForStatement(t,a,r,i):dt.createForInStatement(o,n,i)}function Ee(){var e=null,t;return(H('continue'),59===nt.charCodeAt(st))?(j(),ht.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(null)):q()?(ht.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(ht.labelSet,t)&&U({},at.UnknownLabel,e.name)),K(),null!==e||ht.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(e))}function Re(){var e=null,t;return(H('break'),59===nt.charCodeAt(st))?(j(),ht.inIteration||ht.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(null)):q()?(ht.inIteration||ht.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(ht.labelSet,t)&&U({},at.UnknownLabel,e.name)),K(),null!==e||ht.inIteration||ht.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(e))}function Ae(){var e=null;return(H('return'),ht.inFunctionBody||N({},at.IllegalReturn),32===nt.charCodeAt(st)&&s(nt.charCodeAt(st+1)))?(e=_e(),K(),dt.createReturnStatement(e)):q()?dt.createReturnStatement(null):(W(';')||W('}')||ct.type===Ze.EOF||(e=_e()),K(),dt.createReturnStatement(e))}function Le(){var e,t;return it&&(m(),N({},at.StrictModeWith)),H('with'),V('('),e=_e(),V(')'),t=Ne(),dt.createWithStatement(e,t)}function je(){var e=[],t,a,r;for(r=ct,X('default')?(j(),t=null):(H('case'),t=_e()),V(':');st<pt&&!(W('}')||X('default')||X('case'));)a=Ne(),e.push(a);return dt.markEnd(dt.createSwitchCase(t,e),r)}function ze(){var e,t,a,r,o;if(H('switch'),V('('),e=_e(),V(')'),V('{'),t=[],W('}'))return j(),dt.createSwitchStatement(e,t);for(r=ht.inSwitch,ht.inSwitch=!0,o=!1;st<pt&&!W('}');)a=je(),null===a.test&&(o&&U({},at.MultipleDefaultsInSwitch),o=!0),t.push(a);return ht.inSwitch=r,V('}'),dt.createSwitchStatement(e,t)}function Ge(){var e;return H('throw'),q()&&U({},at.NewlineAfterThrow),e=_e(),K(),dt.createThrowStatement(e)}function Oe(){var e,t,a;return a=ct,H('catch'),V('('),W(')')&&B(ct),e=ve(),it&&d(e.name)&&N({},at.StrictCatchVariable),V(')'),t=ye(),dt.markEnd(dt.createCatchClause(e,t),a)}function qe(){var e=[],t=null,a;return H('try'),a=ye(),X('catch')&&e.push(Oe()),X('finally')&&(j(),t=ye()),0!==e.length||t||U({},at.NoCatchOrFinally),dt.createTryStatement(a,[],e,t)}function Ue(){return H('debugger'),K(),dt.createDebuggerStatement()}function Ne(){var e=ct.type,t,a,r,o;if(e===Ze.EOF&&B(ct),e===Ze.Punctuator&&'{'===ct.value)return ye();if(o=ct,e===Ze.Punctuator)switch(ct.value){case';':return dt.markEnd(we(),o);case'(':return dt.markEnd(Ce(),o);default:}if(e===Ze.Keyword)switch(ct.value){case'break':return dt.markEnd(Re(),o);case'continue':return dt.markEnd(Ee(),o);case'debugger':return dt.markEnd(Ue(),o);case'do':return dt.markEnd(Fe(),o);case'for':return dt.markEnd(Ie(),o);case'function':return dt.markEnd(He(),o);case'if':return dt.markEnd(ke(),o);case'return':return dt.markEnd(Ae(),o);case'switch':return dt.markEnd(ze(),o);case'throw':return dt.markEnd(Ge(),o);case'try':return dt.markEnd(qe(),o);case'var':return dt.markEnd(Te(),o);case'while':return dt.markEnd(Me(),o);case'with':return dt.markEnd(Le(),o);default:}return(t=_e(),t.type===et.Identifier&&W(':'))?(j(),r='$'+t.name,Object.prototype.hasOwnProperty.call(ht.labelSet,r)&&U({},at.Redeclaration,'Label',t.name),ht.labelSet[r]=!0,a=Ne(),delete ht.labelSet[r],dt.markEnd(dt.createLabeledStatement(t,a),o)):(K(),dt.markEnd(dt.createExpressionStatement(t),o))}function Be(){var e=[],t,a,r,o,n,i,s,u,l;for(l=ct,V('{');st<pt&&ct.type===Ze.StringLiteral&&(a=ct,t=Xe(),e.push(t),t.expression.type===et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&N(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(n=ht.labelSet,i=ht.inIteration,s=ht.inSwitch,u=ht.inFunctionBody,ht.labelSet={},ht.inIteration=!1,ht.inSwitch=!1,ht.inFunctionBody=!0;st<pt&&!W('}')&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return V('}'),ht.labelSet=n,ht.inIteration=i,ht.inSwitch=s,ht.inFunctionBody=u,dt.markEnd(dt.createBlockStatement(e),l)}function Ve(e){var t=[],a,r,o,n,i,s;if(V('('),!W(')'))for(n={};st<pt&&(r=ct,a=ve(),i='$'+r.value,it?(d(r.value)&&(o=r,s=at.StrictParamName),Object.prototype.hasOwnProperty.call(n,i)&&(o=r,s=at.StrictParamDupe)):!e&&(d(r.value)?(e=r,s=at.StrictParamName):p(r.value)?(e=r,s=at.StrictReservedWord):Object.prototype.hasOwnProperty.call(n,i)&&(e=r,s=at.StrictParamDupe)),t.push(a),n[i]=!0,!W(')'));)V(',');return V(')'),{params:t,stricted:o,firstRestricted:e,message:s}}function He(){var e=[],t,a,r,o,n,i,s,u,l;return l=ct,H('function'),r=ct,t=ve(),it?d(r.value)&&N(r,at.StrictFunctionName):d(r.value)?(i=r,s=at.StrictFunctionName):p(r.value)&&(i=r,s=at.StrictReservedWord),n=Ve(i),e=n.params,o=n.stricted,i=n.firstRestricted,n.message&&(s=n.message),u=it,a=Be(),it&&i&&U(i,s),it&&o&&N(o,s),it=u,dt.markEnd(dt.createFunctionDeclaration(t,e,[],a),l)}function We(){var e=null,t=[],a,r,o,n,i,s,u,l;return l=ct,H('function'),W('(')||(a=ct,e=ve(),it?d(a.value)&&N(a,at.StrictFunctionName):d(a.value)?(o=a,n=at.StrictFunctionName):p(a.value)&&(o=a,n=at.StrictReservedWord)),i=Ve(o),t=i.params,r=i.stricted,o=i.firstRestricted,i.message&&(n=i.message),u=it,s=Be(),it&&o&&U(o,n),it&&r&&N(r,n),it=u,dt.markEnd(dt.createFunctionExpression(e,t,[],s),l)}function Xe(){if(ct.type===Ze.Keyword)switch(ct.value){case'const':case'let':return Pe(ct.value);case'function':return He();default:return Ne();}return ct.type===Ze.EOF?void 0:Ne()}function $e(){for(var e=[],t,a,r,o;st<pt&&(a=ct,a.type===Ze.StringLiteral)&&!(t=Xe(),e.push(t),t.expression.type!==et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&N(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(;st<pt&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return e}function Ke(){var e,t;return m(),z(),t=ct,it=!1,e=$e(),dt.markEnd(dt.createProgram(e),t)}function Qe(){var e=[],t,a,r;for(t=0;t<gt.tokens.length;++t)a=gt.tokens[t],r={type:a.type,value:a.value},gt.range&&(r.range=a.range),gt.loc&&(r.loc=a.loc),e.push(r);gt.tokens=e}var Ze,Ye,Je,et,tt,at,rt,ot,nt,it,st,ut,lt,pt,dt,ct,ht,gt;Ze={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},Ye={},Ye[Ze.BooleanLiteral]='Boolean',Ye[Ze.EOF]='<end>',Ye[Ze.Identifier]='Identifier',Ye[Ze.Keyword]='Keyword',Ye[Ze.NullLiteral]='Null',Ye[Ze.NumericLiteral]='Numeric',Ye[Ze.Punctuator]='Punctuator',Ye[Ze.StringLiteral]='String',Ye[Ze.RegularExpression]='RegularExpression',Je=['(','{','[','in','typeof','instanceof','new','return','case','delete','throw','void','=','+=','-=','*=','/=','%=','<<=','>>=','>>>=','&=','|=','^=',',','+','-','*','/','%','++','--','<<','>>','>>>','&','|','^','!','~','&&','||','?',':','===','==','>=','<=','<','>','!=','!=='],et={AssignmentExpression:'AssignmentExpression',ArrayExpression:'ArrayExpression',BlockStatement:'BlockStatement',BinaryExpression:'BinaryExpression',BreakStatement:'BreakStatement',CallExpression:'CallExpression',CatchClause:'CatchClause',ConditionalExpression:'ConditionalExpression',ContinueStatement:'ContinueStatement',DoWhileStatement:'DoWhileStatement',DebuggerStatement:'DebuggerStatement',EmptyStatement:'EmptyStatement',ExpressionStatement:'ExpressionStatement',ForStatement:'ForStatement',ForInStatement:'ForInStatement',FunctionDeclaration:'FunctionDeclaration',FunctionExpression:'FunctionExpression',Identifier:'Identifier',IfStatement:'IfStatement',Literal:'Literal',LabeledStatement:'LabeledStatement',LogicalExpression:'LogicalExpression',MemberExpression:'MemberExpression',NewExpression:'NewExpression',ObjectExpression:'ObjectExpression',Program:'Program',Property:'Property',ReturnStatement:'ReturnStatement',SequenceExpression:'SequenceExpression',SwitchStatement:'SwitchStatement',SwitchCase:'SwitchCase',ThisExpression:'ThisExpression',ThrowStatement:'ThrowStatement',TryStatement:'TryStatement',UnaryExpression:'UnaryExpression',UpdateExpression:'UpdateExpression',VariableDeclaration:'VariableDeclaration',VariableDeclarator:'VariableDeclarator',WhileStatement:'WhileStatement',WithStatement:'WithStatement'},tt={Data:1,Get:2,Set:4},at={UnexpectedToken:'Unexpected token %0',UnexpectedNumber:'Unexpected number',UnexpectedString:'Unexpected string',UnexpectedIdentifier:'Unexpected identifier',UnexpectedReserved:'Unexpected reserved word',UnexpectedEOS:'Unexpected end of input',NewlineAfterThrow:'Illegal newline after throw',InvalidRegExp:'Invalid regular expression',UnterminatedRegExp:'Invalid regular expression: missing /',InvalidLHSInAssignment:'Invalid left-hand side in assignment',InvalidLHSInForIn:'Invalid left-hand side in for-in',MultipleDefaultsInSwitch:'More than one default clause in switch statement',NoCatchOrFinally:'Missing catch or finally after try',UnknownLabel:'Undefined label \'%0\'',Redeclaration:'%0 \'%1\' has already been declared',IllegalContinue:'Illegal continue statement',IllegalBreak:'Illegal break statement',IllegalReturn:'Illegal return statement',StrictModeWith:'Strict mode code may not include a with statement',StrictCatchVariable:'Catch variable may not be eval or arguments in strict mode',StrictVarName:'Variable name may not be eval or arguments in strict mode',StrictParamName:'Parameter name eval or arguments is not allowed in strict mode',StrictParamDupe:'Strict mode function may not have duplicate parameter names',StrictFunctionName:'Function name may not be eval or arguments in strict mode',StrictOctalLiteral:'Octal literals are not allowed in strict mode.',StrictDelete:'Delete of an unqualified identifier in strict mode.',StrictDuplicateProperty:'Duplicate data property in object literal not allowed in strict mode',AccessorDataProperty:'Object literal may not have data and accessor property with the same name',AccessorGetSet:'Object literal may not have multiple get/set accessors with the same name',StrictLHSAssignment:'Assignment to eval or arguments is not allowed in strict mode',StrictLHSPostfix:'Postfix increment/decrement may not have eval or arguments operand in strict mode',StrictLHSPrefix:'Prefix increment/decrement may not have eval or arguments operand in strict mode',StrictReservedWord:'Use of future reserved word in strict mode'},rt={NonAsciiIdentifierStart:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/,NonAsciiIdentifierPart:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/},ot={name:'SyntaxTree',processComment:function(e){var t,a;if(!(e.type===et.Program&&0<e.body.length)){for(0<gt.trailingComments.length?gt.trailingComments[0].range[0]>=e.range[1]?(a=gt.trailingComments,gt.trailingComments=[]):gt.trailingComments.length=0:0<gt.bottomRightStack.length&&gt.bottomRightStack[gt.bottomRightStack.length-1].trailingComments&&gt.bottomRightStack[gt.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(a=gt.bottomRightStack[gt.bottomRightStack.length-1].trailingComments,delete gt.bottomRightStack[gt.bottomRightStack.length-1].trailingComments);0<gt.bottomRightStack.length&&gt.bottomRightStack[gt.bottomRightStack.length-1].range[0]>=e.range[0];)t=gt.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):0<gt.leadingComments.length&&gt.leadingComments[gt.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=gt.leadingComments,gt.leadingComments=[]),a&&(e.trailingComments=a),gt.bottomRightStack.push(e)}},markEnd:function(e,t){return gt.range&&(e.range=[t.start,st]),gt.loc&&(e.loc=new O(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),ut,st-lt),this.postProcess(e)),gt.attachComment&&this.processComment(e),e},postProcess:function(e){return gt.source&&(e.loc.source=gt.source),e},createArrayExpression:function(e){return{type:et.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,a){return{type:et.AssignmentExpression,operator:e,left:t,right:a}},createBinaryExpression:function(e,t,a){var r='||'===e||'&&'===e?et.LogicalExpression:et.BinaryExpression;return{type:r,operator:e,left:t,right:a}},createBlockStatement:function(e){return{type:et.BlockStatement,body:e}},createBreakStatement:function(e){return{type:et.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:et.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:et.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,a){return{type:et.ConditionalExpression,test:e,consequent:t,alternate:a}},createContinueStatement:function(e){return{type:et.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:et.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:et.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:et.EmptyStatement}},createExpressionStatement:function(e){return{type:et.ExpressionStatement,expression:e}},createForStatement:function(e,t,a,r){return{type:et.ForStatement,init:e,test:t,update:a,body:r}},createForInStatement:function(e,t,a){return{type:et.ForInStatement,left:e,right:t,body:a,each:!1}},createFunctionDeclaration:function(e,t,a,r){return{type:et.FunctionDeclaration,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,a,r){return{type:et.FunctionExpression,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:et.Identifier,name:e}},createIfStatement:function(e,t,a){return{type:et.IfStatement,test:e,consequent:t,alternate:a}},createLabeledStatement:function(e,t){return{type:et.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:et.Literal,value:e.value,raw:nt.slice(e.start,e.end)}},createMemberExpression:function(e,t,a){return{type:et.MemberExpression,computed:'['===e,object:t,property:a}},createNewExpression:function(e,t){return{type:et.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:et.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:et.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:et.Program,body:e}},createProperty:function(e,t,a){return{type:et.Property,key:t,value:a,kind:e}},createReturnStatement:function(e){return{type:et.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:et.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:et.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:et.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:et.ThisExpression}},createThrowStatement:function(e){return{type:et.ThrowStatement,argument:e}},createTryStatement:function(e,t,a,r){return{type:et.TryStatement,block:e,guardedHandlers:t,handlers:a,finalizer:r}},createUnaryExpression:function(e,t){return'++'===e||'--'===e?{type:et.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:et.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:et.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:et.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:et.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:et.WithStatement,object:e,body:t}}},e.version='1.2.5',e.tokenize=function(e,t){var a,r,o;a=String,'string'==typeof e||e instanceof String||(e=a(e)),dt=ot,nt=e,st=0,ut=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,ht={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},gt={},t=t||{},t.tokens=!0,gt.tokens=[],gt.tokenize=!0,gt.openParenToken=-1,gt.openCurlyToken=-1,gt.range='boolean'==typeof t.range&&t.range,gt.loc='boolean'==typeof t.loc&&t.loc,'boolean'==typeof t.comment&&t.comment&&(gt.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(gt.errors=[]);try{if(z(),ct.type===Ze.EOF)return gt.tokens;for(r=j();ct.type!==Ze.EOF;)try{r=j()}catch(e){if(r=ct,gt.errors){gt.errors.push(e);break}else throw e}Qe(),o=gt.tokens,'undefined'!=typeof gt.comments&&(o.comments=gt.comments),'undefined'!=typeof gt.errors&&(o.errors=gt.errors)}catch(t){throw t}finally{gt={}}return o},e.parse=function(e,t){var a,r;r=String,'string'==typeof e||e instanceof String||(e=r(e)),dt=ot,nt=e,st=0,ut=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,ht={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},gt={},'undefined'!=typeof t&&(gt.range='boolean'==typeof t.range&&t.range,gt.loc='boolean'==typeof t.loc&&t.loc,gt.attachComment='boolean'==typeof t.attachComment&&t.attachComment,gt.loc&&null!==t.source&&t.source!==void 0&&(gt.source=r(t.source)),'boolean'==typeof t.tokens&&t.tokens&&(gt.tokens=[]),'boolean'==typeof t.comment&&t.comment&&(gt.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(gt.errors=[]),gt.attachComment&&(gt.range=!0,gt.comments=[],gt.bottomRightStack=[],gt.trailingComments=[],gt.leadingComments=[]));try{a=Ke(),'undefined'!=typeof gt.comments&&(a.comments=gt.comments),'undefined'!=typeof gt.tokens&&(Qe(),a.tokens=gt.tokens),'undefined'!=typeof gt.errors&&(a.errors=gt.errors)}catch(t){throw t}finally{gt={}}return a},e.Syntax=function(){var e={},t;for(t in'function'==typeof Object.create&&(e=Object.create(null)),et)et.hasOwnProperty(t)&&(e[t]=et[t]);return'function'==typeof Object.freeze&&Object.freeze(e),e}()})}),Xh=0,$h=Rr,Kh=['args','body'],Qh=['pre','post','printCode','funcName','blockSize'],Zh=Ar,Yh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t={}){const{alpha:a=1}=t;r(e.tensor,a)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array','scalar'],body:function(e,t){e=Sn(e,0)+t*(_n(bn(e,0))-1)}})});ge(Yh);var Jh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array','scalar'],body:function(e){e=1.0507009873554805*(Sn(e,0)+1.6732632423543772*(_n(bn(e,0))-1))}})});ge(Jh);var eg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array'],body:function(e){e=mn(_n(e)+1)}})});ge(eg);var tg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array'],body:function(e){e/=1+Tn(e)}})});ge(tg);var ag=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t={}){const{alpha:a=0,maxValue:n=null}=t;let i;0!==a&&(i=new o.default([],e.tensor.shape),r.default.mins(i.tensor,e.tensor,0),r.default.mulseq(i.tensor,a)),r.default.maxseq(e.tensor,0),n&&r.default.minseq(e.tensor,n),i&&r.default.addeq(e.tensor,i.tensor)};var r=a(qh),o=a(Bh)});ge(ag);var rg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array'],body:function(e){e=Math.tanh(e)}})});ge(rg);var og=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array'],body:function(e){e=1/(1+_n(-e))}})});ge(og);var ng=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Zh);const r=(0,a.default)({args:['array'],body:function(e){e=0.2*e+0.5,0>=e?e=0:1<=e&&(e=1)}})});ge(ng);var ig=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){return e}});ge(ig);var sg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'softmax',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'elu',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'selu',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'softplus',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'softsign',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'relu',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'tanh',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'sigmoid',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'hard_sigmoid',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'linear',{enumerable:!0,get:function(){return c.default}});var r=a(Hh),o=a(Yh),n=a(Jh),i=a(eg),s=a(tg),u=a(ag),l=a(rg),p=a(og),d=a(ng),c=a(ig)});ge(sg);var ug=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh);class n extends r.default{constructor(e={}){super(e),this.layerClass='LeakyReLU';const{alpha:t=0.3}=e;this.description=`alpha: ${t}`,this.alpha=t,this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * min(v, 0.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,(0,sg.relu)(this.output,{alpha:this.alpha})}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=n});ge(ug);var lg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(Zh);class i extends r.default{constructor(e={}){super(e),Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','array'],body:function(e,t){e=Sn(e,0)+t*bn(e,0)}})}),this.layerClass='PReLU',this.params=['alpha'],this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  vec4 a = texture(alpha, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + a * min(v, 0.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.weights.alpha.tensor)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.alpha,name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});ge(lg);var pg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(Zh);class i extends r.default{constructor(e={}){super(e),s.call(this),this.layerClass='ELU';const{alpha:t=1}=e;this.description=`alpha: ${t}`,this.alpha=t,this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.alpha)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i;var s=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e=Sn(e,0)+t*(_n(bn(e,0))-1)}})})}});ge(pg);var dg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(Zh);class i extends r.default{constructor(e={}){super(e),s.call(this),this.layerClass='ThresholdedReLU';const{theta:t=1}=e;this.description=`theta: ${t}`,this.theta=t,this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float theta;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = v * float(greaterThan(v, vec4(theta)));\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.theta)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.theta,type:'float',name:'theta'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i;var s=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e*=+(e>t)}})})}});ge(dg);var cg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'LeakyReLU',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'PReLU',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'ELU',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'ThresholdedReLU',{enumerable:!0,get:function(){return i.default}});var r=a(ug),o=a(lg),n=a(pg),i=a(dg)});ge(cg);var hg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4(${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' + ')});
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(Ih)});ge(hg);var gg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4((${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' + ')}) / float(${e}));
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(Ih)});ge(gg);var fg=Lr,mg=jr,_g=zr,xg=Gr,yg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,s){const u=t.map((e)=>e[s]),l=(0,n.default)(e+1).map((e)=>(0,o.default)((0,r.default)(u,e))),p=0===s?'out_y':'out_x';let i=`
  int n = 0;
  int offset = 0;
  if (${p} >= ${l[1]} && ${p} < ${l[2]}) {
    n = 1;
    offset = ${l[1]};
  }`;2<e&&(i+=`${(0,n.default)(2,e).map((e)=>` else if (${p} >= ${l[e]} && ${p} < ${l[e+1]}) {
    n = ${e};
    offset = ${l[e]};
  }`).join('')}
`);let d='outColor = vec4(0.0);';if(0===s||1===s){const t=(e)=>`out_x${1===s?` - ${l[e]}`:''}`,a=(e)=>`out_y${0===s?` - ${l[e]}`:''}`;d=`
  if (n == 0) {
    outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r);
  }${(0,n.default)(1,e).map((e)=>` else if (n == ${e}) {
    outColor = vec4(texelFetch(inputs[${e}], ivec2(${t(e)}, ${a(e)}), 0).r);
  }`).join('')}
`}const c=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${a[0]}) * outTex.y);
  int out_x = int(float(${a[1]}) * outTex.x);
${i}
${d}
}
`;return c};var r=a(mg),o=a(xg),n=a(Ih)});ge(yg);var vg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;
  for (int i = 1; i < ${e}; i++) {
    val = max(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);
  }

  outColor = vec4(val);
}
`;return a}});ge(vg);var bg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;
  for (int i = 1; i < ${e}; i++) {
    val = min(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);
  }

  outColor = vec4(val);
}
`;return a}});ge(bg);var Sg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  outColor = vec4(${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' * ')});
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(Ih)});ge(Sg);var Tg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[2];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r - texelFetch(inputs[1], ivec2(out_x, out_y), 0).r);
}
`;return a}});ge(Tg);var Pg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){const n=r?`sum += texelFetch(bias, ivec2(out_x, 0), 0).r;`:'',i=o?`int fragmentIndex = int(floor(float(rowIndex) / float(${t[0]})));
      rowIndex = int(mod(float(rowIndex), float(${t[0]})));
      colIndex += fragmentIndex * ${t[1]};`:'',s=`#version 300 es
precision highp float;
precision highp isampler2D;

in vec2 outTex;
uniform sampler2D x;
uniform isampler2D indexMap;
uniform sampler2D kernel;
uniform sampler2D bias;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int i = 0; i < ${a[1]}; ++i) {
    int index = texelFetch(indexMap, ivec2(i, out_y), 0).r;    
    if (index != -1) {
      int rowIndex = int(floor(float(index) / float(${t[1]})));
      int colIndex = int(mod(float(index), float(${t[1]})));
      ${i}
      sum += texelFetch(x, ivec2(colIndex, rowIndex), 0).r * texelFetch(kernel, ivec2(out_x, i), 0).r;
    }
  }

  ${n}
  outColor = vec4(sum);
}   
`;return s}});ge(Pg);var wg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){const n=r?`sum += texelFetch(bias, ivec2(out_x, 0), 0).r;`:'',i=o?`int fragmentIndex = int(floor(float(rowIndex) / float(${t[0]})));
      rowIndex = int(mod(float(rowIndex), float(${t[0]})));
      colIndex += fragmentIndex * ${t[1]};`:'',s=`#version 300 es
precision highp float;
precision highp isampler2D;

in vec2 outTex;
uniform sampler2D matMulResult;
uniform isampler2D indexMap;
uniform sampler2D bias;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int n = 0; n < ${a[1]}; ++n) {
    int index = texelFetch(indexMap, ivec2(n, out_y), 0).r;
    if (index != -1) {
      int rowIndex = int(floor(float(index) / float(${t[1]})));
      int colIndex = int(mod(float(index), float(${t[1]})));
      ${i}
      sum += texelFetch(matMulResult, ivec2(colIndex + out_x, rowIndex), 0).r;
    }
  }

  ${n}
  outColor = vec4(sum);
}  
`;return s}});ge(wg);var Cg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a){let r;return r=a?`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D featureMaps;
uniform sampler2D weights;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  int featureMapsRow = out_x + ${e[0]} * out_y;

  float sum = 0.;
  for (int k = 0; k < ${t}; ++k) {
    float f = texelFetch(featureMaps, ivec2(k, featureMapsRow), 0).r;
    float w = texelFetch(weights, ivec2(k, 0), 0).r;
    sum += f * w;
  }

  outColor = vec4(max(sum, 0.0));
}  
`:`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D featureMaps;
uniform sampler2D weights;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int k = 0; k < ${t}; ++k) {
    float f = texelFetch(featureMaps, ivec2(k, out_y), 0).r;
    float w = texelFetch(weights, ivec2(out_x, k), 0).r;
    sum += f * w;
  }

  outColor = vec4(max(sum, 0.0));
}  
`,r}});ge(Cg);var kg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,...t){switch(e){case'add':return(0,r.default)(...t);case'average':return(0,o.default)(...t);case'concatenate':return(0,n.default)(...t);case'maximum':return(0,i.default)(...t);case'minimum':return(0,s.default)(...t);case'multiply':return(0,u.default)(...t);case'subtract':return(0,l.default)(...t);case'conv2d':return(0,p.default)(...t);case'conv2dTranspose':return(0,d.default)(...t);case'cam':return(0,c.default)(...t);default:throw new Error('GLSL program not found');}};var r=a(hg),o=a(gg),n=a(yg),i=a(vg),s=a(bg),u=a(Sg),l=a(Tg),p=a(Pg),d=a(wg),c=a(Cg)});ge(kg);var Fg=Xr,Mg=32,Dg=Zr,Ig={},Eg=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.linear=t.hard_sigmoid=t.sigmoid=t.tanh=t.relu=t.softsign=t.softplus=t.selu=t.elu=t.softmax=void 0;t.softmax='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float maxval = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    if (i == 0 || val > maxval) {\n      maxval = val;\n    }\n  }\n\n  float sum = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    sum += exp(val - maxval);\n  }\n\n  outColor = exp(texture(x, vec2(outTex.x, outTex.y)) - maxval) / sum;\n}\n';t.elu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.0;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n';t.selu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.6732632423543772848170429916717;\n  float scale = 1.0507009873554804934193349852946;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = scale * (max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0));\n}\n';t.softplus='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = log(1.0 + exp(texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.softsign='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v /= 1.0 + abs(v);\n  outColor = v;\n}\n';t.relu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0);\n}\n';t.tanh='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = tanh(v);\n}\n';t.sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = 1.0 / (1.0 + exp(-1.0 * texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.hard_sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v = v * 0.2 + 0.5;\n  v = max(v, 0.0);\n  v = min(v, 1.0);\n  outColor = v;\n}\n';t.linear='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, outTex.y));\n}\n'});ge(Eg);var Rg=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=r(kg),u=a(Uh),l=r(qh),p=r(Dg),d=a(Eg);class c extends o.default{constructor(e={}){super(e),this.layerClass='Conv2D';const{filters:t=1,kernel_size:a=[3,3],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',dilation_rate:s=[1,1],activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.dilationRate=Array.isArray(s)?s:[s,s],(1!==this.dilationRate[0]||1!==this.dilationRate[1])&&(1!==this.strides[0]||1!==this.strides[1])&&this.throwError(`Incompatible combination of dilation_rate with strides.`),this.activation=u,this.activationFunc=i[u],this.useBias=l,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=this.dilationRate.some((e)=>1<e)?`, ${this.dilationRate.join('x')} dilation`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.mapInputFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(d[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const t=e[0],a=e[1],[r,o,n]=this.kernelShape,i=o+(o-1)*(this.dilationRate[0]-1),s=n+(n-1)*(this.dilationRate[1]-1),u='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-i+this.strides[0])/this.strides[0]),l='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-s+this.strides[1])/this.strides[1]),p='same'===this.padding?Sn(0,fn((u-1)*this.strides[0]+i-t)):0,d='same'===this.padding?Sn(0,fn((l-1)*this.strides[1]+s-a)):0,c=fn(p/2),h=fn(d/2);this.outputShape=[u,l,r],this.inputPadding=[c,p-c,h,d-h]}}_padInput(e,t=0){if('same'===this.padding){const[a,r,o]=e.tensor.shape,[i,s,u,p]=this.inputPadding,d=new n.default([],[a+i+s,r+u+p,o]);return 0!==t&&l.default.assigns(d.tensor,t),l.default.assign(d.tensor.hi(a+i,r+u,o).lo(i,u,0),e.tensor),d}return e}_im2col(e){const[t,a,r]=e.tensor.shape,o=this.kernelShape[1],i=this.kernelShape[2],s=this.outputShape[0],u=this.outputShape[1],p=o*i*r,d=o+(o-1)*(this.dilationRate[0]-1),c=i+(i-1)*(this.dilationRate[1]-1);if(this.imColsMat||(this.imColsMat=new n.default([],[s*u,p])),1===d&&1===c&&1===this.strides[0]&&1===this.strides[1])return this.imColsMat.replaceTensorData(e.tensor.data),this.imColsMat;const h=new n.default([],[o,i,r]);let g=0;for(let o=0;o<=t-d;o+=this.strides[0])for(let t=0;t<=a-c;t+=this.strides[1])l.default.assign(h.tensor,e.tensor.hi(o+d,t+c,r).lo(o,t,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.imColsMat.tensor.data.set(h.tensor.data,g),g+=p;return this.imColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[2],[t,a,r]=this.kernelShape,o=a*r*e;this.wRowsMat=new n.default([],[o,t]);const i=new n.default([],[a,r,e]),s=new n.default([],[o]);for(let e=0;e<t;e++)l.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,null,e)),s.replaceTensorData(i.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,e),s.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=new n.default([],[a*r,t]);if(this.useBias)for(let e=0;e<t;e++)l.default.assigns(o.tensor.pick(null,e),this.weights.bias.tensor.get(e));(0,p.default)(o.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);let i=new n.default([],[a*r]),s=new n.default([],[a,r]);for(let a=0;a<t;a++)l.default.assign(i.tensor,o.tensor.pick(null,a)),s.replaceTensorData(i.tensor.data),l.default.assign(this.output.tensor.pick(null,null,a),s.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e){if(this.indexMap)return;let[t,a,r]=this.inputShape,o=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,r,n,i]=this.inputPadding;t=t+e+r,a=a+n+i;o=this._padInput(o,-1)}const i=this.kernelShape[1],s=this.kernelShape[2],u=this.outputShape[0],p=this.outputShape[1],d=i*s*r,c=i+(i-1)*(this.dilationRate[0]-1),h=s+(s-1)*(this.dilationRate[1]-1);this.indexMap=new n.default([],[u*p,d],{type:Int32Array});const g=new n.default([],[i,s,r]);let f=0;for(let n=0,i=t-c;n<=i;n+=this.strides[0])for(let e=0,t=a-h;e<=t;e+=this.strides[1])l.default.assign(g.tensor,o.tensor.hi(n+c,e+h,r).lo(n,e,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.indexMap.tensor.data.set(g.tensor.data,f),f+=d;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){let t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.imColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){const t=!!e.glTextureFragments;if(t&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){const a=(0,s.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,t);this.convProgram=Ph.webgl2.compileProgram(a)}Ph.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),t&&e.removeGLTextureFragmentsAsColStack()}else{const e=[{input:this.imColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&e.push({input:this.weights.bias,name:'C'}),Ph.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:e,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&Ph.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=c});ge(Rg);var Ag=Yr,Lg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(Rg),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Uh),s=a(qh),u=a(Nh),l=a(Ag);class p extends r.default{constructor(e={}){super(e),this.layerClass='Conv1D';const{filters:t=1,kernel_size:a=1,strides:r=1,padding:o='valid',dilation_rate:i=1,activation:s='linear',use_bias:u=!0}=e;this.description=`${t} filters of size ${a}, striding ${r}`,this.description+='valid'===o?`, no border padding`:', pad to same borders',this.description+=1<i?`, dilation rate ${i}`:'',this.description+='linear'===s?'':`, ${s} activation`,'valid'!==o&&'same'!==o&&this.throwError('Invalid padding.'),1!==i&&1!==r&&this.throwError('Incompatible combination of dilation_rate with strides.'),this.use_bias=u,this.params=this.use_bias?['kernel','bias']:['kernel'];const l={filters:t,kernel_size:[a,1],strides:[r,1],padding:o,data_format:'channels_first',dilation_rate:i,activation:s,use_bias:u};this._conv2dAttrs=l,this._conv2d=new n.default(Object.assign(l,{gpu:e.gpu}))}setWeights(e){e[0].tensor=(0,l.default)(e[0].tensor).transpose(2,1,0,3),this._conv2d.setWeights(e)}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=new o.default(e.tensor.data,e.tensor.shape);t.tensor=(0,l.default)(t.tensor).transpose(0,2,1);const a=this._conv2d.call(t);this.outputShape=[0,2].map((e)=>this._conv2d.outputShape[e]),this.output=new o.default([],this.outputShape),s.default.assign(this.output.tensor,(0,u.default)(a.tensor).transpose(1,0,2))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=e.tensor.shape,a=new o.default([],t);Object.assign(a,e),a.glTextureShape=t,a.is2DReshaped=!0,a.originalShape=[t[0],1,t[1]],a.indicesForReshaped=i.createIndicesFor2DReshaped(a.originalShape,!1,-1),this.output=this._conv2d.call(a),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});ge(Lg);var jg=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=a(Uh),u=r(qh),l=r(Dg),p=r(Rg),d=a(Eg);class c extends p.default{constructor(e={}){super(e)}_calcOutputShape(e){super._calcOutputShape(e);const t=this.kernelShape[0],a=e[2];this.outputShape[2]=t*a}_im2col(e){const[t,a,r]=e.tensor.shape,o=this.kernelShape[1],s=this.kernelShape[2],i=this.outputShape[0],l=this.outputShape[1],p=o*s;this.imColsMat||(this.imColsMat=new n.default([],[i*l*r,p]));let d=new n.default([],[o,s,1]),h=0;for(let n=0;n<r;n++)for(let r=0;r<=t-o;r+=this.strides[0])for(let t=0;t<=a-s;t+=this.strides[1])u.default.assign(d.tensor,e.tensor.hi(r+o,t+s,n+1).lo(r,t,n)),this.imColsMat.tensor.data.set(d.tensor.data,h),h+=p;return this.imColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[2],[t,a,r]=this.kernelShape,o=a*r;this.wRowsMat=new n.default([],[o,t*e]);let i=new n.default([],[a,r]),s=new n.default([],[o]),l=0;for(let a=0;a<e;a++)for(let e=0;e<t;e++)u.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,a,e)),s.replaceTensorData(i.tensor.data),u.default.assign(this.wRowsMat.tensor.pick(null,l),s.tensor),l+=1;return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.inputShape[2],i=new n.default([],[a*r*o,t*o]);(0,l.default)(i.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);const s=a*r*t*o;let u=new Float32Array(s);for(let a=0;a<o;a++)for(let e=a*s+a*t;e<(a+1)*s;e+=t*o)for(let r=0;r<t;r++)u[e+r-a*s]=i.tensor.data[e+r];this.output.replaceTensorData(u)}_createIndexMap(e){if(this.indexMap)return;let[t,a,r]=this.inputShape,o=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,r,n,i]=this.inputPadding;t=t+e+r,a=a+n+i;o=this._padInput(o,-1)}const s=this.kernelShape[1],l=this.kernelShape[2],i=this.outputShape[0],p=this.outputShape[1],d=s*l;this.indexMap=new n.default([],[i*p*r,d],{type:Int32Array});const h=new n.default([],[s,l,1]);let g=0;for(let n=0;n<r;n++)for(let e=0,r=t-s;e<=r;e+=this.strides[0])for(let t=0,r=a-l;t<=r;t+=this.strides[1])u.default.assign(h.tensor,o.tensor.hi(e+s,t+l,n+1).lo(e,t,n)),this.indexMap.tensor.data.set(h.tensor.data,g),g+=d;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_createOutputReshapeIndexMap(){if(!this.reshapeIndexMap){const e=this.kernelShape[0],t=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]],a=new n.default([],t,{type:Int32Array}),r=new n.default([],t,{type:Int32Array});this.reshapeIndexMap=new n.default([],t,{type:Int32Array});for(let r=0;r<t[1];r++)for(let o=0;o<t[0];o++)u.default.assigns(a.tensor.pick(o,r),o+fn(r/e)*t[0]);for(let e=0;e<t[1];e++)u.default.assigns(r.tensor.pick(null,e),e);u.default.muls(this.reshapeIndexMap.tensor,a.tensor,t[1]),u.default.addeq(this.reshapeIndexMap.tensor,r.tensor),this.reshapeIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){if(super._callGPU(e),this._createOutputReshapeIndexMap(),!this.outputReshaped){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputReshaped=new n.default([],e),this.outputReshaped.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputReshaped.is2DReshaped=!0,this.outputReshaped.originalShape=this.outputShape,this.outputReshaped.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)}this.output.glTextureFragments&&this.output.convert2DRowFragmentedGLTextureToColStack(),Ph.webgl2.runProgram({program:this.output.glTextureFragments?this.mapInputFragmentsProgram:this.mapInputProgram,output:this.outputReshaped,inputs:[{input:this.output,name:'x'},{input:this.reshapeIndexMap,name:'indexMap'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),this.output.glTextureFragments&&this.output.removeGLTextureFragmentsAsColStack()}}class h extends o.default{constructor(e={}){super(e),this.layerClass='SeparableConv2D';const{filters:t=1,kernel_size:a=[1,1],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',depth_multiplier:s=1,activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.activation=u,this.activationFunc=i[u],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),this.useBias=l,this.params=this.useBias?['depthwise_kernel','pointwise_kernel','bias']:['depthwise_kernel','pointwise_kernel'],this.depthwiseConvAttrs={filters:s,kernel_size:[this.kernelShape[1],this.kernelShape[2]],strides:this.strides,padding:o,data_format:n,activation:'linear',use_bias:!1,gpu:e.gpu},this.pointwiseConvAttrs={filters:t,kernel_size:[1,1],strides:[1,1],padding:o,data_format:n,activation:'linear',use_bias:l,gpu:e.gpu},this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=1<s?`, depth multiplier: ${s}`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.activationProgram=Ph.webgl2.compileProgram(d[this.activation]))}setWeights(e){this._depthwiseConv=new c(this.depthwiseConvAttrs),this._depthwiseConv.setWeights(e.slice(0,1)),this._pointwiseConv=new p.default(this.pointwiseConvAttrs),this._pointwiseConv.setWeights(e.slice(1,3))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this._depthwiseConv._callCPU(e),this._pointwiseConv._callCPU(this._depthwiseConv.output),this.output=this._pointwiseConv.output,this.activationFunc(this.output)}_callGPU(e){this._depthwiseConv.outbound=[null],this._pointwiseConv.outbound=[null],this._depthwiseConv._callGPU(e),this._pointwiseConv._callGPU(this._depthwiseConv.outputReshaped),'linear'===this.activation?this.output=this._pointwiseConv.output:(!this.output&&(this.output=new n.default([],this._pointwiseConv.output.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this._pointwiseConv.output.originalShape,this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this._pointwiseConv.output.originalShape,!1,-1)),this.outputPreactiv=this._pointwiseConv.output,Ph.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0})),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=h});ge(jg);var zg=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=r(kg),u=a(Uh),l=r(Zh),p=r(qh),d=r(Dg),c=a(Eg);const h=(0,l.default)({args:[{blockIndices:-1},'scalar','scalar'],body:function(e,t,a){for(let r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}}),g=(0,l.default)({args:[{blockIndices:-1},'array','scalar'],body:function(e,t,a){for(let r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}});class f extends o.default{constructor(e={}){super(e),this.layerClass='Conv2DTranspose';const{filters:t=1,kernel_size:a=[3,3],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',activation:s='linear',use_bias:u=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.activation=s,this.activationFunc=i[s],this.useBias=u,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(c[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.outputPadding)){const t=e[0],a=e[1],[r,o,n]=this.kernelShape,i='same'===this.padding?t*this.strides[0]:t*this.strides[0]+Sn(o-this.strides[0],0),s='same'===this.padding?a*this.strides[1]:a*this.strides[1]+Sn(n-this.strides[1],0),u='same'===this.padding?Sn(0,fn((t-1)*this.strides[0]+o-i)):0,l='same'===this.padding?Sn(0,fn((a-1)*this.strides[1]+n-s)):0,p=fn(u/2),d=fn(l/2);this.outputShape=[i,s,r],this.outputPadding=[p,u-p,d,l-d]}}_im2col(e){const[t,a,r]=e.tensor.shape;this.imColsMat||(this.imColsMat=new n.default([],[t*a,r]));const o=new n.default([],[t*a]),i=new n.default([],[t,a]);for(let t=0;t<r;t++)p.default.assign(i.tensor,e.tensor.pick(null,null,t)),o.replaceTensorData(i.tensor.data),p.default.assign(this.imColsMat.tensor.pick(null,t),o.tensor);return this.imColsMat}_w2row(){const[e,t,a,r]=this.weights.kernel.tensor.shape;this.wRowsMat=new n.default([],[r,e*t*a]);const o=new n.default([],[e*t*a]),i=new n.default([],[e,t,a]);for(let e=0;e<r;e++)p.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,null,e)),o.replaceTensorData(i.tensor.data),p.default.assign(this.wRowsMat.tensor.pick(e,null),o.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e);const t=e.tensor.shape[0],a=e.tensor.shape[1],[r,o,s]=this.kernelShape,u=new n.default([],[t*a,o*s*r]);(0,d.default)(u.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1);const[i,l,c,h]=this.outputPadding;this.output=new n.default([],this.outputShape);let g=new n.default([],[this.outputShape[0]+i+l,this.outputShape[1]+c+h,this.outputShape[2]]);let f=new n.default([],[o,s,r]),m=new n.default([],[o*s*r]),_=0;for(let r=0;r<t;r++)for(let e=0;e<a;e++){p.default.assign(m.tensor,u.tensor.pick(_,null)),f.replaceTensorData(m.tensor.data);const t=r*this.strides[0],a=e*this.strides[1];p.default.addeq(g.tensor.hi(t+o,a+s,this.outputShape[2]).lo(t,a,0),f.tensor),_+=1}if(p.default.assign(this.output.tensor,g.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+c,this.outputShape[2]).lo(i,c,0)),this.useBias)for(let e=0;e<r;e++)p.default.addseq(this.output.tensor.pick(null,null,e),this.weights.bias.tensor.get(e));this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(){if(!this.indexMap){const e=this.inputShape[0],t=this.inputShape[1],[a,r,o]=this.kernelShape,[i,s,u,l]=this.outputPadding,d=(r-this.strides[0]+1)*(o-this.strides[1]+1),c=[this.outputShape[0],this.outputShape[1],d],f=[this.outputShape[0]+i+s,this.outputShape[1]+u+l,d],m=new n.default([],c,{type:Int32Array}),_=new n.default([],c,{type:Int32Array}),x=new n.default([],f,{type:Int32Array}),y=new n.default([],f,{type:Int32Array});p.default.assigns(m.tensor,-1),p.default.assigns(_.tensor,-1),p.default.assigns(x.tensor,-1),p.default.assigns(y.tensor,-1);const v=new n.default([],[r,o,a],{type:Int32Array});for(let e=0;e<r*o*a;e++)v.tensor.data[e]=e;for(let a=0;a<e;a++)for(let e=0;e<t;e++){const n=a*t+e,i=a*this.strides[0],s=e*this.strides[1];h(x.tensor.hi(i+r,s+o,d).lo(i,s,0),n,d),g(y.tensor.hi(i+r,s+o,d).lo(i,s,0),v.tensor.pick(null,null,0),d)}p.default.assign(m.tensor,x.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+u,d).lo(i,u,0)),p.default.assign(_.tensor,y.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+u,d).lo(i,u,0));const b=[this.outputShape[0]*this.outputShape[1],d];this.indexMap=new n.default([],b,{type:Int32Array});const S=new n.default([],[d],{type:Int32Array});for(let e=0;e<this.outputShape[0];e++)for(let t=0;t<this.outputShape[1];t++){for(let a=0;a<d;a++){const r=m.tensor.get(e,t,a),o=_.tensor.get(e,t,a);-1!==r&&-1!==o?S.tensor.set(a,r*this.weights.kernel.glTextureShape[1]+o):S.tensor.set(a,-1)}p.default.assign(this.indexMap.tensor.pick(e*this.outputShape[1]+t,null),S.tensor)}this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape)):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.imColsMat;if(!this.matMulResult){const e=[t.glTextureShape[0],this.weights.kernel.glTextureShape[1]];this.matMulResult=new n.default([],e),this.matMulResult.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}if('linear'!==this.activation&&!this.outputPreactiv){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputPreactiv=new n.default([],e),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)}if(!this.output){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.output=new n.default([],e),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)}Ph.webgl2.runProgram({program:this.matMulProgram,output:this.matMulResult,inputs:[{input:t,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}],supportsTextureFragments:!0}),this._createIndexMap();const a=!!this.matMulResult.glTextureFragments;if(a&&this.matMulResult.convert2DRowFragmentedGLTextureToColStack(),!this.convTransposeProgram){const e=(0,s.default)('conv2dTranspose',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,this.matMulResult.glTextureFragmentShape?this.matMulResult.glTextureFragmentShape:this.matMulResult.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,a);this.convTransposeProgram=Ph.webgl2.compileProgram(e)}Ph.webgl2.runProgram({program:this.convTransposeProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:this.matMulResult,name:'matMulResult'},{input:this.indexMap,name:'indexMap'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),a&&this.matMulResult.removeGLTextureFragmentsAsColStack(),'linear'!==this.activation&&Ph.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=f});ge(zg);var Gg=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=r(kg),u=a(Uh),l=r(qh),p=r(Dg),d=a(Eg);class c extends o.default{constructor(e={}){super(e),this.layerClass='Conv3D';const{filters:t=1,kernel_size:a=[1,1,1],strides:r=[1,1,1],padding:o='valid',data_format:n='channels_last',dilation_rate:s=[1,1,1],activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a,a],this.strides=Array.isArray(r)?r:[r,r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.dilationRate=Array.isArray(s)?s:[s,s,s],(1!==this.dilationRate[0]||1!==this.dilationRate[1]||1!==this.dilationRate[2])&&(1!==this.strides[0]||1!==this.strides[1]||1!==this.strides[2])&&this.throwError('Incompatible combination of dilation_rate with strides.'),this.activation=u,this.activationFunc=i[u],this.useBias=l,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=this.dilationRate.some((e)=>1<e)?`, ${this.dilationRate.join('x')} dilation`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.mapInputFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(d[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,4,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const t=e[0],a=e[1],r=e[2],[o,n,i,s]=this.kernelShape,u=n+(n-1)*(this.dilationRate[0]-1),l=i+(i-1)*(this.dilationRate[1]-1),p=s+(s-1)*(this.dilationRate[2]-1),d='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-u+this.strides[0])/this.strides[0]),c='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-l+this.strides[1])/this.strides[1]),h='same'===this.padding?fn((r+this.strides[2]-1)/this.strides[2]):fn((r-p+this.strides[2])/this.strides[2]),g='same'===this.padding?Sn(0,fn((d-1)*this.strides[0]+u-t)):0,f='same'===this.padding?Sn(0,fn((c-1)*this.strides[1]+l-a)):0,m='same'===this.padding?Sn(0,fn((h-1)*this.strides[2]+p-r)):0,_=fn(g/2),x=fn(f/2),y=fn(m/2);this.outputShape=[d,c,h,o],this.inputPadding=[_,g-_,x,f-x,y,m-y]}}_padInput(e,t=0){if('same'===this.padding){const[a,r,o,i]=e.tensor.shape,[s,u,p,d,c,h]=this.inputPadding,g=new n.default([],[a+s+u,r+p+d,o+c+h,i]);return 0!==t&&l.default.assigns(g.tensor,t),l.default.assign(g.tensor.hi(a+s,r+p,o+c,i).lo(s,p,c,0),e.tensor),g}return e}_vol2col(e){const[t,a,r,o]=e.tensor.shape,i=this.kernelShape[1],s=this.kernelShape[2],u=this.kernelShape[3],p=this.outputShape[0],d=this.outputShape[1],c=this.outputShape[2],h=i*s*u*o,g=i+(i-1)*(this.dilationRate[0]-1),f=s+(s-1)*(this.dilationRate[1]-1),m=u+(u-1)*(this.dilationRate[2]-1);if(this.volColsMat||(this.volColsMat=new n.default([],[p*d*c,h])),1===g&&1===f&&1===m&&1===this.strides[0]&&1===this.strides[1]&&1===this.strides[2])return this.volColsMat.replaceTensorData(e.tensor.data),this.volColsMat;const _=new n.default([],[i,s,u,o]);let x=0;for(let n=0;n<=t-g;n+=this.strides[0])for(let t=0;t<=a-f;t+=this.strides[1])for(let a=0;a<=r-m;a+=this.strides[2])l.default.assign(_.tensor,e.tensor.hi(n+g,t+f,a+m,o).lo(n,t,a,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.volColsMat.tensor.data.set(_.tensor.data,x),x+=h;return this.volColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[3],[t,a,r,o]=this.kernelShape,i=a*r*o*e;this.wRowsMat=new n.default([],[i,t]);const s=new n.default([],[a,r,o,e]),u=new n.default([],[i]);for(let e=0;e<t;e++)l.default.assign(s.tensor,this.weights.kernel.tensor.pick(null,null,null,null,e)),u.replaceTensorData(s.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,e),u.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.outputShape[2],i=new n.default([],[a*r*o,t]);if(this.useBias)for(let e=0;e<t;e++)l.default.assigns(i.tensor.pick(null,e),this.weights.bias.tensor.get(e));(0,p.default)(i.tensor,this.volColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);let s=new n.default([],[a*r*o]),u=new n.default([],[a,r,o]);for(let a=0;a<t;a++)l.default.assign(s.tensor,i.tensor.pick(null,a)),u.replaceTensorData(s.tensor.data),l.default.assign(this.output.tensor.pick(null,null,null,a),u.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e){if(this.indexMap)return;let[t,a,r,o]=this.inputShape,s=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,o,n,i,u,l]=this.inputPadding;t=t+e+o,a=a+n+i,r=r+u+l;s=this._padInput(s,-1)}const i=this.kernelShape[1],u=this.kernelShape[2],p=this.kernelShape[3],d=this.outputShape[0],c=this.outputShape[1],h=this.outputShape[2],g=i*u*p*o,f=i+(i-1)*(this.dilationRate[0]-1),m=u+(u-1)*(this.dilationRate[1]-1),_=p+(p-1)*(this.dilationRate[2]-1);this.indexMap=new n.default([],[d*c*h,g],{type:Int32Array});const x=new n.default([],[i,u,p,o]);let y=0;for(let n=0,i=t-f;n<=i;n+=this.strides[0])for(let e=0,t=a-m;e<=t;e+=this.strides[1])for(let t=0,a=r-_;t<=a;t+=this.strides[2])l.default.assign(x.tensor,s.tensor.hi(n+f,e+m,t+_,o).lo(n,e,t,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.indexMap.tensor.data.set(x.tensor.data,y),y+=g;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){let t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e),this.volColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.volColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){const t=!!e.glTextureFragments;if(t&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){const a=(0,s.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,t);this.convProgram=Ph.webgl2.compileProgram(a)}Ph.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),t&&e.removeGLTextureFragmentsAsColStack()}else{const e=[{input:this.volColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&e.push({input:this.weights.bias,name:'C'}),Ph.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:e,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&Ph.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}t.default=c});ge(Gg);var Og=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping1D';const{cropping:t=[0,0]}=e;this.cropping=Array.isArray(t)?t:[t,t],this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[1],this.inputShape[2]).lo(this.cropping[0],0))}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r=[this.cropping[0],0],i=[this.inputShape[0]-this.cropping[1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,e.tensor.hi(...i).lo(...r)),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Og);var qg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping2D';const{cropping:t=[[0,0],[0,0]],data_format:a='channels_last'}=e;this.cropping=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]]]:[[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]).lo(this.cropping[0][0],this.cropping[1][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0]]:[this.cropping[0][0],this.cropping[1][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,a.tensor.hi(...i).lo(...r)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(qg);var Ug=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping3D';const{cropping:t=[[0,0],[0,0],[0,0]],data_format:a='channels_last'}=e;this.cropping=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]],[t[2],t[2]]]:[[t,t],[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]).lo(this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0],this.cropping[2][0]]:[this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]];n.default.assign(this.indexMap.tensor,a.tensor.hi(...i).lo(...r)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][0]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(Ug);var Ng=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling1D';const{size:t=2}=e;this.size=t,this.description=`size ${t}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size;t++)n.default.assign(this.output.tensor.lo(t,0).step(this.size,1),e.tensor)}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let t=0;t<this.size;t++)n.default.assign(this.indexMap.tensor.lo(t,0).step(this.size,1),e.tensor);this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Ng);var Bg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling2D';const{size:t=[2,2],data_format:a='channels_last'}=e;this.size=Array.isArray(t)?t:[t,t],this.dataFormat=a,this.description=`size ${this.size.join('x')}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size[0];t++)for(let a=0;a<this.size[1];a++)n.default.assign(this.output.tensor.lo(t,a,0).step(this.size[0],this.size[1],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let e=0;e<this.size[0];e++)for(let t=0;t<this.size[1];t++){const r='channels_first'===this.dataFormat?[0,e,t]:[e,t,0],o='channels_first'===this.dataFormat?[1,this.size[0],this.size[1]]:[this.size[0],this.size[1],1];n.default.assign(this.indexMap.tensor.lo(...r).step(...o),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(Bg);var Vg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling3D';const{size:t=[2,2,2],data_format:a='channels_last'}=e;this.size=Array.isArray(t)?t:[t,t,t],this.dataFormat=a,this.description=`size ${this.size.join('x')}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size[0];t++)for(let a=0;a<this.size[1];a++)for(let r=0;r<this.size[2];r++)n.default.assign(this.output.tensor.lo(t,a,r,0).step(this.size[0],this.size[1],this.size[2],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let e=0;e<this.size[0];e++)for(let t=0;t<this.size[1];t++)for(let r=0;r<this.size[2];r++){const o='channels_first'===this.dataFormat?[0,e,t,r]:[e,t,r,0],i='channels_first'===this.dataFormat?[1,this.size[0],this.size[1],this.size[2]]:[this.size[0],this.size[1],this.size[2],1];n.default.assign(this.indexMap.tensor.lo(...o).step(...i),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1],this.inputShape[3]*this.size[2]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(Vg);var Hg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding1D';const{padding:t=[1,1]}=e;this.padding=Array.isArray(t)?t:[t,t],this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0],this.inputShape[1]).lo(this.padding[0],0),e.tensor)}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r=[this.padding[0],0],i=[this.inputShape[0]+this.padding[0],this.inputShape[1]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),e.tensor),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Hg);var Wg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding2D';const{padding:t=[[1,1],[1,1]],data_format:a='channels_last'}=e;this.padding=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]]]:[[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]).lo(this.padding[0][0],this.padding[1][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0]]:[this.padding[0][0],this.padding[1][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),a.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(Wg);var Xg=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding3D';const{padding:t=[[1,1],[1,1],[1,1]],data_format:a='channels_last'}=e;this.padding=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]],[t[2],t[2]]]:[[t,t],[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]).lo(this.padding[0][0],this.padding[1][0],this.padding[2][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0],this.padding[2][0]]:[this.padding[0][0],this.padding[1][0],this.padding[2][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0],this.inputShape[3]+this.padding[2][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),a.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1],this.inputShape[3]+this.padding[2][0]+this.padding[2][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});ge(Xg);var $g=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Conv1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Conv2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'SeparableConv2D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Conv2DTranspose',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Conv3D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Cropping1D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Cropping2D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Cropping3D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'UpSampling1D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'UpSampling2D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'UpSampling3D',{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,'ZeroPadding1D',{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,'ZeroPadding2D',{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,'ZeroPadding3D',{enumerable:!0,get:function(){return m.default}});var r=a(Lg),o=a(Rg),n=a(jg),i=a(zg),s=a(Gg),u=a(Og),l=a(qg),p=a(Ug),d=a(Ng),c=a(Bg),h=a(Vg),g=a(Hg),f=a(Wg),m=a(Xg)});ge($g);var Kg=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],s=e.offset,u=t.offset,l,i;for(l=e.shape[0]-1;0<=l;l--,s+=o,u+=n)i=a[s],a[s]=r[u],r[u]=i},Qg=function(e,t){var a=t.data,r=t.stride[0],o=t.offset,n;for(n=t.shape[0]-1;0<=n;n--,o+=r)a[o]*=e},Zg=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],s=e.offset,u=t.offset,l;for(l=e.shape[0]-1;0<=l;l--,s+=o,u+=n)r[u]=a[s]},Yg=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],s=a.stride[0],u=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,u+=n,l+=s)o[l]+=e*r[u]},Jg=function(e,t){var a=e.data,r=e.stride[0],o=e.offset,n=0,s,i;if(e===t)for(s=e.shape[0]-1;0<=s;s--,o+=r)i=a[o],n+=i*i;else{var u=t.data,l=t.stride[0],p=t.offset;for(s=e.shape[0]-1;0<=s;s--,o+=r,p+=l)n+=u[p]*a[o]}return n},ef=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],s=a.stride[0],u=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,u+=n,l+=s)o[l]=e*r[u]},tf=function(e,a){if(0===e&&0===a)return 0;var r=Tn(e),o=Tn(a),n=bn(r,o),t=Sn(r,o);return n/=t,t*Pn(1+n*n)},af=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n,i;for(n=e.shape[0]-1;0<=n;n--,r+=a)i=t[r],o=tf(o,i);return o},rf=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n;for(n=e.shape[0]-1;0<=n;n--,r+=a)o+=Tn(t[r]);return o},of=function(e){var t=-Infinity,a=e.data,r=e.stride[0],o=e.offset,n=e.shape[0],s,i,u;for(s=0;s<n;s++,o+=r)i=Tn(a[o]),i>t&&(t=i,u=s);return u};gn=gn||function(e){return e=+e,0===e||isNaN(e)?e:0<e?1:-1};var nf=function(e,a,o){var n=0,i=0,s=0,r=0,t=0;return 0===a?(n=gn(e),i=0,s=Tn(e)):0===e?(n=0,i=gn(a),s=Tn(a)):Tn(e)>Tn(a)?(r=a/e,t=gn(e)*Pn(1+r*r),n=1/t,i=r*n,s=e*t):(r=e/a,t=gn(e)*Pn(1+r*r),i=1/t,n=r*i,s=a*t),void 0!==o&&2<o.length?void(o[0]=n,o[1]=i,o[2]=s):[n,i,s]},sf=Kg,uf=Qg,lf=Zg,pf=Yg,df=Jg,cf=ef,hf=af,gf=rf,ff=of,mf=nf,_f={swap:sf,scal:uf,copy:lf,axpy:pf,dot:df,cpsc:cf,nrm2:hf,asum:gf,iamax:ff,rotg:mf},xf=Jr,yf=eo,vf=to,bf=ao,Sf=fe(function(e){e.exporst=function(){console.error('SPMV (symmetric packed matrix vector multiply) not yet implemented')}}),Tf=ro,Pf=oo,wf=no,Cf=fe(function(e){e.exporst=function(){console.error('TBSV (triangular banded matrix solver) not yet implemented')}}),kf=io,Ff=so,Mf=uo,Df=lo,If=po,Ef=co,Rf=fe(function(e){e.exports.gemv=xf,e.exports.gbmv=yf,e.exports.symv=vf,e.exports.sbmv=bf,e.exports.spmv=Sf,e.exports.trmv=Tf,e.exports.tbmv=Pf,e.exports.trsv=wf,e.exports.tbsv=Cf,e.exports.tpsv=kf,e.exports.ger=Ff,e.exports.syr=Mf,e.exports.spr=Df,e.exports.syr2=If,e.exports.spr2=Ef,e.exports.trmv_lower=function(t,a){return console.warn('trmv_lower is deprecated. Please use the \'isLower\' flag with trmv.'),e.exports.trmv(t,a,!0)},e.exports.trsv_lower=function(t,a){return console.warn('trsv_lower is deprecated. Please use the \'isLower\' flag with trsv.'),e.exports.trsv(t,a,!0)}}),Af=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=r(qh),u=a(Eg);class l extends o.default{constructor(e={}){super(e),this.layerClass='Dense';const{units:t=1,activation:a='linear',input_dim:r=null,use_bias:o=!0}=e;this.description=`${a} activation, output dimensions: ${t}`,this.activation=a,this.activationFunc=i[this.activation],this.units=t,this.input_dim=r,this.use_bias=o,this.params=this.use_bias?['kernel','bias']:['kernel'],this.input_dim&&(this.inputShape=[this.input_dim]),this.gpu&&(this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(u[this.activation]))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=new n.default([],[this.units]),this.use_bias&&s.default.assign(this.output.tensor,this.weights.bias.tensor),(0,Rf.gemv)(1,this.weights.kernel.tensor.transpose(1,0),e.tensor,1,this.output.tensor),this.activationFunc(this.output)}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],[this.units]),this.outputPreactiv.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new n.default([],[this.units]),this.output.createGLTexture({type:'2d',format:'float'}));const t=[{input:e,name:'A'},{input:this.weights.kernel,name:'B'}];this.use_bias&&t.push({input:this.weights.bias,name:'C'}),Ph.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:t,uniforms:[{value:this.use_bias?1:0,type:'bool',name:'addC'}]}),'linear'!==this.activation&&Ph.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=l});ge(Af);var Lf=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wh),n=r(Bh),i=a(sg),s=a(Eg);class u extends o.default{constructor(e={}){super(e),this.layerClass='Activation';const{activation:t='linear'}=e;this.activation=t,this.activationFunc=i[t],this.description=`${this.activation}`,this.gpu&&(this.program=Ph.webgl2.compileProgram(s[this.activation]))}call(e){return'linear'===this.activation?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}_callCPU(e){this.output=new n.default(new e.arrayType(e.tensor.data),e.tensor.shape),this.activationFunc(this.output)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new n.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=u});ge(Lf);var jf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='Dropout';const{rate:t=0.5}=e;this.description=`${t}`,this.rate=bn(Sn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});ge(jf);var zf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout1D';const{p:t=0.5}=e;this.description=`${t}`,this.p=bn(Sn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});ge(zf);var Gf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout2D';const{rate:t=0.5,data_format:a='channels_last'}=e;this.description=`${t}`,this.rate=bn(Sn(0,t),1),this.dataFormat=a}call(e){return this.output=e,this.output}}t.default=r});ge(Gf);var Of=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout3D';const{rate:t=0.5,data_format:a='channels_last'}=e;this.description=`${t}`,this.rate=bn(Sn(0,t),1),this.dataFormat=a}call(e){return this.output=e,this.output}}t.default=r});ge(Of);var qf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh);class n extends r.default{constructor(e={}){super(e),this.layerClass='Flatten',this.gpu&&(this.flattenProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int i = int(floor(float(out_x) / float(inputCols)));\n  int j = int(mod(float(out_x), float(inputCols)));\n  outColor = vec4(texelFetch(x, ivec2(j, i), 0).r);\n}\n'),this.flattenFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputRows;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int rowIndex = int(mod(floor(float(out_x) / float(inputCols)), float(inputRows)));\n  int colIndex = int(mod(float(out_x), float(inputCols)));\n  int fragmentIndex = int(floor(float(out_x) / (float(inputRows) * float(inputCols))));\n  colIndex += fragmentIndex * inputCols;\n  outColor = vec4(texelFetch(x, ivec2(colIndex, rowIndex), 0).r);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){1>=e.tensor.shape.length?this.output=e:(this.output=new o.default([],[e.tensor.shape.reduce((e,t)=>e*t,1)]),this.output.replaceTensorData(e.tensor.data))}_callGPU(e){e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this.output||(this.output=new o.default([],[e.glTextureShape.reduce((e,t)=>e*t,1)]),this.output.createGLTexture({type:'2d',format:'float'})),e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),Ph.webgl2.runProgram({program:this.flattenFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[0],type:'int',name:'inputRows'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):Ph.webgl2.runProgram({program:this.flattenProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=n});ge(qf);var Uf=ho,Nf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Uf),o=a(wh),n=a(Bh),s=a(qh);class i extends o.default{constructor(e={}){super(e),this.layerClass='Reshape';const{target_shape:t=[]}=e;this.targetShape=t,this.description=`target shape: ${JSON.stringify(this.targetShape)}`,this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.targetShape.reduce((e,t)=>e*t,1)!==e.tensor.size&&this.throwError('The total size of new array must be unchanged in reshape layer.'),this.output=new n.default([],this.targetShape),this.output.replaceTensorData(e.tensor.data)}_createIndexMap(){if(!this.indexMap){const e=new n.default([],this.inputShape,{type:Int32Array}),t=new n.default([],this.inputShape,{type:Int32Array}),a=new n.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)s.default.assigns(t.tensor.pick(e,null),e);else if(3===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)s.default.assigns(t.tensor.pick(e,a,null),e*this.inputShape[1]+a);else if(4===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)for(let r=0;r<this.inputShape[2];r++)s.default.assigns(t.tensor.pick(e,a,r,null),e*this.inputShape[1]*this.inputShape[2]+a*this.inputShape[2]+r);for(let e=0;e<(0,r.default)(this.inputShape);e++)s.default.assigns(a.tensor.pick(...Array(this.inputShape.length-1).fill(null),e),e);s.default.muls(e.tensor,t.tensor,(0,r.default)(this.inputShape)),s.default.addeq(e.tensor,a.tensor),this.indexMap=new n.default([],this.targetShape,{type:Int32Array}),this.indexMap.replaceTensorData(new Int32Array(e.tensor.data)),2<this.targetShape.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),this.output||(this.output=new n.default([],this.targetShape),2<this.targetShape.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});ge(Nf);var Bf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Uf),o=a(Ih),n=a($p),i=a(wh),s=a(Bh),u=a(qh);class l extends i.default{constructor(e={}){super(e),this.layerClass='Permute';const{dims:t=[]}=e;this.description=`${JSON.stringify(t)}`,this.dims=t.map((e)=>e-1),this.gpu&&(this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return 1>=e.tensor.shape.length||(0,n.default)((0,o.default)(e.tensor.shape.length),this.dims)?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}_callCPU(e){this.dims.length!==e.tensor.shape.length&&this.throwError('The specified dims permutation must match the number of dimensions.');const t=this.dims.map((t)=>e.tensor.shape[t]);this.output=new s.default([],t),u.default.assign(this.output.tensor,e.tensor.transpose(...this.dims))}_createIndexMap(){if(!this.indexMap){const e=new s.default([],this.inputShape,{type:Int32Array}),t=new s.default([],this.inputShape,{type:Int32Array}),a=new s.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)u.default.assigns(t.tensor.pick(e,null),e);else if(3===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)u.default.assigns(t.tensor.pick(e,a,null),e*this.inputShape[1]+a);else if(4===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)for(let r=0;r<this.inputShape[2];r++)u.default.assigns(t.tensor.pick(e,a,r,null),e*this.inputShape[1]*this.inputShape[2]+a*this.inputShape[2]+r);for(let e=0;e<(0,r.default)(this.inputShape);e++)u.default.assigns(a.tensor.pick(...Array(this.inputShape.length-1).fill(null),e),e);u.default.muls(e.tensor,t.tensor,(0,r.default)(this.inputShape)),u.default.addeq(e.tensor,a.tensor);const o=this.dims.map((e)=>this.inputShape[e]);this.indexMap=new s.default([],o,{type:Int32Array}),u.default.assign(this.indexMap.tensor,e.tensor.transpose(...this.dims)),2<o.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){if(e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),!this.output){const e=this.dims.map((e)=>this.inputShape[e]);this.output=new s.default([],e),2<e.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})}Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=l});ge(Bf);var Vf=32,Hf=Vf,Wf=2147483647,Xf=-1<<Vf-1,$f=function(e){return(0<e)-(0>e)},Kf=function(e){var t=e>>Vf-1;return(e^t)-t},Qf=function(e,t){return t^(e^t)&-(e<t)},Zf=function(e,t){return e^(e^t)&-(e<t)},Yf=function(e){return!(e&e-1)&&!!e},Jf=function(e){var t,a;return t=(65535<e)<<4,e>>>=t,a=(255<e)<<3,e>>>=a,t|=a,a=(15<e)<<2,e>>>=a,t|=a,a=(3<e)<<1,e>>>=a,t|=a,t|e>>1},em=function(e){return 1e9<=e?9:1e8<=e?8:1e7<=e?7:1e6<=e?6:1e5<=e?5:1e4<=e?4:1e3<=e?3:100<=e?2:10<=e?1:0},tm=function(e){return e-=1431655765&e>>>1,e=(858993459&e)+(858993459&e>>>2),16843009*(252645135&e+(e>>>4))>>>24},am=go,rm=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1},om=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e-(e>>>1)},nm=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,e&=15,1&27030>>>e},im=Array(256);(function(e){for(var t=0;256>t;++t){var a=t,o=t,r=7;for(a>>>=1;a;a>>>=1)o<<=1,o|=1&a,--r;e[t]=255&o<<r}})(im);var sm=function(e){return im[255&e]<<24|im[255&e>>>8]<<16|im[255&e>>>16]<<8|im[255&e>>>24]},um=function(e,t){return e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1},lm=function(e,t){return e=1431655765&e>>>t,e=858993459&(e|e>>>1),e=252645135&(e|e>>>2),e=16711935&(e|e>>>4),e=65535&(e|e>>>16),e<<16>>16},pm=function(e,t,a){return e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e|=t<<1,a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),e|a<<2},dm=function(e,t){return e=1227133513&e>>>t,e=3272356035&(e|e>>>2),e=251719695&(e|e>>>4),e=4278190335&(e|e>>>8),e=1023&(e|e>>>16),e<<22>>22},cm=function(e){var a=e|e-1;return a+1|(~a&-~a)-1>>>go(e)+1},hm={INT_BITS:Hf,INT_MAX:Wf,INT_MIN:Xf,sign:$f,abs:Kf,min:Qf,max:Zf,isPow2:Yf,log2:Jf,log10:em,popCount:tm,countTrailingZeros:am,nextPow2:rm,prevPow2:om,parity:nm,reverse:sm,interleave2:um,deinterleave2:lm,interleave3:pm,deinterleave3:dm,nextCombination:cm},gm=_o,fm=fe(function(e,t){function a(e){if(e){var t=e.length||e.byteLength,a=hm.log2(t);_[a].push(e)}}function r(e){var e=hm.nextPow2(e),t=hm.log2(e),a=_[t];return 0<a.length?a.pop():new ArrayBuffer(e)}function o(e){return new Uint8Array(r(e),0,e)}function i(e){return new Uint16Array(r(2*e),0,e)}function s(e){return new Uint32Array(r(4*e),0,e)}function u(e){return new Int8Array(r(e),0,e)}function l(e){return new Int16Array(r(2*e),0,e)}function p(e){return new Int32Array(r(4*e),0,e)}function d(e){return new Float32Array(r(4*e),0,e)}function c(e){return new Float64Array(r(8*e),0,e)}function h(e){return m?new Uint8ClampedArray(r(e),0,e):o(e)}function g(e){return new DataView(r(e),0,e)}function f(e){e=hm.nextPow2(e);var t=hm.log2(e),a=x[t];return 0<a.length?a.pop():new Buffer(e)}Wi.__TYPEDARRAY_POOL||(Wi.__TYPEDARRAY_POOL={UINT8:gm([32,0]),UINT16:gm([32,0]),UINT32:gm([32,0]),INT8:gm([32,0]),INT16:gm([32,0]),INT32:gm([32,0]),FLOAT:gm([32,0]),DOUBLE:gm([32,0]),DATA:gm([32,0]),UINT8C:gm([32,0]),BUFFER:gm([32,0])});var m='undefined'!=typeof Uint8ClampedArray,n=Wi.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=gm([32,0])),n.BUFFER||(n.BUFFER=gm([32,0]));var _=n.DATA,x=n.BUFFER;t.free=function(e){if(Buffer.isBuffer(e))x[hm.log2(e.length)].push(e);else{if('[object ArrayBuffer]'!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,a=0|hm.log2(t);_[a].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){a(e.buffer)},t.freeArrayBuffer=a,t.freeBuffer=function(e){x[hm.log2(e.length)].push(e)},t.malloc=function(e,t){return void 0===t||'arraybuffer'===t?r(e):'uint8'===t?o(e):'uint16'===t?i(e):'uint32'===t?s(e):'int8'===t?u(e):'int16'===t?l(e):'int32'===t?p(e):'float'===t||'float32'===t?d(e):'double'===t||'float64'===t?c(e):'uint8_clamped'===t?h(e):'buffer'===t?f(e):'data'===t||'dataview'===t?g(e):null},t.mallocArrayBuffer=r,t.mallocUint8=o,t.mallocUint16=i,t.mallocUint32=s,t.mallocInt8=u,t.mallocInt16=l,t.mallocInt32=p,t.mallocFloat32=t.mallocFloat=d,t.mallocFloat64=t.mallocDouble=c,t.mallocUint8Clamped=h,t.mallocDataView=g,t.mallocBuffer=f,t.clearCache=function(){for(var e=0;32>e;++e)n.UINT8[e].length=0,n.UINT16[e].length=0,n.UINT32[e].length=0,n.INT8[e].length=0,n.INT16[e].length=0,n.INT32[e].length=0,n.FLOAT[e].length=0,n.DOUBLE[e].length=0,n.UINT8C[e].length=0,_[e].length=0,x[e].length=0}}),mm=xo,_m=yo,xm=vo,ym=bo,vm=So,bm=To,Sm={clone:mm,malloc:_m,free:xm,zeros:ym,ones:vm,eye:bm},Tm=Po,Pm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(Ag),i=a(Tm);class s extends r.default{constructor(e={}){super(e),this.layerClass='RepeatVector';const{n:t=1}=e;this.n=t,this.description=`n = ${t}`,this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, 0));\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){1!==e.tensor.shape.length&&this.throwError('Only 1D tensor inputs allowed.'),this.output=new o.default([],[this.n,e.tensor.shape[1]]),this.output.tensor=(0,i.default)((0,n.default)(e.tensor,0),[this.n,1])}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[this.n,e.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=s});ge(Pm);var wm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Dense',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Activation',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Dropout',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'SpatialDropout1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'SpatialDropout2D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'SpatialDropout3D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Flatten',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Reshape',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'Permute',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'RepeatVector',{enumerable:!0,get:function(){return c.default}});var r=a(Af),o=a(Lf),n=a(jf),i=a(zf),s=a(Gf),u=a(Of),l=a(qf),p=a(Nf),d=a(Bf),c=a(Pm)});ge(wm);var Cm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Embedding';const{input_dim:t=1,output_dim:a=1,input_length:r=0,mask_zero:o=!1}=e;this.description=`output dimensions: ${a}`,this.inputDim=t,this.outputDim=a,this.inputLength=r,this.maskZero=o,this.params=['embeddings'],this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D embeddings;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 x_size = textureSize(x, 0);\n  ivec2 embeddings_size = textureSize(embeddings, 0);\n  int out_x = int(float(embeddings_size[0]) * outTex.x);\n  int out_y = int(float(x_size[0]) * outTex.y);\n\n  int index = int(texelFetch(x, ivec2(out_y, 0), 0).r);\n  outColor = texelFetch(embeddings, ivec2(out_x, index), 0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=new o.default([],[e.tensor.shape[0],this.weights.embeddings.tensor.shape[1]]);for(let t=0,a=e.tensor.shape[0];t<a;t++)n.default.assign(this.output.tensor.pick(t,null),this.weights.embeddings.tensor.pick(e.tensor.get(t),null))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[e.glTextureShape[1],this.weights.embeddings.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.embeddings,name:'embeddings'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Cm);var km=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Embedding',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(Cm)});ge(km);var Fm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Ih),o=a($p),n=a(wh),i=a(Bh);class s extends n.default{constructor(e={}){super(e),this.layerClass='_Merge',this.isMergeLayer=!0}call(e){if(this.gpu)this._callGPU(e);else{const t=this._validateInputs(e);t||this.throwError('Invalid inputs to call method.'),this._callCPU(e)}return this.output}_validateInputs(e){const t=e.map((e)=>e.tensor.shape.slice());if(-1<['sum','diff','mul','ave','max','min'].indexOf(this.mode)&&!t.every((e)=>(0,o.default)(e,t[0]))&&this.throwError(`All input shapes must be the same for mode ${this.mode}.`),'dot'===this.mode)2!==e.length&&this.throwError(`Exactly 2 inputs required for mode ${this.mode}.`),0>this.dotAxes[0]&&(this.dotAxes[0]=t[0].length+this.dotAxes[0]),0>this.dotAxes[1]&&(this.dotAxes[1]=t[1].length+this.dotAxes[1]),t[0][this.dotAxes[0]]!==t[1][this.dotAxes[1]]&&this.throwError('Dimensions incompatibility using dot mode.');else if('concat'===this.mode){let e=t.slice(),a=0>this.concatAxis?e[0].length+this.concatAxis:this.concatAxis;0===this.concatAxis&&(a=0),(0,r.default)(e.length).forEach((t)=>{e[t].splice(a,1)}),e.every((t)=>(0,o.default)(t,e[0]))||this.throwError('In concat mode, all shapes must be the same except along the concat axis.')}return!0}_callCPU(){}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}),this.output||(this.output=new i.default([],e[0].glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e[0].is1D?this.output.is1D=e[0].is1D:(e[0].is2DReshaped||e[0].is2DSquareReshaped)&&(e[0].is2DReshaped?this.output.is2DReshaped=e[0].is2DReshaped:e[0].is2DSquareReshaped&&(this.output.is2DSquareReshaped=e[0].is2DSquareReshaped),this.output.originalShape=e[0].originalShape.slice(),this.output.indicesForReshaped=e[0].indicesForReshaped)),Ph.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map((e,t)=>({input:e,name:`inputs[${t}]`})),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=s});ge(Fm);var Mm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Add',this.mode='sum'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(let t=0;t<e.length;t++)s.default.addeq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('add',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});ge(Mm);var Dm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),i=a(qh);class s extends r.default{constructor(e={}){super(e),this.layerClass='Subtract',this.mode='diff'}_callCPU(e){2!==e.length&&this.throwError('Inputs should be an array of 2 Tensors.');const t=e[0].tensor.shape.slice();this.output=new o.default([],t),i.default.sub(this.output.tensor,e[0].tensor,e[1].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('subtract',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=s});ge(Dm);var Im=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Multiply',this.mode='mul'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assigns(this.output.tensor,1);for(let t=0;t<e.length;t++)s.default.muleq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('multiply',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});ge(Im);var Em=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Average',this.mode='ave'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(let t=0;t<e.length;t++)s.default.addeq(this.output.tensor,e[t].tensor);s.default.divseq(this.output.tensor,e.length)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('average',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});ge(Em);var Rm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Maximum',this.mode='max'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assign(this.output.tensor,e[0].tensor);for(let t=1;t<e.length;t++)s.default.maxeq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('maximum',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});ge(Rm);var Am=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(kg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Minimum',this.mode='min'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assign(this.output.tensor,e[0].tensor);for(let t=1;t<e.length;t++)s.default.mineq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('minimum',e.length,t);this.mergeProgram=Ph.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});ge(Am);var Lm=wo,jm=Co,zm={dtype:'double'},Gm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(xg),o=a(Fm),n=a(Bh),i=a(kg),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Uh),u=a(jm);class l extends o.default{constructor(e={}){super(e),this.layerClass='Concatenate',this.mode='concat';const{axis:t=-1}=e;this.concatAxis=0>=t?t:t-1}_callCPU(e){const t=e[0].tensor.shape.slice(),a=0>this.concatAxis?t.length+this.concatAxis:this.concatAxis;if(e.slice(1,e.length).forEach((e)=>{const r=e.tensor.shape.slice()[a];t[a]+=r}),this.output=new n.default([],t),0===a)(0,u.default)(this.output.tensor,e.map((e)=>e.tensor));else{let t=[a];for(let r=0;r<e[0].tensor.shape.length;r++)r!==a&&t.push(r);(0,u.default)(this.output.tensor.transpose(...t),e.map((e)=>e.tensor.transpose(...t)))}}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})});const t=e[0].glTextureShape.slice();let a=1;if(e[0].is2DReshaped?-1===this.concatAxis||this.concatAxis===e[0].originalShape.length-1?a=1:this.throwError('specified axis not supported for now.'):-1===this.concatAxis||1===this.concatAxis?a=1:-2===this.concatAxis||0===this.concatAxis?a=0:this.throwError('specified axis not supported for now.'),t[a]=(0,r.default)(e.map((e)=>e.glTextureShape[a])),!this.output)if(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:1==a}),e[0].is1D)this.output.is1D=e[0].is1D;else if(e[0].is2DReshaped){this.output.is2DReshaped=e[0].is2DReshaped,this.output.originalShape=e[0].originalShape.slice();const t=0>this.concatAxis?this.output.originalShape.length+this.concatAxis:this.concatAxis;this.output.originalShape[t]=(0,r.default)(e.map((e)=>e.originalShape[t])),this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this.output.originalShape,!1,t)}if(!this.mergeProgram){const t=this.output.glTextureFragments?this.output.glTextureFragmentShape:this.output.glTextureShape,r=(0,i.default)('concatenate',e.length,e.map((e)=>e.glTextureShape),t,a);this.mergeProgram=Ph.webgl2.compileProgram(r)}Ph.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map((e,t)=>({input:e,name:`inputs[${t}]`})),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=l});ge(Gm);var Om=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Fm),o=a(Bh),n=a(Dg),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='Dot',this.mode='dot';const{axes:t=-1,normalize:a=!1}=e;this.dotAxes=Array.isArray(t)?[0>=t[0]?t[0]:t[0]-1,0>=t[1]?t[1]:t[1]-1]:[0>=t?t:t-1,0>=t?t:t-1],this.normalize=a,this.gpu&&(this.mergeProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D input1;\nuniform sampler2D input2;\nuniform int rows;\nuniform int cols;\nuniform int dotAxis1;\nuniform int dotAxis2;\nuniform int commonDim;\nuniform bool normalize;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(cols) * outTex.x);\n  int out_y = int(float(rows) * outTex.y);\n\n  float sum = 0.;\n  float a = 0.;\n  float b = 0.;\n  float norm1 = 0.;\n  float norm2 = 0.;\n\n  for (int i = 0; i < commonDim; ++i) {\n    if (dotAxis1 == 0 && dotAxis2 == 0) {\n      a = texelFetch(input1, ivec2(out_y, i), 0).r;\n      b = texelFetch(input2, ivec2(out_x, i), 0).r;\n    } else if (dotAxis1 == 1 && dotAxis2 == 1) {\n      a = texelFetch(input1, ivec2(i, out_y), 0).r;\n      b = texelFetch(input2, ivec2(i, out_x), 0).r;\n    }\n\n    sum += a * b;\n\n    if (normalize) {\n      norm1 += a * a;\n      norm2 += b * b;\n    }\n  }\n\n  if (normalize) {\n    sum /= sqrt(norm1) * sqrt(norm2);\n  }\n\n  outColor = vec4(sum);\n}\n'))}_calcOutputShape(e){let t=e[0].slice(),a=e[1].slice();t.splice(this.dotAxes[0],1),a.splice(this.dotAxes[1],1),this.outputShape=t.concat(a),1===this.outputShape.length&&this.outputShape.push(1)}_callCPU(e){if(this._calcOutputShape([e[0].tensor.shape,e[1].tensor.shape]),this.output=new o.default([],this.outputShape),2!==e[0].tensor.shape.length||2!==e[1].tensor.shape.length)this.throwError('dot mode for 3+ dim tensors not yet implemented.');else if(0===this.dotAxes[0]&&0===this.dotAxes[1]){if(this.normalize){for(let t=0;t<e[0].tensor.shape[1];t++)s.default.divseq(e[0].tensor.pick(null,t),s.default.norm2(e[0].tensor.pick(null,t)));for(let t=0;t<e[1].tensor.shape[1];t++)s.default.divseq(e[1].tensor.pick(null,t),s.default.norm2(e[1].tensor.pick(null,t)))}(0,n.default)(this.output.tensor,e[0].tensor.transpose(1,0),e[1].tensor)}else if(1===this.dotAxes[0]&&1===this.dotAxes[1]){if(this.normalize){for(let t=0;t<e[0].tensor.shape[0];t++)s.default.divseq(e[0].tensor.pick(t,null),s.default.norm2(e[0].tensor.pick(t,null)));for(let t=0;t<e[1].tensor.shape[0];t++)s.default.divseq(e[1].tensor.pick(t,null),s.default.norm2(e[1].tensor.pick(t,null)))}(0,n.default)(this.output.tensor,e[0].tensor,e[1].tensor.transpose(1,0))}}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float'})}),this._calcOutputShape([e[0].glTextureShape,e[1].glTextureShape]),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}));const t=e[0].glTextureShape[this.dotAxes[0]];Ph.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:e[0],name:'input1'},{input:e[1],name:'input2'}],uniforms:[{value:this.output.glTextureShape[0],type:'int',name:'rows'},{value:this.output.glTextureShape[1],type:'int',name:'cols'},{value:this.dotAxes[0],type:'int',name:'dotAxis1'},{value:this.dotAxes[1],type:'int',name:'dotAxis2'},{value:t,type:'int',name:'commonDim'},{value:+this.normalize,type:'bool',name:'normalize'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Om);var qm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Add',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Subtract',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Multiply',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Average',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Maximum',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Minimum',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Concatenate',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Dot',{enumerable:!0,get:function(){return p.default}});var r=a(Mm),o=a(Dm),n=a(Im),i=a(Em),s=a(Rm),u=a(Am),l=a(Gm),p=a(Om)});ge(qm);var Um=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='GaussianDropout';const{rate:t=0.5}=e;this.rate=bn(Sn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});ge(Um);var Nm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(wh);class r extends a.default{constructor(e={}){super(e),this.layerClass='GaussianNoise';const{stddev:t=0}=e;this.stddev=t}call(e){return this.output=e,this.output}}t.default=r});ge(Nm);var Bm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'GaussianDropout',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'GaussianNoise',{enumerable:!0,get:function(){return o.default}});var r=a(Um),o=a(Nm)});ge(Bm);var Vm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='BatchNormalization';const{epsilon:t=1e-3,axis:a=-1,center:r=!0,scale:o=!0}=e;this.epsilon=t,this.center=r,this.scale=o,this.axis=a,this.axisNormalized=!1,this.params=[],this.scale&&this.params.push('gamma'),this.center&&this.params.push('beta'),this.params=this.params.concat(['moving_mean','moving_variance']),this.gpu&&(this.program=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D X;\nuniform isampler2D normAxisIndexMap;\nuniform sampler2D gamma;\nuniform sampler2D beta;\nuniform sampler2D mean;\nuniform sampler2D std;\nuniform float epsilon;\nuniform bool scale;\nuniform bool center;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(X, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\nint normAxisIndex = texelFetch(normAxisIndexMap, ivec2(out_x, out_y), 0).r;\n\n  float _x = texelFetch(X, ivec2(out_x, out_y), 0).r;\n  float _mean = texelFetch(mean, ivec2(normAxisIndex, 0), 0).r;\n  float _std = texelFetch(std, ivec2(normAxisIndex, 0), 0).r;\n\n  float _gamma = 1.0;\n  if (scale) {\n    _gamma = texelFetch(gamma, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float _beta = 0.0;\n  if (center) {\n    _beta = texelFetch(beta, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float sum = _beta + _gamma * (_x - _mean) / sqrt(_std + epsilon);\n\n  outColor = vec4(sum);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.axisNormalized||(this.axis=0>this.axis?e.tensor.shape.length+this.axis:this.axis-1,this.axisNormalized=!0);let t=[];for(let a=0;a<e.tensor.shape.length;a++)a===this.axis?t.push(1):t.push(null);let a=new o.default([],e.tensor.shape),r=new o.default([],e.tensor.shape);for(let o=0;o<e.tensor.shape[this.axis];o++)t[this.axis]=o,this.scale&&n.default.assigns(a.tensor.pick(...t),this.weights.gamma.tensor.get(o)),this.center&&n.default.assigns(r.tensor.pick(...t),this.weights.beta.tensor.get(o));let s=new o.default([],e.tensor.shape),u=new o.default([],e.tensor.shape);for(let a=0;a<e.tensor.shape[this.axis];a++)t[this.axis]=a,n.default.assigns(s.tensor.pick(...t),this.weights.moving_mean.tensor.get(a)),n.default.assigns(u.tensor.pick(...t),this.weights.moving_variance.tensor.get(a)+this.epsilon);n.default.sqrteq(u.tensor),this.output=new o.default(e.tensor.data,e.tensor.shape),n.default.subeq(this.output.tensor,s.tensor),n.default.diveq(this.output.tensor,u.tensor),this.scale&&n.default.muleq(this.output.tensor,a.tensor),this.center&&n.default.addeq(this.output.tensor,r.tensor)}_createIndexMap(e,t){if(!this.normAxisIndexMap){const a=new o.default([],this.inputShape,{type:Int32Array});this.normAxisIndexMap=new o.default([],e,{type:Int32Array});const r=Array(this.inputShape.length).fill(null);for(let e=0;e<this.inputShape[this.axis];e++)r[this.axis]=e,n.default.assigns(a.tensor.pick(...r),e);if(t)for(let e=0;e<t.data.length;e++)this.normAxisIndexMap.tensor.data[t.data[e]]=a.tensor.data[e];else this.normAxisIndexMap=a;this.normAxisIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){this.axisNormalized||(this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,this.axis=0>this.axis?this.inputShape.length+this.axis:this.axis-1,this.axisNormalized=!0),e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this._createIndexMap(e.glTextureShape,e.indicesForReshaped),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped));const t=[{input:e,name:'X'},{input:this.normAxisIndexMap,name:'normAxisIndexMap'}];this.scale&&t.push({input:this.weights.gamma,name:'gamma'}),this.center&&t.push({input:this.weights.beta,name:'beta'}),t.push({input:this.weights.moving_mean,name:'mean'}),t.push({input:this.weights.moving_variance,name:'std'});const a=[{value:this.epsilon,type:'float',name:'epsilon'},{value:+this.scale,type:'bool',name:'scale'},{value:+this.center,type:'bool',name:'center'}];Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:t,uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});ge(Vm);var Hm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'BatchNormalization',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(Vm)});ge(Hm);var Wm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling1D';const{pool_size:t=2,strides:a=null,padding:r='valid'}=e;this.poolSize=t,this.strides=null===a?this.poolSize:a,this.padding=r,this.poolingFunc='max',this.description=`pool size ${this.poolSize}`,this.description+=1<this.strides?`, striding ${this.strides} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t='valid'===this.padding?fn((e.tensor.shape[0]-this.poolSize+this.strides)/this.strides):fn((e.tensor.shape[0]+this.strides-1)/this.strides);this.output=new o.default([],[t,e.tensor.shape[1]]);const a=new o.default([],[e.tensor.shape[1]]);let r='valid'===this.padding?0:bn(0,yn((e.tensor.shape[0]-(t-1)*this.strides-this.poolSize)/2));for(let o=0;o<t;o++){let t=Sn(0,r),i=this.poolSize+bn(0,r);n.default.assign(a.tensor,e.tensor.pick(t,null));let s=1;for(let r=1;r<i&&!(t+r>e.tensor.shape[0]-1);r++)'max'===this.poolingFunc?n.default.maxeq(a.tensor,e.tensor.pick(t+r,null)):'average'===this.poolingFunc&&n.default.addeq(a.tensor,e.tensor.pick(t+r,null)),s+=1;'average'===this.poolingFunc&&n.default.divseq(a.tensor,s),n.default.assign(this.output.tensor.pick(o,null),a.tensor),r+=this.strides}}_createIndexMap(){if(this.poolIndexMap)return;const e='valid'===this.padding?fn((this.inputShape[0]-this.poolSize+this.strides)/this.strides):fn((this.inputShape[0]+this.strides-1)/this.strides);this.outputShape=[e,this.inputShape[1]],this.poolIndexMap=new o.default([],[e,this.poolSize],{type:Int32Array}),n.default.assigns(this.poolIndexMap.tensor,-1);let t='valid'===this.padding?0:bn(0,yn((this.inputShape[0]-(e-1)*this.strides-this.poolSize)/2));for(let a=0;a<e;a++){let e=Sn(0,t),r=this.poolSize+bn(0,t),o=e;this.poolIndexMap.tensor.set(a,0,o);for(let t=1;t<r&&(o=e+t,o<=this.inputShape[0]-1);t++)this.poolIndexMap.tensor.set(a,t,o);t+=this.strides}this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.inputShape=e.tensor.shape,this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));const t='max'===this.poolingFunc,a=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:this.poolSize,type:'int',name:'poolSize'},{value:+t,type:'bool',name:'isMaxPooling'}];e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),Ph.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(Wm);var Xm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Wm);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling1D',this.poolingFunc='max'}}t.default=r});ge(Xm);var $m=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Uh),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling2D';const{pool_size:t=[2,2],strides:a=null,padding:r='valid',data_format:o='channels_last'}=e;this.poolSize=Array.isArray(t)?t:[t,t],this.strides=Array.isArray(a)?a:null===a?this.poolSize:[a,a],this.padding=r,this.dataFormat=o,this.poolingFunc='max',this.description=`pool size ${this.poolSize.join('x')}`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const[t,a,r]=e,[o,n]=this.poolSize,i='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-o+this.strides[0])/this.strides[0]),s='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-n+this.strides[1])/this.strides[1]),u='same'===this.padding?Sn(0,fn((i-1)*this.strides[0]+o-t)):0,l='same'===this.padding?Sn(0,fn((s-1)*this.strides[1]+n-a)):0,p=fn(u/2),d=fn(l/2);this.outputShape=[i,s,r],this.inputPadding=[p,u-p,d,l-d]}}_padInput(e){if('same'===this.padding){const[t,a,r]=e.tensor.shape,[n,i,u,l]=this.inputPadding,p=new o.default([],[t+n+i,a+u+l,r]);return'max'===this.poolingFunc&&s.default.assigns(p.tensor,Number.NEGATIVE_INFINITY),s.default.assign(p.tensor.hi(t+n,a+u,r).lo(n,u,0),e.tensor),p}return e}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);const[t,a,r]=e.tensor.shape,[n,u]=this.poolSize;this.output=new o.default([],this.outputShape);const l=new o.default([],[n,u,r]),[p,d,c,h]=this.inputPadding;for(let o=0,i=0,g;o<=t-n;o+=this.strides[0],i++){g=0,o<p?g=p-o:o+n>t-d&&(g=o+n-(t-d));for(let t=0,p=0,d;t<=a-u;t+=this.strides[1],p++){d=0,t<c?d=c-t:t+u>a-h&&(d=t+u-(a-h));const f=(n-g)*(u-d);s.default.assign(l.tensor,e.tensor.hi(o+n,t+u,r).lo(o,t,0));for(let e=0;e<r;e++)'max'===this.poolingFunc?this.output.tensor.set(i,p,e,s.default.sup(l.tensor.pick(null,null,e))):'average'===this.poolingFunc&&this.output.tensor.set(i,p,e,s.default.sum(l.tensor.pick(null,null,e))/f)}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_im2col(e){const[t,a,r]=e.tensor.shape;this.tiledInput||(this.tiledInput=new o.default([],[t*a,r]));const n=new o.default([],[t,a]),i=new o.default([],[t*a]);for(let t=0;t<r;t++)s.default.assign(n.tensor,e.tensor.pick(null,null,t)),i.replaceTensorData(n.tensor.data),s.default.assign(this.tiledInput.tensor.pick(null,t),i.tensor);return this.tiledInput}_createIndexMap(){if(this.poolIndexMap)return;let e=this.inputShape[0],t=this.inputShape[1];const a=new o.default([],[e,t]);let r=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++)a.tensor.set(o,e,r),r+=1;if('same'===this.padding){const[r,n,i,u]=this.inputPadding;e=e+r+n,t=t+i+u;const l=new o.default([],[e,t]);s.default.assigns(l.tensor,-1),s.default.assign(l.tensor.hi(this.inputShape[0]+r,this.inputShape[1]+i).lo(r,i),a.tensor),a.tensor=l.tensor}const[n,u]=this.poolSize,i=this.outputShape[0],l=this.outputShape[1];this.poolIndexMap=new o.default([],[i*l,n*u],{type:Int32Array});const p=new o.default([],[n,u]);let d=0;for(let r=0,o=e-n;r<=o;r+=this.strides[0])for(let e=0,o=t-u;e<=o;e+=this.strides[1])s.default.assign(p.tensor,a.tensor.hi(r+n,e+u).lo(r,e)),this.poolIndexMap.tensor.data.set(p.tensor.data,d),d+=n*u;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this._im2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){const[e,t,a]=this.outputShape;this.output=new o.default([],[e*t,a]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,a=this.poolSize[0]*this.poolSize[1],r='max'===this.poolingFunc,i=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:a,type:'int',name:'poolSize'},{value:+r,type:'bool',name:'isMaxPooling'}];t.glTextureFragments?(t.convert2DRowFragmentedGLTextureToColStack(),Ph.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),t.removeGLTextureFragmentsAsColStack()):Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=i});ge($m);var Km=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}($m);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling2D',this.poolingFunc='max'}}t.default=r});ge(Km);var Qm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Uh),s=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling3D';const{pool_size:t=[2,2,2],strides:a=null,padding:r='valid',data_format:o='channels_last'}=e;this.poolSize=Array.isArray(t)?t:[t,t,t],this.strides=Array.isArray(a)?a:null===a?this.poolSize:[a,a,a],this.padding=r,this.dataFormat=o,this.poolingFunc='max',this.description=`pool size ${this.poolSize.join('x')}`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const[t,a,r,o]=e,[n,i,s]=this.poolSize,u='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-n+this.strides[0])/this.strides[0]),l='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-i+this.strides[1])/this.strides[1]),p='same'===this.padding?fn((r+this.strides[2]-1)/this.strides[2]):fn((r-s+this.strides[2])/this.strides[2]),d='same'===this.padding?Sn(0,fn((u-1)*this.strides[0]+n-t)):0,c='same'===this.padding?Sn(0,fn((l-1)*this.strides[1]+i-a)):0,h='same'===this.padding?Sn(0,fn((p-1)*this.strides[2]+s-r)):0,g=fn(d/2),f=fn(c/2),m=fn(h/2);this.outputShape=[u,l,p,o],this.inputPadding=[g,d-g,f,c-f,m,h-m]}}_padInput(e){if('same'===this.padding){const[t,a,r,n]=e.tensor.shape,[i,u,l,p,d,c]=this.inputPadding,h=new o.default([],[t+i+u,a+l+p,r+d+c,n]);return'max'===this.poolingFunc&&s.default.assigns(h.tensor,Number.NEGATIVE_INFINITY),s.default.assign(h.tensor.hi(t+i,a+l,r+d,n).lo(i,l,d,0),e.tensor),h}return e}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);const[t,a,r,n]=e.tensor.shape,[u,l,p]=this.poolSize;this.output=new o.default([],this.outputShape);let d=new o.default([],[u,l,p,n]);const[c,h,g,f,m,_]=this.inputPadding;for(let o=0,i=0,x;o<=t-u;o+=this.strides[0],i++){x=0,o<c?x=c-o:o+u>t-h&&(x=o+u-(t-h));for(let t=0,h=0,c;t<=a-l;t+=this.strides[1],h++){c=0,t<g?c=g-t:t+l>a-f&&(c=t+l-(a-f));for(let a=0,g=0,f;a<=r-p;a+=this.strides[2],g++){f=0,a<m?f=m-a:a+p>r-_&&(f=a+p-(r-_));const y=(u-x)*(l-c)*(p-f);s.default.assign(d.tensor,e.tensor.hi(o+u,t+l,a+p,n).lo(o,t,a,0));for(let e=0;e<n;e++)'max'===this.poolingFunc?this.output.tensor.set(i,h,g,e,s.default.sup(d.tensor.pick(null,null,null,e))):'average'===this.poolingFunc&&this.output.tensor.set(i,h,g,e,s.default.sum(d.tensor.pick(null,null,null,e))/y)}}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_vol2col(e){const[t,a,r,n]=e.tensor.shape;this.tiledInput||(this.tiledInput=new o.default([],[t*a*r,n]));const i=new o.default([],[t,a,r]),u=new o.default([],[t*a*r]);for(let t=0;t<n;t++)s.default.assign(i.tensor,e.tensor.pick(null,null,null,t)),u.replaceTensorData(i.tensor.data),s.default.assign(this.tiledInput.tensor.pick(null,t),u.tensor);return this.tiledInput}_createIndexMap(){if(this.poolIndexMap)return;let e=this.inputShape[0],t=this.inputShape[1],a=this.inputShape[2];const r=new o.default([],[e,t,a]);let n=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++)for(let t=0;t<a;t++)r.tensor.set(o,e,t,n),n+=1;if('same'===this.padding){const[n,i,u,l,p,d]=this.inputPadding;e=e+n+i,t=t+u+l,a=a+p+d;const c=new o.default([],[e,t,a]);s.default.assigns(c.tensor,-1),s.default.assign(c.tensor.hi(this.inputShape[0]+n,this.inputShape[1]+u,this.inputShape[2]+p).lo(n,u,p),r.tensor),r.tensor=c.tensor}const[u,l,p]=this.poolSize,i=this.outputShape[0],d=this.outputShape[1],c=this.outputShape[2];this.poolIndexMap=new o.default([],[i*d*c,u*l*p],{type:Int32Array});const h=new o.default([],[u,l,p]);let g=0;for(let o=0,n=e-u;o<=n;o+=this.strides[0])for(let e=0,n=t-l;e<=n;e+=this.strides[1])for(let t=0,n=a-p;t<=n;t+=this.strides[2])s.default.assign(h.tensor,r.tensor.hi(o+u,e+l,t+p).lo(o,e,t)),this.poolIndexMap.tensor.data.set(h.tensor.data,g),g+=u*l*p;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this._vol2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){const[e,t,a,r]=this.outputShape;this.output=new o.default([],[e*t*a,r]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,a=this.poolSize[0]*this.poolSize[1]*this.poolSize[2],r='max'===this.poolingFunc,i=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:a,type:'int',name:'poolSize'},{value:+r,type:'bool',name:'isMaxPooling'}];t.glTextureFragments?(t.convert2DRowFragmentedGLTextureToColStack(),Ph.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),t.removeGLTextureFragmentsAsColStack()):Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}t.default=i});ge(Qm);var Zm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Qm);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling3D',this.poolingFunc='max'}}t.default=r});ge(Zm);var Ym=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Wm);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling1D',this.poolingFunc='average'}}t.default=r});ge(Ym);var Jm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}($m);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling2D',this.poolingFunc='average'}}t.default=r});ge(Jm);var e_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Qm);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling3D',this.poolingFunc='average'}}t.default=r});ge(e_);var t_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling1D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const[t,a]=e.tensor.shape;this.output=new o.default([],[a]);for(let r=0;r<a;r++)'max'===this.poolingFunc?this.output.tensor.set(r,n.default.sup(e.tensor.pick(null,r))):'average'===this.poolingFunc&&this.output.tensor.set(r,n.default.sum(e.tensor.pick(null,r))/t)}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.output||(this.output=new o.default([],[this.inputShape[1]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(t_);var a_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(t_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling1D',this.poolingFunc='max'}}t.default=r});ge(a_);var r_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling2D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0));const[t,a,r]=e.tensor.shape;this.output=new o.default([],[r]);for(let o=0;o<r;o++)'max'===this.poolingFunc?this.output.tensor.set(o,n.default.sup(e.tensor.pick(null,null,o))):'average'===this.poolingFunc&&this.output.tensor.set(o,n.default.sum(e.tensor.pick(null,null,o))/(t*a))}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[2]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(r_);var o_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(r_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling2D',this.poolingFunc='max'}}t.default=r});ge(o_);var n_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling3D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0));const[t,a,r,s]=e.tensor.shape;this.output=new o.default([],[s]);for(let o=0;o<s;o++)'max'===this.poolingFunc?this.output.tensor.set(o,n.default.sup(e.tensor.pick(null,null,null,o))):'average'===this.poolingFunc&&this.output.tensor.set(o,n.default.sum(e.tensor.pick(null,null,null,o))/(t*a*r))}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[3]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;Ph.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1]*this.inputShape[2],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});ge(n_);var i_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling3D',this.poolingFunc='max'}}t.default=r});ge(i_);var s_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(t_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling1D',this.poolingFunc='average'}}t.default=r});ge(s_);var u_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(r_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling2D',this.poolingFunc='average'}}t.default=r});ge(u_);var l_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(n_);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling3D',this.poolingFunc='average'}}t.default=r});ge(l_);var p_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'MaxPooling1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'MaxPooling2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'MaxPooling3D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'AveragePooling1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'AveragePooling2D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'AveragePooling3D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'GlobalMaxPooling1D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'GlobalMaxPooling2D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'GlobalMaxPooling3D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'GlobalAveragePooling1D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'GlobalAveragePooling2D',{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,'GlobalAveragePooling3D',{enumerable:!0,get:function(){return g.default}});var r=a(Xm),o=a(Km),n=a(Zm),i=a(Ym),s=a(Jm),u=a(e_),l=a(a_),p=a(o_),d=a(i_),c=a(s_),h=a(u_),g=a(l_)});ge(p_);var d_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(sg),n=a(Bh),i=a(wh),s=a(qh),u=a(Zh),l=r(Eg);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),this.layerClass='SimpleRNN';const{units:t=1,activation:a='tanh',use_bias:r=!0,return_sequences:n=!1,go_backwards:i=!1,stateful:s=!1}=e;this.units=t,this.activation=a,this.activationFunc=o[a],this.use_bias=r,this.returnSequences=n,this.goBackwards=i,this.stateful=s,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(l[this.activation]),this.gateSummationProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.timestepReadProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'))}setWeights(e){super.setWeights(e),this.use_bias||(this.weights.bias=new n.default([],[this.units]),this.gpu&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.units,a=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[t]),r=new n.default([],[t]),o=new n.default([],[t]),i=new n.default([],[t]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],t]);const u=new n.default([],[e.tensor.shape[1]]),l=()=>{s.default.assign(i.tensor,a.tensor),(0,Rf.gemv)(1,this.weights.kernel.tensor.transpose(1,0),u.tensor,1,r.tensor),(0,Rf.gemv)(1,this.weights.recurrent_kernel.tensor.transpose(1,0),i.tensor,1,o.tensor),this._combine(a.tensor,r.tensor,o.tensor,this.weights.bias.tensor),this.activationFunc(a)};for(let t=0,n=e.tensor.shape[0];t<n;t++){const i=this.goBackwards?n-t-1:t;s.default.assign(u.tensor,e.tensor.pick(i,null));[r,o].forEach((e)=>s.default.assigns(e.tensor,0)),l(),this.returnSequences&&s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),a.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:a,this.stateful&&(this.currentHiddenState=a)}_stepGPU(){Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.recurrent_kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.bias,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:Ph.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.units;this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[t]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[t]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[t]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[t]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[t]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;Ph.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),Ph.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});ge(d_);var c_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(sg),n=a(Bh),i=a(wh),s=a(qh),u=a(Zh),l=r(Eg);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(this,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=e*a+t*r}})}),this.layerClass='LSTM';const{units:t=1,activation:a='tanh',use_bias:r=!0,recurrent_activation:n='hard_sigmoid',return_sequences:i=!1,go_backwards:s=!1,stateful:p=!1}=e;this.units=t,this.activation=a,this.recurrentActivation=n,this.activationFunc=o[a],this.recurrentActivationFunc=o[n],this.use_bias=r,this.returnSequences=i,this.goBackwards=s,this.stateful=p,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+='linear'===this.recurrentActivation?'':`, ${this.recurrentActivation} recurrent activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(l[this.activation]),this.recurrentActivationProgram=Ph.webgl2.compileProgram(l[this.recurrentActivation]),this.gateSummationProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.gateProductProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),this.timestepReadProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),this.updateProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D c;\nuniform sampler2D ctm1;\nuniform sampler2D i;\nuniform sampler2D f;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(c, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float c_val = texelFetch(c, ivec2(out_x, out_y), 0).r;\n  float ctm1_val = texelFetch(ctm1, ivec2(out_x, out_y), 0).r;\n  float i_val = texelFetch(i, ivec2(out_x, out_y), 0).r;\n  float f_val = texelFetch(f, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(c_val * i_val + ctm1_val * f_val);\n}\n'))}setWeights(e){super.setWeights(e);const t=this.weights.kernel.tensor.shape;this.weights.W_i=new n.default([],[t[0],this.units]),this.weights.W_f=new n.default([],[t[0],this.units]),this.weights.W_c=new n.default([],[t[0],this.units]),this.weights.W_o=new n.default([],[t[0],this.units]),s.default.assign(this.weights.W_i.tensor,this.weights.kernel.tensor.hi(t[0],this.units).lo(0,0)),s.default.assign(this.weights.W_f.tensor,this.weights.kernel.tensor.hi(t[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.W_c.tensor,this.weights.kernel.tensor.hi(t[0],3*this.units).lo(0,2*this.units)),s.default.assign(this.weights.W_o.tensor,this.weights.kernel.tensor.hi(t[0],4*this.units).lo(0,3*this.units));const a=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_i=new n.default([],[a[0],this.units]),this.weights.U_f=new n.default([],[a[0],this.units]),this.weights.U_c=new n.default([],[a[0],this.units]),this.weights.U_o=new n.default([],[a[0],this.units]),s.default.assign(this.weights.U_i.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],this.units).lo(0,0)),s.default.assign(this.weights.U_f.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.U_c.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],3*this.units).lo(0,2*this.units)),s.default.assign(this.weights.U_o.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],4*this.units).lo(0,3*this.units)),this.weights.b_i=new n.default([],[this.units]),this.weights.b_f=new n.default([],[this.units]),this.weights.b_c=new n.default([],[this.units]),this.weights.b_o=new n.default([],[this.units]),this.use_bias&&(s.default.assign(this.weights.b_i.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),s.default.assign(this.weights.b_f.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),s.default.assign(this.weights.b_c.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units)),s.default.assign(this.weights.b_o.tensor,this.weights.bias.tensor.hi(4*this.units).lo(3*this.units))),this.gpu){['W_i','W_f','W_c','W_o','U_i','U_f','U_c','U_o','b_i','b_f','b_c','b_o'].forEach((e)=>{this.weights[e].createGLTexture({type:'2d',format:'float'})})}}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.weights.b_i.tensor.shape[0],a=this.weights.b_c.tensor.shape[0],r=this.weights.b_f.tensor.shape[0],o=this.weights.b_o.tensor.shape[0],i=new n.default([],[t]),u=new n.default([],[t]),l=new n.default([],[t]),p=new n.default([],[r]),d=new n.default([],[r]),c=new n.default([],[r]),h=new n.default([],[o]),g=new n.default([],[o]),f=new n.default([],[o]),m=new n.default([],[a]),_=new n.default([],[a]),x=new n.default([],[a]),y=this.stateful&&this.previousCandidate?this.previousCandidate:new n.default([],[a]),v=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[a]),b=new n.default([],[a]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],a]);const S=new n.default([],[e.tensor.shape[1]]),T=()=>{s.default.assign(b.tensor,v.tensor),(0,Rf.gemv)(1,this.weights.W_i.tensor.transpose(1,0),S.tensor,1,u.tensor),(0,Rf.gemv)(1,this.weights.U_i.tensor.transpose(1,0),b.tensor,1,l.tensor),this._combine(i.tensor,u.tensor,l.tensor,this.weights.b_i.tensor),this.recurrentActivationFunc(i),(0,Rf.gemv)(1,this.weights.W_f.tensor.transpose(1,0),S.tensor,1,d.tensor),(0,Rf.gemv)(1,this.weights.U_f.tensor.transpose(1,0),b.tensor,1,c.tensor),this._combine(p.tensor,d.tensor,c.tensor,this.weights.b_f.tensor),this.recurrentActivationFunc(p),(0,Rf.gemv)(1,this.weights.W_o.tensor.transpose(1,0),S.tensor,1,g.tensor),(0,Rf.gemv)(1,this.weights.U_o.tensor.transpose(1,0),b.tensor,1,f.tensor),this._combine(h.tensor,g.tensor,f.tensor,this.weights.b_o.tensor),this.recurrentActivationFunc(h),(0,Rf.gemv)(1,this.weights.W_c.tensor.transpose(1,0),S.tensor,1,_.tensor),(0,Rf.gemv)(1,this.weights.U_c.tensor.transpose(1,0),b.tensor,1,x.tensor),this._combine(m.tensor,_.tensor,x.tensor,this.weights.b_c.tensor),this.activationFunc(m),this._update(m.tensor,y.tensor,i.tensor,p.tensor),s.default.assign(y.tensor,m.tensor),this.activationFunc(m),s.default.mul(v.tensor,h.tensor,m.tensor)};for(let t=0,a=e.tensor.shape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;s.default.assign(S.tensor,e.tensor.pick(r,null));[u,l,d,c,g,f,_,x].forEach((e)=>s.default.assigns(e.tensor,0)),T(),s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),v.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:v,this.stateful&&(this.previousCandidate=y,this.currentHiddenState=v)}_stepGPU(){Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXI,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHI,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentInputGateStatePreactiv,inputs:[{input:this.tempXI,name:'t1'},{input:this.tempHI,name:'t2'},{input:this.weights.b_i,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentInputGateState=this.currentInputGateStatePreactiv:Ph.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentInputGateState,inputs:[{input:this.currentInputGateStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXF,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHF,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentForgetGateStatePreactiv,inputs:[{input:this.tempXF,name:'t1'},{input:this.tempHF,name:'t2'},{input:this.weights.b_f,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentForgetGateState=this.currentForgetGateStatePreactiv:Ph.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentForgetGateState,inputs:[{input:this.currentForgetGateStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXO,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHO,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentOutputGateStatePreactiv,inputs:[{input:this.tempXO,name:'t1'},{input:this.tempHO,name:'t2'},{input:this.weights.b_o,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentOutputGateState=this.currentOutputGateStatePreactiv:Ph.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentOutputGateState,inputs:[{input:this.currentOutputGateStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXC,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHC,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.tempXC,name:'t1'},{input:this.tempHC,name:'t2'},{input:this.weights.b_c,name:'bias'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:Ph.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidateCopy,inputs:[{input:this.currentCandidate,name:'source'}]}),Ph.webgl2.runProgram({program:this.updateProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidateCopy,name:'c'},{input:this.previousCandidate,name:'ctm1'},{input:this.currentInputGateState,name:'i'},{input:this.currentForgetGateState,name:'f'}]}),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousCandidate,inputs:[{input:this.currentCandidate,name:'source'}]}),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.currentCandidate,name:'source'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:Ph.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.gateProductProgram,output:this.currentHiddenState,inputs:[{input:this.currentOutputGateState,name:'t1'},{input:this.currentCandidate,name:'t2'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.weights.b_i.glTextureShape[1],a=this.weights.b_c.glTextureShape[1],r=this.weights.b_f.glTextureShape[1],o=this.weights.b_o.glTextureShape[1];this.currentInputGateState||(this.currentInputGateState=new n.default([],[t]),this.currentInputGateState.createGLTexture({type:'2d',format:'float'})),this.currentInputGateStatePreactiv||(this.currentInputGateStatePreactiv=new n.default([],[t]),this.currentInputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXI||(this.tempXI=new n.default([],[t]),this.tempXI.createGLTexture({type:'2d',format:'float'})),this.tempHI||(this.tempHI=new n.default([],[t]),this.tempHI.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateState||(this.currentForgetGateState=new n.default([],[r]),this.currentForgetGateState.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateStatePreactiv||(this.currentForgetGateStatePreactiv=new n.default([],[r]),this.currentForgetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXF||(this.tempXF=new n.default([],[r]),this.tempXF.createGLTexture({type:'2d',format:'float'})),this.tempHF||(this.tempHF=new n.default([],[r]),this.tempHF.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateState||(this.currentOutputGateState=new n.default([],[o]),this.currentOutputGateState.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateStatePreactiv||(this.currentOutputGateStatePreactiv=new n.default([],[o]),this.currentOutputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXO||(this.tempXO=new n.default([],[o]),this.tempXO.createGLTexture({type:'2d',format:'float'})),this.tempHO||(this.tempHO=new n.default([],[o]),this.tempHO.createGLTexture({type:'2d',format:'float'})),this.currentCandidate||(this.currentCandidate=new n.default([],[a]),this.currentCandidate.createGLTexture({type:'2d',format:'float'})),this.currentCandidateCopy||(this.currentCandidateCopy=new n.default([],[a]),this.currentCandidateCopy.createGLTexture({type:'2d',format:'float'})),this.currentCandidatePreactiv||(this.currentCandidatePreactiv=new n.default([],[a]),this.currentCandidatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXC||(this.tempXC=new n.default([],[a]),this.tempXC.createGLTexture({type:'2d',format:'float'})),this.tempHC||(this.tempHC=new n.default([],[a]),this.tempHC.createGLTexture({type:'2d',format:'float'})),this.previousCandidate&&this.stateful||(this.previousCandidate=new n.default([],[a]),this.previousCandidate.createGLTexture({type:'2d',format:'float'})),this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[a]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[a]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;Ph.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),Ph.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});ge(c_);var h_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(sg),n=a(Bh),i=a(wh),s=a(qh),u=a(Zh),l=r(Eg);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(this,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array'],body:function(e,t,a){e=e*(1-a)+t*a}})}),this.layerClass='GRU';const{units:t=1,activation:a='tanh',use_bias:r=!0,recurrent_activation:n='hard_sigmoid',return_sequences:i=!1,go_backwards:s=!1,stateful:p=!1}=e;this.units=t,this.activation=a,this.recurrentActivation=n,this.activationFunc=o[a],this.recurrentActivationFunc=o[n],this.use_bias=r,this.returnSequences=i,this.goBackwards=s,this.stateful=p,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+='linear'===this.recurrentActivation?'':`, ${this.recurrentActivation} recurrent activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=Ph.webgl2.compileProgram(l[this.activation]),this.recurrentActivationProgram=Ph.webgl2.compileProgram(l[this.recurrentActivation]),this.gateSummationProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.gateProductProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),this.timestepReadProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),this.updateProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D h;\nuniform sampler2D htm1;\nuniform sampler2D z;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(h, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float h_val = texelFetch(h, ivec2(out_x, out_y), 0).r;\n  float htm1_val = texelFetch(htm1, ivec2(out_x, out_y), 0).r;\n  float z_val = texelFetch(z, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(h_val * (float(1.0) - z_val) + htm1_val * z_val);\n}\n'))}setWeights(e){super.setWeights(e);const t=this.weights.kernel.tensor.shape;this.weights.W_z=new n.default([],[t[0],this.units]),this.weights.W_r=new n.default([],[t[0],this.units]),this.weights.W_h=new n.default([],[t[0],this.units]),s.default.assign(this.weights.W_z.tensor,this.weights.kernel.tensor.hi(t[0],this.units).lo(0,0)),s.default.assign(this.weights.W_r.tensor,this.weights.kernel.tensor.hi(t[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.W_h.tensor,this.weights.kernel.tensor.hi(t[0],3*this.units).lo(0,2*this.units));const a=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_z=new n.default([],[a[0],this.units]),this.weights.U_r=new n.default([],[a[0],this.units]),this.weights.U_h=new n.default([],[a[0],this.units]),s.default.assign(this.weights.U_z.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],this.units).lo(0,0)),s.default.assign(this.weights.U_r.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.U_h.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],3*this.units).lo(0,2*this.units)),this.weights.b_z=new n.default([],[this.units]),this.weights.b_r=new n.default([],[this.units]),this.weights.b_h=new n.default([],[this.units]),this.use_bias&&(s.default.assign(this.weights.b_z.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),s.default.assign(this.weights.b_r.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),s.default.assign(this.weights.b_h.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units))),this.gpu){['W_z','W_r','W_h','U_z','U_r','U_h','b_z','b_r','b_h'].forEach((e)=>{this.weights[e].createGLTexture({type:'2d',format:'float'})})}}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.weights.b_z.tensor.shape[0],a=this.weights.b_r.tensor.shape[0],r=this.weights.b_h.tensor.shape[0],o=new n.default([],[t]),u=new n.default([],[t]),l=new n.default([],[t]),i=new n.default([],[a]),p=new n.default([],[a]),d=new n.default([],[a]),c=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[r]),h=new n.default([],[r]),g=new n.default([],[r]),f=new n.default([],[r]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],r]);const m=new n.default([],[e.tensor.shape[1]]),_=()=>{s.default.assign(f.tensor,c.tensor),(0,Rf.gemv)(1,this.weights.W_z.tensor.transpose(1,0),m.tensor,1,u.tensor),(0,Rf.gemv)(1,this.weights.U_z.tensor.transpose(1,0),f.tensor,1,l.tensor),this._combine(o.tensor,u.tensor,l.tensor,this.weights.b_z.tensor),this.recurrentActivationFunc(o),(0,Rf.gemv)(1,this.weights.W_r.tensor.transpose(1,0),m.tensor,1,p.tensor),(0,Rf.gemv)(1,this.weights.U_r.tensor.transpose(1,0),f.tensor,1,d.tensor),this._combine(i.tensor,p.tensor,d.tensor,this.weights.b_r.tensor),this.recurrentActivationFunc(i),s.default.muleq(i.tensor,f.tensor),(0,Rf.gemv)(1,this.weights.W_h.tensor.transpose(1,0),m.tensor,1,h.tensor),(0,Rf.gemv)(1,this.weights.U_h.tensor.transpose(1,0),i.tensor,1,g.tensor),this._combine(c.tensor,h.tensor,g.tensor,this.weights.b_h.tensor),this.activationFunc(c),this._update(c.tensor,f.tensor,o.tensor)};for(let t=0,a=e.tensor.shape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;s.default.assign(m.tensor,e.tensor.pick(r,null));[u,l,p,d,h,g].forEach((e)=>s.default.assigns(e.tensor,0)),_(),this.returnSequences&&s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),c.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:c,this.stateful&&(this.currentHiddenState=c)}_stepGPU(){Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXZ,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHZ,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentUpdateGateStatePreactiv,inputs:[{input:this.tempXZ,name:'t1'},{input:this.tempHZ,name:'t2'},{input:this.weights.b_z,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentUpdateGateState=this.currentUpdateGateStatePreactiv:Ph.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentUpdateGateState,inputs:[{input:this.currentUpdateGateStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXR,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHR,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentResetGateStatePreactiv,inputs:[{input:this.tempXR,name:'t1'},{input:this.tempHR,name:'t2'},{input:this.weights.b_r,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentResetGateState=this.currentResetGateStatePreactiv:Ph.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentResetGateStateCopy,inputs:[{input:this.currentResetGateState,name:'source'}]}),Ph.webgl2.runProgram({program:this.gateProductProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStateCopy,name:'t1'},{input:this.previousHiddenState,name:'t2'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.currentResetGateState,name:'A'},{input:this.weights.U_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),Ph.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.b_h,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:Ph.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]}),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentHiddenStateCopy,inputs:[{input:this.currentHiddenState,name:'source'}]}),Ph.webgl2.runProgram({program:this.updateProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStateCopy,name:'h'},{input:this.previousHiddenState,name:'htm1'},{input:this.currentUpdateGateState,name:'z'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.weights.b_z.glTextureShape[1],a=this.weights.b_r.glTextureShape[1],r=this.weights.b_h.glTextureShape[1];this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[r]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStateCopy||(this.currentHiddenStateCopy=new n.default([],[r]),this.currentHiddenStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[r]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateState||(this.currentUpdateGateState=new n.default([],[t]),this.currentUpdateGateState.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateStatePreactiv||(this.currentUpdateGateStatePreactiv=new n.default([],[t]),this.currentUpdateGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXZ||(this.tempXZ=new n.default([],[t]),this.tempXZ.createGLTexture({type:'2d',format:'float'})),this.tempHZ||(this.tempHZ=new n.default([],[t]),this.tempHZ.createGLTexture({type:'2d',format:'float'})),this.currentResetGateState||(this.currentResetGateState=new n.default([],[a]),this.currentResetGateState.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStateCopy||(this.currentResetGateStateCopy=new n.default([],[a]),this.currentResetGateStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStatePreactiv||(this.currentResetGateStatePreactiv=new n.default([],[a]),this.currentResetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXR||(this.tempXR=new n.default([],[a]),this.tempXR.createGLTexture({type:'2d',format:'float'})),this.tempHR||(this.tempHR=new n.default([],[a]),this.tempHR.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[r]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[r]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[r]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;Ph.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),Ph.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});ge(h_);var g_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'SimpleRNN',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'LSTM',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'GRU',{enumerable:!0,get:function(){return n.default}});var r=a(d_),o=a(c_),n=a(h_)});ge(g_);var f_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(x_);class s extends r.default{constructor(e={}){super(e),this.layerClass='TimeDistributed';const{layer:t}=e;t||this.throwError('wrapped layer is undefined.');const a=Object.assign({},t.config,{gpu:e.gpu});this.wrappedLayer=new i[t.class_name](a),this.wrappedLayer.outbound=[null],this.gpu&&(this.copyTextureProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.mapInputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.selectSliceProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int t;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, t), 0).r);\n}\n'),this.copySliceOutputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform int t;\nuniform int timesteps;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(sliceOutput, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(timesteps) * outTex.y);\n\n  if (t == out_y) {\n    outColor = vec4(texelFetch(sliceOutput, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n'),this.mapSliceOutputProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform isampler2D indexMap;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(outputCopy, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(textureSize(sliceOutput, 0)[0])));\n    int colIndex = int(mod(float(index), float(textureSize(sliceOutput, 0)[0])));\n    float val = texelFetch(sliceOutput, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n'))}setWeights(e){this.wrappedLayer.setWeights(e)}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=[...e.tensor.shape.slice(1)],a=new o.default([],t);n.default.assign(a.tensor,e.tensor.pick(0,...Array(t.length).fill(null)));let r=this.wrappedLayer.call(a);const s=r.tensor.shape.slice();this.output=new o.default([],[e.tensor.shape[0],...s]),n.default.assign(this.output.tensor.pick(0,...Array(s.length).fill(null)),r.tensor);for(let o=1,i=e.tensor.shape[0];o<i;o++)n.default.assign(a.tensor,e.tensor.pick(o,...Array(t.length).fill(null))),r=this.wrappedLayer.call(a),n.default.assign(this.output.tensor.pick(o,...Array(s.length).fill(null)),r.tensor)}_createIndexMap(e){if(!this.indexMaps){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMaps=[];const r=this.inputShape[0],i=this.inputShape.slice(1);for(let e=0;e<r;e++){const t=new o.default([],i,{type:Int32Array});n.default.assign(t.tensor,a.tensor.pick(e,...Array(i.length).fill(null))),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.indexMaps.push(t)}}}_createOutputIndexMap(e){if(!this.outputIndexMaps){const a=new o.default(e.data,e.shape,{type:Int32Array});this.outputIndexMaps=[];const r=this.outputShape[0],i=this.outputShape.slice(1);for(let e=0;e<r;e++){const t=new o.default([],this.outputShape,{type:Int32Array});n.default.assigns(t.tensor,-1),n.default.assign(t.tensor.pick(e,...Array(i.length).fill(null)),a.tensor),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.outputIndexMaps.push(t)}}}_callGPU(e){this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'}))),2<this.inputShape.length&&this._createIndexMap(e.indicesForReshaped);const t=this.inputShape[0],a=this.inputShape.slice(1);this.slice||(this.slice=new o.default([],a),2>=a.length?this.slice.createGLTexture({type:'2d',format:'float'}):(this.slice.reshapeTo2DSquare(),this.slice.createGLTexture({type:'2d',format:'float'}))),2>=this.inputShape.length?Ph.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:0,type:'int',name:'t'}]}):Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[0],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,this.output||(2>=this.inputShape.length?(this.outputShape=[t,this.sliceOutput.glTextureShape[1]],this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'})):(this.outputShape=[t,...this.sliceOutput.originalShape],this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.reshapeTo2DSquare(),this.outputCopy.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'}),this._createOutputIndexMap(this.sliceOutput.indicesForReshaped))),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?Ph.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:0,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):Ph.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[0],name:'indexMap'}]});for(let a=1;a<t;a++)2>=this.inputShape.length?Ph.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:a,type:'int',name:'t'}]}):Ph.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[a],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?Ph.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:a,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):Ph.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[a],name:'indexMap'}]});0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=s});ge(f_);var m_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(wh),o=a(Bh),n=a(qh),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(g_);class s extends r.default{constructor(e={}){super(e),this.layerClass='Bidirectional';const{layer:t,merge_mode:a='concat'}=e;t||this.throwError('wrapped layer is undefined.'),['SimpleRNN','GRU','LSTM'].includes(t.class_name)||this.throwError(`cannot wrap ${t.class_name} layer.`),['concat','sum','mul','ave'].includes(a)||this.throwError(`merge_mode ${a} not supported.`);const r=Object.assign({},t.config,{gpu:e.gpu}),o=Object.assign({},t.config,{gpu:e.gpu});o.go_backwards=!o.go_backwards,this.forwardLayer=new i[t.class_name](r),this.backwardLayer=new i[t.class_name](o),this.forwardLayer.outbound=[null],this.backwardLayer.outbound=[null],this.mergeMode=a,this.returnSequences=t.config.return_sequences,this.gpu&&(this.copyTextureProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),'concat'===this.mergeMode?this.mergeProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0] * 2) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_x >= 0 && out_x < size[0]) {\n    outColor = vec4(texelFetch(forward, ivec2(out_x, out_y), 0).r);\n  } else {\n    outColor = vec4(texelFetch(backward, ivec2(out_x - size[0], size[1] - out_y - 1), 0).r);\n  }\n}\n'):'sum'===this.mergeMode?this.mergeProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val + backward_val);\n}\n'):'mul'===this.mergeMode?this.mergeProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val * backward_val);\n}\n'):'ave'===this.mergeMode&&(this.mergeProgram=Ph.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(0.5 * (forward_val + backward_val));\n}\n')))}setWeights(e){this.forwardLayer.setWeights(e.slice(0,e.length/2)),this.backwardLayer.setWeights(e.slice(e.length/2))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.forwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape)),this.backwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape));const t=this.forwardLayer.output,a=this.backwardLayer.output;this.returnSequences&&(a.tensor=a.tensor.step(-1));const r=t.tensor.shape.slice();'concat'===this.mergeMode&&(r[r.length-1]+=a.tensor.shape[r.length-1]),this.output=new o.default([],r),'concat'===this.mergeMode?this.returnSequences?(n.default.assign(this.output.tensor.hi(r[0],t.tensor.shape[1]).lo(0,0),t.tensor),n.default.assign(this.output.tensor.hi(r[0],r[1]).lo(0,t.tensor.shape[1]),a.tensor)):(n.default.assign(this.output.tensor.hi(t.tensor.shape[0]).lo(0),t.tensor),n.default.assign(this.output.tensor.hi(r[0]).lo(t.tensor.shape[0]),a.tensor)):'sum'===this.mergeMode?(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor)):'mul'===this.mergeMode?(n.default.assigns(this.output.tensor,1),n.default.muleq(this.output.tensor,t.tensor),n.default.muleq(this.output.tensor,a.tensor)):'ave'===this.mergeMode&&(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor),n.default.divseq(this.output.tensor,2))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputCopy||(this.inputCopy=new o.default([],e.glTextureShape),this.inputCopy.createGLTexture({type:'2d',format:'float'})),Ph.webgl2.runProgram({program:this.copyTextureProgram,output:this.inputCopy,inputs:[{input:e,name:'source'}]}),this.forwardLayer._callGPU(e),this.backwardLayer._callGPU(this.inputCopy);const t=this.forwardLayer.output,a=this.backwardLayer.output,r=t.glTextureShape.slice();'concat'===this.mergeMode&&(r[1]+=a.glTextureShape[1]),this.output||(this.output=new o.default([],r),this.output.createGLTexture({type:'2d',format:'float'}),!this.returnSequences&&(this.output.is1D=!0)),Ph.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:t,name:'forward'},{input:a,name:'backward'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=s});ge(m_);var __=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'TimeDistributed',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Bidirectional',{enumerable:!0,get:function(){return o.default}});var r=a(f_),o=a(m_)});ge(__);var x_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0});var a={InputLayer:!0};Object.defineProperty(t,'InputLayer',{enumerable:!0,get:function(){return r.default}});var r=function(e){return e&&e.__esModule?e:{default:e}}(Vh);Object.keys(cg).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return cg[e]}})}),Object.keys($g).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return $g[e]}})}),Object.keys(wm).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return wm[e]}})}),Object.keys(km).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return km[e]}})}),Object.keys(qm).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return qm[e]}})}),Object.keys(Bm).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return Bm[e]}})}),Object.keys(Hm).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return Hm[e]}})}),Object.keys(p_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p_[e]}})}),Object.keys(g_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g_[e]}})}),Object.keys(__).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return __[e]}})})});ge(x_);var y_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Bh),o=a(qh),n=a(Dg),i=a(kg);t.default=class{constructor(e={}){if(this.modelLayersMap=e.modelLayersMap,this.gpu=e.gpu,!this.modelLayersMap)throw new Error(`[CAM] modelLayersMap is required`)}initialize(){if(this.modelLayersMap.forEach((e)=>{'GlobalAveragePooling2D'===e.layerClass&&(this.enabled=!0,this.poolLayer=e)}),this.enabled&&!this.data){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output;let e=this.poolLayer;for(e.outbound.length||(this.weights=this.poolLayer.output);e.outbound.length;)e=this.modelLayersMap.get(e.outbound[0]),this.weights=e.weights.kernel?e.weights.kernel:this.poolLayer.output;if(this.inputShape=this.featureMaps.is2DReshaped?this.featureMaps.originalShape.slice(0,2):this.featureMaps.tensor.shape.slice(0,2),1===this.weights.tensor.shape.length)this.shape=this.inputShape;else{const e=this.weights.tensor.shape[1];this.shape=[...this.inputShape,e]}this.data=new Float32Array(this.shape.reduce((e,t)=>e*t,1))}}update(){if(this.enabled){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output,this.gpu?this._updateGPU():this._updateCPU();const e=o.default.inf(this.output.tensor),t=o.default.sup(this.output.tensor);o.default.divseq(o.default.subseq(this.output.tensor,e),t-e),this.data=this.output.tensor.data}}_updateCPU(){if(this.featureMaps.is2DReshaped||this.featureMaps.reshapeTo2D(),1===this.weights.tensor.shape.length){this.output||(this.output=new r.default([],this.shape));const e=new r.default([],[this.shape[0]*this.shape[1]]);(0,Rf.gemv)(1,this.featureMaps.tensor,this.weights.tensor,1,e.tensor),this.output.replaceTensorData(e.tensor.data)}else this.output||(this.output=new r.default([],this.shape)),this.output.reshapeTo2D(),(0,n.default)(this.output.tensor,this.featureMaps.tensor,this.weights.tensor,1,1),this.output.reshapeFrom2D();o.default.maxseq(this.output.tensor,0),this.featureMaps.is2DReshaped&&this.featureMaps.reshapeFrom2D()}_updateGPU(){this.output||(this.output=new r.default([],this.shape));const e=this.weights.is1D;!this.output.glTexture&&e?this.output.createGLTexture({type:'2d',format:'float'}):(this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'}));const t=e?this.weights.glTextureShape[1]:this.weights.glTextureShape[0];if(!this.program){const a=(0,i.default)('cam',this.output.glTextureShape,t,e);this.program=Ph.webgl2.compileProgram(a)}Ph.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:this.featureMaps,name:'featureMaps'},{input:this.weights,name:'weights'}]}),this.output.transferFromGLTexture(),this.output.is2DReshaped&&this.output.reshapeFrom2D()}}});ge(y_);var v_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'CAM',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(y_)});ge(v_);var b_=ko,S_=fe(function(e,t){var a=t;a.length=function(e){var t=e.length;if(!t)return 0;for(var a=0;1<--t%4&&'='===e.charAt(t);)++a;return yn(3*e.length)/4-a};for(var r=Array(64),o=Array(123),n=0;64>n;)o[r[n]=26>n?n+65:52>n?n+71:62>n?n-4:43|n-59]=n++;a.encode=function(e,a,o){for(var n=null,s=[],u=0,i=0,l,t;a<o;)t=e[a++],0==i?(s[u++]=r[t>>2],l=(3&t)<<4,i=1):1==i?(s[u++]=r[l|t>>4],l=(15&t)<<2,i=2):2==i?(s[u++]=r[l|t>>6],s[u++]=r[63&t],i=0):void 0,8191<u&&((n||(n=[])).push(xn.apply(String,s)),u=0);return i&&(s[u++]=r[l],s[u++]=61,1==i&&(s[u++]=61)),n?(u&&n.push(xn.apply(String,s.slice(0,u))),n.join('')):xn.apply(String,s.slice(0,u))};var s='invalid encoding';a.decode=function(e,a,r){for(var n=r,u=0,l=0,i,t;l<e.length&&(t=e.charCodeAt(l++),!(61===t&&1<u));){if(void 0===(t=o[t]))throw Error(s);0==u?(i=t,u=1):1==u?(a[r++]=i<<2|(48&t)>>4,i=t,u=2):2==u?(a[r++]=(15&i)<<4|(60&t)>>2,i=t,u=3):3==u?(a[r++]=(3&i)<<6|t,u=0):void 0}if(1==u)throw Error(s);return r-n},a.test=function(e){return /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}),T_=Fo;Fo.prototype.on=function(e,t,a){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:a||this}),this},Fo.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var a=this._listeners[e],r=0;r<a.length;)a[r].fn===t?a.splice(r,1):++r;return this},Fo.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var a=[],r=1;r<arguments.length;)a.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,a)}return this};var P_=Mo(Mo),w_=Ao,C_=fe(function(e,t){var a=t;a.length=function(e){for(var t=0,a=0,r=0;r<e.length;++r)a=e.charCodeAt(r),128>a?t+=1:2048>a?t+=2:55296==(64512&a)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},a.read=function(e,a,r){var o=r-a;if(1>o)return'';for(var n=null,s=[],u=0,i;a<r;)i=e[a++],128>i?s[u++]=i:191<i&&224>i?s[u++]=(31&i)<<6|63&e[a++]:239<i&&365>i?(i=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536,s[u++]=55296+(i>>10),s[u++]=56320+(1023&i)):s[u++]=(15&i)<<12|(63&e[a++])<<6|63&e[a++],8191<u&&((n||(n=[])).push(xn.apply(String,s)),u=0);return n?(u&&n.push(xn.apply(String,s.slice(0,u))),n.join('')):xn.apply(String,s.slice(0,u))},a.write=function(e,t,a){for(var r=a,o=0,n,i;o<e.length;++o)n=e.charCodeAt(o),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>6,t[a++]=128|63&n):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,t[a++]=240|n>>18,t[a++]=128|63&n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n):(t[a++]=224|n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n);return a-r}}),k_=Lo,F_=jo,M_=jo.zero=new jo(0,0);M_.toNumber=function(){return 0},M_.zzEncode=M_.zzDecode=function(){return this},M_.length=function(){return 1};var D_=jo.zeroHash='\0\0\0\0\0\0\0\0';jo.fromNumber=function(e){if(0===e)return M_;var t=0>e;t&&(e=-e);var a=e>>>0,r=(e-a)/4294967296>>>0;return t&&(r=~r>>>0,a=~a>>>0,4294967295<++a&&(a=0,4294967295<++r&&(r=0))),new jo(a,r)},jo.from=function(e){if('number'==typeof e)return jo.fromNumber(e);if(E_.isString(e))if(E_.Long)e=E_.Long.fromString(e);else return jo.fromNumber(parseInt(e,10));return e.low||e.high?new jo(e.low>>>0,e.high>>>0):M_},jo.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,a=~this.hi>>>0;return t||(a=a+1>>>0),-(t+4294967296*a)}return this.lo+4294967296*this.hi},jo.prototype.toLong=function(e){return E_.Long?new E_.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var I_=String.prototype.charCodeAt;jo.fromHash=function(e){return e===D_?M_:new jo((I_.call(e,0)|I_.call(e,1)<<8|I_.call(e,2)<<16|I_.call(e,3)<<24)>>>0,(I_.call(e,4)|I_.call(e,5)<<8|I_.call(e,6)<<16|I_.call(e,7)<<24)>>>0)},jo.prototype.toHash=function(){return xn(255&this.lo,255&this.lo>>>8,255&this.lo>>>16,this.lo>>>24,255&this.hi,255&this.hi>>>8,255&this.hi>>>16,this.hi>>>24)},jo.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},jo.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},jo.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,a=this.hi>>>24;return 0==a?0==t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>a?9:10};var E_=fe(function(e,t){function a(e,t,a){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&a||(e[r[o]]=t[r[o]]);return e}function r(e){function t(e,r){return this instanceof t?void(Object.defineProperty(this,'message',{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,'stack',{value:new Error().stack||''}),r&&a(this,r)):new t(e,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,'name',{get:function(){return e}}),t.prototype.toString=function(){return this.name+': '+this.message},t}var o=t;o.asPromise=b_,o.base64=S_,o.EventEmitter=T_,o.float=P_,o.inquire=w_,o.utf8=C_,o.pool=k_,o.LongBits=F_,o.global='undefined'!=typeof window&&window||'undefined'!=typeof Wi&&Wi||'undefined'!=typeof self&&self||Wi,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isNode=!!(o.global.process&&o.global.process.versions&&o.global.process.versions.node),o.isInteger=Number.isInteger||function(e){return'number'==typeof e&&isFinite(e)&&fn(e)===e},o.isString=function(e){return'string'==typeof e||e instanceof String},o.isObject=function(e){return e&&'object'==typeof e},o.isset=o.isSet=function(e,t){var a=e[t];return null!=a&&e.hasOwnProperty(t)&&('object'!=typeof a||0<(Array.isArray(a)?a.length:Object.keys(a).length))},o.Buffer=function(){try{var e=o.inquire('buffer').Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(e){return'number'==typeof e?o.Buffer?o._Buffer_allocUnsafe(e):new o.Array(e):o.Buffer?o._Buffer_from(e):'undefined'==typeof Uint8Array?e:new Uint8Array(e)},o.Array='undefined'==typeof Uint8Array?Array:Uint8Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire('long'),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(e){return e?o.LongBits.from(e).toHash():o.LongBits.zeroHash},o.longFromHash=function(e,t){var a=o.LongBits.fromHash(e);return o.Long?o.Long.fromBits(a.lo,a.hi,t):a.toNumber(!!t)},o.merge=a,o.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},o.newError=r,o.ProtocolError=r('ProtocolError'),o.oneOfGetter=function(e){for(var t={},a=0;a<e.length;++a)t[e[a]]=1;return function(){for(var e=Object.keys(this),a=e.length-1;-1<a;--a)if(1===t[e[a]]&&this[e[a]]!==void 0&&null!==this[e[a]])return e[a]}},o.oneOfSetter=function(e){return function(t){for(var a=0;a<e.length;++a)e[a]!==t&&delete this[e[a]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var e=o.Buffer;return e?void(o._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,a){return new e(t,a)},o._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):void(o._Buffer_from=o._Buffer_allocUnsafe=null)}}),R_=qo,A_=E_.LongBits,L_=E_.base64,j_=E_.utf8,z_;qo.create=E_.Buffer?function(){return(qo.create=function(){return new z_})()}:function(){return new qo},qo.alloc=function(e){return new E_.Array(e)},E_.Array!==Array&&(qo.alloc=E_.pool(qo.alloc,E_.Array.prototype.subarray)),qo.prototype._push=function(e,t,a){return this.tail=this.tail.next=new zo(e,t,a),this.len+=t,this},Bo.prototype=Object.create(zo.prototype),Bo.prototype.fn=No,qo.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Bo(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},qo.prototype.int32=function(e){return 0>e?this._push(Vo,10,A_.fromNumber(e)):this.uint32(e)},qo.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},qo.prototype.uint64=function(e){var t=A_.from(e);return this._push(Vo,t.length(),t)},qo.prototype.int64=qo.prototype.uint64,qo.prototype.sint64=function(e){var t=A_.from(e).zzEncode();return this._push(Vo,t.length(),t)},qo.prototype.bool=function(e){return this._push(Uo,1,e?1:0)},qo.prototype.fixed32=function(e){return this._push(Ho,4,e>>>0)},qo.prototype.sfixed32=qo.prototype.fixed32,qo.prototype.fixed64=function(e){var t=A_.from(e);return this._push(Ho,4,t.lo)._push(Ho,4,t.hi)},qo.prototype.sfixed64=qo.prototype.fixed64,qo.prototype.float=function(e){return this._push(E_.float.writeFloatLE,4,e)},qo.prototype.double=function(e){return this._push(E_.float.writeDoubleLE,8,e)};var G_=E_.Array.prototype.set?function(e,t,a){t.set(e,a)}:function(e,t,a){for(var r=0;r<e.length;++r)t[a+r]=e[r]};qo.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Uo,1,0);if(E_.isString(e)){var a=qo.alloc(t=L_.length(e));L_.decode(e,a,0),e=a}return this.uint32(t)._push(G_,t,e)},qo.prototype.string=function(e){var t=j_.length(e);return t?this.uint32(t)._push(j_.write,t,e):this._push(Uo,1,0)},qo.prototype.fork=function(){return this.states=new Oo(this),this.head=this.tail=new zo(Go,0,0),this.len=0,this},qo.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new zo(Go,0,0),this.len=0),this},qo.prototype.ldelim=function(){var e=this.head,t=this.tail,a=this.len;return this.reset().uint32(a),a&&(this.tail.next=e.next,this.tail=t,this.len+=a),this},qo.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),a=0;e;)e.fn(e.val,t,a),a+=e.len,e=e.next;return t},qo._configure=function(e){z_=e};var O_=Wo;(Wo.prototype=Object.create(R_.prototype)).constructor=Wo;var q_=E_.Buffer;Wo.alloc=function(e){return(Wo.alloc=E_._Buffer_allocUnsafe)(e)};var U_=q_&&q_.prototype instanceof Uint8Array&&'set'===q_.prototype.set.name?function(e,t,a){t.set(e,a)}:function(e,t,a){if(e.copy)e.copy(t,a,0,e.length);else for(var r=0;r<e.length;)t[a++]=e[r++]};Wo.prototype.bytes=function(e){E_.isString(e)&&(e=E_._Buffer_from(e,'base64'));var t=e.length>>>0;return this.uint32(t),t&&this._push(U_,t,e),this},Wo.prototype.string=function(e){var t=q_.byteLength(e);return this.uint32(t),t&&this._push(Xo,t,e),this};var N_=Ko,B_=E_.LongBits,V_=E_.utf8,H_='undefined'==typeof Uint8Array?function(e){if(Array.isArray(e))return new Ko(e);throw Error('illegal buffer')}:function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ko(e);throw Error('illegal buffer')},W_;Ko.create=E_.Buffer?function(e){return(Ko.create=function(e){return E_.Buffer.isBuffer(e)?new W_(e):H_(e)})(e)}:H_,Ko.prototype._slice=E_.Array.prototype.subarray||E_.Array.prototype.slice,Ko.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,$o(this,10);return e}}(),Ko.prototype.int32=function(){return 0|this.uint32()},Ko.prototype.sint32=function(){var e=this.uint32();return 0|e>>>1^-(1&e)},Ko.prototype.bool=function(){return 0!==this.uint32()},Ko.prototype.fixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return Zo(this.buf,this.pos+=4)},Ko.prototype.sfixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return 0|Zo(this.buf,this.pos+=4)},Ko.prototype.float=function(){if(this.pos+4>this.len)throw $o(this,4);var e=E_.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Ko.prototype.double=function(){if(this.pos+8>this.len)throw $o(this,4);var e=E_.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Ko.prototype.bytes=function(){var e=this.uint32(),t=this.pos,a=this.pos+e;if(a>this.len)throw $o(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,a):t===a?new this.buf.constructor(0):this._slice.call(this.buf,t,a)},Ko.prototype.string=function(){var e=this.bytes();return V_.read(e,0,e.length)},Ko.prototype.skip=function(e){if('number'==typeof e){if(this.pos+e>this.len)throw $o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw $o(this);while(128&this.buf[this.pos++]);return this},Ko.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error('invalid wire type '+e+' at offset '+this.pos);}return this},Ko._configure=function(e){W_=e;var t=E_.Long?'toLong':'toNumber';E_.merge(Ko.prototype,{int64:function(){return Qo.call(this)[t](!1)},uint64:function(){return Qo.call(this)[t](!0)},sint64:function(){return Qo.call(this).zzDecode()[t](!1)},fixed64:function(){return Yo.call(this)[t](!0)},sfixed64:function(){return Yo.call(this)[t](!1)}})};var X_=Jo;(Jo.prototype=Object.create(N_.prototype)).constructor=Jo,E_.Buffer&&(Jo.prototype._slice=E_.Buffer.prototype.slice),Jo.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=bn(this.pos+e,this.len))};var $_=en;(en.prototype=Object.create(E_.EventEmitter.prototype)).constructor=en,en.prototype.rpcCall=function e(t,a,r,o,n){if(!o)throw TypeError('request must be specified');var i=this;if(!n)return E_.asPromise(e,i,t,a,r,o);if(!i.rpcImpl)return void setTimeout(function(){n(Error('already ended'))},0);try{return i.rpcImpl(t,a[i.requestDelimited?'encodeDelimited':'encode'](o).finish(),function(e,a){if(e)return i.emit('error',e,t),n(e);if(null===a)return void i.end(!0);if(!(a instanceof r))try{a=r[i.responseDelimited?'decodeDelimited':'decode'](a)}catch(e){return i.emit('error',e,t),n(e)}return i.emit('data',a,t),n(null,a)})}catch(e){return i.emit('error',e,t),void setTimeout(function(){n(e)},0)}},en.prototype.end=function(e){return this.rpcImpl&&(!e&&this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit('end').off()),this};var K_=fe(function(e,t){t.Service=$_}),Q_={},Z_=fe(function(e,t){function a(){r.Reader._configure(r.BufferReader),r.util._configure()}var r=t;r.build='minimal',r.Writer=R_,r.BufferWriter=O_,r.Reader=N_,r.BufferReader=X_,r.util=E_,r.rpc=K_,r.roots=Q_,r.configure=a,r.Writer._configure(r.BufferWriter),a()}),Y_=Z_,J_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=t.Model=t.Weights=void 0;var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Y_);const r=a.Reader,o=a.Writer,n=a.util,s=a.roots['default']||(a.roots['default']={});t.default=s;const i=s.Weights=(()=>{function e(e){if(this.shape=[],e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.layerName='',e.prototype.weightName='',e.prototype.shape=n.emptyArray,e.prototype.type='',e.prototype.data=n.newBuffer([]),e.prototype.quantizeMin=0,e.prototype.quantizeMax=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.layerName&&e.hasOwnProperty('layerName')&&t.uint32(10).string(e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&t.uint32(18).string(e.weightName),null!=e.shape&&e.shape.length){t.uint32(26).fork();for(let a=0;a<e.shape.length;++a)t.uint32(e.shape[a]);t.ldelim()}return null!=e.type&&e.hasOwnProperty('type')&&t.uint32(34).string(e.type),null!=e.data&&e.hasOwnProperty('data')&&t.uint32(42).bytes(e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&t.uint32(53).float(e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&t.uint32(61).float(e.quantizeMax),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));let a=void 0===t?e.len:e.pos+t,o=new s.Weights;for(;e.pos<a;){let t=e.uint32();switch(t>>>3){case 1:o.layerName=e.string();break;case 2:o.weightName=e.string();break;case 3:if(o.shape&&o.shape.length||(o.shape=[]),2==(7&t))for(let t=e.uint32()+e.pos;e.pos<t;)o.shape.push(e.uint32());else o.shape.push(e.uint32());break;case 4:o.type=e.string();break;case 5:o.data=e.bytes();break;case 6:o.quantizeMin=e.float();break;case 7:o.quantizeMax=e.float();break;default:e.skipType(7&t);}}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!=typeof e||null===e)return'object expected';if(null!=e.layerName&&e.hasOwnProperty('layerName')&&!n.isString(e.layerName))return'layerName: string expected';if(null!=e.weightName&&e.hasOwnProperty('weightName')&&!n.isString(e.weightName))return'weightName: string expected';if(null!=e.shape&&e.hasOwnProperty('shape')){if(!Array.isArray(e.shape))return'shape: array expected';for(let t=0;t<e.shape.length;++t)if(!n.isInteger(e.shape[t]))return'shape: integer[] expected'}return null!=e.type&&e.hasOwnProperty('type')&&!n.isString(e.type)?'type: string expected':null!=e.data&&e.hasOwnProperty('data')&&!(e.data&&'number'==typeof e.data.length||n.isString(e.data))?'data: buffer expected':null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&'number'!=typeof e.quantizeMin?'quantizeMin: number expected':null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&'number'!=typeof e.quantizeMax?'quantizeMax: number expected':null},e.fromObject=function(e){if(e instanceof s.Weights)return e;let t=new s.Weights;if(null!=e.layerName&&(t.layerName=e.layerName+''),null!=e.weightName&&(t.weightName=e.weightName+''),e.shape){if(!Array.isArray(e.shape))throw TypeError('.Weights.shape: array expected');t.shape=[];for(let a=0;a<e.shape.length;++a)t.shape[a]=e.shape[a]>>>0}return null!=e.type&&(t.type=e.type+''),null!=e.data&&('string'==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.quantizeMin&&(t.quantizeMin=+e.quantizeMin),null!=e.quantizeMax&&(t.quantizeMax=+e.quantizeMax),t},e.toObject=function(e,t){t||(t={});let a={};if((t.arrays||t.defaults)&&(a.shape=[]),t.defaults&&(a.layerName='',a.weightName='',a.type='',a.data=t.bytes===String?'':[],a.quantizeMin=0,a.quantizeMax=0),null!=e.layerName&&e.hasOwnProperty('layerName')&&(a.layerName=e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&(a.weightName=e.weightName),e.shape&&e.shape.length){a.shape=[];for(let t=0;t<e.shape.length;++t)a.shape[t]=e.shape[t]}return null!=e.type&&e.hasOwnProperty('type')&&(a.type=e.type),null!=e.data&&e.hasOwnProperty('data')&&(a.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&(a.quantizeMin=t.json&&!isFinite(e.quantizeMin)?e.quantizeMin+'':e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&(a.quantizeMax=t.json&&!isFinite(e.quantizeMax)?e.quantizeMax+'':e.quantizeMax),a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e})();t.Weights=i;const u=s.Model=(()=>{function e(e){if(this.modelWeights=[],e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.id='',e.prototype.name='',e.prototype.kerasVersion='',e.prototype.backend='',e.prototype.modelConfig='',e.prototype.modelWeights=n.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.id&&e.hasOwnProperty('id')&&t.uint32(10).string(e.id),null!=e.name&&e.hasOwnProperty('name')&&t.uint32(18).string(e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&t.uint32(26).string(e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&t.uint32(34).string(e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&t.uint32(42).string(e.modelConfig),null!=e.modelWeights&&e.modelWeights.length)for(let a=0;a<e.modelWeights.length;++a)s.Weights.encode(e.modelWeights[a],t.uint32(50).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));let a=void 0===t?e.len:e.pos+t,o=new s.Model;for(;e.pos<a;){let t=e.uint32();switch(t>>>3){case 1:o.id=e.string();break;case 2:o.name=e.string();break;case 3:o.kerasVersion=e.string();break;case 4:o.backend=e.string();break;case 5:o.modelConfig=e.string();break;case 6:o.modelWeights&&o.modelWeights.length||(o.modelWeights=[]),o.modelWeights.push(s.Weights.decode(e,e.uint32()));break;default:e.skipType(7&t);}}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!=typeof e||null===e)return'object expected';if(null!=e.id&&e.hasOwnProperty('id')&&!n.isString(e.id))return'id: string expected';if(null!=e.name&&e.hasOwnProperty('name')&&!n.isString(e.name))return'name: string expected';if(null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&!n.isString(e.kerasVersion))return'kerasVersion: string expected';if(null!=e.backend&&e.hasOwnProperty('backend')&&!n.isString(e.backend))return'backend: string expected';if(null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&!n.isString(e.modelConfig))return'modelConfig: string expected';if(null!=e.modelWeights&&e.hasOwnProperty('modelWeights')){if(!Array.isArray(e.modelWeights))return'modelWeights: array expected';for(let t=0,a;t<e.modelWeights.length;++t)if(a=s.Weights.verify(e.modelWeights[t]),a)return'modelWeights.'+a}return null},e.fromObject=function(e){if(e instanceof s.Model)return e;let t=new s.Model;if(null!=e.id&&(t.id=e.id+''),null!=e.name&&(t.name=e.name+''),null!=e.kerasVersion&&(t.kerasVersion=e.kerasVersion+''),null!=e.backend&&(t.backend=e.backend+''),null!=e.modelConfig&&(t.modelConfig=e.modelConfig+''),e.modelWeights){if(!Array.isArray(e.modelWeights))throw TypeError('.Model.modelWeights: array expected');t.modelWeights=[];for(let a=0;a<e.modelWeights.length;++a){if('object'!=typeof e.modelWeights[a])throw TypeError('.Model.modelWeights: object expected');t.modelWeights[a]=s.Weights.fromObject(e.modelWeights[a])}}return t},e.toObject=function(e,t){t||(t={});let a={};if((t.arrays||t.defaults)&&(a.modelWeights=[]),t.defaults&&(a.id='',a.name='',a.kerasVersion='',a.backend='',a.modelConfig=''),null!=e.id&&e.hasOwnProperty('id')&&(a.id=e.id),null!=e.name&&e.hasOwnProperty('name')&&(a.name=e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&(a.kerasVersion=e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&(a.backend=e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&(a.modelConfig=e.modelConfig),e.modelWeights&&e.modelWeights.length){a.modelWeights=[];for(let r=0;r<e.modelWeights.length;++r)a.modelWeights[r]=s.Weights.toObject(e.modelWeights[r],t)}return a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e})();t.Model=u});ge(J_);var ex={},tx=Object.freeze({default:ex}),ax=tx&&ex||tx,rx=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(wu),n=r($p),i=r(Hd),s=r(Kd),u=r(cc),l=r(qc),p=r(Uc),d=r(bh),c=r(Sh),h=a(x_),g=a(v_),f=r(Bh),m=r(J_);const _=d.default.CancelToken.source();t.default=class{constructor(e={}){const{filepath:t=null,headers:a={},filesystem:r=!1,gpu:o=!1,transferLayerOutputs:n=!1,pauseAfterLayerCalls:i=!1,visualizations:s=[]}=e;if(!t)throw new Error('[Model] path to protobuf-serialized model definition file is missing.');this.filepath=t,this.headers=a,this.filesystem=!('undefined'!=typeof window)&&r,this.events=new Th.EventEmitter,this.id=null,this.name=null,this.kerasVersion=null,this.backend=null,this.modelConfig={},this.modelWeights=[],this.gpu='undefined'!=typeof window&&Ph.webgl2.isSupported&&o,this.transferLayerOutputs=n,this.pauseAfterLayerCalls=i,this.modelLayersInfo=[],this.modelLayersMap=new Map,this.inputTensorsMap=new Map,this.inputLayerNames=[],this.outputLayerNames=[],this.finishedLayerNames=[],this.isRunning=!1,this.runningProgress=0,this.predictStats={},this.visMap=new Map,s.forEach((e)=>{if(e in g){const t=new g[e]({modelLayersMap:this.modelLayersMap,gpu:this.gpu});this.visMap.set(e,t)}}),this._ready=this._initialize()}checkGPUSupport(){return Ph.webgl2.isSupported}ready(){return this._ready}_interrupt(){_.cancel()}async _initialize(){this.events.emit('loadingProgress',0);try{const e=this.filesystem?this._dataRequestFS():this._dataRequestHTTP(this.headers);await e}catch(e){console.log(e),this._interrupt()}this.events.emit('loadingProgress',100),this._buildDAG(),this.inputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);t.call(this.inputTensorsMap.get(e)),t.hasOutput=!0,t.visited=!0});const e=this.pauseAfterLayerCalls;return this.pauseAfterLayerCalls=!0,this.runningProgress=0,this.events.emit('initProgress',0),await this._traverseDAG(this.inputLayerNames,'initProgress'),this.pauseAfterLayerCalls=e,this.finishedLayerNames=[],this.modelLayersMap.forEach((e)=>{e.hasOutput=!1,e.visited=!1}),this.visMap.forEach((e)=>{e.initialize()}),this.events.emit('initProgress',100),!0}async _dataRequestHTTP(e={}){try{const t=await d.default.get(this.filepath,{responseType:'arraybuffer',headers:e,onDownloadProgress:(t)=>{if(t.lengthComputable){const e=vn(100*t.loaded/t.total);this.events.emit('loadingProgress',e)}},cancelToken:_.token});this._decodeProtobuf(new Uint8Array(t.data))}catch(e){if(d.default.isCancel(e))console.log('[Model] Data request canceled',e.message);else throw e}}async _dataRequestFS(){const e=p.default.promisify(ax.readFile);try{const t=await e(this.filepath);this._decodeProtobuf(t)}catch(e){throw e}}_decodeProtobuf(e){const t=m.default.Model.verify(e);if(t)throw new Error(`[Model] Invalid model - check protobuf serialization: {err}`);const a=m.default.Model.decode(e);this.id=a.id,this.name=a.name,this.kerasVersion=a.kerasVersion,this.backend=a.backend,this.modelConfig=JSON.parse(a.modelConfig),this.modelWeights=a.modelWeights}toggleGPU(e){this.gpu='undefined'==typeof e?!this.gpu:e,this.modelLayersMap.forEach((e)=>{e.toggleGPU(this.gpu)}),this.visMap.forEach((e)=>{e.gpu=this.gpu}),this.resetInputTensors()}resetInputTensors(){this.inputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);this.inputTensorsMap.set(e,new f.default([],t.shape))})}_buildDAG(){const e=this.modelConfig.class_name;let t=[];if('Sequential'===e?t=this.modelConfig.config:'Model'===e&&(t=this.modelConfig.config.layers),!(Array.isArray(t)&&t.length))throw new Error('[Model] Model configuration does not contain any layers.');t.forEach((a,r)=>{const o=a.class_name,n=a.config;if('Model'===e&&'Sequential'===o)n.forEach((e,t)=>{const r=e.class_name,o=e.config,i=0===t?a.inbound_nodes[0].map((e)=>e[0]):[n[t-1].config.name];this._createLayer(r,o,i)});else if(!(o in h))throw new Error(`[Model] Layer ${o} specified in model configuration is not implemented!`);else{if('Sequential'===e&&0===r){const e='input',t=n.batch_input_shape.slice(1),a=new h.InputLayer({name:e,shape:t,gpu:this.gpu});this.modelLayersMap.set(e,a),this.inputTensorsMap.set(e,new f.default([],t)),this.inputLayerNames.push(e)}else if('Model'===e&&'InputLayer'===o){const e=n.batch_input_shape.slice(1);this.inputTensorsMap.set(n.name,new f.default([],e)),this.inputLayerNames.push(n.name)}let i=[];if('Sequential'===e)i=0===r?['input']:[t[r-1].config.name];else if('Model'===e){const e=a.inbound_nodes;e&&e.length&&(i=e[0].map((e)=>e[0]))}this._createLayer(o,n,i)}}),this.modelLayersMap.forEach((e)=>{this.modelLayersInfo.push((0,l.default)(e,['name','description','layerClass','inbound','outbound'])),0===e.outbound.length&&this.outputLayerNames.push(e.name)}),this.inputLayerNames.sort(),this.outputLayerNames.sort()}_createLayer(e,t,a){const r=new h[e](Object.assign({},t,{gpu:this.gpu}));let o=[];if('Bidirectional'===e){const e=r.forwardLayer.params.map((e)=>`${t.name}/forward_${t.layer.config.name}/${e}`),a=r.backwardLayer.params.map((e)=>`${t.name}/backward_${t.layer.config.name}/${e}`);o=e.concat(a)}else o='TimeDistributed'===e?r.layer.params.map((e)=>`${t.name}/${e}`):r.params.map((e)=>`${t.name}/${e}`);if(o&&o.length){const e=o.map((e)=>{const t=(0,u.default)(this.modelWeights,(t)=>{const a=new RegExp(`^.*${e}`);return a.test(t.weightName)});if(!t)throw new Error(`[Model] error loading weights.`);const{data:a,shape:r,type:o}=t,n=new ArrayBuffer(a.byteLength),i=new Uint8Array(n);if(i.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),'uint8'===o){const{quantizeMin:e,quantizeMax:a}=t,o=new Float32Array(i);for(let t=0,r=o.length;t<r;t++)o[t]*=(a-e)/255,o[t]+=e;return new f.default(o,r)}return new f.default(new Float32Array(n),r)});r.setWeights(e)}this.modelLayersMap.set(t.name,r),a.forEach((e)=>{this.modelLayersMap.get(t.name).inbound.push(e),this.modelLayersMap.get(e).outbound.push(t.name)})}async _traverseDAG(e,t){if(0===e.length)return this.runningProgress=100,this.events.emit(t,100),!0;if(1===e.length){const a=e[0],r=this.modelLayersMap.get(a);if('InputLayer'===r.layerClass)this.finishedLayerNames.push(this.modelLayersMap.get(a).name);else{const e=this.modelLayersMap.get(a);if(e.visited)return!1;const t=e.inbound.map((e)=>this.modelLayersMap.get(e));if(!(0,s.default)((0,i.default)(t,'hasOutput')))return!1;e.isMergeLayer?e.call((0,i.default)(t,'output')):e.call(t[0].output),e.hasOutput=!0,e.visited=!0,this.finishedLayerNames.push(e.name),this.pauseAfterLayerCalls&&(await p.default.delay(0))}this.runningProgress+=100/this.modelLayersMap.size,this.events.emit(t,this.runningProgress),await this._traverseDAG(r.outbound,t)}else await p.default.all(e.map((e)=>this._traverseDAG([e],t)))}_maybeTransferIntermediateOutputs(){this.gpu&&this.transferLayerOutputs&&this.modelLayersMap.forEach((e)=>{e.output&&e.output.glTexture&&(Ph.webgl2.bindOutputTexture(e.output.glTexture,e.output.glTextureShape),e.output.transferFromGLTexture(),e.output.is2DReshaped&&e.output.reshapeFrom2D())})}loadData(e){this.inputLayerNames.forEach((t)=>{const a=this.modelLayersMap.get(t);this.inputTensorsMap.get(t).replaceTensorData(e[t]),a.call(this.inputTensorsMap.get(t)),a.hasOutput=!0,a.visited=!0})}async predict(e){if(this.isRunning=!0,this.runningProgress=0,this.events.emit('predictProgress',0),!(0,n.default)((0,o.default)(e).sort(),this.inputLayerNames))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the keys are the named inputs of the model: '+JSON.stringify(this.inputLayerNames));if(!(0,s.default)(this.inputLayerNames,(t)=>e[t]instanceof Float32Array))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the values are the flattened data as Float32Array.');this.finishedLayerNames=[],this.modelLayersMap.forEach((e)=>{e.hasOutput=!1,e.visited=!1});let t=(0,c.default)();this.loadData(e),this.predictStats.loadData=(0,c.default)()-t,t=(0,c.default)(),await this._traverseDAG(this.inputLayerNames,'predictProgress'),this.predictStats.forwardPass=(0,c.default)()-t,this._maybeTransferIntermediateOutputs();const a=this.modelConfig.class_name,r={};if('Sequential'===a){const e=this.modelLayersMap.get(this.outputLayerNames[0]);r.output=e.output.tensor.data}else'Model'===a&&this.outputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);r[e]=t.output.tensor.data});return t=(0,c.default)(),this.visMap.forEach((e)=>{e.update()}),this.predictStats.visualizations=(0,c.default)()-t,this.isRunning=!1,this.events.emit('predictProgress',100),r}layerCall(e,t){if(!this.modelLayersMap.has(e))return;let a=t instanceof f.default?t:new f.default(t.data,t.shape);const r=this.modelLayersMap.get(e);return r.call(a)}cleanup(){Ph.webgl2.clearRefs(),this.modelLayersMap.clear(),this.inputTensorsMap.clear(),this.visMap.clear(),delete this.modelWeights}}});ge(rx);var ox=Yi.isFinite,nx=tn,ix=1/0,sx=an,ux=Zh({args:['array','scalar','index'],body:function(e,t,a){var r=t,o;for(o=0;o<a.length-1;++o)r=r[a[o]];r[a[a.length-1]]=e}}),lx=function(e){var t=gm(e.shape);return ux(e,t),t},px=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.approxEquals=function(e,t,s=1e-4){const u=(0,o.default)((0,n.default)(e)),a=t;if(u.length!==a.length)return!1;for(let o=0;o<u.length;o++){if(!(0,r.default)(u[o]))return!1;if(u[o]<a[o]-s||u[o]>a[o]+s)return!1}return!0};var r=a(nx),o=a(sx),n=a(lx)});ge(px);var dx=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Model',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Tensor',{enumerable:!0,get:function(){return n.default}}),t.testUtils=t.layers=t.activations=t.default=t.GPU_SUPPORT=void 0;var o=r(rx),n=r(Bh),i=a(sg);t.activations=i;var s=a(x_);t.layers=s;var u=a(px);t.testUtils=u;const l=Ph.webgl2.isSupported;t.GPU_SUPPORT=l;const p={Model:o.default,Tensor:n.default,GPU_SUPPORT:l,activations:i,layers:s,testUtils:u};t.default=p}),cx=ge(dx),hx=function(e,t,a,r){return new(a||(a=Promise))(function(o,n){function i(e){try{u(r.next(e))}catch(t){n(t)}}function s(e){try{u(r['throw'](e))}catch(t){n(t)}}function u(e){e.done?o(e.value):new a(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})},gx=!1;try{gx='[object process]'===Object.prototype.toString.call(global.process)}catch(t){}var fx=r('MODEL_PATH')||'/dist/model.bin',mx=new cx.Model({filepath:gx?__dirname+'/model.bin':fx,gpu:!1,filesystem:gx});(function(e){e[e.TD=0]='TD',e[e.IHS=1]='IHS',e[e.HS=2]='HS',e[e.TU=3]='TU',e[e.DT=4]='DT',e[e.DB=5]='DB'})(e.AvailablePatterns||(e.AvailablePatterns={}));class _x extends Rn{}_x.predictPattern=nn,_x.hasDoubleBottom=sn,_x.hasDoubleTop=un,_x.hasHeadAndShoulder=ln,_x.hasInverseHeadAndShoulder=pn,_x.isTrendingUp=dn,_x.isTrendingDown=cn;let xx=hn();e.getAvailableIndicators=hn,e.AvailableIndicators=xx,e.FixedSizeLinkedList=Fn,e.CandleData=Mn,e.CandleList=Dn,e.sma=n,e.SMA=An,e.ema=i,e.EMA=Ln,e.wma=s,e.WMA=jn,e.wema=u,e.WEMA=zn,e.macd=l,e.MACD=Gn,e.rsi=c,e.RSI=Un,e.bollingerbands=g,e.BollingerBands=Bn,e.adx=_,e.ADX=Kn,e.atr=x,e.ATR=Qn,e.truerange=m,e.TrueRange=Xn,e.roc=y,e.ROC=Zn,e.kst=v,e.KST=Yn,e.psar=b,e.PSAR=Jn,e.stochastic=S,e.Stochastic=ei,e.williamsr=T,e.WilliamsR=ti,e.adl=P,e.ADL=ai,e.obv=w,e.OBV=ri,e.trix=C,e.TRIX=oi,e.forceindex=k,e.ForceIndex=ni,e.cci=F,e.CCI=ii,e.awesomeoscillator=M,e.AwesomeOscillator=si,e.vwap=D,e.VWAP=ui,e.volumeprofile=R,e.VolumeProfile=li,e.mfi=L,e.MFI=di,e.stochasticrsi=j,e.StochasticRSI=ci,e.averagegain=p,e.AverageGain=On,e.averageloss=d,e.AverageLoss=qn,e.sd=h,e.SD=Nn,e.highest=z,e.Highest=hi,e.lowest=G,e.Lowest=gi,e.sum=O,e.Sum=fi,e.renko=q,e.HeikinAshi=_i,e.heikinashi=U,e.bullish=Y,e.bearish=ie,e.abandonedbaby=se,e.doji=W,e.bearishengulfingpattern=J,e.bullishengulfingpattern=B,e.darkcloudcover=ue,e.downsidetasukigap=$,e.dragonflydoji=le,e.gravestonedoji=pe,e.bullishharami=V,e.bearishharami=ee,e.bullishharamicross=H,e.bearishharamicross=te,e.eveningdojistar=ae,e.eveningstar=re,e.morningdojistar=X,e.morningstar=N,e.bullishmarubozu=K,e.bearishmarubozu=oe,e.piercingline=Q,e.bullishspinningtop=de,e.bearishspinningtop=ce,e.threeblackcrows=ne,e.threewhitesoldiers=Z,e.fibonacciretracement=he,e.predictPattern=nn,e.PatternDetector=_x,e.hasDoubleBottom=sn,e.hasDoubleTop=un,e.hasHeadAndShoulder=ln,e.hasInverseHeadAndShoulder=pn,e.isTrendingUp=dn,e.isTrendingDown=cn,e.setConfig=a,e.getConfig=r})(this.window=this.window||{},window);
//# sourceMappingURL=browser.es6.js.map

(function(e,t){'use strict';function a(e,t){Gn[e]=t}function r(e){return Gn[e]}function o(e){var t=r('precision');return t?parseFloat(e.toPrecision(t)):e}function n(e){qn.reverseInputs(e);var t=new Bn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function i(e){qn.reverseInputs(e);var t=new Vn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function u(e){qn.reverseInputs(e);var t=new Hn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function s(e){qn.reverseInputs(e);var t=new Wn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function l(e){qn.reverseInputs(e);var t=new $n(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function p(e){qn.reverseInputs(e);var t=new Qn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function d(e){qn.reverseInputs(e);var t=new Yn(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function c(e){qn.reverseInputs(e);var t=new ei(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function g(e){qn.reverseInputs(e);var t=new ai(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function h(e){qn.reverseInputs(e);var t=new ni(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function f(e){qn.reverseInputs(e);var t=new ii(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function m(e){qn.reverseInputs(e);var t=new ci(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function _(e){qn.reverseInputs(e);var t=new fi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function y(e){qn.reverseInputs(e);var t=new _i(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function x(e){qn.reverseInputs(e);var t=new xi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function v(e){qn.reverseInputs(e);var t=new bi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function b(e){qn.reverseInputs(e);var t=new Pi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function S(e){qn.reverseInputs(e);var t=new wi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function P(e){qn.reverseInputs(e);var t=new Ci(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function T(e){qn.reverseInputs(e);var t=new Mi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function w(e){qn.reverseInputs(e);var t=new Ii(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function k(e){qn.reverseInputs(e);var t=new Ei(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function C(e){qn.reverseInputs(e);var t=new Li(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function F(e){qn.reverseInputs(e);var t=new ji(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function M(e){qn.reverseInputs(e);var t=new Gi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function D(e){qn.reverseInputs(e);var t=new qi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function I(e,t,a,r){return e<=a&&t>=a||a<=e&&r>=e}function R(e){qn.reverseInputs(e);var t=new Bi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function A(e){qn.reverseInputs(e);var t=new Hi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function L(e){qn.reverseInputs(e);var t=new Xi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function O(e){qn.reverseInputs(e);var t=new Ki(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function j(e){qn.reverseInputs(e);var t=new Zi(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function z(e){qn.reverseInputs(e);var t=new Ji(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function G(e){qn.reverseInputs(e);var t=new tu(e).result;return e.reversedInput&&t.reverse(),qn.reverseInputs(e),t}function U(e){qn.reverseInputs(e);var t=new ru(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),qn.reverseInputs(e),t}function q(e){qn.reverseInputs(e);var t=new nu(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),qn.reverseInputs(e),t}function N(e){return new uu().hasPattern(e)}function B(e){return new su().hasPattern(e)}function V(e){return new lu().hasPattern(e)}function H(e){return new pu().hasPattern(e)}function W(e){return new du().hasPattern(e)}function X(e){return new cu().hasPattern(e)}function $(e){return new gu().hasPattern(e)}function K(e){return new hu().hasPattern(e)}function Q(e){return new fu().hasPattern(e)}function Z(e){return new mu().hasPattern(e)}function Y(e){return new yu().hasPattern(e)}function J(e){return new xu().hasPattern(e)}function ee(e){return new vu().hasPattern(e)}function te(e){return new bu().hasPattern(e)}function ae(e){return new Su().hasPattern(e)}function re(e){return new Pu().hasPattern(e)}function oe(e){return new Tu().hasPattern(e)}function ne(e){return new wu().hasPattern(e)}function ie(e){return new Cu().hasPattern(e)}function ue(e){return new Fu().hasPattern(e)}function se(e){return new Mu().hasPattern(e)}function le(e){return new Du().hasPattern(e)}function pe(e){return new Iu().hasPattern(e)}function de(e){return new Ru().hasPattern(e)}function ce(e){return new Eu().hasPattern(e)}function ge(e,t){var a=[0,23.6,38.2,50,61.8,78.6,100,127.2,161.8,261.8,423.6],r;return r=e<t?a.map(function(a){var r=t-Pn(e-t)*a/100;return 0<r?r:0}):a.map(function(a){var r=t+Pn(e-t)*a/100;return 0<r?r:0}),r}function he(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e['default']:e}function fe(e,t){return t={exports:{}},e(t,t.exports),t.exports}function me(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}function _e(e){var t=Vu.call(e,Wu),a=e[Wu];try{e[Wu]=void 0}catch(t){}var r=Hu.call(e);return t?e[Wu]=a:delete e[Wu],r}function ye(e){return Ku.call(e)}function xe(e){return null==e?void 0===e?Yu:Zu:Ju&&Ju in Object(e)?Xu(e):Qu(e)}function ve(e){return null!=e&&'object'==('undefined'==typeof e?'undefined':kn(e))}function be(e){return ts(e)&&es(e)==as}function Se(){return!1}function Pe(e,t){return t=null==t?gs:t,!!t&&('number'==typeof e||hs.test(e))&&-1<e&&0==e%1&&e<t}function Te(e){return'number'==typeof e&&-1<e&&0==e%1&&e<=ms}function we(e){return ts(e)&&_s(e.length)&&!!Ns[es(e)]}function ke(e){return function(t){return e(t)}}function Ce(e,t){var a=ps(e),r=!a&&ss(e),o=!a&&!r&&cs(e),n=!a&&!r&&!o&&$s(e),i=a||r||o||n,u=i?Lu(e.length,String):[],s=u.length;for(var l in e)(t||Qs.call(e,l))&&!(i&&('length'==l||o&&('offset'==l||'parent'==l)||n&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||fs(l,s)))&&u.push(l);return u}function Fe(e){var t=e&&e.constructor,a='function'==typeof t&&t.prototype||Ys;return e===a}function Me(e,t){return function(a){return e(t(a))}}function De(e){if(!Js(e))return al(e);var t=[];for(var a in Object(e))ol.call(e,a)&&'constructor'!=a&&t.push(a);return t}function Ie(e){var t='undefined'==typeof e?'undefined':kn(e);return null!=e&&('object'==t||'function'==t)}function Re(e){if(!il(e))return!1;var t=es(e);return t==sl||t==ll||t==ul||t==pl}function Ee(e){return null!=e&&_s(e.length)&&!dl(e)}function Ae(e){return cl(e)?Zs(e):nl(e)}function Le(){this.__data__=[],this.size=0}function Oe(e,t){return e===t||e!==e&&t!==t}function je(e,t){for(var a=e.length;a--;)if(fl(e[a][0],t))return a;return-1}function ze(e){var t=this.__data__,a=ml(t,e);if(0>a)return!1;var r=t.length-1;return a==r?t.pop():yl.call(t,a,1),--this.size,!0}function Ge(e){var t=this.__data__,a=ml(t,e);return 0>a?void 0:t[a][1]}function Ue(e){return-1<ml(this.__data__,e)}function qe(e,t){var a=this.__data__,r=ml(a,e);return 0>r?(++this.size,a.push([e,t])):a[r][1]=t,this}function Ne(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function Be(){this.__data__=new Pl,this.size=0}function Ve(e){var t=this.__data__,a=t['delete'](e);return this.size=t.size,a}function He(e){return this.__data__.get(e)}function We(e){return this.__data__.has(e)}function Xe(e){return!!Dl&&Dl in e}function $e(e){if(null!=e){try{return El.call(e)}catch(t){}try{return e+''}catch(t){}}return''}function Ke(e){if(!il(e)||Il(e))return!1;var t=dl(e)?ql:Ol;return t.test(Al(e))}function Qe(e,t){return null==e?void 0:e[t]}function Ze(e,t){var a=Bl(e,t);return Nl(a)?a:void 0}function Ye(){this.__data__=$l?$l(null):{},this.size=0}function Je(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function et(e){var t=this.__data__;if($l){var a=t[e];return a===Zl?void 0:a}return Jl.call(t,e)?t[e]:void 0}function tt(e){var t=this.__data__;return $l?t[e]!==void 0:ap.call(t,e)}function at(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=$l&&void 0===t?op:t,this}function rt(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ot(){this.size=0,this.__data__={hash:new ip,map:new(Wl||Pl),string:new ip}}function nt(e){var t='undefined'==typeof e?'undefined':kn(e);return'string'==t||'number'==t||'symbol'==t||'boolean'==t?'__proto__'!==e:null===e}function it(e,t){var a=e.__data__;return sp(t)?a['string'==typeof t?'string':'hash']:a.map}function ut(e){var t=lp(this,e)['delete'](e);return this.size-=t?1:0,t}function st(e){return lp(this,e).get(e)}function lt(e){return lp(this,e).has(e)}function pt(e,t){var a=lp(this,e),r=a.size;return a.set(e,t),this.size+=a.size==r?0:1,this}function dt(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ct(e,t){var a=this.__data__;if(a instanceof Pl){var r=a.__data__;if(!Wl||r.length<fp-1)return r.push([e,t]),this.size=++a.size,this;a=this.__data__=new hp(r)}return a.set(e,t),this.size=a.size,this}function gt(e){var t=this.__data__=new Pl(e);this.size=t.size}function ht(e){return this.__data__.set(e,yp),this}function ft(e){return this.__data__.has(e)}function mt(e){var t=-1,a=null==e?0:e.length;for(this.__data__=new hp;++t<a;)this.add(e[t])}function _t(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(t(e[a],a,e))return!0;return!1}function yt(e,t){return e.has(t)}function xt(e,t,a,r,o,n){var i=a&Tp,u=e.length,s=t.length;if(u!=s&&!(i&&s>u))return!1;var l=n.get(e);if(l&&n.get(t))return l==t;var p=-1,d=!0,c=a&wp?new bp:void 0;for(n.set(e,t),n.set(t,e);++p<u;){var g=e[p],h=t[p];if(r)var f=i?r(h,g,p,t,e,n):r(g,h,p,e,t,n);if(void 0!==f){if(f)continue;d=!1;break}if(c){if(!Sp(t,function(e,t){if(!Pp(c,t)&&(g===e||o(g,e,a,r,n)))return c.push(t)})){d=!1;break}}else if(!(g===h||o(g,h,a,r,n))){d=!1;break}}return n['delete'](e),n['delete'](t),d}function vt(e){var t=-1,a=Array(e.size);return e.forEach(function(e,r){a[++t]=[r,e]}),a}function bt(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=e}),a}function St(e,t,a,r,o,n,i){switch(a){case Bp:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Np:return e.byteLength==t.byteLength&&n(new Fp(e),new Fp(t));case Ep:case Ap:case jp:return fl(+e,+t);case Lp:return e.name==t.name&&e.message==t.message;case zp:case Up:return e==t+'';case Op:var u=Mp;case Gp:var s=r&Ip;if(u||(u=Dp),e.size!=t.size&&!s)return!1;var l=i.get(e);if(l)return l==t;r|=Rp,i.set(e,t);var p=kp(u(e),u(t),r,o,n,i);return i['delete'](e),p;case qp:if(Hp)return Hp.call(e)==Hp.call(t);}return!1}function Pt(e,t){for(var a=-1,r=t.length,o=e.length;++a<r;)e[o+a]=t[a];return e}function Tt(e,t,a){var r=t(e);return ps(e)?r:Xp(r,a(e))}function wt(e,t){for(var a=-1,r=null==e?0:e.length,o=0,n=[];++a<r;){var i=e[a];t(i,a,e)&&(n[o++]=i)}return n}function kt(){return[]}function Ct(e){return $p(e,gl,td)}function Ft(e,t,a,r,o,n){var i=a&rd,u=ad(e),s=u.length,l=ad(t),p=l.length;if(s!=p&&!i)return!1;for(var d=s,c;d--;)if(c=u[d],i?!(c in t):!nd.call(t,c))return!1;var g=n.get(e);if(g&&n.get(t))return g==t;var h=!0;n.set(e,t),n.set(t,e);for(var f=i;++d<s;){c=u[d];var m=e[c],_=t[c];if(r)var y=i?r(_,m,c,t,e,n):r(m,_,c,e,t,n);if(void 0===y?!(m===_||o(m,_,a,r,n)):!y){h=!1;break}f||(f='constructor'==c)}if(h&&!f){var x=e.constructor,v=t.constructor;x!=v&&'constructor'in e&&'constructor'in t&&!('function'==typeof x&&x instanceof x&&'function'==typeof v&&v instanceof v)&&(h=!1)}return n['delete'](e),n['delete'](t),h}function Mt(e,t,a,r,o,n){var i=ps(e),u=ps(t),s=i?Dd:Cd(e),l=u?Dd:Cd(t);s=s==Md?Id:s,l=l==Md?Id:l;var p=s==Id,d=l==Id,c=s==l;if(c&&cs(e)){if(!cs(t))return!1;i=!0,p=!1}if(c&&!p)return n||(n=new _p),i||$s(e)?kp(e,t,a,r,o,n):Wp(e,t,s,a,r,o,n);if(!(a&Fd)){var g=p&&Ed.call(e,'__wrapped__'),h=d&&Ed.call(t,'__wrapped__');if(g||h){var f=g?e.value():e,m=h?t.value():t;return n||(n=new _p),o(f,m,a,r,n)}}return!!c&&(n||(n=new _p),id(e,t,a,r,o,n))}function Dt(e,t,a,r,o){return!(e!==t)||(null!=e&&null!=t&&(ts(e)||ts(t))?Ad(e,t,a,r,Dt,o):e!==e&&t!==t)}function It(e,t){return Ld(e,t)}function Rt(e,t){for(var a=-1,r=null==e?0:e.length,o=Array(r);++a<r;)o[a]=t(e[a],a,e);return o}function Et(e,t,a,r){var o=a.length,n=o,i=!r;if(null==e)return!n;for(e=Object(e);o--;){var u=a[o];if(i&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<n;){u=a[o];var s=u[0],l=e[s],p=u[1];if(!(i&&u[2])){var d=new _p;if(r)var c=r(l,p,s,e,t,d);if(void 0===c?!Ld(p,l,zd|Gd,r,d):!c)return!1}else if(void 0===l&&!(s in e))return!1}return!0}function At(e){return e===e&&!il(e)}function Lt(e){for(var t=gl(e),a=t.length;a--;){var r=t[a],o=e[r];t[a]=[r,o,qd(o)]}return t}function Ot(e,t){return function(a){return null!=a&&a[e]===t&&(t!==void 0||e in Object(a))}}function jt(e){var t=Nd(e);return 1==t.length&&t[0][2]?Bd(t[0][0],t[0][1]):function(a){return a===e||Ud(a,e,t)}}function zt(e){return'symbol'==('undefined'==typeof e?'undefined':kn(e))||ts(e)&&es(e)==Hd}function Gt(e,t){if(ps(e))return!1;var a='undefined'==typeof e?'undefined':kn(e);return'number'==a||'symbol'==a||'boolean'==a||null==e||Wd(e)||$d.test(e)||!Xd.test(e)||null!=t&&e in Object(t)}function Ut(e,t){if('function'!=typeof e||null!=t&&'function'!=typeof t)throw new TypeError(Qd);var a=function a(){var r=arguments,o=t?t.apply(this,r):r[0],n=a.cache;if(n.has(o))return n.get(o);var i=e.apply(this,r);return a.cache=n.set(o,i)||n,i};return a.cache=new(Ut.Cache||hp),a}function qt(e){var t=Zd(e,function(e){return a.size===Yd&&a.clear(),e}),a=t.cache;return t}function Nt(e){if('string'==typeof e)return e;if(ps(e))return jd(e,Nt)+'';if(Wd(e))return uc?uc.call(e):'';var t=e+'';return'0'==t&&1/e==-nc?'-0':t}function Bt(e){return null==e?'':sc(e)}function Vt(e,t){return ps(e)?e:Kd(e,t)?[e]:oc(lc(e))}function Ht(e){if('string'==typeof e||Wd(e))return e;var t=e+'';return'0'==t&&1/e==-dc?'-0':t}function Wt(e,t){t=pc(t,e);for(var a=0,r=t.length;null!=e&&a<r;)e=e[cc(t[a++])];return a&&a==r?e:void 0}function Xt(e,t,a){var r=null==e?void 0:gc(e,t);return r===void 0?a:r}function $t(e,t){return null!=e&&t in Object(e)}function Kt(e,t,a){t=pc(t,e);for(var r=-1,o=t.length,n=!1,i;++r<o&&(i=cc(t[r]),!!(n=null!=e&&a(e,i)));)e=e[i];return n||++r!=o?n:(o=null==e?0:e.length,!!o&&_s(o)&&fs(i,o)&&(ps(e)||ss(e)))}function Qt(e,t){return null!=e&&mc(e,t,fc)}function Zt(e,t){return Kd(e)&&qd(t)?Bd(cc(e),t):function(a){var r=hc(a,e);return r===void 0&&r===t?_c(a,e):Ld(t,r,yc|xc)}}function Yt(e){return e}function Jt(e){return function(t){return null==t?void 0:t[e]}}function ea(e){return function(t){return gc(t,e)}}function ta(e){return Kd(e)?Sc(cc(e)):Pc(e)}function aa(e){return'function'==typeof e?e:null==e?bc:'object'==('undefined'==typeof e?'undefined':kn(e))?ps(e)?vc(e[0],e[1]):Vd(e):Tc(e)}function ra(e){return function(t,a,r){for(var o=-1,n=Object(t),i=r(t),u=i.length;u--;){var s=i[e?u:++o];if(!1===a(n[s],s,n))break}return t}}function oa(e,t){return e&&Fc(e,t,gl)}function na(e,t){return function(a,r){if(null==a)return a;if(!cl(a))return e(a,r);for(var o=a.length,n=t?o:-1,i=Object(a);(t?n--:++n<o)&&!(!1===r(i[n],n,i)););return a}}function ia(e,t){var a=-1,r=cl(e)?Array(e.length):[];return Rc(e,function(e,o,n){r[++a]=t(e,o,n)}),r}function ua(e,t){var a=ps(e)?jd:Ec;return a(e,wc(t,3))}function sa(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(!t(e[a],a,e))return!1;return!0}function la(e,t){var a=!0;return Rc(e,function(e,r,o){return a=!!t(e,r,o),a}),a}function pa(e,t,a){if(!il(a))return!1;var r='undefined'==typeof t?'undefined':kn(t);return!('number'==r?!(cl(a)&&fs(t,a.length)):!('string'==r&&t in a))&&fl(a[t],e)}function da(e,t,a){var r=ps(e)?Lc:Oc;return a&&jc(e,t,a)&&(t=void 0),r(e,wc(t,3))}function ca(e){return function(t,a,r){var o=Object(t);if(!cl(t)){var n=wc(a,3);t=gl(t),a=function(e){return n(o[e],e,o)}}var i=e(t,a,r);return-1<i?o[n?t[i]:i]:void 0}}function ga(e,t,a,r){for(var o=e.length,n=a+(r?1:-1);r?n--:++n<o;)if(t(e[n],n,e))return n;return-1}function ha(e){if('number'==typeof e)return e;if(Wd(e))return qc;if(il(e)){var t='function'==typeof e.valueOf?e.valueOf():e;e=il(t)?t+'':t}if('string'!=typeof e)return 0===e?e:+e;e=e.replace(Nc,'');var a=Vc.test(e);return a||Hc.test(e)?Wc(e.slice(2),a?2:8):Bc.test(e)?qc:+e}function fa(e){if(!e)return 0===e?e:0;if(e=Xc(e),e===$c||e===-$c){var t=0>e?-1:1;return t*Kc}return e===e?e:0}function ma(e){var t=Qc(e),a=t%1;return t===t?a?t-a:t:0}function _a(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var o=null==a?0:Zc(a);return 0>o&&(o=Yc(r+o,0)),Uc(e,wc(t,3),o)}function ya(e,t,a){'__proto__'==t&&rg?rg(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function xa(e,t,a){var r=e[t];ig.call(e,t)&&fl(r,a)&&(a!==void 0||t in e)||og(e,t,a)}function va(e,t,a,r){if(!il(e))return e;t=pc(t,e);for(var o=-1,n=t.length,i=e;null!=i&&++o<n;){var u=cc(t[o]),s=a;if(o!=n-1){var l=i[u];s=r?r(l,u,i):void 0,s===void 0&&(s=il(l)?l:fs(t[o+1])?[]:{})}ug(i,u,s),i=i[u]}return e}function ba(e,t,a){for(var r=-1,o=t.length,n={};++r<o;){var i=t[r],u=gc(e,i);a(u,i)&&sg(n,pc(i,e),u)}return n}function Sa(e,t){return lg(e,t,function(t,a){return _c(e,a)})}function Pa(e){return ps(e)||ss(e)||!!(dg&&e&&e[dg])}function Ta(e,t,a,r,o){var n=-1,i=e.length;for(a||(a=cg),o||(o=[]);++n<i;){var u=e[n];0<t&&a(u)?1<t?Ta(u,t-1,a,r,o):Xp(o,u):!r&&(o[o.length]=u)}return o}function wa(e){var t=null==e?0:e.length;return t?gg(e,1):[]}function ka(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2]);}return e.apply(t,a)}function Ca(e,t,a){return t=mg(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,n=mg(r.length-t,0),i=Array(n);++o<n;)i[o]=r[t+o];o=-1;for(var u=Array(t+1);++o<t;)u[o]=r[o];return u[t]=a(i),fg(e,this,u)}}function Fa(e){return function(){return e}}function Ma(e){var t=0,a=0;return function(){var r=Pg(),o=Sg-(r-a);if(a=r,!(0<o))t=0;else if(++t>=bg)return arguments[0];return e.apply(void 0,arguments)}}function Da(e){return kg(_g(e,void 0,hg),e+'')}function Ia(e){return!!e.constructor&&'function'==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Ra(e){return'function'==typeof e.readFloatLE&&'function'==typeof e.slice&&Ia(e.slice(0,0))}function Ea(e){return'[object Array]'===Eg.call(e)}function Aa(e){return'[object ArrayBuffer]'===Eg.call(e)}function La(e){return'undefined'!=typeof FormData&&e instanceof FormData}function Oa(e){var t;return t='undefined'!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer,t}function ja(e){return'string'==typeof e}function za(e){return'number'==typeof e}function Ga(e){return'undefined'==typeof e}function Ua(e){return null!==e&&'object'===('undefined'==typeof e?'undefined':kn(e))}function qa(e){return'[object Date]'===Eg.call(e)}function Na(e){return'[object File]'===Eg.call(e)}function Ba(e){return'[object Blob]'===Eg.call(e)}function Va(e){return'[object Function]'===Eg.call(e)}function Ha(e){return Ua(e)&&Va(e.pipe)}function Wa(e){return'undefined'!=typeof URLSearchParams&&e instanceof URLSearchParams}function Xa(e){return e.replace(/^\s*/,'').replace(/\s*$/,'')}function $a(){return'undefined'!=typeof navigator&&'ReactNative'===navigator.product?!1:'undefined'!=typeof window&&'undefined'!=typeof document}function Ka(e,t){if(null!==e&&'undefined'!=typeof e)if('object'!==('undefined'==typeof e?'undefined':kn(e))&&(e=[e]),Ea(e))for(var a=0,r=e.length;a<r;a++)t.call(null,e[a],a,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function Qa(){function e(e,a){t[a]='object'===kn(t[a])&&'object'===('undefined'==typeof e?'undefined':kn(e))?Qa(t[a],e):e}for(var t={},a=0,r=arguments.length;a<r;a++)Ka(arguments[a],e);return t}function Za(e,t,a){return Ka(t,function(t,r){e[r]=a&&'function'==typeof t?Ig(t,a):t}),e}function Ya(e){return encodeURIComponent(e).replace(/%40/gi,'@').replace(/%3A/gi,':').replace(/%24/g,'$').replace(/%2C/gi,',').replace(/%20/g,'+').replace(/%5B/gi,'[').replace(/%5D/gi,']')}function Ja(){this.message='String contains an invalid character'}function E(e){for(var t=e+'',a='',r=0,o=Bg,n,i;t.charAt(0|r)||(o='=',r%1);a+=o.charAt(63&n>>8-8*(r%1))){if(i=t.charCodeAt(r+=3/4),255<i)throw new Ja;n=n<<8|i}return a}function er(e,t){!Ag.isUndefined(e)&&Ag.isUndefined(e['Content-Type'])&&(e['Content-Type']=t)}function tr(){var e;return'undefined'==typeof XMLHttpRequest?'undefined'!=typeof process&&(e=Xg):e=Xg,e}function ar(){this.handlers=[]}function rr(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function or(e){this.defaults=e,this.interceptors={request:new Zg,response:new Zg}}function nr(e){this.message=e}function ir(e){if('function'!=typeof e)throw new TypeError('executor must be a function.');var t;this.promise=new Promise(function(e){t=e});var a=this;e(function(e){a.reason||(a.reason=new oh(e),t(a.reason))})}function ur(e){var t=new rh(e),a=Ig(rh.prototype.request,t);return Ag.extend(a,rh.prototype,t),Ag.extend(a,t),a}function sr(e,t,a,r){for(var o=-1,n=mh(fh((t-e)/(a||1)),0),i=Array(n);n--;)i[r?n:++o]=e,e+=a;return i}function lr(e){return function(t,a,r){return r&&'number'!=typeof r&&jc(t,a,r)&&(a=r=void 0),t=Qc(t),void 0===a?(a=t,t=0):a=Qc(a),r=void 0===r?t<a?1:-1:Qc(r),_h(t,a,r,e)}}function pr(e){for(var t=Array(e),a=0;a<e;++a)t[a]=a;return t}function dr(e,t){return e[0]-t[0]}function cr(){var e=this.stride,t=Array(e.length),a;for(a=0;a<t.length;++a)t[a]=[Pn(e[a]),a];t.sort(dr);var r=Array(t.length);for(a=0;a<r.length;++a)r[a]=t[a][1];return r}function gr(e,t){var a=['View',t,'d',e].join('');0>t&&(a='View_Nil'+e);var r='generic'===e;if(-1===t){var o='function '+a+'(a){this.data=a;};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new '+a+'(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_'+a+'(a){return new '+a+'(a);}',n=new Function(o);return n()}if(0===t){var o='function '+a+'(a,d) {this.data = a;this.offset = d};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function '+a+'_copy() {return new '+a+'(this.data,this.offset)};proto.pick=function '+a+'_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function '+a+'_get(){return '+(r?'this.data.get(this.offset)':'this.data[this.offset]')+'};proto.set=function '+a+'_set(v){return '+(r?'this.data.set(this.offset,v)':'this.data[this.offset]=v')+'};return function construct_'+a+'(a,b,c,d){return new '+a+'(a,d)}',n=new Function('TrivialArray',o);return n(Ph[e][0])}var o=['\'use strict\''],u=bh(t),s=u.map(function(e){return'i'+e}),l='this.offset+'+u.map(function(e){return'this.stride['+e+']*i'+e}).join('+'),p=u.map(function(e){return'b'+e}).join(','),d=u.map(function(e){return'c'+e}).join(',');o.push('function '+a+'(a,'+p+','+d+',d){this.data=a','this.shape=['+p+']','this.stride=['+d+']','this.offset=d|0}','var proto='+a+'.prototype','proto.dtype=\''+e+'\'','proto.dimension='+t),o.push('Object.defineProperty(proto,\'size\',{get:function '+a+'_size(){return '+u.map(function(e){return'this.shape['+e+']'}).join('*'),'}})'),1===t?o.push('proto.order=[0]'):(o.push('Object.defineProperty(proto,\'order\',{get:'),4>t?(o.push('function '+a+'_order(){'),2===t?o.push('return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})'):3===t&&o.push('var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})')):o.push('ORDER})')),o.push('proto.set=function '+a+'_set('+s.join(',')+',v){'),r?o.push('return this.data.set('+l+',v)}'):o.push('return this.data['+l+']=v}'),o.push('proto.get=function '+a+'_get('+s.join(',')+'){'),r?o.push('return this.data.get('+l+')}'):o.push('return this.data['+l+']}'),o.push('proto.index=function '+a+'_index(',s.join(),'){return '+l+'}'),o.push('proto.hi=function '+a+'_hi('+s.join(',')+'){return new '+a+'(this.data,'+u.map(function(e){return['(typeof i',e,'!==\'number\'||i',e,'<0)?this.shape[',e,']:i',e,'|0'].join('')}).join(',')+','+u.map(function(e){return'this.stride['+e+']'}).join(',')+',this.offset)}');var c=u.map(function(e){return'a'+e+'=this.shape['+e+']'}),g=u.map(function(e){return'c'+e+'=this.stride['+e+']'});o.push('proto.lo=function '+a+'_lo('+s.join(',')+'){var b=this.offset,d=0,'+c.join(',')+','+g.join(','));for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'&&i'+h+'>=0){d=i'+h+'|0;b+=c'+h+'*d;a'+h+'-=d}');o.push('return new '+a+'(this.data,'+u.map(function(e){return'a'+e}).join(',')+','+u.map(function(e){return'c'+e}).join(',')+',b)}'),o.push('proto.step=function '+a+'_step('+s.join(',')+'){var '+u.map(function(e){return'a'+e+'=this.shape['+e+']'}).join(',')+','+u.map(function(e){return'b'+e+'=this.stride['+e+']'}).join(',')+',c=this.offset,d=0,ceil=Math.ceil');for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'){d=i'+h+'|0;if(d<0){c+=b'+h+'*(a'+h+'-1);a'+h+'=ceil(-a'+h+'/d)}else{a'+h+'=ceil(a'+h+'/d)}b'+h+'*=d}');o.push('return new '+a+'(this.data,'+u.map(function(e){return'a'+e}).join(',')+','+u.map(function(e){return'b'+e}).join(',')+',c)}');for(var i=Array(t),f=Array(t),h=0;h<t;++h)i[h]='a[i'+h+']',f[h]='b[i'+h+']';o.push('proto.transpose=function '+a+'_transpose('+s+'){'+s.map(function(e,t){return e+'=('+e+'===undefined?'+t+':'+e+'|0)'}).join(';'),'var a=this.shape,b=this.stride;return new '+a+'(this.data,'+i.join(',')+','+f.join(',')+',this.offset)}'),o.push('proto.pick=function '+a+'_pick('+s+'){var a=[],b=[],c=this.offset');for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'&&i'+h+'>=0){c=(c+this.stride['+h+']*i'+h+')|0}else{a.push(this.shape['+h+']);b.push(this.stride['+h+'])}');o.push('var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}'),o.push('return function construct_'+a+'(data,shape,stride,offset){return new '+a+'(data,'+u.map(function(e){return'shape['+e+']'}).join(',')+','+u.map(function(e){return'stride['+e+']'}).join(',')+',offset)}');var n=new Function('CTOR_LIST','ORDER',o.join('\n'));return n(Ph[e],cr)}function hr(e){if(Rg(e))return'buffer';if(Sh)switch(Object.prototype.toString.call(e)){case'[object Float64Array]':return'float64';case'[object Float32Array]':return'float32';case'[object Int8Array]':return'int8';case'[object Int16Array]':return'int16';case'[object Int32Array]':return'int32';case'[object Uint8Array]':return'uint8';case'[object Uint16Array]':return'uint16';case'[object Uint32Array]':return'uint32';case'[object Uint8ClampedArray]':return'uint8_clamped';}return Array.isArray(e)?'array':'generic'}function fr(e,t,a,r){if(e===void 0){var o=Ph.array[0];return o([])}'number'==typeof e&&(e=[e]);t===void 0&&(t=[e.length]);var n=t.length;if(a===void 0){a=Array(n);for(var u=n-1,i=1;0<=u;--u)a[u]=i,i*=t[u]}if(void 0===r){r=0;for(var u=0;u<n;++u)0>a[u]&&(r-=(t[u]-1)*a[u])}for(var s=hr(e),l=Ph[s];l.length<=n+1;)l.push(gr(s,l.length-1));var o=l[n+1];return o(e,t,a,r)}function mr(e,t){for(var r=1,o=e.length,n=e[0],a=e[0],u=1;u<o;++u)if(a=n,n=e[u],t(n,a)){if(u===r){r++;continue}e[r++]=n}return e.length=r,e}function _r(e){for(var t=1,r=e.length,o=e[0],a=e[0],n=1;n<r;++n,a=o)if(a=o,o=e[n],o!==a){if(n===t){t++;continue}e[t++]=o}return e.length=t,e}function yr(e,t,a){return 0===e.length?e:t?(a||e.sort(t),mr(e,t)):(a||e.sort(),_r(e))}function xr(e,t,a){var r=e.length,o=t.arrayArgs.length,n=0<t.indexArgs.length,u=[],s=[],l=0,p=0,d,i;for(d=0;d<r;++d)s.push(['i',d,'=0'].join(''));for(i=0;i<o;++i)for(d=0;d<r;++d)p=l,l=e[d],0===d?s.push(['d',i,'s',d,'=t',i,'p',l].join('')):s.push(['d',i,'s',d,'=(t',i,'p',l,'-s',p,'*t',i,'p',p,')'].join(''));for(0<s.length&&u.push('var '+s.join(',')),d=r-1;0<=d;--d)l=e[d],u.push(['for(i',d,'=0;i',d,'<s',l,';++i',d,'){'].join(''));for(u.push(a),d=0;d<r;++d){for(p=l,l=e[d],i=0;i<o;++i)u.push(['p',i,'+=d',i,'s',d].join(''));n&&(0<d&&u.push(['index[',p,']-=s',p].join('')),u.push(['++index[',l,']'].join(''))),u.push('}')}return u.join('\n')}function vr(e,t,a,r){for(var o=t.length,n=a.arrayArgs.length,u=a.blockSize,s=0<a.indexArgs.length,l=[],p=0;p<n;++p)l.push(['var offset',p,'=p',p].join(''));for(var p=e;p<o;++p)l.push(['for(var j'+p+'=SS[',t[p],']|0;j',p,'>0;){'].join('')),l.push(['if(j',p,'<',u,'){'].join('')),l.push(['s',t[p],'=j',p].join('')),l.push(['j',p,'=0'].join('')),l.push(['}else{s',t[p],'=',u].join('')),l.push(['j',p,'-=',u,'}'].join('')),s&&l.push(['index[',t[p],']=j',p].join(''));for(var p=0,i;p<n;++p){i=['offset'+p];for(var d=e;d<o;++d)i.push(['j',d,'*t',p,'p',t[d]].join(''));l.push(['p',p,'=(',i.join('+'),')'].join(''))}l.push(xr(t,a,r));for(var p=e;p<o;++p)l.push('}');return l.join('\n')}function br(e){for(var t=0,a=e[0].length;t<a;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}function Sr(e,t,a){for(var r=e.body,o=[],n=[],u=0,i;u<e.args.length;++u)if(i=e.args[u],!(0>=i.count)){var s=new RegExp(i.name,'g'),l='',p=t.arrayArgs.indexOf(u);switch(t.argTypes[u]){case'offset':var d=t.offsetArgIndex.indexOf(u),c=t.offsetArgs[d];p=c.array,l='+q'+d;case'array':l='p'+p+l;var g='l'+u,h='a'+p;if(0===t.arrayBlockIndices[p])1===i.count?'generic'===a[p]?i.lvalue?(o.push(['var ',g,'=',h,'.get(',l,')'].join('')),r=r.replace(s,g),n.push([h,'.set(',l,',',g,')'].join(''))):r=r.replace(s,[h,'.get(',l,')'].join('')):r=r.replace(s,[h,'[',l,']'].join('')):'generic'===a[p]?(o.push(['var ',g,'=',h,'.get(',l,')'].join('')),r=r.replace(s,g),i.lvalue&&n.push([h,'.set(',l,',',g,')'].join(''))):(o.push(['var ',g,'=',h,'[',l,']'].join('')),r=r.replace(s,g),i.lvalue&&n.push([h,'[',l,']=',g].join('')));else{for(var f=[i.name],m=[l],_=0;_<Pn(t.arrayBlockIndices[p]);_++)f.push('\\s*\\[([^\\]]+)\\]'),m.push('$'+(_+1)+'*t'+p+'b'+_);if(s=new RegExp(f.join(''),'g'),l=m.join('+'),'generic'===a[p])throw new Error('cwise: Generic arrays not supported in combination with blocks!');else r=r.replace(s,[h,'[',l,']'].join(''))}break;case'scalar':r=r.replace(s,'Y'+t.scalarArgs.indexOf(u));break;case'index':r=r.replace(s,'index');break;case'shape':r=r.replace(s,'shape');}}return[o.join('\n'),r,n.join('\n')].join('\n').trim()}function Pr(e){for(var a=Array(e.length),r=!0,o=0;o<e.length;++o){var n=e[o],t=n.match(/\d+/);t=t?t[0]:'',a[o]=0===n.charAt(0)?'u'+n.charAt(1)+t:n.charAt(0)+t,0<o&&(r=r&&a[o]===a[o-1])}return r?a[0]:a.join('')}function Tr(e,t){for(var a=0|t[1].length-Pn(e.arrayBlockIndices[0]),r=Array(e.arrayArgs.length),o=Array(e.arrayArgs.length),n=0;n<e.arrayArgs.length;++n)o[n]=t[2*n],r[n]=t[2*n+1];for(var i=[],u=[],s=[],l=[],p=[],n=0;n<e.arrayArgs.length;++n){0>e.arrayBlockIndices[n]?(s.push(0),l.push(a),i.push(a),u.push(a+e.arrayBlockIndices[n])):(s.push(e.arrayBlockIndices[n]),l.push(e.arrayBlockIndices[n]+a),i.push(0),u.push(e.arrayBlockIndices[n]));for(var d=[],c=0;c<r[n].length;c++)s[n]<=r[n][c]&&r[n][c]<l[n]&&d.push(r[n][c]-s[n]);p.push(d)}for(var g=['SS'],h=['\'use strict\''],m=[],c=0;c<a;++c)m.push(['s',c,'=SS[',c,']'].join(''));for(var n=0;n<e.arrayArgs.length;++n){g.push('a'+n),g.push('t'+n),g.push('p'+n);for(var c=0;c<a;++c)m.push(['t',n,'p',c,'=t',n,'[',s[n]+c,']'].join(''));for(var c=0;c<Pn(e.arrayBlockIndices[n]);++c)m.push(['t',n,'b',c,'=t',n,'[',i[n]+c,']'].join(''))}for(var n=0;n<e.scalarArgs.length;++n)g.push('Y'+n);if(0<e.shapeArgs.length&&m.push('shape=SS.slice(0)'),0<e.indexArgs.length){for(var _=Array(a),n=0;n<a;++n)_[n]='0';m.push(['index=[',_.join(','),']'].join(''))}for(var n=0;n<e.offsetArgs.length;++n){for(var y=e.offsetArgs[n],x=[],c=0;c<y.offset.length;++c)if(0===y.offset[c])continue;else 1===y.offset[c]?x.push(['t',y.array,'p',c].join('')):x.push([y.offset[c],'*t',y.array,'p',c].join(''));0===x.length?m.push('q'+n+'=0'):m.push(['q',n,'=',x.join('+')].join(''))}var v=wh([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));m=m.concat(v),0<m.length&&h.push('var '+m.join(','));for(var n=0;n<e.arrayArgs.length;++n)h.push('p'+n+'|=0');3<e.pre.body.length&&h.push(Sr(e.pre,e,o));var b=Sr(e.body,e,o),S=br(p);S<a?h.push(vr(S,p[0],e,b)):h.push(xr(p[0],e,b)),3<e.post.body.length&&h.push(Sr(e.post,e,o)),e.debug&&console.log('-----Generated cwise routine for ',t,':\n'+h.join('\n')+'\n----------');var P=[e.funcName||'unnamed','_cwise_loop_',r[0].join('s'),'m',S,Pr(o)].join(''),T=new Function(['function ',P,'(',g.join(','),'){',h.join('\n'),'} return ',P].join(''));return T()}function wr(e){var t=['\'use strict\'','var CACHED={}'],a=[],r=e.funcName+'_cwise_thunk';t.push(['return function ',r,'(',e.shimArgs.join(','),'){'].join(''));for(var o=[],n=[],u=[['array',e.arrayArgs[0],'.shape.slice(',Sn(0,e.arrayBlockIndices[0]),0>e.arrayBlockIndices[0]?','+e.arrayBlockIndices[0]+')':')'].join('')],s=[],l=[],p=0,i;p<e.arrayArgs.length;++p)i=e.arrayArgs[p],a.push(['t',i,'=array',i,'.dtype,','r',i,'=array',i,'.order'].join('')),o.push('t'+i),o.push('r'+i),n.push('t'+i),n.push('r'+i+'.join()'),u.push('array'+i+'.data'),u.push('array'+i+'.stride'),u.push('array'+i+'.offset|0'),0<p&&(s.push('array'+e.arrayArgs[0]+'.shape.length===array'+i+'.shape.length+'+(Pn(e.arrayBlockIndices[0])-Pn(e.arrayBlockIndices[p]))),l.push('array'+e.arrayArgs[0]+'.shape[shapeIndex+'+Sn(0,e.arrayBlockIndices[0])+']===array'+i+'.shape[shapeIndex+'+Sn(0,e.arrayBlockIndices[p])+']'));1<e.arrayArgs.length&&(t.push('if (!('+s.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same dimensionality!\')'),t.push('for(var shapeIndex=array'+e.arrayArgs[0]+'.shape.length-'+Pn(e.arrayBlockIndices[0])+'; shapeIndex-->0;) {'),t.push('if (!('+l.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same shape!\')'),t.push('}'));for(var p=0;p<e.scalarArgs.length;++p)u.push('scalar'+e.scalarArgs[p]);a.push(['type=[',n.join(','),'].join()'].join('')),a.push('proc=CACHED[type]'),t.push('var '+a.join(',')),t.push(['if(!proc){','CACHED[type]=proc=compile([',o.join(','),'])}','return proc(',u.join(','),')}'].join('')),e.debug&&console.log('-----Generated thunk:\n'+t.join('\n')+'\n----------');var d=new Function('compile',t.join('\n'));return d(kh.bind(void 0,e))}function kr(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName='',this.pre=null,this.body=null,this.post=null,this.debug=!1}function Cr(e){var t=new kr;t.pre=e.pre,t.body=e.body,t.post=e.post;var a=e.args.slice(0);t.argTypes=a;for(var r=0,o;r<a.length;++r)if(o=a[r],'array'===o||'object'===('undefined'==typeof o?'undefined':kn(o))&&o.blockIndices){if(t.argTypes[r]='array',t.arrayArgs.push(r),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push('array'+r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array args');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array args')}else if('scalar'===o)t.scalarArgs.push(r),t.shimArgs.push('scalar'+r);else if('index'===o){if(t.indexArgs.push(r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array index');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array index');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array index')}else if('shape'===o){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error('cwise: pre() block may not write to array shape');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array shape');if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error('cwise: post() block may not write to array shape')}else if('object'===('undefined'==typeof o?'undefined':kn(o))&&o.offset)t.argTypes[r]='offset',t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(r);else throw new Error('cwise: Unknown argument type '+a[r]);if(0>=t.arrayArgs.length)throw new Error('cwise: No array arguments specified');if(t.pre.args.length>a.length)throw new Error('cwise: Too many arguments in pre() block');if(t.body.args.length>a.length)throw new Error('cwise: Too many arguments in body() block');if(t.post.args.length>a.length)throw new Error('cwise: Too many arguments in post() block');return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||'cwise',t.blockSize=e.blockSize||64,Ch(t)}function Fr(e,t){var a=[],r=[],o;if(t!==void 0&&!Array.isArray(t))throw new Error('axes must be an Array list of dimensions to squeeze');for(o=0;o<e.shape.length;o++)(1!==e.shape[o]||void 0!==t&&-1===t.indexOf(o))&&(a.push(e.shape[o]),r.push(e.stride[o]));return Th(e.data,a,r,e.offset)}function Mr(e,t,a){this.name=e,this.lvalue=t,this.rvalue=a,this.count=0}function Dr(e,t,a,r){this.body=e,this.args=t,this.thisVars=a,this.localVars=r}function Ir(e){if('eval'===e)throw new Error('cwise-parser: eval() not allowed');return'undefined'==typeof window?'undefined'==typeof Au?'undefined'!=typeof self&&e in self:e in Au:e in window}function Rr(e){for(var t=e.body[0].expression.callee.params,a=Array(t.length),r=0;r<t.length;++r)a[r]=t[r].name;return a}function Er(e){function t(e){var t=p+e.replace(/\_/g,'__');return n.push(t),t}function a(e){var t='this_'+e.replace(/\_/g,'__');return f.push(t),t}function r(e,t){for(var a=e.range[0],r=e.range[1],o=a+1;o<r;++o)h[o]='';h[a]=t}function o(e){return'\''+e.replace(/\_/g,'\\_').replace(/\'/g,'\'')+'\''}function u(e){return'AssignmentExpression'===e.parent.type&&e.parent.left===e?'='===e.parent.operator?m:m|_:'UpdateExpression'===e.parent.type?m|_:_}for(var s=['(',e,')()'].join(''),l=Lh.parse(s,{range:!0}),p='_inline_'+Oh++ +'_',d=Rr(l),c=Array(d.length),g=0;g<d.length;++g)c[g]=new Mr([p,'arg',g,'_'].join(''),!1,!1);for(var h=Array(s.length),g=0,i=s.length;g<i;++g)h[g]=s.charAt(g);var n=[],f=[],m=1,_=2;(function e(s,l){if(s.parent=l,'MemberExpression'===s.type)s.computed?(e(s.object,s),e(s.property,s)):'ThisExpression'===s.object.type?r(s,a(s.property.name)):e(s.object,s);else if('ThisExpression'===s.type)throw new Error('cwise-parser: Computed this is not allowed');else if('Identifier'===s.type){var p=s.name,g=d.indexOf(p);if(0<=g){var h=c[g],f=u(s);f&m&&(h.lvalue=!0),f&_&&(h.rvalue=!0),++h.count,r(s,h.name)}else if(Ir(p));else r(s,t(p))}else if('Literal'===s.type)'string'==typeof s.value&&r(s,o(s.value));else if('WithStatement'===s.type)throw new Error('cwise-parser: with() statements not allowed');else for(var y=Object.keys(s),x=0,i=y.length;x<i;++x)if('parent'!==y[x]){var n=s[y[x]];if(n)if(n instanceof Array)for(var v=0;v<n.length;++v)n[v]&&'string'==typeof n[v].type&&e(n[v],s);else'string'==typeof n.type&&e(n,s)}})(l.body[0].expression.callee.body,void 0),wh(n),wh(f);var y=new Dr(function(e){return h.slice(e.range[0],e.range[1]).join('')}(l.body[0].expression.callee.body),c,f,n);return y}function Ar(e){for(var t in e)0>zh.indexOf(t)&&0>Gh.indexOf(t)&&console.warn('cwise: Unknown argument \''+t+'\' passed to expression compiler');for(var a=0;a<zh.length;++a)if(!e[zh[a]])throw new Error('cwise: Missing argument: '+zh[a]);return Fh({args:e.args,pre:jh(e.pre||function(){}),body:jh(e.body),post:jh(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||'cwise',blockSize:e.blockSize||64})}function Lr(e,t,a){var r=-1,o=e.length;0>t&&(t=-t>o?0:o+t),a=a>o?o:a,0>a&&(a+=o),o=t>a?0:a-t>>>0,t>>>=0;for(var n=Array(o);++r<o;)n[r]=e[r+t];return n}function Or(e,t,a){return e&&e.length?(t=a||void 0===t?1:Zc(t),of(e,0,0>t?0:t)):[]}function jr(e,t){for(var a=-1,r=e.length,o;++a<r;){var n=t(e[a]);n!==void 0&&(o=o==void 0?n:o+n)}return o}function zr(e){return e&&e.length?uf(e,bc):0}function Gr(e,t){return'native'===t[1]?[e,'d0=',e,'.length,',e,'d1=',e,'[0].length,'].join(''):[e,'d0=',e,'.shape[0],',e,'d1=',e,'.shape[1],',e,'s0=',e,'.stride[0],',e,'s1=',e,'.stride[1],',e,'o=',e,'.offset,',e,'d=',e,'.data,'].join('')}function Ur(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]&&(r?i.push('var ',t,'p=',t,'[',r,'];'):i.push('var ',t,'p=',t,'[0];')):r&&o?n?i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',n,',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):r?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0;'):o?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',t,'d',e[0],',',t,'p=',t,'o;'),i}function qr(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]&&1===r&&n.push(t,'p=',t,'[',o,'+1]'):n.push(t,'p+=',t,'t',r,';'),n}function Nr(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]?i.push(t,'p[',o,']=',n,';'):i.push(t,'[',r,'][',o,']=',n,';'):'generic'===a[1]?i.push(t,'d.set(',t,'p,',n,');'):i.push(t,'d[',t,'p]=',n,';'),i}function Br(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]?n.push(t,'p[',o,']'):n.push(t,'[',r,'][',o,']'):'generic'===a[1]?n.push(t,'d.get(',t,'p)'):n.push(t,'d[',t,'p]'),n.join('')}function Vr(e,t,a,r,o){var n=[],i='r'===e[0]?[1,0]:[0,1],u=[1,0],s=[0,1],l=['i','j'];return n.push.apply(n,Ur(i,'o',e)),i[1]?(n.push('for(j=0;j<od1;++j){'),n.push('for(i=0;i<od0;++i){')):(n.push('for(i=0;i<od0;++i){'),n.push('for(j=0;j<od1;++j){')),n.push.apply(n,Ur(u,'a',t,'i')),n.push.apply(n,Ur(s,'b',a,void 0,'j')),n.push('var r=0.0;','for(k=0;k<ad1;++k){','r+=',Br(u,'a',t,'i','k'),'*',Br(s,'b',a,'k','j'),';'),n.push.apply(n,qr(u,'a',t,0,'k')),n.push.apply(n,qr(s,'b',a,0,'k')),n.push('}'),r&&n.push('r*=A;'),o&&n.push('r+=B*',Br(i,'o',e,'i','j'),';'),n.push.apply(n,Nr(i,'o',e,'i','j','r')),n.push.apply(n,qr(i,'o',e,0,l[1])),n.push('}'),n.push.apply(n,qr(i,'o',e,1,l[0])),n.push('}'),n}function Hr(e,t){var a=[],r='r'===e[0]?[1,0]:[0,1],o;return t&&a.push('if(B!==1.0){'),a.push.apply(a,Ur(r,'o',e)),r[0]?(a.push('for(i=0;i<od0;++i){for(j=0;j<od1;++j){'),o=['i','j']):(a.push('for(j=0;j<od1;++j){for(i=0;i<od0;++i){'),o=['j','i']),t?a.push.apply(a,Nr(r,'o',e,'i','j','B*'+Br(r,'o',e,'i','j'))):a.push.apply(a,Nr(r,'o',e,'i','j','0')),a.push.apply(a,qr(r,'o',e,0,o[1])),a.push('}'),a.push.apply(a,qr(r,'o',e,1,o[0])),a.push('}'),t&&a.push('}'),a}function Wr(e,t,a,r,o){var n=[],u=['od0','od1','ad1'],s=[1,0],l=[1,0],p=[0,1];n.push.apply(n,Hr(e,o));for(var d=0;3>d;++d)n.push('for(var i',d,'=',u[d],';i',d,'>0;){','var w',d,'=',xf,';','if(i',d,'<',xf,'){','w',d,'=i',d,';','i',d,'=0;','}else{','i',d,'-=',xf,';','}');n.push.apply(n,Ur(s,'o',e,'i0','i1','w1')),n.push('for(i=0;i<w0;++i){for(j=0;j<w1;++j){var r=0.0;'),n.push.apply(n,Ur(l,'a',t,'(i0+i)','i2')),n.push.apply(n,Ur(p,'b',a,'i2','(i1+j)')),n.push('for(k=0;k<w2;++k){'),n.push('r+=',Br(l,'a',t,'(i0+i)','(i2+k)'),'*',Br(p,'b',a,'(i2+k)','(i1+j)'),';'),n.push.apply(n,qr(l,'a',t,0,'(i2+k)')),n.push.apply(n,qr(p,'b',a,0,'(i2+k)')),n.push('}');var i='r';return r&&(i='A*r'),n.push.apply(n,Nr(s,'o',e,'(i0+i)','(i1+j)',i+'+'+Br(s,'o',e,'(i0+i)','(i1+j)'))),n.push.apply(n,qr(s,'o',e,0,'(i1+j)')),n.push('}'),n.push.apply(n,qr(s,'o',e,1,'(i0+i)')),n.push('}}}}'),n}function Xr(e,t,a,r,o){var n=['gemm',e[0],e[1],'a',t[0],t[1],'b',a[0],a[1],r?'alpha':'',o?'beta':''].join(''),i=['function ',n,'(o,a,b,A,B){','var ',Gr('o',e),Gr('a',t),Gr('b',a),'i,j,k;'];'r'===t[0]&&'c'===a[0]?i.push.apply(i,Vr(e,t,a,r,o)):i.push.apply(i,Wr(e,t,a,r,o)),i.push('}return ',n);var u=new Function(i.join(''));return u()}function $r(e){return Array.isArray(e)?[e.length,e[0].length]:e.shape}function Kr(e,t,a){var r=$r(e),o=$r(t),n=$r(a);if(r[0]!==o[0]||r[1]!==n[1]||o[1]!==n[0])throw new Error('Mismatched array shapes for matrix product')}function Qr(e){if(Array.isArray(e)){if(Array.isArray(e))return['r','native'];}else if(e.shape&&2===e.shape.length)return e.order[0]?['r',e.dtype]:['c',e.dtype];throw new Error('Unrecognized data type')}function Zr(e,t,a,r,o){void 0===r&&(r=1),void 0===o&&(o=0);var n=1!==r,i=0!==o,u=Qr(e),s=Qr(t),l=Qr(a);Kr(e,t,a);var p=[u,s,l,n,i].join(':'),d=bf[p];return d||(d=bf[p]=yf(u,s,l,n,i)),d(e,t,a,r,o)}function Yr(e,t){var a,r;if(void 0!==t&&(!Number.isFinite(t)||t%1!==t))throw new Error('axis of dimension to unsqueeze must be an integer');return t=void 0===t?e.shape.length:t,a=e.shape.slice(0),r=e.stride.slice(0),a.splice(t||0,0,1),r.splice(t||0,0,(r[t]||1)*(a[t+1]||1)),Th(e.data,a,r,e.offset)}function Jr(e,t,a,r,o){for(var n=im.dot,u=t.shape[0]-1;0<=u;u--)o.set(u,o.get(u)*r+e*n(t.pick(u,null),a));return!0}function eo(e,t,a,o,u,s,l){for(var p=0,r=0,i=0,d=0,c=0,g=e.shape[0],h=e.shape[1],n=bn(t,g-1),f=bn(a,h-1),m=void 0===s?1:s,_=void 0===l?0:l;p<=n;){d=0;var y=bn(p+f,h-1);for(i=0;i<=y;i++)d+=e.get(p,i)*o.get(i);u.set(p,d*m+_*u.get(p)),p++}if(p<g)for(r=0;p+f<h;){for(d=0,i=0;i<=n+f;i++)c=r+i+1,d+=e.get(p,c)*o.get(c);if(u.set(p,d*m+_*u.get(p)),p++,r++,p===g)break}if(p<g)for(r++;p-n<h;){for(d=0,i=r;i<h;i++)d+=e.get(p,i)*o.get(i);if(u.set(p,d*m+_*u.get(p)),p++,r++,p===g)break}return!0}function to(e,t,a,r,o,u){var s=e.shape[0],n=r||!0,l=o===void 0?1:o,p=u===void 0?0:u,d=0,i=0,c=0,g=0;if(0===p)for(d=0;d<a.shape[0];++d)a.set(d,0);else 1!==p&&im.scal(p,a);if(0===l)return!0;if(1===l){if(n)for(i=0;i<s;++i){for(c=t.get(i),g=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<s;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+g)}else for(i=0;i<s;++i){for(c=t.get(i),g=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+g)}}else if(n)for(i=0;i<s;++i){for(c=l*t.get(i),g=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<s;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+l*g)}else for(i=0;i<s;++i){for(c=l*t.get(i),g=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+l*g)}return!0}function ao(){console.error('SBMV (symmetric banded matrix vector multiply) not yet implemented')}function ro(e,t,a){var r=im.dot,o=e.shape[1],n=0;if(a)for(n=o-1;0<=n;n--)t.set(n,r(e.pick(n,null).hi(n+1),t.hi(n+1)));else for(n=0;n<o;n++)t.set(n,r(e.pick(n,null).lo(n),t.lo(n)));return!0}function oo(){console.error('TBMV (triangular banded matrix vector multiply) not yet implemented')}function no(e,t,a){var r=im.dot,o=e.shape[1],n=0;if(a)for(t.set(0,t.get(0)/e.get(0,0)),n=1;n<o;n++)t.set(n,(t.get(n)-r(e.pick(n,null).hi(n),t.hi(n)))/e.get(n,n));else for(t.set(o-1,t.get(o-1)/e.get(o-1,o-1)),n=o-2;0<=n;n--)t.set(n,(t.get(n)-r(e.pick(n,null).lo(n+1),t.lo(n+1)))/e.get(n,n));return!0}function io(){console.error('TPSV (triangular packed matrix solver) not yet implemented')}function uo(){console.error('GER (rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function so(){console.error('SYR (symmetric rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function lo(){console.error('SPR (symmetric packed rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function po(){console.error('SYR (symmetric rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function co(){console.error('SPR (symmetric packed rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function go(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function ho(e){var t=32;return e&=-e,e&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function fo(e,t,a){var r=0|e[a];if(0>=r)return[];var o=Array(r),n;if(a===e.length-1)for(n=0;n<r;++n)o[n]=t;else for(n=0;n<r;++n)o[n]=fo(e,t,a+1);return o}function mo(e,t){var a,r;for(a=Array(e),r=0;r<e;++r)a[r]=t;return a}function _o(e,t){switch('undefined'==typeof t&&(t=0),'undefined'==typeof e?'undefined':kn(e)){case'number':if(0<e)return mo(0|e,t);break;case'object':if('number'==typeof e.length)return fo(e,t,0);}return[]}function yo(e){var t=e.dtype;('generic'===t||'array'===t)&&(t='double');var a=o_.malloc(e.size,t),r=Th(a,e.shape);return Mh.assign(r,e),r}function xo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];return Th(o_.malloc(a,t),e,r,0)}function vo(e){'generic'===e.dtype||'array'===e.dtype||o_.free(e.data)}function bo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=o_.malloc(a,t),o=0;o<a;++o)n[o]=0;return Th(n,e,r,0)}function So(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=o_.malloc(a,t),o=0;o<a;++o)n[o]=1;return Th(n,e,r,0)}function Po(e,t){var a,r;t||(t='double');var o=1,n=Array(e.length);for(a=e.length-1;0<=a;--a)n[a]=o,o*=e[a];var i=o_.malloc(o,t);for(a=0;a<o;++a)i[a]=0;var u=Infinity,s=0;for(a=e.length-1;0<=a;a--)s+=n[a],u=bn(u,e[a]);for(a=0,r=0;a<u;a++,r+=s)i[r]=1;return Th(i,e,n,0)}function To(){var e,t,a,r;if(2===arguments.length?(t=arguments[0],r=arguments[1]):3===arguments.length&&(a=arguments[0],t=arguments[1],r=arguments[2]),!Array.isArray(r))throw new Error('second argument of tile must be an array of repetition counts for each dimension');var o=t.shape.slice(0),n=o.slice(0),i=Sn(n.length,r.length);for(e=0;e<i;e++)if(o[e]=void 0===o[e]?1:o[e],r[e]=void 0===r[e]?1:r[e],n[e]=(void 0===n[e]?1:n[e])*r[e],0===n[e])throw new Error('Number of tiles must be greater than zero');a||(a=d_.zeros(n,t.dtype));var u=1;for(e=0;e<r.length;e++)u*=r[e];var s=Array(r.length);for(e=0;e<r.length;e++)s[e]=0;var l=n.slice(0);for(c=0;c<n.length;c++)l[c]=c<t.dimension?null:0;for(e=0;e<u;e++){for(c=t.dimension;c<n.length;c++)l[c]=s[c];var p=a.pick.apply(a,l);if(p=p.lo.apply(p,s),p=p.hi.apply(p,t.shape),Mh.assign(p,t),e===u-1)break;for(var c=i-1;0<=c&&(s[c]+=o[c],s[c]===n[c]);)s[c]=0,c--}return a}function wo(e,t){if(!t||'object'!==('undefined'==typeof t?'undefined':kn(t)))return e;for(var a=Object.keys(t),r=a.length;r--;)e[a[r]]=t[a[r]];return e}function ko(){var e,t,a,r,o,n,i,u,s,l;if(r=T_({},k_),0===arguments.length)throw new Error('Array of ndarrays to concatenate must not be empty');if(Array.isArray(arguments[0])?(a=arguments[0],T_(r,arguments[1]||{})):2===arguments.length&&(a=arguments[1],e=arguments[0],T_(r,arguments[2]||{})),0===a.length)throw new Error('Array of ndarrays to concatenate must not be empty');for(o=0;o<a.length;o++)if(!i)i=a[o].shape.slice(0);else{if(a[o].dimension!==i.length)throw new Error('all arrays must have the same dimensionality');for(n=1;n<a[o].shape.length;n++)if(a[o].shape[n]!==i[n])throw new Error('last n-1 dimensions of concatenated rows must have the same size');i[0]+=a[o].shape[0]}if(!e)e=d_.zeros(i,r.dtype);else if(i[0]!==e.shape[0])throw new Error('first dimension of output array must match the total number of concatenated rows');for(n=0,u=0;n<a.length;n++)t=a[n],s=t.shape[0],l=e.lo(u).hi(s),Mh.assign(l,t),u+=s;return e}function Co(e,t){for(var a=Array(arguments.length-1),r=0,o=2,n=!0;o<arguments.length;)a[r++]=arguments[o++];return new Promise(function(o,i){a[r]=function(e){if(n)if(n=!1,e)i(e);else{for(var t=Array(arguments.length-1),a=0;a<t.length;)t[a++]=arguments[a];o.apply(null,t)}};try{e.apply(t||null,a)}catch(e){n&&(n=!1,i(e))}})}function Fo(){this._listeners={}}function Mo(e){var t=Math.LN2;return'undefined'==typeof Float32Array?function(){function a(e,a,r,o){var n=0>a?1:0;if(n&&(a=-a),0===a)e(0<1/a?0:2147483648,r,o);else if(isNaN(a))e(2143289344,r,o);else if(3.4028234663852886e38<a)e((2139095040|n<<31)>>>0,r,o);else if(1.1754943508222875e-38>a)e((n<<31|vn(a/1.401298464324817e-45))>>>0,r,o);else{var i=fn(mn(a)/t),u=8388607&vn(8388608*(a*wn(2,-i)));e((n<<31|i+127<<23|u)>>>0,r,o)}}function r(e,t,a){var r=e(t,a),o=2*(r>>31)+1,n=255&r>>>23,i=8388607&r;return 255==n?i?NaN:o*Infinity:0==n?1.401298464324817e-45*o*i:o*wn(2,n-150)*(i+8388608)}e.writeFloatLE=a.bind(null,Do),e.writeFloatBE=a.bind(null,Io),e.readFloatLE=r.bind(null,Ro),e.readFloatBE=r.bind(null,Eo)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3]}function a(e,t,a){n[0]=e,t[a]=i[3],t[a+1]=i[2],t[a+2]=i[1],t[a+3]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n[0]}function o(e,t){return i[3]=e[t],i[2]=e[t+1],i[1]=e[t+2],i[0]=e[t+3],n[0]}var n=new Float32Array([0]),i=new Uint8Array(n.buffer),u=128===i[3];e.writeFloatLE=u?t:a,e.writeFloatBE=u?a:t,e.readFloatLE=u?r:o,e.readFloatBE=u?o:r}(),'undefined'==typeof Float64Array?function(){function a(e,a,r,o,n,i){var u=0>o?1:0;if(u&&(o=-o),0===o)e(0,n,i+a),e(0<1/o?0:2147483648,n,i+r);else if(isNaN(o))e(0,n,i+a),e(2146959360,n,i+r);else if(1.7976931348623157e308<o)e(0,n,i+a),e((2146435072|u<<31)>>>0,n,i+r);else{var s;if(2.2250738585072014e-308>o)s=o/5e-324,e(s>>>0,n,i+a),e((u<<31|s/4294967296)>>>0,n,i+r);else{var l=fn(mn(o)/t);1024===l&&(l=1023),s=o*wn(2,-l),e(4503599627370496*s>>>0,n,i+a),e((u<<31|l+1023<<20|1048575&1048576*s)>>>0,n,i+r)}}}function r(e,t,a,r,o){var n=e(r,o+t),i=e(r,o+a),u=2*(i>>31)+1,s=2047&i>>>20,l=4294967296*(1048575&i)+n;return 2047==s?l?NaN:u*Infinity:0==s?5e-324*u*l:u*wn(2,s-1075)*(l+4503599627370496)}e.writeDoubleLE=a.bind(null,Do,0,4),e.writeDoubleBE=a.bind(null,Io,4,0),e.readDoubleLE=r.bind(null,Ro,0,4),e.readDoubleBE=r.bind(null,Eo,4,0)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3],t[a+4]=i[4],t[a+5]=i[5],t[a+6]=i[6],t[a+7]=i[7]}function a(e,t,a){n[0]=e,t[a]=i[7],t[a+1]=i[6],t[a+2]=i[5],t[a+3]=i[4],t[a+4]=i[3],t[a+5]=i[2],t[a+6]=i[1],t[a+7]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i[4]=e[t+4],i[5]=e[t+5],i[6]=e[t+6],i[7]=e[t+7],n[0]}function o(e,t){return i[7]=e[t],i[6]=e[t+1],i[5]=e[t+2],i[4]=e[t+3],i[3]=e[t+4],i[2]=e[t+5],i[1]=e[t+6],i[0]=e[t+7],n[0]}var n=new Float64Array([0]),i=new Uint8Array(n.buffer),u=128===i[7];e.writeDoubleLE=u?t:a,e.writeDoubleBE=u?a:t,e.readDoubleLE=u?r:o,e.readDoubleBE=u?o:r}(),e}function Do(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function Io(e,t,a){t[a]=e>>>24,t[a+1]=255&e>>>16,t[a+2]=255&e>>>8,t[a+3]=255&e}function Ro(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Eo(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Ao(e){try{var t=eval('quire'.replace(/^/,'re'))(e);if(t&&(t.length||Object.keys(t).length))return t}catch(t){}return null}function Lo(e,t,a){var r=a||8192,o=null,n=r;return function(a){if(1>a||a>r>>>1)return e(a);n+a>r&&(o=e(r),n=0);var i=t.call(o,n,n+=a);return 7&n&&(n=(7|n)+1),i}}function Oo(e,t){this.lo=e>>>0,this.hi=t>>>0}function jo(e,t,a){this.fn=e,this.len=t,this.next=void 0,this.val=a}function zo(){}function Go(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Uo(){this.len=0,this.head=new jo(zo,0,0),this.tail=this.head,this.states=null}function qo(e,t,a){t[a]=255&e}function No(e,t,a){for(;127<e;)t[a++]=128|127&e,e>>>=7;t[a]=e}function Bo(e,t){this.len=e,this.next=void 0,this.val=t}function Vo(e,t,a){for(;e.hi;)t[a++]=128|127&e.lo,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[a++]=128|127&e.lo,e.lo>>>=7;t[a++]=e.lo}function Ho(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function Wo(){Sy.call(this)}function Xo(e,t,a){40>e.length?by.utf8.write(e,t,a):t.utf8Write(e,a)}function $o(e,t){return RangeError('index out of range: '+e.pos+' + '+(t||1)+' > '+e.len)}function Ko(e){this.buf=e,this.pos=0,this.len=e.length}function Qo(){var e=new Ry(0,0),t=0;if(4<this.len-this.pos){for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;t=0}else{for(;3>t;++t){if(this.pos>=this.len)throw $o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e;}else for(;5>t;++t){if(this.pos>=this.len)throw $o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error('invalid varint encoding')}function Zo(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Yo(){if(this.pos+8>this.len)throw $o(this,8);return new Ry(Zo(this.buf,this.pos+=4),Zo(this.buf,this.pos+=4))}function Jo(e){Iy.call(this,e)}function en(e,t,a){if('function'!=typeof e)throw TypeError('rpcImpl must be a function');by.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!a}function tn(e){return'number'==typeof e&&Xy(e)}function an(e){var t=null==e?0:e.length;return t?gg(e,Ky):[]}function rn(e,t){var a=function(e,t,a){return e+(t-e)*a},r=[],o=new Number((e.length-1)/(t-1));r[0]=e[0];for(var n=1;n<t-1;n++){var i=n*o,u=new Number(fn(i)).toFixed(),s=new Number(xn(i)).toFixed();r[n]=a(e[u],e[s],i-u)}return r[t-1]=e[e.length-1],r}function on(e){var t=e.reduce(function(e,t){return e+t*t},0),a=Tn(t);return e.map(function(e){return e/a})}function nn(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r,o,n,i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return 200>t.values.length&&console.warn('Pattern detector requires atleast 250 data for a reliable prediction, received just ',t.values.length),a.next=3,nx.ready();case 3:return qn.reverseInputs(t),r=t.values,o=on(rn(r,400)),a.next=8,nx.predict({input:new Float32Array(o)});case 8:return n=a.sent,i=n.output.indexOf(Sn.apply(Math,En(n.output))),qn.reverseInputs(t),a.abrupt('return',{pattern:e.AvailablePatterns[i],patternId:i,probability:100*n.output[i]});case 12:case'end':return a.stop();}},a,this)}))}function un(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.DB&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function sn(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.DT&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function ln(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.HS&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function pn(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.IHS&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function dn(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.TU&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function cn(t){return ax(this,void 0,void 0,regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,nn(t);case 2:return r=a.sent,a.abrupt('return',r.patternId===e.AvailablePatterns.TD&&75<r.probability);case 4:case'end':return a.stop();}},a,this)}))}function gn(){return['sma','ema','wma','wema','macd','rsi','bollingerbands','adx','atr','truerange','roc','kst','psar','stochastic','williamsr','adl','obv','trix','cci','awesomeoscillator','forceindex','vwap','volumeprofile','renko','heikinashi','stochasticrsi','mfi','averagegain','averageloss','highest','lowest','sum','FixedSizeLinkedList','sd','bullish','bearish','abandonedbaby','doji','bearishengulfingpattern','bullishengulfingpattern','darkcloudcover','downsidetasukigap','dragonflydoji','gravestonedoji','bullishharami','bearishharami','bullishharamicross','bearishharamicross','eveningdojistar','eveningstar','morningdojistar','morningstar','bullishmarubozu','bearishmarubozu','piercingline','bullishspinningtop','bearishspinningtop','threeblackcrows','threewhitesoldiers','predictPattern','hasDoubleBottom','hasDoubleTop','hasHeadAndShoulder','hasInverseHeadAndShoulder','isTrendingUp','isTrendingDown']}var hn=Math.sign,fn=Math.floor,mn=Math.log,_n=Math.exp,yn=String.fromCharCode,xn=Math.ceil,vn=Math.round,bn=Math.min,Sn=Math.max,Pn=Math.abs,Tn=Math.sqrt,wn=Math.pow;t='default'in t?t['default']:t;var kn='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},Cn=function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')},Fn=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Mn=function e(t,a,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,a);if(o===void 0){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,a,r)}if('value'in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(r)},Dn=function(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},In=function(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e},Rn=function(){function e(e,t){var a=[],r=!0,o=!1,n;try{for(var i=e[Symbol.iterator](),u;!(r=(u=i.next()).done)&&(a.push(u.value),!(t&&a.length===t));r=!0);}catch(e){o=!0,n=e}finally{try{!r&&i['return']&&i['return']()}finally{if(o)throw n}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),En=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)},An=function e(t,a,r){Cn(this,e),this.next=r,r&&(r.prev=this),this.prev=a,a&&(a.next=this),this.data=t},Ln=function(){function e(){Cn(this,e),this._length=0}return Fn(e,[{key:'push',value:function(e){this._tail=new An(e,this._tail),0===this._length&&(this._head=this._tail,this._current=this._head,this._next=this._head),this._length++}},{key:'pop',value:function(){var e=this._tail;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._tail=e.prev,this._tail.next=void 0,this._current===e&&(this._current=this._tail,this._next=void 0),e.data)}},{key:'shift',value:function(){var e=this._head;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._head=this._head.next,this._current===e&&(this._current=this._head,this._next=this._current.next),e.data)}},{key:'unshift',value:function(e){this._head=new An(e,void 0,this._head),0===this._length&&(this._tail=this._head,this._next=this._head),this._length++}},{key:'unshiftCurrent',value:function(){var e=this._current;return e===this._head||2>this._length?e&&e.data:(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.next=this._head,e.prev=void 0,this._head.prev=e,this._head=e,e.data)}},{key:'removeCurrent',value:function(){var e=this._current;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):e===this._head?(this._head=e.next,this._head.prev=void 0,this._current=this._head):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.data)}},{key:'resetCursor',value:function(){return this._current=this._next=this._head,this}},{key:'next',value:function(){var e=this._next;if(void 0!==e)return this._next=e.next,this._current=e,e.data}},{key:'head',get:function(){return this._head&&this._head.data}},{key:'tail',get:function(){return this._tail&&this._tail.data}},{key:'current',get:function(){return this._current&&this._current.data}},{key:'length',get:function(){return this._length}}]),e}(),On=function(e){function t(e,a,r,o){Cn(this,t);var n=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(n.size=e,n.maintainHigh=a,n.maintainLow=r,n.maintainSum=o,n.totalPushed=0,n.periodHigh=0,n.periodLow=Infinity,n.periodSum=0,!e||'number'!=typeof e)throw'Size required and should be a number.';return n._push=n.push,n.push=function(e){this.add(e),this.totalPushed++},n}return Dn(t,e),Fn(t,[{key:'add',value:function(e){this.length===this.size?(this.lastShift=this.shift(),this._push(e),this.maintainHigh&&this.lastShift==this.periodHigh&&this.calculatePeriodHigh(),this.maintainLow&&this.lastShift==this.periodLow&&this.calculatePeriodLow(),this.maintainSum&&(this.periodSum-=this.lastShift)):this._push(e),this.maintainHigh&&this.periodHigh<=e&&(this.periodHigh=e),this.maintainLow&&this.periodLow>=e&&(this.periodLow=e),this.maintainSum&&(this.periodSum+=e)}},{key:'iterator',value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.resetCursor();case 1:if(!this.next()){e.next=6;break}return e.next=4,this.current;case 4:e.next=1;break;case 6:case'end':return e.stop();}},e,this)})},{key:'calculatePeriodHigh',value:function(){for(this.resetCursor(),this.next()&&(this.periodHigh=this.current);this.next();)this.periodHigh<=this.current&&(this.periodHigh=this.current)}},{key:'calculatePeriodLow',value:function(){for(this.resetCursor(),this.next()&&(this.periodLow=this.current);this.next();)this.periodLow>=this.current&&(this.periodLow=this.current)}}]),t}(Ln),jn=function e(){Cn(this,e)},zn=function e(){Cn(this,e),this.open=[],this.high=[],this.low=[],this.close=[],this.volume=[],this.timestamp=[]},Gn={},Un=function e(){Cn(this,e)},qn=function(){function e(t){Cn(this,e),this.format=t.format||o}return Fn(e,[{key:'getResult',value:function(){return this.result}}],[{key:'reverseInputs',value:function(e){e.reversedInput&&(e.values?e.values.reverse():void 0,e.open?e.open.reverse():void 0,e.high?e.high.reverse():void 0,e.low?e.low.reverse():void 0,e.close?e.close.reverse():void 0,e.volume?e.volume.reverse():void 0,e.timestamp?e.timestamp.reverse():void 0)}}]),e}(),Nn=function(e){function t(e,a){Cn(this,t);var r=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.period=e,r.values=a,r}return Dn(t,e),t}(Un),Bn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.period=e.period,a.price=e.values;var r=regeneratorRuntime.mark(function e(t){var a,r,o,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Ln,r=0,o=1,void(e.next=5);case 5:n=e.sent,a.push(0);case 7:return o<t?(o++,a.push(n),r+=n):(r=r-a.shift()+n,i=r/t,a.push(n)),e.next=11,i;case 11:n=e.sent,e.next=7;break;case 14:case'end':return e.stop();}},e,this)});return a.generator=r(a.period),a.generator.next(),a.result=[],a.price.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return this.format(t)}}]),t}(qn);Bn.calculate=n;var Vn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values,n;a.result=[],n=new Bn({period:r,values:[]});var i=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:if(void 0==a||void 0===t){e.next=11;break}return a=(t-a)*(2/(r+1))+a,e.next=8,a;case 8:t=e.sent,e.next=19;break;case 11:return void(e.next=13);case 13:if(t=e.sent,a=n.nextValue(t),!a){e.next=19;break}return e.next=18,a;case 18:t=e.sent;case 19:e.next=3;break;case 21:case'end':return e.stop();}},e,this)});return a.generator=i(),a.generator.next(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return this.format(t)}}]),t}(qn);Vn.calculate=i;var Hn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values;return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,o,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=new Ln,a=r*(r+1)/2;case 2:if(!(t.length<r)){e.next=11;break}return e.t0=t,void(e.next=7);case 7:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=19;break;case 11:for(t.resetCursor(),o=0,n=1;n<=r;n++)o+=t.next()*n/a;return e.next=16,o;case 16:i=e.sent,t.shift(),t.push(i);case 19:e.next=2;break;case 21:case'end':return e.stop();}},e,this)})(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return this.format(t)}}]),t}(qn);Hn.calculate=u;var Wn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values,n;a.result=[],n=new Bn({period:r,values:[]});var i=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:if(void 0==a||void 0===t){e.next=11;break}return a=(t-a)*(1/r)+a,e.next=8,a;case 8:t=e.sent,e.next=19;break;case 11:return void(e.next=13);case 13:if(t=e.sent,a=n.nextValue(t),void 0===a){e.next=19;break}return e.next=18,a;case 18:t=e.sent;case 19:e.next=3;break;case 21:case'end':return e.stop();}},e,this)});return a.generator=i(),a.generator.next(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return this.format(t)}}]),t}(qn);Wn.calculate=s;var Xn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.values=e,a.SimpleMAOscillator=!0,a.SimpleMASignal=!0,a}return Dn(t,e),t}(Un),$n=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.SimpleMAOscillator?Bn:Vn,o=e.SimpleMASignal?Bn:Vn,n=new r({period:e.fastPeriod,values:[],format:function(e){return e}}),i=new r({period:e.slowPeriod,values:[],format:function(e){return e}}),u=new o({period:e.signalPeriod,values:[],format:function(e){return e}}),s=a.format;return a.result=[],a.generator=regeneratorRuntime.mark(function t(){var a,r,o,l,p,d,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.slowPeriod)){t.next=10;break}return void(t.next=5);case 5:return r=t.sent,d=n.nextValue(r),c=i.nextValue(r),a++,t.abrupt('continue',1);case 10:return d&&c&&(o=d-c,l=u.nextValue(o)),p=o-l,t.next=14,{MACD:s(o),signal:l?s(l):void 0,histogram:isNaN(p)?void 0:s(p)};case 14:r=t.sent,d=n.nextValue(r),c=i.nextValue(r),t.next=1;break;case 19:case'end':return t.stop();}},t,this)})(),a.generator.next(),e.values.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;return t}}]),t}(qn);$n.calculate=l;var Kn=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Qn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period,n=a.format;return a.generator=regeneratorRuntime.mark(function e(t){var a,r,o,i,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:return a=e.sent,r=1,o=0,s=a,void(e.next=8);case 8:a=e.sent;case 9:return u=a-s,u=0<u?u:0,0<u&&(o+=u),r<t?r++:void 0==i?i=o/t:i=(i*(t-1)+u)/t,s=a,i=void 0===i?void 0:n(i),e.next=18,i;case 18:a=e.sent,e.next=9;break;case 21:case'end':return e.stop();}},e,this)})(o),a.generator.next(),a.result=[],r.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);Qn.calculate=p;var Zn=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Yn=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period,n=a.format;return a.generator=regeneratorRuntime.mark(function e(t){var a,r,o,i,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:return a=e.sent,r=1,o=0,s=a,void(e.next=8);case 8:a=e.sent;case 9:return u=s-a,u=0<u?u:0,0<u&&(o+=u),r<t?r++:void 0==i?i=o/t:i=(i*(t-1)+u)/t,s=a,i=void 0===i?void 0:n(i),e.next=18,i;case 18:a=e.sent,e.next=9;break;case 21:case'end':return e.stop();}},e,this)})(o),a.generator.next(),a.result=[],r.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);Yn.calculate=d;var Jn=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ei=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values,n=new Qn({period:r,values:[]}),i=new Yn({period:r,values:[]}),u=1;return a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return a=n.nextValue(t),r=i.nextValue(t),void 0!==a&&void 0!==r&&(0===r?s=100:0===a?s=0:(o=a/r,o=isNaN(o)?0:o,s=parseFloat((100-100/(1+o)).toFixed(2)))),u++,e.next=10,s;case 10:t=e.sent,e.next=3;break;case 13:case'end':return e.stop();}},e,this)})(r),a.generator.next(),a.result=[],o.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);ei.calculate=c;var ti=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ai=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values,n=new Bn({period:r,values:[],format:function(e){return e}});return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,o,i,u,s,l,p,d,c,g;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=new On(r);;return void(e.next=4);case 4:t=e.sent;case 5:if(o.push(t),a=n.nextValue(t),!a){e.next=30;break}for(u=0,s=!0,l=!1,p=void 0,e.prev=13,d=o.iterator()[Symbol.iterator]();!(s=(c=d.next()).done);s=!0)g=c.value,u+=wn(g-a,2);e.next=21;break;case 17:e.prev=17,e.t0=e['catch'](13),l=!0,p=e.t0;case 21:e.prev=21,e.prev=22,!s&&d.return&&d.return();case 24:if(e.prev=24,!l){e.next=27;break}throw p;case 27:return e.finish(24);case 28:return e.finish(21);case 29:i=Tn(u/r);case 30:return e.next=32,i;case 32:t=e.sent,e.next=5;break;case 35:case'end':return e.stop();}},e,this,[[13,17,21,29],[22,,24,28]])})(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return this.format(t.value)}}]),t}(qn);ai.calculate=g;var ri=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),oi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ni=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values,n=e.stdDev,i=a.format,u,s;return a.result=[],u=new Bn({period:r,values:[],format:function(e){return e}}),s=new ai({period:r,values:[],format:function(e){return e}}),a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,l,p,d,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:a=e.sent;case 3:return r=u.nextValue(a),o=s.nextValue(a),r&&(l=i(r),p=i(r+o*n),d=i(r-o*n),c=i((a-d)/(p-d)),t={middle:l,upper:p,lower:d,pb:c}),e.next=9,t;case 9:a=e.sent,e.next=3;break;case 12:case'end':return e.stop();}},e,this)})(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);ni.calculate=h;var ii=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.period=e.period,a.price=e.values;var r=regeneratorRuntime.mark(function e(t){var a,r,o,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Ln,r=0,o=1,void(e.next=5);case 5:n=e.sent,i=0;case 7:return o<t?(o++,r+=n,i=void 0):o==t?(o++,r+=n,i=r):i=i-i/t+n,e.next=11,i;case 11:n=e.sent,e.next=7;break;case 14:case'end':return e.stop();}},e,this)});return a.generator=r(a.period),a.generator.next(),a.result=[],a.price.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return this.format(t)}}]),t}(qn);ii.calculate=f;var ui=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),si=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=a.format;if(r.length!=o.length)throw'Inputs(low,high) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:a=e.sent;case 3:return r&&(o=a.high-r.high,i=r.low-a.low,t=n(i>o&&0<i?i:0)),r=a,e.next=8,t;case 8:a=e.sent,e.next=3;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var n=a.generator.next({high:o[t],low:r[t]});void 0!==n.value&&a.result.push(n.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}],[{key:'calculate',value:function(e){qn.reverseInputs(e);var a=new t(e).result;return e.reversedInput&&a.reverse(),qn.reverseInputs(e),a}}]),t}(qn),li=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),pi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=a.format;if(r.length!=o.length)throw'Inputs(low,high) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:a=e.sent;case 3:return r&&(o=a.high-r.high,i=r.low-a.low,t=n(o>i&&0<o?o:0)),r=a,e.next=8,t;case 8:a=e.sent,e.next=3;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var n=a.generator.next({high:o[t],low:r[t]});void 0!==n.value&&a.result.push(n.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}],[{key:'calculate',value:function(e){qn.reverseInputs(e);var a=new t(e).result;return e.reversedInput&&a.reverse(),qn.reverseInputs(e),a}}]),t}(qn),di=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ci=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=a.format;if(r.length!=o.length)throw'Inputs(low,high) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:if(void 0!=a){e.next=9;break}return a=t.close,e.next=8,r;case 8:t=e.sent;case 9:return r=Sn(t.high-t.low,isNaN(Pn(t.high-a))?0:Pn(t.high-a),isNaN(Pn(t.low-a))?0:Pn(t.low-a)),a=t.close,void 0!=r&&(r=i(r)),e.next=14,r;case 14:t=e.sent,e.next=3;break;case 17:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!=i.value&&a.result.push(i.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);ci.calculate=m;var gi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),hi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),fi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.period,u=a.format,s=new pi({high:[],low:[]}),l=new si({high:[],low:[]}),p=new ii({period:i,values:[],format:function(e){return e}}),d=new ii({period:i,values:[],format:function(e){return e}}),c=new ii({period:i,values:[],format:function(e){return e}}),g=new Wn({period:i,values:[],format:function(e){return e}}),h=new ci({low:[],high:[],close:[]});if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';return a.result=[],hi,a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,i,u,f,m,_,y,x,v,b,S,P,T;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent,a=0,r=0,o=0,n=0;case 7:if(_=h.nextValue(t),y=s.nextValue(t),x=l.nextValue(t),void 0!==_){e.next=16;break}return void(e.next=14);case 14:return t=e.sent,e.abrupt('continue',7);case 16:return v=c.nextValue(_),b=p.nextValue(y),S=d.nextValue(x),void 0!=v&&void 0!=b&&void 0!=S&&(i=100*b/v,u=100*S/v,P=Pn(i-u),T=i+u,f=100*(P/T),m=g.nextValue(f)),e.next=22,{adx:m,pdi:i,mdi:u};case 22:t=e.sent,e.next=7;break;case 25:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!=i.value&&void 0!=i.value.adx&&a.result.push({adx:u(i.value.adx),pdi:u(i.value.pdi),mdi:u(i.value.mdi)})}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t&&void 0!=t.adx)return{adx:this.format(t.adx),pdi:this.format(t.pdi),mdi:this.format(t.mdi)}}}]),t}(qn);fi.calculate=_;var mi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),_i=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.period,u=a.format;if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';var s=new ci({low:[],high:[],close:[]}),l=new Wn({period:i,values:[],format:function(e){return e}});return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;;case 4:return r=s.nextValue({low:t.low,high:t.high,close:t.close}),a=void 0===r?void 0:l.nextValue(r),e.next=9,a;case 9:t=e.sent,e.next=4;break;case 12:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!==i.value&&a.result.push(u(i.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);_i.calculate=y;var yi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),xi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.period,o=e.values;return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,o,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=1,a=new On(r);;return void(e.next=5);case 5:o=e.sent;case 6:return a.push(o),t<r?t++:n=100*((o-a.lastShift)/a.lastShift),e.next=11,n;case 11:o=e.sent,e.next=6;break;case 14:case'end':return e.stop();}},e,this)})(),a.generator.next(),o.forEach(function(e){var t=a.generator.next(e);void 0==t.value||isNaN(t.value)||a.result.push(a.format(t.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value&&!isNaN(t.value))return this.format(t.value)}}]),t}(qn);xi.calculate=x;var vi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),bi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.ROCPer1,n=e.ROCPer2,i=e.ROCPer3,u=e.ROCPer4,s=e.SMAROCPer1,l=e.SMAROCPer2,p=e.SMAROCPer3,d=e.SMAROCPer4,c=e.signalPeriod,g=new xi({period:o,values:[]}),h=new xi({period:n,values:[]}),f=new xi({period:i,values:[]}),m=new xi({period:u,values:[]}),_=new Bn({period:s,values:[],format:function(e){return e}}),y=new Bn({period:l,values:[],format:function(e){return e}}),x=new Bn({period:p,values:[],format:function(e){return e}}),v=new Bn({period:d,values:[],format:function(e){return e}}),b=new Bn({period:c,values:[],format:function(e){return e}}),S=a.format;a.result=[];var P=Sn(o+s,n+l,i+p,u+d);return a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,i,u,s,l,p,d,c,T;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=1,void(e.next=3);case 3:a=e.sent,r=void 0,o=void 0,n=void 0,i=void 0,u=void 0,s=void 0,l=void 0;case 6:return p=g.nextValue(a),d=h.nextValue(a),c=f.nextValue(a),T=m.nextValue(a),o=void 0===p?void 0:_.nextValue(p),n=void 0===d?void 0:y.nextValue(d),i=void 0===c?void 0:x.nextValue(c),u=void 0===T?void 0:v.nextValue(T),t<P?t++:r=1*o+2*n+3*i+4*u,s=void 0===r?void 0:b.nextValue(r),l=void 0===r?void 0:{kst:S(r),signal:s?S(s):void 0},e.next=20,l;case 20:a=e.sent,e.next=6;break;case 23:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return t.value}}]),t}(qn);bi.calculate=v;var Si=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Pi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.high||[],o=e.low||[],n=regeneratorRuntime.mark(function e(t,a){var r,o,n,i,u,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,o=void 0,n=void 0,i=void 0,u=!0,s=t,void(e.next=5);case 5:l=e.sent;case 6:return r?(n+=s*(o-n),u?(n=bn(n,i.low,l.low),r.high>o&&(o=r.high,s=bn(s+t,a))):(n=Sn(n,i.high,l.high),r.low<o&&(o=r.low,s=bn(s+t,a))),(u&&r.low<n||!u&&r.high>n)&&(s=t,n=o,u=!u,o=u?r.high:r.low)):(n=l.low,o=l.high),i=l,r&&(l=r),e.next=12,n;case 12:r=e.sent,e.next=6;break;case 15:case'end':return e.stop();}},e,this)});return a.result=[],a.generator=n(e.step,e.max),a.generator.next(),o.forEach(function(e,t){var n=a.generator.next({high:r[t],low:o[t]});void 0!==n.value&&a.result.push(n.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!==t.value)return t.value}}]),t}(qn);Pi.calculate=b;var Ti=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),wi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.period,u=e.signalPeriod,s=a.format;if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,l,p,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=1,a=new On(i,!0,!1),r=new On(i,!1,!0),o=new Bn({period:u,values:[],format:function(e){return e}}),n=void 0,l=void 0,void(e.next=7);case 7:p=e.sent;case 8:if(a.push(p.high),r.push(p.low),!(t<i)){e.next=17;break}return t++,void(e.next=15);case 15:return p=e.sent,e.abrupt('continue',8);case 17:return d=r.periodLow,n=100*((p.close-d)/(a.periodHigh-d)),n=isNaN(n)?0:n,l=o.nextValue(n),e.next=23,{k:s(n),d:void 0===l?void 0:s(l)};case 23:p=e.sent,e.next=8;break;case 26:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!==i.value&&a.result.push(i.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!==t.value)return t.value}}]),t}(qn);wi.calculate=S;var ki=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Ci=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.period,u=a.format;if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=1,a=new On(i,!0,!1),r=new On(i,!1,!0),o=void 0,n=void 0,void(e.next=7);case 7:s=e.sent,l=void 0;case 9:if(a.push(s.high),r.push(s.low),!(t<i)){e.next=18;break}return t++,void(e.next=16);case 16:return s=e.sent,e.abrupt('continue',9);case 18:return o=r.periodLow,n=a.periodHigh,l=u(-100*((n-s.close)/(n-o))),e.next=23,l;case 23:s=e.sent,e.next=9;break;case 26:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!==i.value&&a.result.push(i.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return this.format(t.value)}}]),t}(qn);Ci.calculate=P;var Fi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Mi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.high,o=e.low,n=e.close,i=e.volume;if(o.length!==r.length||r.length!==n.length||r.length!==i.length)throw'Inputs(low,high, close, volumes) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,void(e.next=3);case 3:a=e.sent;case 4:return r=(a.close-a.low-(a.high-a.close))/(a.high-a.low),r=isNaN(r)?1:r,o=r*a.volume,t+=o,e.next=11,vn(t);case 11:a=e.sent,e.next=4;break;case 14:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var r={high:e,low:o[t],close:n[t],volume:i[t]},u=a.generator.next(r);void 0!=u.value&&a.result.push(u.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);Mi.calculate=T;var Di=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Ii=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.close,o=e.volume;return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,void(e.next=3);case 3:if(a=e.sent,!(a.close&&'number'==typeof a.close)){e.next=9;break}return r=a.close,void(e.next=8);case 8:a=e.sent;case 9:return r<a.close?t+=a.volume:a.close<r&&(t-=a.volume),r=a.close,e.next=14,t;case 14:a=e.sent,e.next=9;break;case 17:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var n={close:r[t],volume:o[t]},i=a.generator.next(n);void 0!=i.value&&a.result.push(i.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){return this.generator.next(e).value}}]),t}(qn);Ii.calculate=w;var Ri=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Ei=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period,n=a.format,i=new Vn({period:o,values:[],format:function(e){return e}}),u=new Vn({period:o,values:[],format:function(e){return e}}),s=new Vn({period:o,values:[],format:function(e){return e}}),l=new xi({period:1,values:[],format:function(e){return e}});return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return a=i.nextValue(t),r=a?u.nextValue(a):void 0,o=r?s.nextValue(r):void 0,p=o?l.nextValue(o):void 0,e.next=10,p?n(p):void 0;case 10:t=e.sent,e.next=3;break;case 13:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!==t.value)return t.value}}]),t}(qn);Ei.calculate=k;var Ai=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.period=1,e}return Dn(t,e),t}(Un),Li=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.close,o=e.volume,n=e.period||1;if(o.length!==r.length)throw'Inputs(volume, close) not of equal size';var i=new Vn({values:[],period:n});return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:return t=e.sent,void(e.next=5);case 5:a=e.sent,r=void 0;case 7:return r=(a.close-t.close)*a.volume,t=a,e.next=12,i.nextValue(r);case 12:a=e.sent,e.next=7;break;case 15:case'end':return e.stop();}},e,this)})(),a.generator.next(),o.forEach(function(e,t){var n=a.generator.next({close:r[t],volume:o[t]});void 0!=n.value&&a.result.push(n.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return t}}]),t}(qn);Li.calculate=C;var Oi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ji=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.period,u=a.format,s=new On(i),l=new Bn({period:i,values:[],format:function(e){return e}});if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,i,u,p,d,c,g,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:if(a=(t.high+t.low+t.close)/3,s.push(a),r=l.nextValue(a),o=null,n=void 0,i=0,void 0==r){e.next=32;break}for(u=!0,p=!1,d=void 0,e.prev=14,c=s.iterator()[Symbol.iterator]();!(u=(g=c.next()).done);u=!0)h=g.value,i+=Pn(h-r);e.next=22;break;case 18:e.prev=18,e.t0=e['catch'](14),p=!0,d=e.t0;case 22:e.prev=22,e.prev=23,!u&&c.return&&c.return();case 25:if(e.prev=25,!p){e.next=28;break}throw d;case 28:return e.finish(25);case 29:return e.finish(22);case 30:o=i/20,n=(a-r)/(.015*o);case 32:return e.next=34,n;case 34:t=e.sent,e.next=3;break;case 37:case'end':return e.stop();}},e,this,[[14,18,22,30],[23,,25,29]])})(),a.generator.next(),r.forEach(function(e,t){var i=a.generator.next({high:o[t],low:r[t],close:n[t]});void 0!=i.value&&a.result.push(i.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return t}}]),t}(qn);ji.calculate=F;var zi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Gi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.high,o=e.low,n=e.fastPeriod,i=e.slowPeriod,u=new Bn({values:[],period:i}),s=new Bn({values:[],period:n});return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:a=e.sent;case 3:return r=(a.high+a.low)/2,o=u.nextValue(r),n=s.nextValue(r),void 0!==o&&void 0!==n&&(t=n-o),e.next=10,t;case 10:a=e.sent,e.next=3;break;case 13:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var r={high:e,low:o[t]},n=a.generator.next(r);void 0!=n.value&&a.result.push(a.format(n.value))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return this.format(t.value)}}]),t}(qn);Gi.calculate=M;var Ui=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),qi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.low,o=e.high,n=e.close,i=e.volume,u=a.format;if(r.length!==o.length||o.length!==n.length)throw'Inputs(low,high, close) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent,a=0,r=0;case 5:return o=(t.high+t.low+t.close)/3,n=t.volume*o,a+=n,r+=t.volume,e.next=12,a/r;case 12:t=e.sent;;e.next=5;break;case 16:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var u=a.generator.next({high:o[t],low:r[t],close:n[t],volume:i[t]});void 0!=u.value&&a.result.push(u.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;if(void 0!=t)return t}}]),t}(qn);qi.calculate=D;var Ni=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Bi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.high,o=e.low,n=e.close,u=e.open,s=e.volume,l=e.noOfBars;if(o.length!==r.length||r.length!==n.length||r.length!==s.length)throw'Inputs(low,high, close, volumes) not of equal size';a.result=[];for(var p=Sn.apply(Math,En(r).concat(En(o),En(n),En(u))),d=bn.apply(Math,En(r).concat(En(o),En(n),En(u))),c=d,g=0;g<l;g++){var i=c,h=i+(p-d)/l;c=h;for(var f=0,m=0,_=0,y=0;y<r.length;y++){var x=o[y],v=r[y],b=u[y],S=n[y],P=s[y];I(i,h,x,v)&&(_+=P,b>S?m+=P:f+=P)}a.result.push({rangeStart:i,rangeEnd:h,bullishVolume:f,bearishVolume:m,totalVolume:_})}return a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(){throw'Next value not supported for volume profile'}}]),t}(qn);Bi.calculate=R;var Vi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Hi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return e.next=6,(t.high+t.low+t.close)/3;case 6:t=e.sent,e.next=3;break;case 9:case'end':return e.stop();}},e,this)})(),a.generator.next(),e.low.forEach(function(t,r){var o=a.generator.next({high:e.high[r],low:e.low[r],close:e.close[r]});a.result.push(o.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;return t}}]),t}(qn);Hi.calculate=A;var Wi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Xi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.high,o=e.low,n=e.close,i=e.volume,u=e.period,s=new Hi({low:[],high:[],close:[]}),l=new On(u,!1,!1,!0),p=new On(u,!1,!1,!0);if(o.length!==r.length||r.length!==n.length||r.length!==i.length)throw'Inputs(low,high, close, volumes) not of equal size';return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,n,i,d,c,g,h,f,m,_,y,x,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,c=null,g=null,void(e.next=5);case 5:return a=e.sent,r=a.close,void(e.next=9);case 9:a=e.sent;case 10:return h=a,f=h.high,m=h.low,_=h.close,y=h.volume,x=0,v=0,c=s.nextValue({high:f,low:m,close:_}),n=c*y,null!=c&&null!=g&&(c>g?x=n:v=n,l.push(x),p.push(v),o=l.periodSum,d=p.periodSum,l.totalPushed>=u&&l.totalPushed>=u&&(i=o/d,t=100-100/(1+i))),g=c,e.next=20,t;case 20:a=e.sent,e.next=10;break;case 23:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e,t){var r={high:e,low:o[t],close:n[t],volume:i[t]},u=a.generator.next(r);void 0!=u.value&&a.result.push(parseFloat(u.value.toFixed(2)))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return parseFloat(t.value.toFixed(2))}}]),t}(qn);Xi.calculate=L;var $i=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Ki=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.rsiPeriod,n=e.stochasticPeriod,i=e.kPeriod,u=e.dPeriod,s=a.format;return a.result=[],a.generator=regeneratorRuntime.mark(function e(){var t,a,r,s,l,p,c,g,h,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=1,a=new ei({period:o,values:[]}),r=new wi({period:n,high:[],low:[],close:[],signalPeriod:i}),s=new Bn({period:u,values:[],format:function(e){return e}}),l=void 0,p=void 0,c=void 0,g=void 0,void(e.next=7);case 7:h=e.sent;case 8:return l=a.nextValue(h),void 0!==l&&(f={high:l,low:l,close:l},p=r.nextValue(f),void 0!==p&&void 0!==p.d&&(c=s.nextValue(p.d),void 0!==c&&(g={stochRSI:p.k,k:p.d,d:c}))),e.next=13,g;case 13:h=e.sent,e.next=8;break;case 16:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!==t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!==t.value)return t.value}}]),t}(qn);Ki.calculate=O;var Qi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Zi=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period;a.result=[];var n=new On(o,!0,!1,!1);return a.generator=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return n.push(t),n.totalPushed>=o&&(a=n.periodHigh),e.next=8,a;case 8:t=e.sent,e.next=3;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return t.value}}]),t}(qn);Zi.calculate=j;var Yi=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),Ji=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period;a.result=[];var n=new On(o,!1,!0,!1);return a.generator=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return n.push(t),n.totalPushed>=o&&(a=n.periodLow),e.next=8,a;case 8:t=e.sent,e.next=3;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return t.value}}]),t}(qn);Ji.calculate=z;var eu=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),tu=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.values,o=e.period;a.result=[];var n=new On(o,!1,!1,!0);return a.generator=regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:return n.push(t),n.totalPushed>=o&&(a=n.periodSum),e.next=8,a;case 8:t=e.sent,e.next=3;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),r.forEach(function(e){var t=a.generator.next(e);void 0!=t.value&&a.result.push(t.value)}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e);if(void 0!=t.value)return t.value}}]),t}(qn);tu.calculate=G;var au=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),ru=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=a.format,o=e.useATR,n=e.brickSize||0;if(o){var i=y(Object.assign({},e));n=i[i.length-1]}if(a.result=new zn,0===n)return console.error('Not enough data to calculate brickSize for renko when using ATR'),In(a);var u=0,s=0,l=Infinity,p=0,d=0,c=0;return a.generator=regeneratorRuntime.mark(function e(){var t,a,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent;case 3:if(0!=u){e.next=15;break}return u=t.close,s=t.high,l=t.low,p=t.close,d=t.volume,c=t.timestamp,void(e.next=13);case 13:return t=e.sent,e.abrupt('continue',3);case 15:if(a=Pn(t.close-p),r=Pn(t.close-u),!(a>=n&&r>=n)){e.next=30;break}return o=a>r?u:p,i={open:o,high:s>t.high?s:t.high,low:l<t.Low?l:t.low,close:o>t.close?o-n:o+n,volume:d+t.volume,timestamp:t.timestamp},u=i.open,s=i.close,l=i.close,p=i.close,d=0,e.next=27,i;case 27:t=e.sent,e.next=37;break;case 30:return s=s>t.high?s:t.high,l=l<t.Low?l:t.low,d+=t.volume,c=t.timestamp,void(e.next=36);case 36:t=e.sent;case 37:e.next=3;break;case 39:case'end':return e.stop();}},e,this)})(),a.generator.next(),e.low.forEach(function(t,r){var o=a.generator.next({open:e.open[r],high:e.high[r],low:e.low[r],close:e.close[r],volume:e.volume[r],timestamp:e.timestamp[r]});o.value&&(a.result.open.push(o.value.open),a.result.high.push(o.value.high),a.result.low.push(o.value.low),a.result.close.push(o.value.close),a.result.volume.push(o.value.volume),a.result.timestamp.push(o.value.timestamp))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(){return console.error('Cannot calculate next value on Renko, Every value has to be recomputed for every change, use calcualte method'),null}}]),t}(qn);ru.calculate=U;var ou=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(Un),nu=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=a.format;a.result=new zn;var o=null,n=0,i=Infinity,u=0,s=0,l=0;return a.generator=regeneratorRuntime.mark(function e(){var t,a,r,p,d,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void(e.next=2);case 2:t=e.sent,a=null;case 4:return null==o?(o=(t.close+t.open)/2,n=t.high,i=t.low,u=(t.close+t.open+t.high+t.low)/4,s=t.volume||0,l=t.timestamp||0,a={open:o,high:n,low:i,close:u,volume:t.volume||0,timestamp:t.timestamp||0}):(r=(t.close+t.open+t.high+t.low)/4,p=(o+u)/2,d=Sn(p,r,t.high),c=bn(t.low,p,r),a={close:r,open:p,high:d,low:c,volume:t.volume||0,timestamp:t.timestamp||0},u=r,o=p,n=d,i=c),e.next=8,a;case 8:t=e.sent,e.next=4;break;case 11:case'end':return e.stop();}},e,this)})(),a.generator.next(),e.low.forEach(function(t,r){var o=a.generator.next({open:e.open[r],high:e.high[r],low:e.low[r],close:e.close[r],volume:e.volume?e.volume[r]:e.volume,timestamp:e.timestamp?e.timestamp[r]:e.timestamp});o.value&&(a.result.open.push(o.value.open),a.result.high.push(o.value.high),a.result.low.push(o.value.low),a.result.close.push(o.value.close),a.result.volume.push(o.value.volume),a.result.timestamp.push(o.value.timestamp))}),a}return Dn(t,e),Fn(t,[{key:'nextValue',value:function(e){var t=this.generator.next(e).value;return t}}]),t}(qn);nu.calculate=q;var iu=function(){function e(){Cn(this,e)}return Fn(e,[{key:'approximateEqual',value:function(e,t){var a=1*parseFloat(Pn(e-t).toPrecision(4)),r=1*parseFloat((1e-3*e).toPrecision(4));return a<=r}},{key:'logic',value:function(){throw'this has to be implemented'}},{key:'getAllPatternIndex',value:function(e){var t=this;if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),[];e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());var a=this.logic;return this._generateDataForCandleStick(e).map(function(e,r){return a.call(t,e)?r:void 0}).filter(function(e){return e})}},{key:'hasPattern',value:function(e){if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),!1;e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());var t=this.logic;return t.call(this,this._getLastDataForCandleStick(e))}},{key:'_getLastDataForCandleStick',value:function(e){var t=this.requiredCount;if(e.close.length===t)return e;for(var a={open:[],high:[],low:[],close:[]},r=0,o=e.close.length-t;r<t;)a.open.push(e.open[o+r]),a.high.push(e.high[o+r]),a.low.push(e.low[o+r]),a.close.push(e.close[o+r]),r++;return a}},{key:'_generateDataForCandleStick',value:function(e){var t=this.requiredCount,a=e.close.map(function(a,r){for(var o=0,n={open:[],high:[],low:[],close:[]};o<t;)n.open.push(e.open[r+o]),n.high.push(e.high[r+o]),n.low.push(e.low[r+o]),n.close.push(e.close[r+o]),o++;return n}).filter(function(a,r){return r<=e.close.length-t});return a}}]),e}(),uu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='MorningStar',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&o>s&&o>u&&u<o&&s<o&&l>u&&i<l&&l<p&&p>(t+a)/2}}]),t}(iu),su=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BullishEngulfingPattern',e.requiredCount=2,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return a<t&&t>n&&a>n&&t<i}}]),t}(iu),lu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=2,e.name='BullishHarami',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return t>n&&a<n&&a<i&&t>s&&r>u}}]),t}(iu),pu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=2,e.name='BullishHaramiCross',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=this.approximateEqual(n,i);return t>n&&a<n&&a<i&&t>s&&r>u&&l}}]),t}(iu),du=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='Doji',e.requiredCount=1,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0];return this.approximateEqual(t,a)}}]),t}(iu),cu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='MorningDojiStar',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new du().hasPattern({open:[n],close:[i],high:[u],low:[s]});return a<t&&g&&l<p&&u<o&&s<o&&l>u&&i<l&&p>(t+a)/2}}]),t}(iu),gu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=3,e.name='DownsideTasukiGap',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&i<n&&p>l&&u<o&&n>l&&i<l&&p>n&&p<a}}]),t}(iu),hu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BullishMarubozu',e.requiredCount=1,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(a,r)&&this.approximateEqual(o,t)&&t<a&&t<r;return n}}]),t}(iu),fu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=2,e.name='PiercingLine',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return s<o&&a<t&&o>n&&i>(t+a)/2&&i>n}}]),t}(iu),mu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='ThreeWhiteSoldiers',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return u>r&&d>u&&t<a&&n<i&&l<p&&a>n&&n<r&&u>l&&l<i}}]),t}(iu),_u=[new su,new gu,new lu,new pu,new cu,new uu,new hu,new fu,new mu],yu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='Bullish Candlesticks',e}return Dn(t,e),Fn(t,[{key:'hasPattern',value:function(e){return _u.reduce(function(t,a){var r=a.hasPattern(e);return t||r},!1)}}]),t}(iu),xu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BearishEngulfingPattern',e.requiredCount=2,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return a>t&&t<n&&a<n&&t>i}}]),t}(iu),vu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=2,e.name='BearishHarami',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return t<n&&a>n&&a>i&&t<s&&r>u}}]),t}(iu),bu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=2,e.name='BearishHaramiCross',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=this.approximateEqual(n,i);return t<n&&a>n&&a>i&&t<s&&r>u&&l}}]),t}(iu),Su=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='EveningDojiStar',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new du().hasPattern({open:[n],close:[i],high:[u],low:[s]});return a>t&&g&&u>r&&s>r&&l<s&&i>l&&l>p&&p<(t+a)/2}}]),t}(iu),Pu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='EveningStar',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a>t&&r<s&&r<u&&u>r&&s>r&&l<s&&i>l&&l>p&&p<(t+a)/2}}]),t}(iu),Tu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BearishMarubozu',e.requiredCount=1,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,r)&&this.approximateEqual(o,a)&&t>a&&t>o;return n}}]),t}(iu),wu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='ThreeBlackCrows',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return o>s&&s>c&&t>a&&n>i&&l>p&&t>n&&n>a&&n>l&&l>i}}]),t}(iu),ku=[new xu,new vu,new bu,new Su,new Pu,new Tu,new wu],Cu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='Bearish Candlesticks',e}return Dn(t,e),Fn(t,[{key:'hasPattern',value:function(e){return ku.reduce(function(t,a){return t||a.hasPattern(e)},!1)}}]),t}(iu),Fu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='AbandonedBaby',e.requiredCount=3,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new du().hasPattern({open:[n],close:[i],high:[u],low:[s]});return a<t&&g&&u<o&&c>u&&p>l&&d<t}}]),t}(iu),Mu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='DarkCloudCover',e.requiredCount=2,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],u=e.high[1],s=e.low[1];return a>t&&i<n&&n>r&&i<(a+t)/2&&i>t}}]),t}(iu),Du=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=1,e.name='DragonFlyDoji',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=this.approximateEqual(t,a),n=this.approximateEqual(t,r);return o&&n}}]),t}(iu),Iu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requiredCount=1,e.name='GraveStoneDoji',e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.low[0],o=this.approximateEqual(t,a),n=this.approximateEqual(t,r);return o&&n}}]),t}(iu),Ru=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BullishSpinningTop',e.requiredCount=1,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Pn(a-t),i=Pn(r-a),u=Pn(t-o);return n<i&&n<u}}]),t}(iu),Eu=function(e){function t(){Cn(this,t);var e=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name='BearishSpinningTop',e.requiredCount=1,e}return Dn(t,e),Fn(t,[{key:'logic',value:function(e){var t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Pn(a-t),i=Pn(r-t),u=Pn(r-o);return n<i&&n<u}}]),t}(iu),Au='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,Lu=me,Ou='object'==kn(Au)&&Au&&Au.Object===Object&&Au,ju=Ou,zu='object'==('undefined'==typeof self?'undefined':kn(self))&&self&&self.Object===Object&&self,Gu=ju||zu||Function('return this')(),Uu=Gu,qu=Uu.Symbol,Nu=qu,Bu=Object.prototype,Vu=Bu.hasOwnProperty,Hu=Bu.toString,Wu=Nu?Nu.toStringTag:void 0,Xu=_e,$u=Object.prototype,Ku=$u.toString,Qu=ye,Zu='[object Null]',Yu='[object Undefined]',Ju=Nu?Nu.toStringTag:void 0,es=xe,ts=ve,as='[object Arguments]',rs=be,os=Object.prototype,ns=os.hasOwnProperty,is=os.propertyIsEnumerable,us=rs(function(){return arguments}())?rs:function(e){return ts(e)&&ns.call(e,'callee')&&!is.call(e,'callee')},ss=us,ls=Array.isArray,ps=ls,ds=Se,cs=fe(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o?Uu.Buffer:void 0,i=n?n.isBuffer:void 0;e.exports=i||ds}),gs=9007199254740991,hs=/^(?:0|[1-9]\d*)$/,fs=Pe,ms=9007199254740991,_s=Te,ys='[object Arguments]',xs='[object Array]',vs='[object Boolean]',bs='[object Date]',Ss='[object Error]',Ps='[object Function]',Ts='[object Map]',ws='[object Number]',ks='[object Object]',Cs='[object RegExp]',Fs='[object Set]',Ms='[object String]',Ds='[object WeakMap]',Is='[object ArrayBuffer]',Rs='[object DataView]',Es='[object Float32Array]',As='[object Float64Array]',Ls='[object Int8Array]',Os='[object Int16Array]',js='[object Int32Array]',zs='[object Uint8Array]',Gs='[object Uint8ClampedArray]',Us='[object Uint16Array]',qs='[object Uint32Array]',Ns={};Ns[Es]=Ns[As]=Ns[Ls]=Ns[Os]=Ns[js]=Ns[zs]=Ns[Gs]=Ns[Us]=Ns[qs]=!0,Ns[ys]=Ns[xs]=Ns[Is]=Ns[vs]=Ns[Rs]=Ns[bs]=Ns[Ss]=Ns[Ps]=Ns[Ts]=Ns[ws]=Ns[ks]=Ns[Cs]=Ns[Fs]=Ns[Ms]=Ns[Ds]=!1;var Bs=we,Vs=ke,Hs=fe(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o&&ju.process,i=function(){try{return n&&n.binding&&n.binding('util')}catch(t){}}();e.exports=i}),Ws=Hs&&Hs.isTypedArray,Xs=Ws?Vs(Ws):Bs,$s=Xs,Ks=Object.prototype,Qs=Ks.hasOwnProperty,Zs=Ce,Ys=Object.prototype,Js=Fe,el=Me,tl=el(Object.keys,Object),al=tl,rl=Object.prototype,ol=rl.hasOwnProperty,nl=De,il=Ie,ul='[object AsyncFunction]',sl='[object Function]',ll='[object GeneratorFunction]',pl='[object Proxy]',dl=Re,cl=Ee,gl=Ae,hl=Le,fl=Oe,ml=je,_l=Array.prototype,yl=_l.splice,xl=ze,vl=Ge,bl=Ue,Sl=qe;Ne.prototype.clear=hl,Ne.prototype['delete']=xl,Ne.prototype.get=vl,Ne.prototype.has=bl,Ne.prototype.set=Sl;var Pl=Ne,Tl=Be,wl=Ve,kl=He,Cl=We,Fl=Uu['__core-js_shared__'],Ml=Fl,Dl=function(){var e=/[^.]+$/.exec(Ml&&Ml.keys&&Ml.keys.IE_PROTO||'');return e?'Symbol(src)_1.'+e:''}(),Il=Xe,Rl=Function.prototype,El=Rl.toString,Al=$e,Ll=/[\\^$.*+?()[\]{}|]/g,Ol=/^\[object .+?Constructor\]$/,jl=Function.prototype,zl=Object.prototype,Gl=jl.toString,Ul=zl.hasOwnProperty,ql=RegExp('^'+Gl.call(Ul).replace(Ll,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),Nl=Ke,Bl=Qe,Vl=Ze,Hl=Vl(Uu,'Map'),Wl=Hl,Xl=Vl(Object,'create'),$l=Xl,Kl=Ye,Ql=Je,Zl='__lodash_hash_undefined__',Yl=Object.prototype,Jl=Yl.hasOwnProperty,ep=et,tp=Object.prototype,ap=tp.hasOwnProperty,rp=tt,op='__lodash_hash_undefined__',np=at;rt.prototype.clear=Kl,rt.prototype['delete']=Ql,rt.prototype.get=ep,rt.prototype.has=rp,rt.prototype.set=np;var ip=rt,up=ot,sp=nt,lp=it,pp=ut,dp=st,cp=lt,gp=pt;dt.prototype.clear=up,dt.prototype['delete']=pp,dt.prototype.get=dp,dt.prototype.has=cp,dt.prototype.set=gp;var hp=dt,fp=200,mp=ct;gt.prototype.clear=Tl,gt.prototype['delete']=wl,gt.prototype.get=kl,gt.prototype.has=Cl,gt.prototype.set=mp;var _p=gt,yp='__lodash_hash_undefined__',xp=ht,vp=ft;mt.prototype.add=mt.prototype.push=xp,mt.prototype.has=vp;var bp=mt,Sp=_t,Pp=yt,Tp=1,wp=2,kp=xt,Cp=Uu.Uint8Array,Fp=Cp,Mp=vt,Dp=bt,Ip=1,Rp=2,Ep='[object Boolean]',Ap='[object Date]',Lp='[object Error]',Op='[object Map]',jp='[object Number]',zp='[object RegExp]',Gp='[object Set]',Up='[object String]',qp='[object Symbol]',Np='[object ArrayBuffer]',Bp='[object DataView]',Vp=Nu?Nu.prototype:void 0,Hp=Vp?Vp.valueOf:void 0,Wp=St,Xp=Pt,$p=Tt,Kp=wt,Qp=kt,Zp=Object.prototype,Yp=Zp.propertyIsEnumerable,Jp=Object.getOwnPropertySymbols,ed=Jp?function(e){return null==e?[]:(e=Object(e),Kp(Jp(e),function(t){return Yp.call(e,t)}))}:Qp,td=ed,ad=Ct,rd=1,od=Object.prototype,nd=od.hasOwnProperty,id=Ft,ud=Vl(Uu,'DataView'),sd=ud,ld=Vl(Uu,'Promise'),pd=ld,dd=Vl(Uu,'Set'),cd=dd,gd=Vl(Uu,'WeakMap'),hd=gd,fd='[object Map]',md='[object Object]',_d='[object Promise]',yd='[object Set]',xd='[object WeakMap]',vd='[object DataView]',bd=Al(sd),Sd=Al(Wl),Pd=Al(pd),Td=Al(cd),wd=Al(hd),kd=es;(sd&&kd(new sd(new ArrayBuffer(1)))!=vd||Wl&&kd(new Wl)!=fd||pd&&kd(pd.resolve())!=_d||cd&&kd(new cd)!=yd||hd&&kd(new hd)!=xd)&&(kd=function(e){var t=es(e),a=t==md?e.constructor:void 0,r=a?Al(a):'';if(r)switch(r){case bd:return vd;case Sd:return fd;case Pd:return _d;case Td:return yd;case wd:return xd;}return t});var Cd=kd,Fd=1,Md='[object Arguments]',Dd='[object Array]',Id='[object Object]',Rd=Object.prototype,Ed=Rd.hasOwnProperty,Ad=Mt,Ld=Dt,Od=It,jd=Rt,zd=1,Gd=2,Ud=Et,qd=At,Nd=Lt,Bd=Ot,Vd=jt,Hd='[object Symbol]',Wd=zt,Xd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$d=/^\w*$/,Kd=Gt,Qd='Expected a function';Ut.Cache=hp;var Zd=Ut,Yd=500,Jd=qt,ec=/^\./,tc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ac=/\\(\\)?/g,rc=Jd(function(e){var t=[];return ec.test(e)&&t.push(''),e.replace(tc,function(e,a,r,o){t.push(r?o.replace(ac,'$1'):a||e)}),t}),oc=rc,nc=1/0,ic=Nu?Nu.prototype:void 0,uc=ic?ic.toString:void 0,sc=Nt,lc=Bt,pc=Vt,dc=1/0,cc=Ht,gc=Wt,hc=Xt,fc=$t,mc=Kt,_c=Qt,yc=1,xc=2,vc=Zt,bc=Yt,Sc=Jt,Pc=ea,Tc=ta,wc=aa,kc=ra,Cc=kc(),Fc=Cc,Mc=oa,Dc=na,Ic=Dc(Mc),Rc=Ic,Ec=ia,Ac=ua,Lc=sa,Oc=la,jc=pa,zc=da,Gc=ca,Uc=ga,qc=0/0,Nc=/^\s+|\s+$/g,Bc=/^[-+]0x[0-9a-f]+$/i,Vc=/^0b[01]+$/i,Hc=/^0o[0-7]+$/i,Wc=parseInt,Xc=ha,$c=1/0,Kc=1.7976931348623157e308,Qc=fa,Zc=ma,Yc=Sn,Jc=_a,eg=Gc(Jc),tg=eg,ag=function(){try{var e=Vl(Object,'defineProperty');return e({},'',{}),e}catch(t){}}(),rg=ag,og=ya,ng=Object.prototype,ig=ng.hasOwnProperty,ug=xa,sg=va,lg=ba,pg=Sa,dg=Nu?Nu.isConcatSpreadable:void 0,cg=Pa,gg=Ta,hg=wa,fg=ka,mg=Sn,_g=Ca,yg=Fa,xg=rg?function(e,t){return rg(e,'toString',{configurable:!0,enumerable:!1,value:yg(t),writable:!0})}:bc,vg=xg,bg=800,Sg=16,Pg=Date.now,Tg=Ma,wg=Tg(vg),kg=wg,Cg=Da,Fg=Cg(function(e,t){return null==e?{}:pg(e,t)}),Mg=Fg,Dg=fe(function(t,e){!function(a){t.exports=a()}(function(){var e,t,a;return function p(d,e,t){function a(i,o){if(!e[i]){if(!d[i]){var n='function'==typeof _dereq_&&_dereq_;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error('Cannot find module \''+i+'\'');throw s.code='MODULE_NOT_FOUND',s}var c=e[i]={exports:{}};d[i][0].call(c.exports,function(t){var e=d[i][1][t];return a(e?e:t)},c,c.exports,p,d,e,t)}return e[i].exports}for(var r='function'==typeof _dereq_&&_dereq_,n=0;n<t.length;n++)a(t[n]);return a}({1:[function(e,t){t.exports=function(e){function t(e){var t=new a(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var a=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t){function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=u}function r(e,t,a){this._lateQueue.push(e,t,a),this._queueTick()}function o(e,t,a){this._normalQueue.push(e,t,a),this._queueTick()}function n(e){this._normalQueue._pushOne(e),this._queueTick()}var i;try{throw new Error}catch(t){i=t}var u=e('./schedule'),s=e('./queue'),l=e('./util');a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},a.prototype.disableTrampolineIfNecessary=function(){l.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,e){e?(process.stderr.write('Fatal '+(t instanceof Error?t.stack:t)+'\n'),process.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),'undefined'!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(t){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}},l.hasDevTools?(a.prototype.invokeLater=function(e,t,a){this._trampolineEnabled?r.call(this,e,t,a):this._schedule(function(){setTimeout(function(){e.call(t,a)},100)})},a.prototype.invoke=function(e,t,a){this._trampolineEnabled?o.call(this,e,t,a):this._schedule(function(){e.call(t,a)})},a.prototype.settlePromises=function(e){this._trampolineEnabled?n.call(this,e):this._schedule(function(){e._settlePromises()})}):(a.prototype.invokeLater=r,a.prototype.invoke=o,a.prototype.settlePromises=n),a.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if('function'!=typeof t){t._settlePromises();continue}var a=e.shift(),r=e.shift();t.call(a,r)}},a.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=i},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t){t.exports=function(e,t,a,r){var o=!1,n=function(t,a){this._reject(a)},i=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(n,n,null,this,t)},u=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},s=function(t,e){e.promiseRejectionQueued||this._reject(t)};e.prototype.bind=function(n){o||(o=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var l=a(n),p=new e(t);p._propagateFrom(this,1);var d=this._target();if(p._setBoundTo(l),l instanceof e){var c={promiseRejectionQueued:!1,promise:p,target:d,bindingPromise:l};d._then(t,i,void 0,p,c),l._then(u,s,void 0,p,c),p._setOnCancel(l)}else p._resolveCallback(d);return p},e.prototype._setBoundTo=function(e){e===void 0?this._bitField&=-2097153:(this._bitField|=2097152,this._boundTo=e)},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,a){return e.resolve(a).bind(t)}}},{}],4:[function(e,t){var a;'undefined'!=typeof Promise&&(a=Promise);var r=e('./promise')();r.noConflict=function(){try{Promise===r&&(Promise=a)}catch(t){}return r},t.exports=r},{"./promise":22}],5:[function(e,t){var a=Object.create;if(a){var r=a(null),o=a(null);r[' size']=o[' size']=0}t.exports=function(t){function a(e,a){var r;if(null!=e&&(r=e[a]),'function'!=typeof r){var o='Object '+i.classString(e)+' has no method \''+i.toString(a)+'\'';throw new t.TypeError(o)}return r}function r(e){var t=this.pop(),r=a(e,t);return r.apply(e,this)}function o(e){return e[this]}function n(e){var t=+this;return 0>t&&(t=Sn(0,t+e.length)),e[t]}var i=e('./util'),u=i.canEvaluate,s=i.isIdentifier,l;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if(!!('number'==typeof e))t=n;else if(u){var a=l(e);t=null===a?o:a}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t){t.exports=function(t,a,r,o){var n=e('./util'),i=n.tryCatch,u=n.errorObj,s=t._async;t.prototype['break']=t.prototype.cancel=function(){if(!o.cancellation())return this._warn('cancellation is disabled');for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var a=e._cancellationParent;if(null==a||!a._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}else e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=a}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||0>=this._branchesRemainingToCancel},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):!(this._branchHasCancelled(),!this._enoughBranchesHaveCancelled())&&(this._invokeOnCancel(),!0)},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),s.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,a){if(n.isArray(t))for(var r=0;r<t.length;++r)this._doInvokeOnCancel(t[r],a);else if(t!==void 0)if('function'!=typeof t)t._resultCancelled(this);else if(!a){var o=i(t).call(this._boundValue());o===u&&(this._attachExtraTrace(o.e),s.throwLater(o.e))}},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),s.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t){t.exports=function(t){var a=e('./util'),r=e('./es5').keys,o=a.tryCatch,n=a.errorObj;return function(u,s,l){return function(p){var e=l._boundValue();predicateLoop:for(var d=0,i;d<u.length;++d)if(i=u[d],i===Error||null!=i&&i.prototype instanceof Error){if(p instanceof i)return o(s).call(e,p);}else if('function'==typeof i){var c=o(i).call(e,p);if(c===n)return c;if(c)return o(s).call(e,p)}else if(a.isObject(p)){for(var g=r(i),h=0,f;h<g.length;++h)if(f=g[h],i[f]!=p[f])continue predicateLoop;return o(s).call(e,p)}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t){t.exports=function(e){function t(){this._trace=new t.CapturedTrace(a())}function a(){var e=o.length-1;return 0<=e?o[e]:void 0}var r=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=function(){if(r)return new t},t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var o=e.prototype._pushContext,n=e.prototype._popContext,i=e._peekContext,u=e.prototype._peekContext,s=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=o,e.prototype._popContext=n,e._peekContext=i,e.prototype._peekContext=u,e.prototype._promiseCreated=s,r=!1},r=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=a,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t){t.exports=function(t,a){function r(e,t){return{promise:t}}function o(){return!1}function n(e,t,a){var r=this;try{e(t,a,function(e){if('function'!=typeof e)throw new TypeError('onCancel must be a function, got: '+I.toString(e));r._attachCancellationCallback(e)})}catch(t){return t}}function i(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0===t?this._setOnCancel(e):I.isArray(t)?t.push(e):this._setOnCancel([t,e])}function u(){return this._onCancelField}function s(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function p(e,t){if(0!=(1&t)){this._cancellationParent=e;var a=e._branchesRemainingToCancel;void 0===a&&(a=0),e._branchesRemainingToCancel=a+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function d(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function c(){this._trace=new C(this._peekContext())}function g(e,t){if(R(e)){var a=this._trace;if(void 0!==a&&t&&(a=a._parent),void 0!==a)a.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=v(e);I.notEnumerableProp(e,'stack',r.message+'\n'+r.stack.join('\n')),I.notEnumerableProp(e,'__stackCleaned__',!0)}}}function h(e,a,r){if(te.warnings){var o=new D(e),n;if(a)r._attachExtraTrace(o);else if(te.longStackTraces&&(n=t._peekContext()))n.attachExtraTrace(o);else{var i=v(o);o.stack=i.message+'\n'+i.stack.join('\n')}Q('warning',o)||b(o,'',!0)}}function f(e,t){for(var a=0;a<t.length-1;++a)t[a].push('From previous event:'),t[a]=t[a].join('\n');return a<t.length&&(t[a]=t[a].join('\n')),e+'\n'+t.join('\n')}function m(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function _(e){for(var t=e[0],a=1;a<e.length;++a){for(var r=e[a],o=t.length-1,n=t[o],i=-1,u=r.length-1;0<=u;--u)if(r[u]===n){i=u;break}for(var u=i,s;0<=u&&(s=r[u],t[o]===s);--u)t.pop(),o--;t=r}}function y(e){for(var t=[],a=0;a<e.length;++a){var r=e[a],o='    (No stack trace)'===r||O.test(r),n=o&&Y(r);o&&!n&&(z&&' '!==r.charAt(0)&&(r='    '+r),t.push(r))}return t}function x(e){for(var t=e.stack.replace(/\s+$/g,'').split('\n'),a=0,r;a<t.length&&(r=t[a],!('    (No stack trace)'===r||O.test(r)));++a);return 0<a&&'SyntaxError'!=e.name&&(t=t.slice(a)),t}function v(e){var t=e.stack,a=e.toString();return t='string'==typeof t&&0<t.length?x(e):['    (No stack trace)'],{message:a,stack:'SyntaxError'==e.name?t:y(t)}}function b(e,t,a){if('undefined'!=typeof console){var r;if(I.isObject(e)){var o=e.stack;r=t+j(o,e)}else r=t+(e+'');'function'==typeof H?H(r,a):('function'==typeof console.log||'object'===kn(console.log))&&console.log(r)}}function S(e,t,a,r){var o=!1;try{'function'==typeof t&&(o=!0,'rejectionHandled'===e?t(r):t(a,r))}catch(t){M.throwLater(t)}'unhandledRejection'===e?!Q(e,a,r)&&!o&&b(a,'Unhandled rejection '):Q(e,r)}function P(e){var t;if('function'==typeof e)t='[function '+(e.name||'anonymous')+']';else{t=e&&'function'==typeof e.toString?e.toString():I.toString(e);var a=/\[object [a-zA-Z0-9$_]+\]/;if(a.test(t))try{var r=JSON.stringify(e);t=r}catch(t){}0===t.length&&(t='(empty array)')}return'(<'+T(t)+'>, no stack trace)'}function T(e){var t=41;return e.length<t?e:e.substr(0,t-3)+'...'}function w(){return'function'==typeof ee}function k(e){var t=e.match(J);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function C(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ee(this,C),32<t&&this.uncycle()}var F=t._getDomain,M=t._async,D=e('./errors').Warning,I=e('./util'),R=I.canAttachTrace,E=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,A=/\((?:timers\.js):\d+:\d+\)/,L=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,O=null,j=null,z=!1,G=!(0==I.env('BLUEBIRD_DEBUG')||0),U=!!(0!=I.env('BLUEBIRD_WARNINGS')&&(G||I.env('BLUEBIRD_WARNINGS'))),q=!!(0!=I.env('BLUEBIRD_LONG_STACK_TRACES')&&(G||I.env('BLUEBIRD_LONG_STACK_TRACES'))),N=0!=I.env('BLUEBIRD_W_FORGOTTEN_RETURN')&&(U||!!I.env('BLUEBIRD_W_FORGOTTEN_RETURN')),B,V,H;t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=524288|-1048577&e._bitField},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){S('rejectionHandled',B,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField|=268435456},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),S('unhandledRejection',V,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField|=262144},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField&=-262145},t.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},t.prototype._setRejectionIsUnhandled=function(){this._bitField|=1048576},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField&=-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},t.prototype._warn=function(e,t,a){return h(e,t,a||this)},t.onPossiblyUnhandledRejection=function(e){var t=F();V='function'==typeof e?null===t?e:I.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=F();B='function'==typeof e?null===t?e:I.domainBind(t,e):void 0};var W=function(){};t.longStackTraces=function(){if(M.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');if(!te.longStackTraces&&w()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;te.longStackTraces=!0,W=function(){if(M.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,a.deactivateLongStackTraces(),M.enableTrampoline(),te.longStackTraces=!1},t.prototype._captureStackTrace=c,t.prototype._attachExtraTrace=g,a.activateLongStackTraces(),M.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return te.longStackTraces&&w()};var X=function(){try{if('function'==typeof CustomEvent){var e=new CustomEvent('CustomEvent');return I.global.dispatchEvent(e),function(e,t){var a=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!I.global.dispatchEvent(a)}}if('function'==typeof Event){var e=new Event('CustomEvent');return I.global.dispatchEvent(e),function(e,t){var a=new Event(e.toLowerCase(),{cancelable:!0});return a.detail=t,!I.global.dispatchEvent(a)}}var e=document.createEvent('CustomEvent');return e.initCustomEvent('testingtheevent',!1,!0,{}),I.global.dispatchEvent(e),function(e,t){var a=document.createEvent('CustomEvent');return a.initCustomEvent(e.toLowerCase(),!1,!0,t),!I.global.dispatchEvent(a)}}catch(t){}return function(){return!1}}(),$=function(){return I.isNode?function(){return process.emit.apply(process,arguments)}:I.global?function(e){var t='on'+e.toLowerCase(),a=I.global[t];return!!a&&(a.apply(I.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),K={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(e,t,a){return{promise:t,child:a}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,a){return{reason:t,promise:a}},rejectionHandled:r},Q=function(e){var t=!1;try{t=$.apply(null,arguments)}catch(a){M.throwLater(a),t=!0}var a=!1;try{a=X(e,K[e].apply(null,arguments))}catch(t){M.throwLater(t),a=!0}return a||t};t.config=function(e){if(e=Object(e),'longStackTraces'in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&W()),'warnings'in e){var a=e.warnings;te.warnings=!!a,N=te.warnings,I.isObject(a)&&'wForgottenReturn'in a&&(N=!!a.wForgottenReturn)}if('cancellation'in e&&e.cancellation&&!te.cancellation){if(M.haveItemsQueued())throw new Error('cannot enable cancellation after promises are in use');t.prototype._clearCancellationData=l,t.prototype._propagateFrom=p,t.prototype._onCancel=u,t.prototype._setOnCancel=s,t.prototype._attachCancellationCallback=i,t.prototype._execute=n,Z=p,te.cancellation=!0}return'monitoring'in e&&(e.monitoring&&!te.monitoring?(te.monitoring=!0,t.prototype._fireEvent=Q):!e.monitoring&&te.monitoring&&(te.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,a){try{e(t,a)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(){},t.prototype._attachCancellationCallback=function(){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(){};var Z=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},Y=function(){return!1},J=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;I.inherits(C,Error),a.CapturedTrace=C,C.prototype.uncycle=function(){var e=this._length;if(!(2>e)){for(var t=[],a={},r=0,o=this;void 0!==o;++r)t.push(o),o=o._parent;e=this._length=r;for(var r=e-1,n;0<=r;--r)n=t[r].stack,void 0===a[n]&&(a[n]=r);for(var r=0;r<e;++r){var i=t[r].stack,u=a[i];if(void 0!==u&&u!==r){0<u&&(t[u-1]._parent=void 0,t[u-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var s=0<r?t[r-1]:this;u<e-1?(s._parent=t[u+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,p=r-2;0<=p;--p)t[p]._length=l,l++;return}}}},C.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=v(e),a=t.message,r=[t.stack],o=this;void 0!==o;)r.push(y(o.stack.split('\n'))),o=o._parent;_(r),m(r),I.notEnumerableProp(e,'stack',f(a,r)),I.notEnumerableProp(e,'__stackCleaned__',!0)}};var ee=function(){var e=/^\s*at\s*/,t=function(e,t){return'string'==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():P(t)};if('number'==typeof Error.stackTraceLimit&&'function'==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,O=e,j=t;var a=Error.captureStackTrace;return Y=function(e){return E.test(e)},function(e,t){Error.stackTraceLimit+=6,a(e,t),Error.stackTraceLimit-=6}}var r=new Error;if('string'==typeof r.stack&&0<=r.stack.split('\n')[0].indexOf('stackDetection@'))return O=/@/,j=t,z=!0,function(e){e.stack=new Error().stack};var o;try{throw new Error}catch(t){o='stack'in t}return!('stack'in r)&&o&&'number'==typeof Error.stackTraceLimit?(O=e,j=t,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(a){t.stack=a.stack}Error.stackTraceLimit-=6}):(j=function(e,t){return'string'==typeof e?e:('object'===('undefined'==typeof t?'undefined':kn(t))||'function'==typeof t)&&void 0!==t.name&&void 0!==t.message?t.toString():P(t)},null)}([]);'undefined'!=typeof console&&'undefined'!=typeof console.warn&&(H=function(e){console.warn(e)},I.isNode&&process.stderr.isTTY?H=function(e,t){var a=t?'\x1B[33m':'\x1B[31m';console.warn(a+e+'\x1B[0m\n')}:!I.isNode&&'string'==typeof new Error().stack&&(H=function(e,t){console.warn('%c'+e,t?'color: darkorange':'color: red')}));var te={warnings:U,longStackTraces:!1,cancellation:!1,monitoring:!1};return q&&t.longStackTraces(),{longStackTraces:function(){return te.longStackTraces},warnings:function(){return te.warnings},cancellation:function(){return te.cancellation},monitoring:function(){return te.monitoring},propagateFromFunction:function(){return Z},boundValueFunction:function(){return d},checkForgottenReturns:function(e,t,a,r,o){if(void 0===e&&null!==t&&N){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&r._bitField))return;a&&(a+=' ');var n='',u='';if(t._trace){for(var s=t._trace.stack.split('\n'),l=y(s),p=l.length-1,i;0<=p;--p)if(i=l[p],!A.test(i)){var d=i.match(L);d&&(n='at '+d[1]+':'+d[2]+':'+d[3]+' ');break}if(0<l.length)for(var c=l[0],p=0;p<s.length;++p)if(s[p]===c){0<p&&(u='\n'+s[p-1]);break}}var g='a promise was created in a '+a+'handler '+n+'but was not returned from it, see http://goo.gl/rRqMUw'+u;r._warn(g,!0,t)}},setBounds:function(e,t){if(w()){for(var a=e.stack.split('\n'),r=t.stack.split('\n'),o=-1,n=-1,u=0,i,s,l;u<a.length;++u)if(l=k(a[u]),l){i=l.fileName,o=l.line;break}for(var u=0,l;u<r.length;++u)if(l=k(r[u]),l){s=l.fileName,n=l.line;break}0>o||0>n||!i||!s||i!==s||o>=n||(Y=function(e){if(E.test(e))return!0;var t=k(e);return t&&t.fileName===i&&o<=t.line&&t.line<=n})}},warn:h,deprecated:function(e,t){var a=e+' is deprecated and will be removed in a future version.';return t&&(a+=' Use '+t+' instead.'),h(a)},CapturedTrace:C,fireDomEvent:X,fireGlobalEvent:$}}},{"./errors":12,"./util":36}],10:[function(e,t){t.exports=function(e){function t(){return this.value}function a(){throw this.reason}e.prototype['return']=e.prototype.thenReturn=function(a){return a instanceof e&&a.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:a},void 0)},e.prototype['throw']=e.prototype.thenThrow=function(e){return this._then(a,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(1>=arguments.length)return this._then(void 0,a,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},e.prototype.catchReturn=function(a){if(1>=arguments.length)return a instanceof e&&a.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:a},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();return this.caught(a,function(){return r})}}},{}],11:[function(e,t){t.exports=function(e,t){function a(){return o(this)}var r=e.reduce,o=e.all;e.prototype.each=function(e){return r(this,e,t,0)._then(a,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,o){return r(e,o,t,0)._then(a,void 0,void 0,e,void 0)},e.mapSeries=function(e,a){return r(e,a,t,t)}}},{}],12:[function(e,t){function a(e,t){function a(r){return this instanceof a?void(l(this,'message','string'==typeof r?r:t),l(this,'name',e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)):new a(r)}return s(a,Error),a}function r(e){return this instanceof r?void(l(this,'name','OperationalError'),l(this,'message',e),this.cause=e,this.isOperational=!0,e instanceof Error?(l(this,'message',e.message),l(this,'stack',e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)):new r(e)}var o=e('./es5'),n=o.freeze,u=e('./util'),s=u.inherits,l=u.notEnumerableProp,p=a('Warning','warning'),d=a('CancellationError','cancellation error'),c=a('TimeoutError','timeout error'),g=a('AggregateError','aggregate error'),h,f;try{h=TypeError,f=RangeError}catch(t){h=a('TypeError','type error'),f=a('RangeError','range error')}for(var m='join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse'.split(' '),_=0;_<m.length;++_)'function'==typeof Array.prototype[m[_]]&&(g.prototype[m[_]]=Array.prototype[m[_]]);o.defineProperty(g.prototype,'length',{value:0,configurable:!1,writable:!0,enumerable:!0}),g.prototype.isOperational=!0;var y=0;g.prototype.toString=function(){var e=Array(4*y+1).join(' '),t='\n'+e+'AggregateError of:\n';y++,e=Array(4*y+1).join(' ');for(var a=0;a<this.length;++a){for(var r=this[a]===this?'[Circular AggregateError]':this[a]+'',o=r.split('\n'),n=0;n<o.length;++n)o[n]=e+o[n];r=o.join('\n'),t+=r+'\n'}return y--,t},s(r,Error);var i=Error.__BluebirdErrorTypes__;i||(i=n({CancellationError:d,TimeoutError:c,OperationalError:r,RejectionError:r,AggregateError:g}),o.defineProperty(Error,'__BluebirdErrorTypes__',{value:i,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:h,RangeError:f,CancellationError:i.CancellationError,OperationalError:i.OperationalError,TimeoutError:i.TimeoutError,AggregateError:i.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t){var a=function(){return this===void 0}();if(a)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(e,t){var a=Object.getOwnPropertyDescriptor(e,t);return!!(!a||a.writable||a.set)}};else{var r={}.hasOwnProperty,o={}.toString,n={}.constructor.prototype,i=function(e){var t=[];for(var a in e)r.call(e,a)&&t.push(a);return t},u=function(e,t){return{value:e[t]}},s=function(e,t,a){return e[t]=a.value,e},l=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(t){return n}},d=function(e){try{return'[object Array]'===o.call(e)}catch(t){return!1}};t.exports={isArray:d,keys:i,names:i,defineProperty:s,getDescriptor:u,freeze:l,getPrototypeOf:p,isES5:a,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t){t.exports=function(e,t){var a=e.map;e.prototype.filter=function(e,r){return a(this,e,r,t)},e.filter=function(e,r,o){return a(e,r,o,t)}}},{}],15:[function(e,t){t.exports=function(t,a,r){function o(e,t,a){this.promise=e,this.type=t,this.handler=a,this.called=!1,this.cancelPromise=null}function n(e){this.finallyHandler=e}function i(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function u(){return l.call(this,this.promise._target()._settledValue())}function s(e){if(!i(this,e))return c.e=e,c}function l(e){var o=this.promise,l=this.handler;if(!this.called){this.called=!0;var p=this.isFinallyHandler()?l.call(o._boundValue()):l.call(o._boundValue(),e);if(p===r)return p;if(void 0!==p){o._setReturnedNonUndefined();var g=a(p,o);if(g instanceof t){if(null!=this.cancelPromise){if(g._isCancelled()){var h=new d('late cancellation observer');return o._attachExtraTrace(h),c.e=h,c}g.isPending()&&g._attachCancellationCallback(new n(this))}return g._then(u,s,void 0,this,void 0)}}}return o.isRejected()?(i(this),c.e=e,c):(i(this),e)}var p=e('./util'),d=t.CancellationError,c=p.errorObj,g=e('./catch_filter')(r);return o.prototype.isFinallyHandler=function(){return 0===this.type},n.prototype._resultCancelled=function(){i(this.finallyHandler)},t.prototype._passThrough=function(e,t,a,r){return'function'==typeof e?this._then(a,r,void 0,new o(this,t,e),void 0):this.then()},t.prototype.lastly=t.prototype['finally']=function(e){return this._passThrough(e,0,l,l)},t.prototype.tap=function(e){return this._passThrough(e,1,l)},t.prototype.tapCatch=function(e){var a=arguments.length;if(1===a)return this._passThrough(e,1,void 0,l);var r=Array(a-1),o=0,n;for(n=0;n<a-1;++n){var i=arguments[n];if(p.isObject(i))r[o++]=i;else return t.reject(new TypeError('tapCatch statement predicate: expecting an object but got '+p.classString(i)))}r.length=o;var u=arguments[n];return this._passThrough(g(r,u,this),1,void 0,l)},o}},{"./catch_filter":7,"./util":36}],16:[function(e,t){t.exports=function(t,a,r,o,n,i){function u(e,a,r){for(var n=0;n<a.length;++n){r._pushContext();var i=g(a[n])(e);if(r._popContext(),i===c){r._pushContext();var u=t.reject(c.e);return r._popContext(),u}var s=o(i,r);if(s instanceof t)return s}return null}function s(e,a,o,n){if(i.cancellation()){var u=new t(r),s=this._finallyPromise=new t(r);this._promise=u.lastly(function(){return s}),u._captureStackTrace(),u._setOnCancel(this)}else{var l=this._promise=new t(r);l._captureStackTrace()}this._stack=n,this._generatorFunction=e,this._receiver=a,this._generator=void 0,this._yieldHandlers='function'==typeof o?[o].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}var l=e('./errors'),p=l.TypeError,d=e('./util'),c=d.errorObj,g=d.tryCatch,h=[];d.inherits(s,n),s.prototype._isResolved=function(){return null===this._promise},s.prototype._cleanup=function(){this._promise=this._generator=null,i.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},s.prototype._promiseCancelled=function(){if(!this._isResolved()){var e='undefined'!=typeof this._generator['return'],a;if(!e){var r=new t.CancellationError('generator .return() sentinel');t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),a=g(this._generator['throw']).call(this._generator,r),this._promise._popContext()}else this._promise._pushContext(),a=g(this._generator['return']).call(this._generator,void 0),this._promise._popContext();this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(a)}},s.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=g(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=g(this._generator['throw']).call(this._generator,e);this._promise._popContext(),this._continue(t)},s.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},s.prototype._continue=function(e){var a=this._promise;if(e===c)return this._cleanup(),this._cancellationPhase?a.cancel():a._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?a.cancel():a._resolveCallback(r);var n=o(r,this._promise);if(!(n instanceof t)&&(n=u(n,this._yieldHandlers,this._promise),null===n))return void this._promiseRejected(new p('A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n'.replace('%s',r+'')+'From coroutine:\n'+this._stack.split('\n').slice(1,-7).join('\n')));n=n._target();var i=n._bitField;0==(50397184&i)?(this._yieldedPromise=n,n._proxy(this,null)):0==(33554432&i)?0==(16777216&i)?this._promiseCancelled():t._async.invoke(this._promiseRejected,this,n._reason()):t._async.invoke(this._promiseFulfilled,this,n._value())},t.coroutine=function(e,t){if('function'!=typeof e)throw new p('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var a=Object(t).yieldHandler,r=new Error().stack;return function(){var t=e.apply(this,arguments),o=new s(void 0,void 0,a,r),n=o.promise();return o._generator=t,o._promiseFulfilled(void 0),n}},t.coroutine.addYieldHandler=function(e){if('function'!=typeof e)throw new p('expecting a function but got '+d.classString(e));h.push(e)},t.spawn=function(e){if(i.deprecated('Promise.spawn()','Promise.coroutine()'),'function'!=typeof e)return a('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var r=new s(e,this),o=r.promise();return r._run(t.spawn),o}}},{"./errors":12,"./util":36}],17:[function(e,t){t.exports=function(t,a){var r=e('./util'),o=r.canEvaluate,n=r.tryCatch,i=r.errorObj;t.join=function(){var e=arguments.length-1,t;if(0<e&&'function'==typeof arguments[e]){t=arguments[e];var r}var o=[].slice.call(arguments);t&&o.pop();var r=new a(o).promise();return t===void 0?r:r.spread(t)}}},{"./util":36}],18:[function(e,t){t.exports=function(t,a,r,o,n,i){function u(e,t,a,r){this.constructor$(e),this._promise._captureStackTrace();var o=l();this._callback=null===o?t:p.domainBind(o,t),this._preservedValues=r===n?Array(this.length()):null,this._limit=a,this._inFlight=0,this._queue=[],g.invoke(this._asyncInit,this,void 0)}function s(e,a,o,n){if('function'!=typeof a)return r('expecting a function but got '+p.classString(a));var i=0;if(void 0!==o)if('object'===('undefined'==typeof o?'undefined':kn(o))&&null!==o){if('number'!=typeof o.concurrency)return t.reject(new TypeError('\'concurrency\' must be a number but it is '+p.classString(o.concurrency)));i=o.concurrency}else return t.reject(new TypeError('options argument must be an object but it is '+p.classString(o)));return i='number'==typeof i&&isFinite(i)&&1<=i?i:0,new u(e,a,i,n).promise()}var l=t._getDomain,p=e('./util'),d=p.tryCatch,c=p.errorObj,g=t._async;p.inherits(u,a),u.prototype._asyncInit=function(){this._init$(void 0,-2)},u.prototype._init=function(){},u.prototype._promiseFulfilled=function(e,a){var r=this._values,n=this.length(),u=this._preservedValues,s=this._limit;if(!(0>a)){if(1<=s&&this._inFlight>=s)return r[a]=e,this._queue.push(a),!1;null!==u&&(u[a]=e);var l=this._promise,p=this._callback,g=l._boundValue();l._pushContext();var h=d(p).call(g,e,a,n),f=l._popContext();if(i.checkForgottenReturns(h,f,null===u?'Promise.map':'Promise.filter',l),h===c)return this._reject(h.e),!0;var m=o(h,this._promise);if(m instanceof t){m=m._target();var _=m._bitField;if(0==(50397184&_))return 1<=s&&this._inFlight++,r[a]=m,m._proxy(this,-1*(a+1)),!1;if(0!=(33554432&_))h=m._value();else return 0==(16777216&_)?(this._cancel(),!0):(this._reject(m._reason()),!0)}r[a]=h}else if(a=-1*a-1,r[a]=e,1<=s&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0;var y=++this._totalResolved;return!!(y>=n)&&(null===u?this._resolve(r):this._filter(r,u),!0)},u.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,a=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(a[r],r)}},u.prototype._filter=function(e,t){for(var a=t.length,r=Array(a),o=0,n=0;n<a;++n)e[n]&&(r[o++]=t[n]);r.length=o,this._resolve(r)},u.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return s(this,e,t,null)},t.map=function(e,t,a,r){return s(e,t,a,r)}}},{"./util":36}],19:[function(e,t){t.exports=function(t,a,r,o,n){var i=e('./util'),u=i.tryCatch;t.method=function(e){if('function'!=typeof e)throw new t.TypeError('expecting a function but got '+i.classString(e));return function(){var r=new t(a);r._captureStackTrace(),r._pushContext();var o=u(e).apply(this,arguments),i=r._popContext();return n.checkForgottenReturns(o,i,'Promise.method',r),r._resolveFromSyncValue(o),r}},t.attempt=t['try']=function(e){if('function'!=typeof e)return o('expecting a function but got '+i.classString(e));var r=new t(a);r._captureStackTrace(),r._pushContext();var s;if(1<arguments.length){n.deprecated('calling Promise.try with more than 1 argument');var l=arguments[1],p=arguments[2];s=i.isArray(l)?u(e).apply(p,l):u(e).call(p,l)}else s=u(e)();var d=r._popContext();return n.checkForgottenReturns(s,d,'Promise.try',r),r._resolveFromSyncValue(s),r},t.prototype._resolveFromSyncValue=function(e){e===i.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t){function a(e){return e instanceof Error&&s.getPrototypeOf(e)===Error.prototype}function r(e){var t;if(a(e)){t=new u(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=s.keys(e),n=0,i;n<r.length;++n)i=r[n],l.test(i)||(t[i]=e[i]);return t}return o.markAsOriginatingFromRejection(e),e}var o=e('./util'),n=o.maybeWrapAsError,i=e('./errors'),u=i.OperationalError,s=e('./es5'),l=/^(?:name|message|stack|cause)$/;t.exports=function(e,t){return function(a,o){if(null!==e){if(a){var i=r(n(a));e._attachExtraTrace(i),e._reject(i)}else if(!t)e._fulfill(o);else{var u=[].slice.call(arguments,1);e._fulfill(u)}e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t){t.exports=function(t){function a(e,t){var a=this;if(!n.isArray(e))return r.call(a,e,t);var o=u(t).apply(a._boundValue(),[null].concat(e));o===s&&i.throwLater(o.e)}function r(e,t){var a=this,r=a._boundValue(),o=e===void 0?u(t).call(r,null):u(t).call(r,null,e);o===s&&i.throwLater(o.e)}function o(e,t){var a=this;if(!e){var r=new Error(e+'');r.cause=e,e=r}var o=u(t).call(a._boundValue(),e);o===s&&i.throwLater(o.e)}var n=e('./util'),i=t._async,u=n.tryCatch,s=n.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if('function'==typeof e){var n=r;t!==void 0&&Object(t).spread&&(n=a),this._then(n,o,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t){t.exports=function(){function a(){}function r(e,t){if(null==e||e.constructor!==o)throw new y('the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n');if('function'!=typeof t)throw new y('expecting a function but got '+c.classString(t))}function o(e){e!==v&&r(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent('promiseCreated',this)}function n(e){this.promise._resolveCallback(e)}function i(e){this.promise._rejectCallback(e,!1)}function u(e){var t=new o(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var s=function(){return new y('circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n')},l=function(){return new o.PromiseInspection(this._target())},p=function(e){return o.reject(new y(e))},d={},c=e('./util'),g;g=c.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},c.notEnumerableProp(o,'_getDomain',g);var h=e('./es5'),f=e('./async'),m=new f;h.defineProperty(o,'_async',{value:m});var _=e('./errors'),y=o.TypeError=_.TypeError;o.RangeError=_.RangeError;var x=o.CancellationError=_.CancellationError;o.TimeoutError=_.TimeoutError,o.OperationalError=_.OperationalError,o.RejectionError=_.OperationalError,o.AggregateError=_.AggregateError;var v=function(){},b={},S={},P=e('./thenables')(o,v),T=e('./promise_array')(o,v,P,p,a),w=e('./context')(o),k=w.create,C=e('./debuggability')(o,w),F=C.CapturedTrace,M=e('./finally')(o,P,S),D=e('./catch_filter')(S),I=e('./nodeback'),R=c.errorObj,E=c.tryCatch;return o.prototype.toString=function(){return'[object Promise]'},o.prototype.caught=o.prototype['catch']=function(e){var t=arguments.length;if(1<t){var a=Array(t-1),r=0,o;for(o=0;o<t-1;++o){var n=arguments[o];if(c.isObject(n))a[r++]=n;else return p('Catch statement predicate: expecting an object but got '+c.classString(n))}return a.length=r,e=arguments[o],this.then(void 0,D(a,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},o.prototype.then=function(e,t){if(C.warnings()&&0<arguments.length&&'function'!=typeof e&&'function'!=typeof t){var a='.then() only accepts functions but was passed: '+c.classString(e);1<arguments.length&&(a+=', '+c.classString(t)),this._warn(a)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){var a=this._then(e,t,void 0,void 0,void 0);a._setIsFinal()},o.prototype.spread=function(e){return'function'==typeof e?this.all()._then(e,void 0,void 0,b,void 0):p('expecting a function but got '+c.classString(e))},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return 0<arguments.length&&this._warn('.all() was passed arguments but it does not take any'),new T(this).promise()},o.prototype.error=function(e){return this.caught(c.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(v);t._captureStackTrace();var a=!!(1<arguments.length)&&!!Object(arguments[1]).multiArgs,r=E(e)(I(t,a));return r===R&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new T(e).promise()},o.cast=function(e){var t=P(e);return t instanceof o||(t=new o(v),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if('function'!=typeof e)throw new y('expecting a function but got '+c.classString(e));return m.setScheduler(e)},o.prototype._then=function(e,t,a,r,n){var i=void 0!==n,u=i?n:new o(v),s=this._target(),l=s._bitField;i||(u._propagateFrom(this,3),u._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(0==(50397184&l)?r=s===this?void 0:this._boundTo:r=this._boundValue()),this._fireEvent('promiseChained',this,u));var p=g();if(0!=(50397184&l)){var d=s._settlePromiseCtx,h,f;0==(33554432&l)?0==(16777216&l)?(d=s._settlePromiseLateCancellationObserver,f=new x('late cancellation observer'),s._attachExtraTrace(f),h=t):(f=s._fulfillmentHandler0,h=t,s._unsetRejectionIsUnhandled()):(f=s._rejectionHandler0,h=e),m.invoke(d,s,{handler:null===p?h:'function'==typeof h&&c.domainBind(p,h),promise:u,receiver:r,value:f})}else s._addCallbacks(e,t,u,r,p);return u},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField|=33554432,this._fireEvent('promiseFulfilled',this)},o.prototype._setRejected=function(){this._bitField|=16777216,this._fireEvent('promiseRejected',this)},o.prototype._setFollowing=function(){this._bitField|=67108864,this._fireEvent('promiseResolved',this)},o.prototype._setIsFinal=function(){this._bitField|=4194304},o.prototype._isFinal=function(){return 0<(4194304&this._bitField)},o.prototype._unsetCancelled=function(){this._bitField&=-65537},o.prototype._setCancelled=function(){this._bitField|=65536,this._fireEvent('promiseCancelled',this)},o.prototype._setWillBeCancelled=function(){this._bitField|=8388608},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField|=134217728)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==d)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=e._bitField,a=e._fulfillmentHandler0,r=e._rejectionHandler0,o=e._promise0,n=e._receiverAt(0);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._migrateCallbackAt=function(e,t){var a=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),o=e._promiseAt(t),n=e._receiverAt(t);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._addCallbacks=function(e,t,a,r,o){var n=this._length();if(65531<=n&&(n=0,this._setLength(0)),0===n)this._promise0=a,this._receiver0=r,'function'==typeof e&&(this._fulfillmentHandler0=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this._rejectionHandler0=null===o?t:c.domainBind(o,t));else{var i=4*n-4;this[i+2]=a,this[i+3]=r,'function'==typeof e&&(this[i+0]=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this[i+1]=null===o?t:c.domainBind(o,t))}return this._setLength(n+1),n},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(s(),!1);var a=P(e,this);if(!(a instanceof o))return this._fulfill(e);t&&this._propagateFrom(a,2);var r=a._target();if(r===this)return void this._reject(s());var n=r._bitField;if(0==(50397184&n)){var u=this._length();0<u&&r._migrateCallback0(this);for(var l=1;l<u;++l)r._migrateCallbackAt(this,l);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&n))this._fulfill(r._value());else if(0!=(16777216&n))this._reject(r._reason());else{var i=new x('late cancellation observer');r._attachExtraTrace(i),this._reject(i)}}},o.prototype._rejectCallback=function(e,t,a){var r=c.ensureErrorObject(e),o=r===e;if(!o&&!a&&C.warnings()){var n='a promise was rejected with a non-error: '+c.classString(e);this._warn(n,!0)}this._attachExtraTrace(r,!!t&&o),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==v){var t=this;this._captureStackTrace(),this._pushContext();var a=!0,o=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,a)});a=!1,this._popContext(),void 0!==o&&t._rejectCallback(o,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,a,r){var o=r._bitField;if(0==(65536&o)){r._pushContext();var n;t===b?a&&'number'==typeof a.length?n=E(e).apply(this._boundValue(),a):(n=R,n.e=new y('cannot .spread() a non-array: '+c.classString(a))):n=E(e).call(t,a);var i=r._popContext();o=r._bitField,0!=(65536&o)||(n===S?r._reject(a):n===R?r._rejectCallback(n.e,!1):(C.checkForgottenReturns(n,i,'',r,this),r._resolveCallback(n)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,r,n){var i=e instanceof o,u=this._bitField,s=0!=(134217728&u);0==(65536&u)?'function'==typeof t?i?(s&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,n,e)):t.call(r,n,e):r instanceof a?!r._isResolved()&&(0==(33554432&u)?r._promiseRejected(n,e):r._promiseFulfilled(n,e)):i&&(s&&e._setAsyncGuaranteed(),0==(33554432&u)?e._reject(n):e._fulfill(n)):(i&&e._invokeInternalOnCancel(),r instanceof M&&r.isFinallyHandler()?(r.cancelPromise=e,E(t).call(r,n)===R&&e._reject(R.e)):t===l?e._fulfill(l.call(r)):r instanceof a?r._promiseCancelled(e):i||e instanceof T?e._cancel():r.cancel())},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,a=e.promise,r=e.receiver,n=e.value;'function'==typeof t?a instanceof o?this._settlePromiseFromHandler(t,r,n,a):t.call(r,n,a):a instanceof o&&a._reject(n)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t){var a=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(a,e,r,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var a=s();return this._attachExtraTrace(a),this._reject(a)}this._setFulfilled(),this._rejectionHandler0=e,0<(65535&t)&&(0==(134217728&t)?m.settlePromises(this):this._settlePromises())}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=e,this._isFinal()?m.fatalError(e,c.isNode):void(0<(65535&t)?m.settlePromises(this):this._ensurePossibleRejectionHandled())},o.prototype._fulfillPromises=function(e,t){for(var a=1;a<e;a++){var r=this._fulfillmentHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._rejectPromises=function(e,t){for(var a=1;a<e;a++){var r=this._rejectionHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(0<t){if(0!=(16842752&e)){var a=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,a,e),this._rejectPromises(t,a)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0==(33554432&e)?0==(16777216&e)?void 0:this._fulfillmentHandler0:this._rejectionHandler0},o.defer=o.pending=function(){C.deprecated('Promise.defer','new Promise');var e=new o(v);return{promise:e,resolve:n,reject:i}},c.notEnumerableProp(o,'_makeSelfResolutionError',s),e('./method')(o,v,P,p,C),e('./bind')(o,v,P,C),e('./cancel')(o,T,p,C),e('./direct_resolve')(o),e('./synchronous_inspection')(o),e('./join')(o,T,P,v,m,g),o.Promise=o,o.version='3.5.1',e('./map.js')(o,T,p,P,v,C),e('./call_get.js')(o),e('./using.js')(o,p,P,k,v,C),e('./timers.js')(o,v,C),e('./generators.js')(o,p,v,P,a,C),e('./nodeify.js')(o),e('./promisify.js')(o,v),e('./props.js')(o,T,P,p),e('./race.js')(o,v,P,p),e('./reduce.js')(o,T,p,P,v,C),e('./settle.js')(o,T,C),e('./some.js')(o,T,p),e('./filter.js')(o,v),e('./each.js')(o,v),e('./any.js')(o),c.toFastProperties(o),c.toFastProperties(o.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new o(v)),C.setBounds(f.firstLineError,c.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t){t.exports=function(t,a,r,o,n){function i(e){return-2===e?[]:-3===e?{}:-6===e?new Map:void 0}function u(e){var r=this._promise=new t(a);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=e('./util'),l=s.isArray;return s.inherits(u,n),u.prototype.length=function(){return this._length},u.prototype.promise=function(){return this._promise},u.prototype._init=function e(a,n){var u=r(this._values,this._promise);if(u instanceof t){u=u._target();var l=u._bitField;if(this._values=u,0==(50397184&l))return this._promise._setAsyncGuaranteed(),u._then(e,this._reject,void 0,this,n);if(0!=(33554432&l))u=u._value();else return 0==(16777216&l)?this._cancel():this._reject(u._reason())}if(u=s.asArray(u),null===u){var p=o('expecting an array or an iterable object but got '+s.classString(u)).reason();return void this._promise._rejectCallback(p,!1)}return 0===u.length?void(-5===n?this._resolveEmptyArray():this._resolve(i(n))):void this._iterate(u)},u.prototype._iterate=function(e){var a=this.getActualLength(e.length);this._length=a,this._values=this.shouldCopyValues()?Array(a):this._values;for(var o=this._promise,n=!1,u=null,s=0,i;s<a;++s)i=r(e[s],o),i instanceof t?(i=i._target(),u=i._bitField):u=null,n?null!==u&&i.suppressUnhandledRejections():null===u?n=this._promiseFulfilled(i,s):0==(50397184&u)?(i._proxy(this,s),this._values[s]=i):0==(33554432&u)?0==(16777216&u)?n=this._promiseCancelled(s):n=this._promiseRejected(i._reason(),s):n=this._promiseFulfilled(i._value(),s);n||o._setAsyncGuaranteed()},u.prototype._isResolved=function(){return null===this._values},u.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},u.prototype._cancel=function(){this._isResolved()||!this._promise._isCancellable()||(this._values=null,this._promise._cancel())},u.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},u.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},u.prototype._promiseCancelled=function(){return this._cancel(),!0},u.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},u.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var a=0;a<e.length;++a)e[a]instanceof t&&e[a].cancel()}},u.prototype.shouldCopyValues=function(){return!0},u.prototype.getActualLength=function(e){return e},u}},{"./util":36}],24:[function(e,t){t.exports=function(t,a){function r(e){return!y.test(e)}function o(e){try{return!0===e.__isPromisified__}catch(t){return!1}}function n(e,t,a){var r=d.getDataPropertyOrDefault(e,t+a,_);return!!r&&o(r)}function u(e,t,a){for(var r=0,o;r<e.length;r+=2)if(o=e[r],a.test(o))for(var n=o.replace(a,''),i=0;i<e.length;i+=2)if(e[i]===n)throw new m('Cannot promisify an API that has normal methods with \'%s\'-suffix\n\n    See http://goo.gl/MqrFmX\n'.replace('%s',t))}function s(e,t,a,r){for(var s=d.inheritedDataKeys(e),l=[],p=0;p<s.length;++p){var i=s[p],c=e[i],g=r===x||x(i,c,e);'function'!=typeof c||o(c)||n(e,i,t)||!r(i,c,e,g)||l.push(i,c)}return u(l,t,a),l}function l(e,t,a,r,o){for(var n=new RegExp(v(t)+'$'),u=s(e,t,n,a),l=0,i=u.length;l<i;l+=2){var c=u[l],g=u[l+1],h=c+t;if(r===b)e[h]=b(c,p,c,g,t,o);else{var f=r(g,function(){return b(c,p,c,g,t,o)});d.notEnumerableProp(f,'__isPromisified__',!0),e[h]=f}}return d.toFastProperties(e),e}function i(e,t,a){return b(e,t,void 0,e,null,a)}var p={},d=e('./util'),c=e('./nodeback'),g=d.withAppended,h=d.maybeWrapAsError,f=d.canEvaluate,m=e('./errors').TypeError,_={__isPromisified__:!0},y=new RegExp('^(?:'+['arity','length','name','arguments','caller','callee','prototype','__isPromisified__'].join('|')+')$'),x=function(e){return d.isIdentifier(e)&&'_'!==e.charAt(0)&&'constructor'!==e},v=function(e){return e.replace(/([$])/,'\\$')},b=f?S:function(e,r,o,n,i,u){function s(){var o=r;r===p&&(o=this);var n=new t(a);n._captureStackTrace();var i='string'==typeof f&&this!==l?this[f]:e,s=c(n,u);try{i.apply(o,g(arguments,s))}catch(t){n._rejectCallback(h(t),!0,!0)}return n._isFateSealed()||n._setAsyncGuaranteed(),n}var l=function(){return this}(),f=e;return'string'==typeof f&&(e=n),d.notEnumerableProp(s,'__isPromisified__',!0),s},S;t.promisify=function(e,t){if('function'!=typeof e)throw new m('expecting a function but got '+d.classString(e));if(o(e))return e;t=Object(t);var a=void 0===t.context?p:t.context,n=!!t.multiArgs,u=i(e,a,n);return d.copyDescriptors(e,u,r),u},t.promisifyAll=function(e,t){if('function'!=typeof e&&'object'!==('undefined'==typeof e?'undefined':kn(e)))throw new m('the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n');t=Object(t);var a=!!t.multiArgs,r=t.suffix;'string'!=typeof r&&(r='Async');var o=t.filter;'function'!=typeof o&&(o=x);var n=t.promisifier;if('function'!=typeof n&&(n=b),!d.isIdentifier(r))throw new RangeError('suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n');for(var u=d.inheritedDataKeys(e),s=0,i;s<u.length;++s)i=e[u[s]],'constructor'!==u[s]&&d.isClass(i)&&(l(i.prototype,r,o,n,a),l(i,r,o,n,a));return l(e,r,o,n,a)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t){t.exports=function(t,a,r,o){function n(e){var t=!1,a;if(p!==void 0&&e instanceof p)a=d(e),t=!0;else{var r=l.keys(e),o=r.length;a=Array(2*o);for(var n=0,i;n<o;++n)i=r[n],a[n]=e[i],a[n+o]=i}this.constructor$(a),this._isMap=t,this._init$(void 0,t?-6:-3)}function i(e){var a=r(e),i;return s(a)?(i=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new n(a).promise(),a instanceof t&&i._propagateFrom(a,2),i):o('cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n')}var u=e('./util'),s=u.isObject,l=e('./es5'),p;'function'==typeof Map&&(p=Map);var d=function(){function e(e,r){this[t]=e,this[t+a]=r,t++}var t=0,a=0;return function(r){a=r.size,t=0;var o=Array(2*r.size);return r.forEach(e,o),o}}(),c=function(e){for(var t=new p,a=0|e.length/2,r=0;r<a;++r){var o=e[a+r],n=e[r];t.set(o,n)}return t};u.inherits(n,a),n.prototype._init=function(){},n.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;if(a>=this._length){var r;if(this._isMap)r=c(this._values);else{r={};for(var o=this.length(),n=0,i=this.length();n<i;++n)r[this._values[n+o]]=this._values[n]}return this._resolve(r),!0}return!1},n.prototype.shouldCopyValues=function(){return!1},n.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return i(this)},t.props=function(e){return i(e)}}},{"./es5":13,"./util":36}],26:[function(e,t){function a(e,t,a,r,o){for(var n=0;n<o;++n)a[n+r]=e[n+t],e[n+t]=void 0}function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var a=this._front+t&this._capacity-1;this[a]=e,this._length=t+1},r.prototype.push=function(e,t,a){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(a);var o=this._front+r-3;this._checkCapacity(r);var n=this._capacity-1;this[o+0&n]=e,this[o+1&n]=t,this[o+2&n]=a,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,o=this._length;a(this,0,this,t,r+o&t-1)},t.exports=r},{}],27:[function(e,t){t.exports=function(t,a,r,o){function n(e,n){var l=r(e);if(l instanceof t)return s(l);if(e=u.asArray(e),null===e)return o('expecting an array or an iterable object but got '+u.classString(e));var p=new t(a);n!==void 0&&p._propagateFrom(n,3);for(var d=p._fulfill,c=p._reject,g=0,i=e.length,h;g<i;++g)(h=e[g],void 0!==h||g in e)&&t.cast(h)._then(d,c,void 0,p,null);return p}var u=e('./util'),s=function(e){return e.then(function(t){return n(t,e)})};t.race=function(e){return n(e,void 0)},t.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(e,t){t.exports=function(t,a,r,o,n,i){function u(e,a,r,o){this.constructor$(e);var i=c();this._fn=null===i?a:g.domainBind(i,a),r!==void 0&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===n?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function s(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function l(e,t,a,o){if('function'!=typeof t)return r('expecting a function but got '+g.classString(t));var n=new u(e,t,a,o);return n.promise()}function p(e){this.accum=e,this.array._gotAccum(e);var a=o(this.value,this.array._promise);return a instanceof t?(this.array._currentCancellable=a,a._then(d,void 0,void 0,this,void 0)):d.call(this,a)}function d(e){var a=this.array,r=a._promise,o=h(a._fn);r._pushContext();var n;n=void 0===a._eachValues?o.call(r._boundValue(),this.accum,e,this.index,this.length):o.call(r._boundValue(),e,this.index,this.length),n instanceof t&&(a._currentCancellable=n);var u=r._popContext();return i.checkForgottenReturns(n,u,void 0===a._eachValues?'Promise.reduce':'Promise.each',r),n}var c=t._getDomain,g=e('./util'),h=g.tryCatch;g.inherits(u,a),u.prototype._gotAccum=function(e){this._eachValues!==void 0&&null!==this._eachValues&&e!==n&&this._eachValues.push(e)},u.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},u.prototype._init=function(){},u.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues===void 0?this._initialValue:this._eachValues)},u.prototype.shouldCopyValues=function(){return!1},u.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},u.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},u.prototype._iterate=function(e){this._values=e;var a=e.length,r,o;if(void 0===this._initialValue?(r=t.resolve(e[0]),o=1):(r=this._initialValue,o=0),this._currentCancellable=r,!r.isRejected())for(;o<a;++o){var n={accum:null,value:e[o],index:o,length:a,array:this};r=r._then(p,void 0,void 0,n,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(s,s,void 0,r,this)},t.prototype.reduce=function(e,t){return l(this,e,t,null)},t.reduce=function(e,t,a,r){return l(e,t,a,r)}}},{"./util":36}],29:[function(e,t){var a=e('./util'),r=a.getNativePromise(),o;if(a.isNode&&'undefined'==typeof MutationObserver){var n=Au.setImmediate,i=process.nextTick;o=a.isRecentNode?function(e){n.call(Au,e)}:function(e){i.call(process,e)}}else if('function'==typeof r&&'function'==typeof r.resolve){var u=r.resolve();o=function(e){u.then(e)}}else o='undefined'==typeof MutationObserver||'undefined'!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?'undefined'==typeof setImmediate?'undefined'==typeof setTimeout?function(){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}:function(e){setTimeout(e,0)}:function(e){setImmediate(e)}:function(){var e=document.createElement('div'),t={attributes:!0},a=!1,r=document.createElement('div'),o=new MutationObserver(function(){e.classList.toggle('foo'),a=!1});o.observe(r,t);var n=function(){a||(a=!0,r.classList.toggle('foo'))};return function(a){var r=new MutationObserver(function(){r.disconnect(),a()});r.observe(e,t),n()}}();t.exports=o},{"./util":36}],30:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e)}var n=t.PromiseInspection,i=e('./util');i.inherits(o,a),o.prototype._promiseResolved=function(e,t){this._values[e]=t;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var a=new n;return a._bitField=33554432,a._settledValueField=e,this._promiseResolved(t,a)},o.prototype._promiseRejected=function(e,t){var a=new n;return a._bitField=16777216,a._settledValueField=e,this._promiseResolved(t,a)},t.settle=function(e){return r.deprecated('.settle()','.reflect()'),new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function n(e,t){if((0|t)!==t||0>t)return r('expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n');var a=new o(e),n=a.promise();return a.setHowMany(t),a.init(),n}var i=e('./util'),u=e('./errors').RangeError,s=e('./errors').AggregateError,l=i.isArray,p={};i.inherits(o,a),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=l(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},o.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},o.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(p),this._checkOutcome())},o.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==p&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t='Input array must contain at least '+this._howMany+' items but contains only '+e+' items';return new u(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return n(e,t)},t.prototype.some=function(e){return n(this,e)},t._SomePromiseArray=o}},{"./errors":12,"./util":36}],32:[function(e,t){t.exports=function(e){function t(e){e===void 0?(this._bitField=0,this._settledValueField=void 0):(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0)}t.prototype._settledValue=function(){return this._settledValueField};var a=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError('cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError('cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},o=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},n=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},i=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},u=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return i.call(this._target())},e.prototype.isRejected=function(){return n.call(this._target())},e.prototype.isFulfilled=function(){return o.call(this._target())},e.prototype.isResolved=function(){return u.call(this._target())},e.prototype.value=function(){return a.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t){t.exports=function(t,a){function r(e){return e.then}function o(e){try{return r(e)}catch(t){return s.e=t,s}}function n(e){try{return p.call(e,'_promise0')}catch(t){return!1}}function i(e,r,o){var n=new t(a),i=n;o&&o._pushContext(),n._captureStackTrace(),o&&o._popContext();var l=!0,p=u.tryCatch(r).call(e,function(e){n&&(n._resolveCallback(e),n=null)},function(e){n&&(n._rejectCallback(e,l,!0),n=null)});return l=!1,n&&p===s&&(n._rejectCallback(p.e,!0,!0),n=null),i}var u=e('./util'),s=u.errorObj,l=u.isObject,p={}.hasOwnProperty;return function(e,r){if(l(e)){if(e instanceof t)return e;var u=o(e);if(u===s){r&&r._pushContext();var p=t.reject(u.e);return r&&r._popContext(),p}if('function'==typeof u){if(n(e)){var p=new t(a);return e._then(p._fulfill,p._reject,void 0,p,null),p}return i(e,u,r)}}return e}}},{"./util":36}],34:[function(e,t){t.exports=function(t,a,r){function o(e){this.handle=e}function n(e){return clearTimeout(this.handle),e}function i(e){throw clearTimeout(this.handle),e}var u=e('./util'),s=t.TimeoutError;o.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(e){return p(+this).thenReturn(e)},p=t.delay=function(e,n){var i,u;return void 0===n?(i=new t(a),u=setTimeout(function(){i._fulfill()},+e),r.cancellation()&&i._setOnCancel(new o(u)),i._captureStackTrace()):(i=t.resolve(n)._then(l,null,null,e,void 0),r.cancellation()&&n instanceof t&&i._setOnCancel(n)),i._setAsyncGuaranteed(),i};t.prototype.delay=function(e){return p(e,this)};var d=function(e,t,a){var r;r='string'==typeof t?new s(t):t instanceof Error?t:new s('operation timed out'),u.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=a&&a.cancel()};t.prototype.timeout=function(e,t){e=+e;var a=new o(setTimeout(function(){u.isPending()&&d(u,t,s)},e)),u,s;return r.cancellation()?(s=this.then(),u=s._then(n,i,void 0,a,void 0),u._setOnCancel(a)):u=this._then(n,i,void 0,a,void 0),u}}},{"./util":36}],35:[function(e,t){t.exports=function(t,a,r,o,n,u){function i(t){setTimeout(function(){throw t},0)}function s(e){var t=r(e);return t!==e&&'function'==typeof e._isDisposable&&'function'==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(e,a){function o(){if(u>=l)return p._fulfill();var n=s(e[u++]);if(n instanceof t&&n._isDisposable()){try{n=r(n._getDisposer().tryDispose(a),e.promise)}catch(t){return i(t)}if(n instanceof t)return n._then(o,i,null,null,null)}o()}var u=0,l=e.length,p=new t(n);return o(),p}function p(e,t,a){this._data=e,this._promise=t,this._context=a}function d(e,t,a){this.constructor$(e,t,a)}function c(e){return p.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function g(e){this.length=e,this.promise=null,this[e-1]=null}var h=e('./util'),f=e('./errors').TypeError,m=e('./util').inherits,_=h.errorObj,y=h.tryCatch,x={};p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():x},p.prototype.tryDispose=function(e){var t=this.resource(),a=this._context;void 0!==a&&a._pushContext();var r=t===x?null:this.doDispose(t,e);return void 0!==a&&a._popContext(),this._promise._unsetDisposable(),this._data=null,r},p.isDisposer=function(e){return null!=e&&'function'==typeof e.resource&&'function'==typeof e.tryDispose},m(d,p),d.prototype.doDispose=function(e,t){var a=this.data();return a.call(e,e,t)},g.prototype._resultCancelled=function(){for(var e=this.length,a=0,r;a<e;++a)r=this[a],r instanceof t&&r.cancel()},t.using=function(){var e=arguments.length;if(2>e)return a('you must pass at least 2 arguments to Promise.using');var o=arguments[e-1];if('function'!=typeof o)return a('expecting a function but got '+h.classString(o));var n=!0,s;2===e&&Array.isArray(arguments[0])?(s=arguments[0],e=s.length,n=!1):(s=arguments,e--);for(var d=new g(e),f=0,m;f<e;++f){if(m=s[f],p.isDisposer(m)){var x=m;m=m.promise(),m._setDisposable(x)}else{var v=r(m);v instanceof t&&(m=v._then(c,null,null,{resources:d,index:f},void 0))}d[f]=m}for(var b=Array(d.length),f=0;f<b.length;++f)b[f]=t.resolve(d[f]).reflect();var S=t.all(b).then(function(e){for(var t=0,a;t<e.length;++t){if(a=e[t],a.isRejected())return _.e=a.error(),_;if(!a.isFulfilled())return void S.cancel();e[t]=a.value()}P._pushContext(),o=y(o);var r=n?o.apply(void 0,e):o(e),i=P._popContext();return u.checkForgottenReturns(r,i,'Promise.using',P),r}),P=S.lastly(function(){var e=new t.PromiseInspection(S);return l(d,e)});return d.promise=P,P._setOnCancel(d),P},t.prototype._setDisposable=function(e){this._bitField|=131072,this._disposer=e},t.prototype._isDisposable=function(){return 0<(131072&this._bitField)},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField&=-131073,this._disposer=void 0},t.prototype.disposer=function(e){if('function'==typeof e)return new d(e,this,o());throw new f}}},{"./errors":12,"./util":36}],36:[function(e,t,a){function r(){try{var e=O;return O=null,e.apply(this,arguments)}catch(t){return F.e=t,F}}function o(e){return O=e,r}function n(e){return null==e||!0===e||!1===e||'string'==typeof e||'number'==typeof e}function i(e){return'function'==typeof e||'object'===('undefined'==typeof e?'undefined':kn(e))&&null!==e}function u(e){return n(e)?new Error(m(e)):e}function s(e,t){var a=e.length,r=Array(a+1),o;for(o=0;o<a;++o)r[o]=e[o];return r[o]=t,r}function l(e,t,a){if(k.isES5){var r=Object.getOwnPropertyDescriptor(e,t);if(null!=r)return null==r.get&&null==r.set?r.value:a}else return{}.hasOwnProperty.call(e,t)?e[t]:void 0}function p(e,t,a){if(n(e))return e;return k.defineProperty(e,t,{value:a,configurable:!0,enumerable:!1,writable:!0}),e}function d(e){throw e}function c(e){try{if('function'==typeof e){var t=k.names(e.prototype),a=k.isES5&&1<t.length,r=0<t.length&&(1!==t.length||'constructor'!==t[0]),o=R.test(e+'')&&0<k.names(e).length;if(a||r||o)return!0}return!1}catch(t){return!1}}function g(e){function t(){}t.prototype=e;for(var a=8;a--;)new t;return e}function h(e){return E.test(e)}function f(e,t,a){for(var r=Array(e),o=0;o<e;++o)r[o]=t+o+a;return r}function m(e){try{return e+''}catch(t){return'[no string representation]'}}function _(e){return e instanceof Error||null!==e&&'object'===('undefined'==typeof e?'undefined':kn(e))&&'string'==typeof e.message&&'string'==typeof e.name}function y(t){try{p(t,'isOperational',!0)}catch(e){}}function x(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function v(e){return _(e)&&k.propertyIsWritable(e,'stack')}function b(e){return{}.toString.call(e)}function S(e,t,a){for(var r=k.names(e),o=0,n;o<r.length;++o)if(n=r[o],a(n))try{k.defineProperty(t,n,k.getDescriptor(e,n))}catch(e){}}function P(e){return G?process.env[e]:void 0}function T(){if('function'==typeof Promise)try{var e=new Promise(function(){});if('[object Promise]'==={}.toString.call(e))return Promise}catch(t){}}function w(e,t){return e.bind(t)}var k=e('./es5'),C='undefined'==typeof navigator,F={e:{}},M='undefined'==typeof self?'undefined'==typeof window?'undefined'==typeof Au?this===void 0?null:this:Au:window:self,D=function(e,t){function a(){for(var a in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,a)&&'$'!==a.charAt(a.length-1)&&(this[a+'$']=t.prototype[a])}var r={}.hasOwnProperty;return a.prototype=t.prototype,e.prototype=new a,e.prototype},I=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var a=0;a<e.length;++a)if(e[a]===t)return!0;return!1};if(k.isES5){var a=Object.getOwnPropertyNames;return function(e){for(var r=[],o=Object.create(null);null!=e&&!t(e);){var n;try{n=a(e)}catch(t){return r}for(var u=0,i;u<n.length;++u)if(i=n[u],!o[i]){o[i]=!0;var s=Object.getOwnPropertyDescriptor(e,i);null!=s&&null==s.get&&null==s.set&&r.push(i)}e=k.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(a){if(t(a))return[];var o=[];enumeration:for(var n in a)if(r.call(a,n))o.push(n);else{for(var u=0;u<e.length;++u)if(r.call(e[u],n))continue enumeration;o.push(n)}return o}}(),R=/this\s*\.\s*\S+\s*=/,E=/^[a-z$_][a-z$_0-9]*$/i,A=function(){return'stack'in new Error?function(e){return v(e)?e:new Error(m(e))}:function(e){if(v(e))return e;try{throw new Error(m(e))}catch(e){return e}}}(),L=function(e){return k.isArray(e)?e:null},O;if('undefined'!=typeof Symbol&&Symbol.iterator){var j='function'==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t=[],a=e[Symbol.iterator](),r;!(r=a.next()).done;)t.push(r.value);return t};L=function(e){if(k.isArray(e))return e;return null!=e&&'function'==typeof e[Symbol.iterator]?j(e):null}}var z='undefined'!=typeof process&&'[object process]'===b(process).toLowerCase(),G='undefined'!=typeof process&&'undefined'!=typeof process.env,U={isClass:c,isIdentifier:h,inheritedDataKeys:I,getDataPropertyOrDefault:l,thrower:d,isArray:k.isArray,asArray:L,notEnumerableProp:p,isPrimitive:n,isObject:i,isError:_,canEvaluate:C,errorObj:F,tryCatch:o,inherits:D,withAppended:s,maybeWrapAsError:u,toFastProperties:g,filledRange:f,toString:m,canAttachTrace:v,ensureErrorObject:A,originatesFromRejection:x,markAsOriginatingFromRejection:y,classString:b,copyDescriptors:S,hasDevTools:'undefined'!=typeof chrome&&chrome&&'function'==typeof chrome.loadTimes,isNode:z,hasEnvVariables:G,env:P,global:M,getNativePromise:T,domainBind:w};U.isRecentNode=U.isNode&&function(){var e=process.versions.node.split('.').map(Number);return 0===e[0]&&10<e[1]||0<e[0]}(),U.isNode&&U.toFastProperties(process);try{throw new Error}catch(t){U.lastLineError=t}t.exports=U},{"./es5":13}]},{},[4])(4)}),'undefined'!=typeof window&&null!==window?window.P=window.Promise:'undefined'!=typeof self&&null!==self&&(self.P=self.Promise)}),Ig=function(e,t){return function(){for(var a=Array(arguments.length),r=0;r<a.length;r++)a[r]=arguments[r];return e.apply(t,a)}},Rg=function(e){return null!=e&&(Ia(e)||Ra(e)||!!e._isBuffer)},Eg=Object.prototype.toString,Ag={isArray:Ea,isArrayBuffer:Aa,isBuffer:Rg,isFormData:La,isArrayBufferView:Oa,isString:ja,isNumber:za,isObject:Ua,isUndefined:Ga,isDate:qa,isFile:Na,isBlob:Ba,isFunction:Va,isStream:Ha,isURLSearchParams:Wa,isStandardBrowserEnv:$a,forEach:Ka,merge:Qa,extend:Za,trim:Xa},Lg=function(e,t){Ag.forEach(e,function(a,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=a,delete e[r])})},Og=function(e,t,a,r,o){return e.config=t,a&&(e.code=a),e.request=r,e.response=o,e},jg=function(e,t,a,r,o){var n=new Error(e);return Og(n,t,a,r,o)},zg=function(e,t,a){var r=a.config.validateStatus;a.status&&r&&!r(a.status)?t(jg('Request failed with status code '+a.status,a.config,null,a.request,a)):e(a)},Gg=function(e,t,a){if(!t)return e;var r;if(a)r=a(t);else if(Ag.isURLSearchParams(t))r=t.toString();else{var o=[];Ag.forEach(t,function(e,t){null===e||'undefined'==typeof e||(Ag.isArray(e)&&(t+='[]'),!Ag.isArray(e)&&(e=[e]),Ag.forEach(e,function(e){Ag.isDate(e)?e=e.toISOString():Ag.isObject(e)&&(e=JSON.stringify(e)),o.push(Ya(t)+'='+Ya(e))}))}),r=o.join('&')}return r&&(e+=(-1===e.indexOf('?')?'?':'&')+r),e},Ug=['age','authorization','content-length','content-type','etag','expires','from','host','if-modified-since','if-unmodified-since','last-modified','location','max-forwards','proxy-authorization','referer','retry-after','user-agent'],qg=function(e){var t={},a,r,o;return e?(Ag.forEach(e.split('\n'),function(e){if(o=e.indexOf(':'),a=Ag.trim(e.substr(0,o)).toLowerCase(),r=Ag.trim(e.substr(o+1)),a){if(t[a]&&0<=Ug.indexOf(a))return;t[a]='set-cookie'===a?(t[a]?t[a]:[]).concat([r]):t[a]?t[a]+', '+r:r}}),t):t},Ng=Ag.isStandardBrowserEnv()?function(){function e(e){var r=e;return t&&(a.setAttribute('href',r),r=a.href),a.setAttribute('href',r),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,''):'',host:a.host,search:a.search?a.search.replace(/^\?/,''):'',hash:a.hash?a.hash.replace(/^#/,''):'',hostname:a.hostname,port:a.port,pathname:'/'===a.pathname.charAt(0)?a.pathname:'/'+a.pathname}}var t=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement('a'),r;return r=e(window.location.href),function(t){var a=Ag.isString(t)?e(t):t;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),Bg='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';Ja.prototype=new Error,Ja.prototype.code=5,Ja.prototype.name='InvalidCharacterError';var Vg=E,Hg=Ag.isStandardBrowserEnv()?function(){return{write:function(e,t,a,r,o,n){var i=[];i.push(e+'='+encodeURIComponent(t)),Ag.isNumber(a)&&i.push('expires='+new Date(a).toGMTString()),Ag.isString(r)&&i.push('path='+r),Ag.isString(o)&&i.push('domain='+o),!0===n&&i.push('secure'),document.cookie=i.join('; ')},read:function(e){var t=document.cookie.match(new RegExp('(^|;\\s*)('+e+')=([^;]*)'));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,'',Date.now()-8.64e7)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Wg='undefined'!=typeof window&&window.btoa&&window.btoa.bind(window)||Vg,Xg=function(t){return new Promise(function(e,a){var r=t.data,o=t.headers;Ag.isFormData(r)&&delete o['Content-Type'];var n=new XMLHttpRequest,i='onreadystatechange',u=!1;if('undefined'==typeof window||!window.XDomainRequest||'withCredentials'in n||Ng(t.url)||(n=new window.XDomainRequest,i='onload',u=!0,n.onprogress=function(){},n.ontimeout=function(){}),t.auth){var s=t.auth.username||'',l=t.auth.password||'';o.Authorization='Basic '+Wg(s+':'+l)}if(n.open(t.method.toUpperCase(),Gg(t.url,t.params,t.paramsSerializer),!0),n.timeout=t.timeout,n[i]=function(){if(n&&(4===n.readyState||u)&&(0!==n.status||n.responseURL&&0===n.responseURL.indexOf('file:'))){var r='getAllResponseHeaders'in n?qg(n.getAllResponseHeaders()):null,o=t.responseType&&'text'!==t.responseType?n.response:n.responseText,i={data:o,status:1223===n.status?204:n.status,statusText:1223===n.status?'No Content':n.statusText,headers:r,config:t,request:n};zg(e,a,i),n=null}},n.onerror=function(){a(jg('Network Error',t,null,n)),n=null},n.ontimeout=function(){a(jg('timeout of '+t.timeout+'ms exceeded',t,'ECONNABORTED',n)),n=null},Ag.isStandardBrowserEnv()){var p=(t.withCredentials||Ng(t.url))&&t.xsrfCookieName?Hg.read(t.xsrfCookieName):void 0;p&&(o[t.xsrfHeaderName]=p)}if('setRequestHeader'in n&&Ag.forEach(o,function(e,t){'undefined'==typeof r&&'content-type'===t.toLowerCase()?delete o[t]:n.setRequestHeader(t,e)}),t.withCredentials&&(n.withCredentials=!0),t.responseType)try{n.responseType=t.responseType}catch(a){if('json'!==t.responseType)throw a}'function'==typeof t.onDownloadProgress&&n.addEventListener('progress',t.onDownloadProgress),'function'==typeof t.onUploadProgress&&n.upload&&n.upload.addEventListener('progress',t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(e){n&&(n.abort(),a(e),n=null)}),void 0===r&&(r=null),n.send(r)})},$g={"Content-Type":'application/x-www-form-urlencoded'},Kg={adapter:tr(),transformRequest:[function(e,t){return Lg(t,'Content-Type'),Ag.isFormData(e)||Ag.isArrayBuffer(e)||Ag.isBuffer(e)||Ag.isStream(e)||Ag.isFile(e)||Ag.isBlob(e)?e:Ag.isArrayBufferView(e)?e.buffer:Ag.isURLSearchParams(e)?(er(t,'application/x-www-form-urlencoded;charset=utf-8'),e.toString()):Ag.isObject(e)?(er(t,'application/json;charset=utf-8'),JSON.stringify(e)):e}],transformResponse:[function(e){if('string'==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:'XSRF-TOKEN',xsrfHeaderName:'X-XSRF-TOKEN',maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e}};Kg.headers={common:{Accept:'application/json, text/plain, */*'}},Ag.forEach(['delete','get','head'],function(e){Kg.headers[e]={}}),Ag.forEach(['post','put','patch'],function(e){Kg.headers[e]=Ag.merge($g)});var Qg=Kg;ar.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},ar.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ar.prototype.forEach=function(e){Ag.forEach(this.handlers,function(t){null!==t&&e(t)})};var Zg=ar,Yg=function(e,t,a){return Ag.forEach(a,function(a){e=a(e,t)}),e},Jg=function(e){return!!(e&&e.__CANCEL__)},eh=function(e){return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},th=function(e,t){return t?e.replace(/\/+$/,'')+'/'+t.replace(/^\/+/,''):e},ah=function(e){rr(e),e.baseURL&&!eh(e.url)&&(e.url=th(e.baseURL,e.url)),e.headers=e.headers||{},e.data=Yg(e.data,e.headers,e.transformRequest),e.headers=Ag.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),Ag.forEach(['delete','get','head','post','put','patch','common'],function(t){delete e.headers[t]});var t=e.adapter||Qg.adapter;return t(e).then(function(t){return rr(e),t.data=Yg(t.data,t.headers,e.transformResponse),t},function(t){return Jg(t)||(rr(e),t&&t.response&&(t.response.data=Yg(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};or.prototype.request=function(e){'string'==typeof e&&(e=Ag.merge({url:arguments[0]},arguments[1])),e=Ag.merge(Qg,this.defaults,{method:'get'},e),e.method=e.method.toLowerCase();var t=[ah,void 0],a=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)a=a.then(t.shift(),t.shift());return a},Ag.forEach(['delete','get','head','options'],function(e){or.prototype[e]=function(t,a){return this.request(Ag.merge(a||{},{method:e,url:t}))}}),Ag.forEach(['post','put','patch'],function(e){or.prototype[e]=function(t,a,r){return this.request(Ag.merge(r||{},{method:e,url:t,data:a}))}});var rh=or;nr.prototype.toString=function(){return'Cancel'+(this.message?': '+this.message:'')},nr.prototype.__CANCEL__=!0;var oh=nr;ir.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ir.source=function(){var e=new ir(function(e){t=e}),t;return{token:e,cancel:t}};var nh=ir,ih=function(e){return function(t){return e.apply(null,t)}},uh=ur(Qg);uh.Axios=rh,uh.create=function(e){return ur(Ag.merge(Qg,e))},uh.Cancel=oh,uh.CancelToken=nh,uh.isCancel=Jg,uh.all=function(e){return Promise.all(e)},uh.spread=ih;var sh=uh,lh=uh;sh.default=lh;var ph=sh,dh=fe(function(e){(function(){var t,a,r,o,n,i;'undefined'!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:'undefined'!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-n)/1e6},a=process.hrtime,t=function(){var e;return e=a(),1e9*e[0]+e[1]},o=t(),i=1e9*process.uptime(),n=o-i):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return new Date().getTime()-r},r=new Date().getTime())}).call(Au)}),ch=fe(function(e){function t(){}function a(e,t,a){this.fn=e,this.context=t,this.once=a||!1}function r(e,t,r,o,n){if('function'!=typeof r)throw new TypeError('The listener must be a function');var i=new a(r,o||e,n),s=u?u+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],i]:e._events[s].push(i):(e._events[s]=i,e._eventsCount++),e}function o(e,a){0==--e._eventsCount?e._events=new t:delete e._events[a]}function n(){this._events=new t,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,u='~';Object.create&&(t.prototype=Object.create(null),!new t().__proto__&&(u=!1)),n.prototype.eventNames=function(){var e=[],t,a;if(0===this._eventsCount)return e;for(a in t=this._events)i.call(t,a)&&e.push(u?a.slice(1):a);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},n.prototype.listeners=function(e){var t=u?u+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,n=Array(o);r<o;r++)n[r]=a[r].fn;return n},n.prototype.listenerCount=function(e){var t=u?u+e:e,a=this._events[t];return a?a.fn?1:a.length:0},n.prototype.emit=function(e,t,a,r,o,n){var s=u?u+e:e;if(!this._events[s])return!1;var l=this._events[s],p=arguments.length,d,c;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,a),!0;case 4:return l.fn.call(l.context,t,a,r),!0;case 5:return l.fn.call(l.context,t,a,r,o),!0;case 6:return l.fn.call(l.context,t,a,r,o,n),!0;}for(c=1,d=Array(p-1);c<p;c++)d[c-1]=arguments[c];l.fn.apply(l.context,d)}else{var i=l.length,g;for(c=0;c<i;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),p){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,a);break;case 4:l[c].fn.call(l[c].context,t,a,r);break;default:if(!d)for(g=1,d=Array(p-1);g<p;g++)d[g-1]=arguments[g];l[c].fn.apply(l[c].context,d);}}return!0},n.prototype.on=function(e,t,a){return r(this,e,t,a,!1)},n.prototype.once=function(e,t,a){return r(this,e,t,a,!0)},n.prototype.removeListener=function(e,t,a,r){var n=u?u+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var s=this._events[n];if(s.fn)s.fn!==t||r&&!s.once||a&&s.context!==a||o(this,n);else{for(var l=0,i=[],p=s.length;l<p;l++)(s[l].fn!==t||r&&!s[l].once||a&&s[l].context!==a)&&i.push(s[l]);i.length?this._events[n]=1===i.length?i[0]:i:o(this,n)}return this},n.prototype.removeAllListeners=function(e){var a;return e?(a=u?u+e:e,this._events[a]&&o(this,a)):(this._events=new t,this._eventsCount=0),this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prefixed=u,n.EventEmitter=n,e.exports=n}),gh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_SIZE=t.webgl2=void 0;var a=function(){function e(){if(Cn(this,e),this.isSupported=!1,this.vertexShader=null,'undefined'!=typeof window){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('webgl2');var t=this.context;t?(this.isSupported=!0,t.getExtension('EXT_color_buffer_float'),this.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),this.MAX_TEXTURE_IMAGE_UNITS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.init()):console.log('Unable to initialize WebGL2 -- your browser may not support it.')}this._refs={textures:[],buffers:[]}}return Fn(e,[{key:'init',value:function(){this.createCommonVertexShader()}},{key:'createCommonVertexShader',value:function(){var e=this.context,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,'#version 300 es\nprecision highp float;\n\nin vec3 position;\nin vec2 texcoord;\nout vec2 outTex;\n\nvoid main () {\n  gl_Position = vec4(position, 1.0);\n\toutTex = texcoord;\n}\n'),e.compileShader(t);var a=e.getShaderParameter(t,e.COMPILE_STATUS);a||(console.error(e.getShaderInfoLog(t)),e.deleteShader(t),this.isSupported=!1),this.vertexShader=t}},{key:'compileProgram',value:function(e){var t=this.context,a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,e),t.compileShader(a);var r=t.getShaderParameter(a,t.COMPILE_STATUS);r||(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),this.isSupported=!1);var o=t.createProgram();return t.attachShader(o,this.vertexShader),t.attachShader(o,a),t.linkProgram(o),r=t.getProgramParameter(o,t.LINK_STATUS),r||(console.error(t.getProgramInfoLog(o)),this.isSupported=!1),this.setupVertices(o),o}},{key:'setupVertices',value:function(e){var t=this.context,a=t.getAttribLocation(e,'position'),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),this.storeRef('buffer',r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.STATIC_DRAW),t.vertexAttribPointer(a,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var o=t.getAttribLocation(e,'texcoord'),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),t.STATIC_DRAW),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),this.storeRef('buffer',n);var i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),t.STATIC_DRAW),this.storeRef('buffer',i)}},{key:'selectProgram',value:function(e){var t=this.context;t.useProgram(e)}},{key:'bindUniforms',value:function(e,t){var a=this.context;t.forEach(function(t){var r=t.value,o=t.type,n=t.name,i=a.getUniformLocation(e,n);'float'===o?a.uniform1f(i,r):('int'===o||'bool'===o)&&a.uniform1i(i,r)})}},{key:'bindInputTextures',value:function(e,t,a){var r=this,o=this.context;t.forEach(function(t,n){var i=t.input,u=t.name;if(o.activeTexture(o.TEXTURE0+n),!i.glTextureFragments){var s=r.getWebGLTextureOptions(i.glTextureType,i.glTextureFormat),l=s.textureTarget;o.bindTexture(l,i.glTexture)}else if(i.glTextureFragmentsAsColStack){var p=r.getWebGLTextureOptions(i.glTextureType,i.glTextureFormat),d=p.textureTarget;o.bindTexture(d,i.glTextureFragmentsAsColStack)}else{var c=r.getWebGLTextureOptions(i.glTextureType,i.glTextureFormat),g=c.textureTarget;o.bindTexture(g,i.glTextureFragments[a])}o.uniform1i(o.getUniformLocation(e,u),n)})}},{key:'bindOutputTexture',value:function(e,t){var a=this.context;a.viewport(0,0,t[1],t[0]),this.framebuffer=this.framebuffer||a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0)}},{key:'runProgram',value:function(e){var t=e.program,a=e.output,r=e.inputs,o=e.uniforms,n=e.supportsTextureFragments;if(!t)throw new Error('[WebGL2] missing program');if(!a)throw new Error('[WebGL2] missing output');if(!r)throw new Error('[WebGL2] missing inputs');var i=this.context;if(this.selectProgram(t),o&&Array.isArray(o)&&this.bindUniforms(t,o),a.glTextureFragments){if(!(void 0!==n&&n))throw new Error('[WebGL2] program does not support texture fragments');var u=r.filter(function(e){return e.input.glTextureFragments&&!e.input.glTextureFragmentsAsColStack}),s=a.glTextureFragments.length;if(u.some(function(e){return e.input.glTextureFragments.length!==s}))throw new Error('[WebGL2] number of texture fragments in inputs and output do not match');for(var l=0;l<s;l++)this.bindOutputTexture(a.glTextureFragments[l],a.glTextureFragmentShape),this.bindInputTextures(t,r,l),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}else this.bindOutputTexture(a.glTexture,a.glTextureShape),this.bindInputTextures(t,r),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}},{key:'readData',value:function(e){var t=this.context,a=new ArrayBuffer(4*(4*(e[0]*e[1]))),r=new Float32Array(a);t.readPixels(0,0,e[1],e[0],t.RGBA,t.FLOAT,r);for(var o=[],n=0;n<r.length;n+=4)o.push(r[n]);return new Float32Array(o)}},{key:'getWebGLTextureOptions',value:function(e,t){var a=this.context,r={"2d":a.TEXTURE_2D,"2d_array":a.TEXTURE_2D_ARRAY,"3d":a.TEXTURE_3D},o={float:a.R32F,int:a.R32I},n={float:a.RED,int:a.RED_INTEGER},i={float:a.FLOAT,int:a.INT},u=r[e],s=o[t],l=n[t],p=i[t];return{textureTarget:u,textureInternalFormat:s,textureFormat:l,textureType:p}}},{key:'storeRef',value:function(e,t){'texture'===e?this._refs.textures.push(t):'buffer'===e&&this._refs.buffers.push(t)}},{key:'clearRefs',value:function(){var e=this.context;this._refs.textures.forEach(function(t){return e.deleteTexture(t)}),this._refs.buffers.forEach(function(t){return e.deleteBuffer(t)}),this._refs={textures:[],buffers:[]}}}]),e}(),r=new a;t.webgl2=r;var o=r.MAX_TEXTURE_SIZE;t.MAX_TEXTURE_SIZE=o;var n=r.MAX_TEXTURE_IMAGE_UNITS;t.MAX_TEXTURE_IMAGE_UNITS=n});he(gh);var hh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,e),this.layerClass='Layer',this.name=t.name,this.description='',this.gpu=gh.webgl2.isSupported&&t.gpu,this.params=[],this.weights={},this.inbound=[],this.outbound=[]}return Fn(e,[{key:'throwError',value:function(e){throw new Error('['+this.layerClass+' layer: '+(this.name||'')+'] '+e)}},{key:'toggleGPU',value:function(e){var t='undefined'==typeof e?!this.gpu:e;this.gpu=gh.webgl2.isSupported&&t}},{key:'setWeights',value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0;this.params.forEach(function(r,o){t.weights[r]=e[o],t.gpu&&a&&t.weights[r].createGLTexture({type:'2d',format:'float'})})}},{key:'call',value:function(e){return this.output=e,this.output}}]),e}();t.default=a});he(hh);var fh=xn,mh=Sn,_h=sr,yh=lr,xh=yh(),vh=xh,bh=pr,Sh='undefined'!=typeof Float64Array,Ph={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]},Th=fr,wh=yr,kh=Tr,Ch=wr,Fh=Cr,Mh=fe(function(e,t){function a(e){if(!e)return n;for(var t=0,r;t<e.args.length;++t)r=e.args[t],e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1};return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function r(e){return Fh({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}function o(e){for(var t=[],a=0;a<e.args.length;++a)t.push('a'+a);var o=new Function('P',['return function ',e.funcName,'_ndarrayops(',t.join(','),') {P(',t.join(','),');return a0}'].join(''));return o(r(e))}var n={body:'',args:[],thisVars:[],localVars:[]},i={add:'+',sub:'-',mul:'*',div:'/',mod:'%',band:'&',bor:'|',bxor:'^',lshift:'<<',rshift:'>>',rrshift:'>>>'};(function(){for(var e in i){var a=i[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a'+a+'=b'},rvalue:!0,funcName:e+'eq'}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a'+a+'=s'},rvalue:!0,funcName:e+'seq'})}})();var u={not:'!',bnot:'~',neg:'-',recip:'1.0/'};(function(){for(var e in u){var a=u[e];t[e]=o({args:['array','array'],body:{args:['a','b'],body:'a='+a+'b'},funcName:e}),t[e+'eq']=o({args:['array'],body:{args:['a'],body:'a='+a+'a'},rvalue:!0,count:2,funcName:e+'eq'})}})();var s={and:'&&',or:'||',eq:'===',neq:'!==',lt:'<',gt:'>',leq:'<=',geq:'>='};(function(){for(var e in s){var a=s[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a=a'+a+'b'},rvalue:!0,count:2,funcName:e+'eq'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a=a'+a+'s'},rvalue:!0,count:2,funcName:e+'seq'})}})();var l=['abs','acos','asin','atan','ceil','cos','exp','floor','log','round','sin','sqrt','tan'];(function(){for(var e=0,a;e<l.length;++e)a=l[e],t[a]=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b)',thisVars:['this_f']},funcName:a}),t[a+'eq']=o({args:['array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a'],body:'a=this_f(a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'})})();var p=['max','min','atan2','pow'];(function(){for(var e=0,a;e<p.length;++e)a=p[e],t[a]=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a}),t[a+'s']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a+'s'}),t[a+'eq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'}),t[a+'seq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'seq'})})();var d=['atan2','pow'];(function(){for(var e=0,a;e<d.length;++e)a=d[e],t[a+'op']=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'op'}),t[a+'ops']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'ops'}),t[a+'opeq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opeq'}),t[a+'opseq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opseq'})})(),t.any=Fh({args:['array'],pre:n,body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'if(a){return true}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return false'},funcName:'any'}),t.all=Fh({args:['array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1}],body:'if(!x){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'all'}),t.sum=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s+=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'sum'}),t.prod=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=1'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s*=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'prod'}),t.norm2squared=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm2squared'}),t.norm2=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return Math.sqrt(this_s)'},funcName:'norm2'}),t.norminf=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:4}],body:'if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norminf'}),t.norm1=Fh({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:3}],body:'this_s+=a<0?-a:a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm1'}),t.sup=Fh({args:['array'],pre:{body:'this_h=-Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.inf=Fh({args:['array'],pre:{body:'this_h=Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.argmin=Fh({args:['index','array','shape'],pre:{body:'{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.argmax=Fh({args:['index','array','shape'],pre:{body:'{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.random=o({args:['array'],pre:{args:[],body:'this_f=Math.random',thisVars:['this_f']},body:{args:['a'],body:'a=this_f()',thisVars:['this_f']},funcName:'random'}),t.assign=o({args:['array','array'],body:{args:['a','b'],body:'a=b'},funcName:'assign'}),t.assigns=o({args:['array','scalar'],body:{args:['a','b'],body:'a=b'},funcName:'assigns'}),t.equals=Fh({args:['array','array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1},{name:'y',lvalue:!1,rvalue:!0,count:1}],body:'if(x!==y){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'equals'})}),Dh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.checkShape=function(e,t){if(e.length&&t.length&&e.length!==t.reduce(function(e,t){return e*t},1))throw new Error('[Tensor] specified shape incompatible with data.')},t.data3DLayoutForGL=function(e,t,a){for(var r=new e(t.data.length),n=(0,o.default)(new e(a[0]*a[1]),[a[0],a[1]]),s=0,l=0;l<a[2];l++)u.default.assign(n,t.pick(null,null,l)),r.set(n.data,s),s+=a[0]*a[1];return r},t.createIndicesFor2DReshaped=function(e){var t=1<arguments.length&&arguments[1]!==void 0&&arguments[1],a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:-1,s=e.reduce(function(e,t){return e*t},1),l=(0,o.default)(new Int32Array(s),e);if(t){for(var p=xn(Tn(s)),d=(0,o.default)(new Int32Array(p**2),[p,p]),c=(0,o.default)(new Int32Array(p**2),[p,p]),g=(0,o.default)(new Int32Array(p**2),[p,p]),h=0;h<p;h++)u.default.assigns(d.pick(h,null),h);for(var i=0;i<p;i++)u.default.assigns(c.pick(null,i),i);u.default.muls(g,d,p),u.default.addeq(g,c),l.data.set(g.data.subarray(0,l.size))}else{0>a&&(a=e.length+a);for(var f=e[a],m=(0,o.default)(new Int32Array(s),e),_=(0,o.default)(new Int32Array(s),e),y=[].concat(En(e.slice(0,a)),En(e.slice(a+1))),x=y.reduce(function(e,t){return e*t},1),v=(0,o.default)(new Int32Array((0,r.default)(x)),y),b=Array(e.length).fill(null),S=0;S<f;S++)b[a]=S,u.default.assign(m.pick.apply(m,En(b)),v),u.default.assigns(_.pick.apply(_,En(b)),S);u.default.muls(l,m,f),u.default.addeq(l,_)}return l};var r=a(vh),o=a(Th),u=a(Mh)});he(Dh);var Ih=Fr,Rh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Dh),o=a(Th),i=a(Mh),n=a(Ih),u=function(){function e(t,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};Cn(this,e),this.arrayType=n.type||Float32Array,t&&t.length&&(t instanceof this.arrayType||t instanceof Array)?(r.checkShape(t,a),t instanceof this.arrayType?this.tensor=(0,o.default)(t,a):t instanceof Array&&(this.tensor=(0,o.default)(new this.arrayType(t),a))):!t.length&&a.length?this.tensor=(0,o.default)(new this.arrayType(a.reduce(function(e,t){return e*t},1)),a):this.tensor=(0,o.default)(new this.arrayType([]),[])}return Fn(e,[{key:'createGLTexture',value:function(e){var t=e.type,a=void 0===t?'2d':t,r=e.format,o=void 0===r?'float':r,n=e.supportsTextureFragments,i=[];if(1===this.tensor.shape.length)i=[1,this.tensor.shape[0]],this.is1D=!0;else if(2===this.tensor.shape.length)i=this.tensor.shape;else if(3===this.tensor.shape.length&&('2d_array'===a||'3d'===a))i=this.tensor.shape;else throw new Error('[Tensor] cannot create WebGL2 texture.');if(this.glTextureShape=i,this.glTextureType=a,this.glTextureFormat=o,'2d'===a)this.glTextureShape[0]>gh.MAX_TEXTURE_SIZE&&void 0!==n&&n?this._create2DRowFragmentedGLTexture():this._create2DGLTexture();else if('2d_array'===a||'3d'===a)this._create3DGLTexture();else throw new Error('[Tensor] invalid type '+a+'.')}},{key:'_create2DGLTexture',value:function(){var e=gh.webgl2.context,t=gh.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),a=t.textureTarget,r=t.textureInternalFormat,o=t.textureFormat,n=t.textureType;this.glTexture=e.createTexture(),gh.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);var i=this.glTextureShape,u=this.tensor.data;e.texImage2D(a,0,r,i[1],i[0],0,o,n,u),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}},{key:'_create2DRowFragmentedGLTexture',value:function(){var e=gh.webgl2.context,t=gh.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),a=t.textureTarget,r=t.textureInternalFormat,o=t.textureFormat,n=t.textureType;this.glTextureFragments=[],this.glTextureFragmentShape=[gh.MAX_TEXTURE_SIZE,this.glTextureShape[1]];for(var i=this.glTextureFragmentShape,u=xn(this.glTextureShape[0]/gh.MAX_TEXTURE_SIZE),s=0,l=0,p;l<u;l++){p=e.createTexture(),gh.webgl2.storeRef('texture',p),e.bindTexture(a,p);var d=void 0;l===u-1?(d=new this.arrayType(i[0]*i[1]),d.set(this.tensor.data.slice(s,s+i[0]*i[1]),0)):d=this.tensor.data.slice(s,s+i[0]*i[1]),e.texImage2D(a,0,r,i[1],i[0],0,o,n,d),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST),this.glTextureFragments.push(p),s+=i[0]*i[1]}}},{key:'_create3DGLTexture',value:function(){var e=gh.webgl2.context,t=gh.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),a=t.textureTarget,o=t.textureInternalFormat,n=t.textureFormat,i=t.textureType;this.glTexture=e.createTexture(),gh.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);var u=this.glTextureShape,s=r.data3DLayoutForGL(this.arrayType,this.tensor,this.glTextureShape);e.texImage3D(a,0,o,u[1],u[0],u[2],0,n,i,s),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}},{key:'convert2DRowFragmentedGLTextureToColStack',value:function(){var e=this;if(!this.glTextureFragments||!this.glTextureFragmentShape)throw new Error('[Tensor] no glTextureFragments available.');var t=gh.webgl2.context,a=gh.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),r=a.textureTarget,o=a.textureInternalFormat,n=a.textureFormat,i=a.textureType;if(!this.glTextureFragmentsAsColStack){this.glTextureFragmentsAsColStack=t.createTexture(),gh.webgl2.storeRef('texture',this.glTextureFragmentsAsColStack),t.bindTexture(r,this.glTextureFragmentsAsColStack);var u=this.glTextureFragments.length;this.glTextureFragmentsAsColStackShape=[this.glTextureFragmentShape[0],this.glTextureFragmentShape[1]*u];var s=this.glTextureFragmentsAsColStackShape,l=new this.arrayType(s.reduce(function(e,t){return e*t},1));t.texImage2D(r,0,o,s[1],s[0],0,n,i,l),t.texParameteri(r,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(r,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.NEAREST)}else t.bindTexture(r,this.glTextureFragmentsAsColStack);var p=t.createFramebuffer();t.bindFramebuffer(t.READ_FRAMEBUFFER,p),this.glTextureFragments.forEach(function(a,o){t.framebufferTexture2D(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0),t.copyTexSubImage2D(r,0,o*e.glTextureFragmentShape[1],0,0,0,e.glTextureFragmentShape[1],e.glTextureFragmentShape[0])}),t.deleteFramebuffer(p)}},{key:'removeGLTextureFragmentsAsColStack',value:function(){if(this.glTextureFragmentsAsColStack){var e=gh.webgl2.context;e.deleteTexture(this.glTextureFragmentsAsColStack),delete this.glTextureFragmentsAsColStack,delete this.glTextureFragmentsAsColStackShape}}},{key:'deleteGLTexture',value:function(){var e=gh.webgl2.context;this.glTexture&&(e.deleteTexture(this.glTexture),delete this.glTexture),this.glTextureFragments&&(this.glTextureFragments.forEach(function(t){e.deleteTexture(t)}),delete this.glTextureFragments)}},{key:'replaceTensorData',value:function(e){if(e&&e.length&&e instanceof this.arrayType)this.tensor.data.set(e);else if(e&&e.length&&e instanceof Array)this.tensor.data.set(new this.arrayType(e));else throw new Error('[Tensor] invalid input for replaceTensorData method.');if(this.glTexture){var t=gh.webgl2.context,a=gh.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),o=a.textureTarget,n=a.textureFormat,i=a.textureType;t.bindTexture(o,this.glTexture);var u=this.glTextureShape;if('2d'===this.glTextureType){var s=this.tensor.data;t.texSubImage2D(o,0,0,0,u[1],u[0],n,i,s,0)}else if('2d_array'===this.glTextureType||'3d'===this.glTextureType){var l=r.data3DLayoutForGL(this.arrayType,this.tensor,u);t.texSubImage3D(o,0,0,0,0,u[1],u[0],u[2],n,i,l,0)}}}},{key:'transferFromGLTexture',value:function(){if(this.glTextureFragments){this.tensor=(0,o.default)(new this.arrayType(this.glTextureShape[0]*this.glTextureShape[1]),this.glTextureShape);for(var e=0,t=0;t<this.glTextureFragments.length;t++){gh.webgl2.bindOutputTexture(this.glTextureFragments[t],this.glTextureFragmentShape);var a=gh.webgl2.readData(this.glTextureFragmentShape);if(t===this.glTextureFragments.length-1){var r=this.tensor.data.length-e;this.tensor.data.set(a.subarray(0,r),e)}else this.tensor.data.set(a,e);e+=a.length}}else gh.webgl2.bindOutputTexture(this.glTexture,this.glTextureShape),this.tensor=(0,o.default)(new this.arrayType([]),this.glTextureShape),this.tensor.data=gh.webgl2.readData(this.glTextureShape);this.is1D&&1===this.glTextureShape[0]&&(this.tensor=(0,n.default)(this.tensor,[0]))}},{key:'reshapeTo2D',value:function(){for(var e=this.tensor.shape.length-1,t=this.tensor.shape[e],a=this.tensor.shape.slice(0,e),u=a.reduce(function(e,t){return e*t},1),s=(0,o.default)(new this.arrayType(u*t),[u,t]),l=(0,o.default)(new this.arrayType(u),a),p=(0,o.default)(new this.arrayType(u),[u]),d=Array(this.tensor.shape.length).fill(null),c=0;c<t;c++){var n;d[e]=c,i.default.assign(l,(n=this.tensor).pick.apply(n,En(d))),p.data=l.data,i.default.assign(s.pick(null,c),p)}this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!1,e),this.tensor=s,this.is2DReshaped=!0}},{key:'reshapeFrom2D',value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;if(!this.is2DReshaped)throw new Error('[Tensor] not in reshaped 2D representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');0>e&&(e=this.originalShape.length+e);for(var t=this.tensor.shape[0],a=this.tensor.shape[1],r=(0,o.default)(new this.arrayType(this.originalShape.reduce(function(e,t){return e*t},1)),this.originalShape),u=(0,o.default)(new this.arrayType(t),[t]),s=[].concat(En(this.originalShape.slice(0,e)),En(this.originalShape.slice(e+1))),l=(0,o.default)(new this.arrayType(s.reduce(function(e,t){return e*t},1)),s),p=Array(this.originalShape.length).fill(null),d=0;d<a;d++)i.default.assign(u,this.tensor.pick(null,d)),l.data=u.data,p[e]=d,i.default.assign(r.pick.apply(r,En(p)),l);this.tensor=r}},{key:'reshapeTo2DSquare',value:function(){var e=xn(Tn(this.tensor.size)),t=(0,o.default)(new this.arrayType(e**2),[e,e]);t.data.set(this.tensor.data),this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!0),this.tensor=t,this.is2DSquareReshaped=!0}},{key:'reshapeFrom2DSquare',value:function(){if(!this.is2DSquareReshaped)throw new Error('[Tensor] not in reshaped 2D square representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');var e=this.originalShape.reduce(function(e,t){return e*t},1),t=(0,o.default)(new this.arrayType(e),this.originalShape);t.data.set(this.tensor.data.subarray(0,e)),this.tensor=t}}]),e}();t.default=u});he(Rh);var Eh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Od),o=a(hh),n=a(Rh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='InputLayer';var r=e.shape,o=void 0===r?[]:r;return a.shape=e.batch_input_shape&&e.batch_input_shape.length?e.batch_input_shape.slice(1):o,a.description='shape: '+JSON.stringify(a.shape),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError('input tensor shape '+e.tensor.shape+' does not match specified shape '+this.shape+'.'),this.output=new n.default(e.tensor.data,e.tensor.shape)}},{key:'_callGPU',value:function(e){this.inputShape=e.glTexture||e.glTextureFragments?e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape:e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError('input tensor shape '+e.tensor.shape+' does not match specified shape '+this.shape+'.'),e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this.output=e}}]),t}(o.default);t.default=i});he(Eh);var Ah=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){if(1===e.tensor.shape.length){var t=a.default.sup(e.tensor);a.default.subseq(e.tensor,t),a.default.expeq(e.tensor);var r=a.default.sum(e.tensor);a.default.divseq(e.tensor,r)}else if(2===e.tensor.shape.length)for(var o=0,n;o<e.tensor.shape[0];o++){n=a.default.sup(e.tensor.pick(o,null)),a.default.subseq(e.tensor.pick(o,null),n),a.default.expeq(e.tensor.pick(o,null));var i=a.default.sum(e.tensor.pick(o,null));a.default.divseq(e.tensor.pick(o,null),i)}else throw new Error('[activations.softmax] tensor shape '+e.tensor.shape+' not supported.')};var a=function(e){return e&&e.__esModule?e:{default:e}}(Mh)});he(Ah);var Lh=fe(function(e,t){(function(e,a){a(t)})(Au,function(e){function t(e,t){if(!e)throw new Error('ASSERT: '+t)}function a(e){return 48<=e&&57>=e}function r(e){return 0<='0123456789abcdefABCDEF'.indexOf(e)}function o(e){return 0<='01234567'.indexOf(e)}function n(e){return 32===e||9===e||11===e||12===e||160===e||5760<=e&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)}function i(e){return 10===e||13===e||8232===e||8233===e}function u(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||92===e||128<=e&&rt.NonAsciiIdentifierStart.test(yn(e))}function s(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||48<=e&&57>=e||92===e||128<=e&&rt.NonAsciiIdentifierPart.test(yn(e))}function l(e){return'class'===e||'enum'===e||'export'===e||'extends'===e||'import'===e||'super'===e}function p(e){return'implements'===e||'interface'===e||'package'===e||'private'===e||'protected'===e||'public'===e||'static'===e||'yield'===e||'let'===e}function d(e){return'eval'===e||'arguments'===e}function c(e){if(it&&p(e))return!0;switch(e.length){case 2:return'if'===e||'in'===e||'do'===e;case 3:return'var'===e||'for'===e||'new'===e||'try'===e||'let'===e;case 4:return'this'===e||'else'===e||'case'===e||'void'===e||'with'===e||'enum'===e;case 5:return'while'===e||'break'===e||'catch'===e||'throw'===e||'const'===e||'yield'===e||'class'===e||'super'===e;case 6:return'return'===e||'typeof'===e||'delete'===e||'switch'===e||'export'===e||'import'===e;case 7:return'default'===e||'finally'===e||'extends'===e;case 8:return'function'===e||'continue'===e||'debugger'===e;case 10:return'instanceof'===e;default:return!1;}}function g(e,a,r,o,n){var i;t('number'==typeof r,'Comment must have valid position');gt.lastCommentStart>=r||(gt.lastCommentStart=r,i={type:e,value:a},ht.range&&(i.range=[r,o]),ht.loc&&(i.loc=n),ht.comments.push(i),ht.attachComment&&(ht.leadingComments.push(i),ht.trailingComments.push(i)))}function h(e){var t,a,r,o;for(t=ut-e,a={start:{line:st,column:ut-lt-e}};ut<pt;)if(r=nt.charCodeAt(ut),++ut,i(r))return ht.comments&&(o=nt.slice(t+e,ut-1),a.end={line:st,column:ut-lt-1},g('Line',o,t,ut-1,a)),13===r&&10===nt.charCodeAt(ut)&&++ut,++st,void(lt=ut);ht.comments&&(o=nt.slice(t+e,ut),a.end={line:st,column:ut-lt},g('Line',o,t,ut,a))}function f(){var e,t,a,r;for(ht.comments&&(e=ut-2,t={start:{line:st,column:ut-lt-2}});ut<pt;)if(a=nt.charCodeAt(ut),i(a))13===a&&10===nt.charCodeAt(ut+1)&&++ut,++st,++ut,lt=ut,ut>=pt&&q({},at.UnexpectedToken,'ILLEGAL');else if(42===a){if(47===nt.charCodeAt(ut+1))return++ut,++ut,void(ht.comments&&(r=nt.slice(e+2,ut-2),t.end={line:st,column:ut-lt},g('Block',r,e,ut,t)));++ut}else++ut;q({},at.UnexpectedToken,'ILLEGAL')}function m(){var e,t;for(t=0===ut;ut<pt;)if(e=nt.charCodeAt(ut),n(e))++ut;else if(i(e))++ut,13===e&&10===nt.charCodeAt(ut)&&++ut,++st,lt=ut,t=!0;else if(47===e){if(e=nt.charCodeAt(ut+1),47===e)++ut,++ut,h(2),t=!0;else if(42===e)++ut,++ut,f();else break;}else if(t&&45===e){if(45===nt.charCodeAt(ut+1)&&62===nt.charCodeAt(ut+2))ut+=3,h(3);else break;}else if(60!==e)break;else if('!--'===nt.slice(ut+1,ut+4))++ut,++ut,++ut,++ut,h(4);else break}function _(e){var t=0,a,o,n;for(o='u'===e?4:2,a=0;a<o;++a)if(ut<pt&&r(nt[ut]))n=nt[ut++],t=16*t+'0123456789abcdef'.indexOf(n.toLowerCase());else return'';return yn(t)}function y(){var e,t;for(e=nt.charCodeAt(ut++),t=yn(e),92===e&&(117!==nt.charCodeAt(ut)&&q({},at.UnexpectedToken,'ILLEGAL'),++ut,e=_('u'),(!e||'\\'===e||!u(e.charCodeAt(0)))&&q({},at.UnexpectedToken,'ILLEGAL'),t=e);ut<pt&&(e=nt.charCodeAt(ut),!!s(e));)++ut,t+=yn(e),92===e&&(t=t.substr(0,t.length-1),117!==nt.charCodeAt(ut)&&q({},at.UnexpectedToken,'ILLEGAL'),++ut,e=_('u'),(!e||'\\'===e||!s(e.charCodeAt(0)))&&q({},at.UnexpectedToken,'ILLEGAL'),t+=e);return t}function x(){var e,t;for(e=ut++;ut<pt;){if(t=nt.charCodeAt(ut),92===t)return ut=e,y();if(s(t))++ut;else break}return nt.slice(e,ut)}function v(){var e,t,a;return e=ut,t=92===nt.charCodeAt(ut)?y():x(),a=1===t.length?Ze.Identifier:c(t)?Ze.Keyword:'null'===t?Ze.NullLiteral:'true'===t||'false'===t?Ze.BooleanLiteral:Ze.Identifier,{type:a,value:t,lineNumber:st,lineStart:lt,start:e,end:ut}}function b(){var e=ut,t=nt.charCodeAt(ut),a=nt[ut],r,o,n,i;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ut,ht.tokenize&&(40===t?ht.openParenToken=ht.tokens.length:123===t&&(ht.openCurlyToken=ht.tokens.length)),{type:Ze.Punctuator,value:yn(t),lineNumber:st,lineStart:lt,start:e,end:ut};default:if(r=nt.charCodeAt(ut+1),61===r)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ut+=2,{type:Ze.Punctuator,value:yn(t)+yn(r),lineNumber:st,lineStart:lt,start:e,end:ut};case 33:case 61:return ut+=2,61===nt.charCodeAt(ut)&&++ut,{type:Ze.Punctuator,value:nt.slice(e,ut),lineNumber:st,lineStart:lt,start:e,end:ut};}}return(i=nt.substr(ut,4),'>>>='===i)?(ut+=4,{type:Ze.Punctuator,value:i,lineNumber:st,lineStart:lt,start:e,end:ut}):(n=i.substr(0,3),'>>>'===n||'<<='===n||'>>='===n)?(ut+=3,{type:Ze.Punctuator,value:n,lineNumber:st,lineStart:lt,start:e,end:ut}):(o=n.substr(0,2),a===o[1]&&0<='+-<>&|'.indexOf(a)||'=>'===o?(ut+=2,{type:Ze.Punctuator,value:o,lineNumber:st,lineStart:lt,start:e,end:ut}):0<='<>=!+-*%&|^/'.indexOf(a)?(++ut,{type:Ze.Punctuator,value:a,lineNumber:st,lineStart:lt,start:e,end:ut}):void q({},at.UnexpectedToken,'ILLEGAL'))}function S(e){for(var t='';ut<pt&&!!r(nt[ut]);)t+=nt[ut++];return 0===t.length&&q({},at.UnexpectedToken,'ILLEGAL'),u(nt.charCodeAt(ut))&&q({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt('0x'+t,16),lineNumber:st,lineStart:lt,start:e,end:ut}}function P(e){for(var t='0'+nt[ut++];ut<pt&&!!o(nt[ut]);)t+=nt[ut++];return(u(nt.charCodeAt(ut))||a(nt.charCodeAt(ut)))&&q({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt(t,8),octal:!0,lineNumber:st,lineStart:lt,start:e,end:ut}}function T(){var e,t;for(e=ut+1;e<pt;++e){if(t=nt[e],'8'===t||'9'===t)return!1;if(!o(t))return!0}return!0}function w(){var e,r,n;if(n=nt[ut],t(a(n.charCodeAt(0))||'.'===n,'Numeric literal must start with a decimal digit or a decimal point'),r=ut,e='','.'!==n){if(e=nt[ut++],n=nt[ut],'0'===e){if('x'===n||'X'===n)return++ut,S(r);if(o(n)&&T())return P(r)}for(;a(nt.charCodeAt(ut));)e+=nt[ut++];n=nt[ut]}if('.'===n){for(e+=nt[ut++];a(nt.charCodeAt(ut));)e+=nt[ut++];n=nt[ut]}if('e'===n||'E'===n)if(e+=nt[ut++],n=nt[ut],('+'===n||'-'===n)&&(e+=nt[ut++]),a(nt.charCodeAt(ut)))for(;a(nt.charCodeAt(ut));)e+=nt[ut++];else q({},at.UnexpectedToken,'ILLEGAL');return u(nt.charCodeAt(ut))&&q({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseFloat(e),lineNumber:st,lineStart:lt,start:r,end:ut}}function k(){var e='',a=!1,r,n,u,s,l,p,d,c;for(d=st,c=lt,r=nt[ut],t('\''===r||'"'===r,'String literal must starts with a quote'),n=ut,++ut;ut<pt;)if(u=nt[ut++],u===r){r='';break}else if('\\'===u)u=nt[ut++],u&&i(u.charCodeAt(0))?(++st,'\r'===u&&'\n'===nt[ut]&&++ut,lt=ut):'u'===u||'x'===u?(p=ut,l=_(u),l?e+=l:(ut=p,e+=u)):'n'===u?e+='\n':'r'===u?e+='\r':'t'===u?e+='\t':'b'===u?e+='\b':'f'===u?e+='\f':'v'===u?e+='\x0B':o(u)?(s='01234567'.indexOf(u),0!==s&&(a=!0),ut<pt&&o(nt[ut])&&(a=!0,s=8*s+'01234567'.indexOf(nt[ut++]),0<='0123'.indexOf(u)&&ut<pt&&o(nt[ut])&&(s=8*s+'01234567'.indexOf(nt[ut++]))),e+=yn(s)):e+=u;else if(i(u.charCodeAt(0)))break;else e+=u;return''!==r&&q({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.StringLiteral,value:e,octal:a,startLineNumber:d,startLineStart:c,lineNumber:st,lineStart:lt,start:n,end:ut}}function C(e,t){var a;try{a=new RegExp(e,t)}catch(t){q({},at.InvalidRegExp)}return a}function F(){var e,a,r,o,n;for(e=nt[ut],t('/'===e,'Regular expression literal must start with a slash'),a=nt[ut++],r=!1,o=!1;ut<pt;)if(e=nt[ut++],a+=e,'\\'===e)e=nt[ut++],i(e.charCodeAt(0))&&q({},at.UnterminatedRegExp),a+=e;else if(i(e.charCodeAt(0)))q({},at.UnterminatedRegExp);else if(r)']'===e&&(r=!1);else if('/'===e){o=!0;break}else'['===e&&(r=!0);return o||q({},at.UnterminatedRegExp),n=a.substr(1,a.length-2),{value:n,literal:a}}function M(){var e,t,a,r;for(t='',a='';ut<pt&&(e=nt[ut],!!s(e.charCodeAt(0)));)if(++ut,!('\\'===e&&ut<pt))a+=e,t+=e;else if(e=nt[ut],'u'===e){if(++ut,r=ut,e=_('u'),e)for(a+=e,t+='\\u';r<ut;++r)t+=nt[r];else ut=r,a+='u',t+='\\u';N({},at.UnexpectedToken,'ILLEGAL')}else t+='\\',N({},at.UnexpectedToken,'ILLEGAL');return{value:a,literal:t}}function D(){var e,t,a,r;return ct=null,m(),e=ut,t=F(),a=M(),r=C(t.value,a.value),ht.tokenize?{type:Ze.RegularExpression,value:r,lineNumber:st,lineStart:lt,start:e,end:ut}:{literal:t.literal+a.literal,value:r,start:e,end:ut}}function I(){var e,t,a,r;return m(),e=ut,t={start:{line:st,column:ut-lt}},a=D(),t.end={line:st,column:ut-lt},ht.tokenize||(0<ht.tokens.length&&(r=ht.tokens[ht.tokens.length-1],r.range[0]===e&&'Punctuator'===r.type&&('/'===r.value||'/='===r.value)&&ht.tokens.pop()),ht.tokens.push({type:'RegularExpression',value:a.literal,range:[e,ut],loc:t})),a}function R(e){return e.type===Ze.Identifier||e.type===Ze.Keyword||e.type===Ze.BooleanLiteral||e.type===Ze.NullLiteral}function E(){var e,t;if(e=ht.tokens[ht.tokens.length-1],!e)return I();if('Punctuator'===e.type){if(']'===e.value)return b();if(')'===e.value)return t=ht.tokens[ht.openParenToken-1],t&&'Keyword'===t.type&&('if'===t.value||'while'===t.value||'for'===t.value||'with'===t.value)?I():b();if('}'===e.value){if(!(ht.tokens[ht.openCurlyToken-3]&&'Keyword'===ht.tokens[ht.openCurlyToken-3].type)){if(!(ht.tokens[ht.openCurlyToken-4]&&'Keyword'===ht.tokens[ht.openCurlyToken-4].type))return b();if(t=ht.tokens[ht.openCurlyToken-5],!t)return I()}else if(t=ht.tokens[ht.openCurlyToken-4],!t)return b();return 0<=Je.indexOf(t.value)?b():I()}return I()}return'Keyword'===e.type&&'this'!==e.value?I():b()}function A(){var e;return(m(),ut>=pt)?{type:Ze.EOF,lineNumber:st,lineStart:lt,start:ut,end:ut}:(e=nt.charCodeAt(ut),u(e)?v():40===e||41===e||59===e?b():39===e||34===e?k():46===e?a(nt.charCodeAt(ut+1))?w():b():a(e)?w():ht.tokenize&&47===e?E():b())}function L(){var e,t,a;return m(),e={start:{line:st,column:ut-lt}},t=A(),e.end={line:st,column:ut-lt},t.type!==Ze.EOF&&(a=nt.slice(t.start,t.end),ht.tokens.push({type:Ye[t.type],value:a,range:[t.start,t.end],loc:e})),t}function O(){var e;return e=ct,ut=e.end,st=e.lineNumber,lt=e.lineStart,ct='undefined'==typeof ht.tokens?A():L(),ut=e.end,st=e.lineNumber,lt=e.lineStart,e}function j(){var e,t,a;e=ut,t=st,a=lt,ct='undefined'==typeof ht.tokens?A():L(),ut=e,st=t,lt=a}function z(e,t){this.line=e,this.column=t}function G(e,t,a,r){this.start=new z(e,t),this.end=new z(a,r)}function U(){var e,t,a,r;return e=ut,t=st,a=lt,m(),r=st!==t,ut=e,st=t,lt=a,r}function q(e,a){var r=Array.prototype.slice.call(arguments,2),o=a.replace(/%(\d)/g,function(e,a){return t(a<r.length,'Message reference must be in range'),r[a]}),n;throw'number'==typeof e.lineNumber?(n=new Error('Line '+e.lineNumber+': '+o),n.index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-lt+1):(n=new Error('Line '+st+': '+o),n.index=ut,n.lineNumber=st,n.column=ut-lt+1),n.description=o,n}function N(){try{q.apply(null,arguments)}catch(t){if(ht.errors)ht.errors.push(t);else throw t}}function B(e){if(e.type===Ze.EOF&&q(e,at.UnexpectedEOS),e.type===Ze.NumericLiteral&&q(e,at.UnexpectedNumber),e.type===Ze.StringLiteral&&q(e,at.UnexpectedString),e.type===Ze.Identifier&&q(e,at.UnexpectedIdentifier),e.type===Ze.Keyword){if(l(e.value))q(e,at.UnexpectedReserved);else if(it&&p(e.value))return void N(e,at.StrictReservedWord);q(e,at.UnexpectedToken,e.value)}q(e,at.UnexpectedToken,e.value)}function V(e){var t=O();(t.type!==Ze.Punctuator||t.value!==e)&&B(t)}function H(e){var t=O();(t.type!==Ze.Keyword||t.value!==e)&&B(t)}function W(e){return ct.type===Ze.Punctuator&&ct.value===e}function X(e){return ct.type===Ze.Keyword&&ct.value===e}function $(){var e;return!(ct.type!==Ze.Punctuator)&&(e=ct.value,'='===e||'*='===e||'/='===e||'%='===e||'+='===e||'-='===e||'<<='===e||'>>='===e||'>>>='===e||'&='===e||'^='===e||'|='===e)}function K(){var e=ut,t=st,a=lt,r=ct,o;return 59===nt.charCodeAt(ut)||W(';')?void O():(o=st,m(),st===o?void(ct.type!==Ze.EOF&&!W('}')&&B(ct)):(ut=e,st=t,lt=a,void(ct=r)))}function Q(e){return e.type===et.Identifier||e.type===et.MemberExpression}function Z(){var e=[],t;for(t=ct,V('[');!W(']');)W(',')?(O(),e.push(null)):(e.push(me()),W(']')||V(','));return O(),dt.markEnd(dt.createArrayExpression(e),t)}function Y(e,t){var a,r,o;return a=it,o=ct,r=Be(),t&&it&&d(e[0].name)&&N(t,at.StrictParamName),it=a,dt.markEnd(dt.createFunctionExpression(null,e,[],r),o)}function J(){var e,t;return t=ct,e=O(),e.type===Ze.StringLiteral||e.type===Ze.NumericLiteral?(it&&e.octal&&N(e,at.StrictOctalLiteral),dt.markEnd(dt.createLiteral(e),t)):dt.markEnd(dt.createIdentifier(e.value),t)}function ee(){var e,t,a,r,o,n;return(e=ct,n=ct,e.type===Ze.Identifier)?(a=J(),'get'===e.value&&!W(':'))?(t=J(),V('('),V(')'),r=Y([]),dt.markEnd(dt.createProperty('get',t,r),n)):'set'!==e.value||W(':')?(V(':'),r=me(),dt.markEnd(dt.createProperty('init',a,r),n)):(t=J(),V('('),e=ct,e.type===Ze.Identifier?(o=[ve()],V(')'),r=Y(o,e)):(V(')'),N(e,at.UnexpectedToken,e.value),r=Y([])),dt.markEnd(dt.createProperty('set',t,r),n)):e.type===Ze.EOF||e.type===Ze.Punctuator?void B(e):(t=J(),V(':'),r=me(),dt.markEnd(dt.createProperty('init',t,r),n))}function te(){var e=[],t={},a=String,r,o,n,i,u;for(u=ct,V('{');!W('}');)r=ee(),o=r.key.type===et.Identifier?r.key.name:a(r.key.value),i='init'===r.kind?tt.Data:'get'===r.kind?tt.Get:tt.Set,n='$'+o,Object.prototype.hasOwnProperty.call(t,n)?(t[n]===tt.Data?it&&i===tt.Data?N({},at.StrictDuplicateProperty):i!==tt.Data&&N({},at.AccessorDataProperty):i===tt.Data?N({},at.AccessorDataProperty):t[n]&i&&N({},at.AccessorGetSet),t[n]|=i):t[n]=i,e.push(r),W('}')||V(',');return V('}'),dt.markEnd(dt.createObjectExpression(e),u)}function ae(){var e;return V('('),e=_e(),V(')'),e}function re(){var e,t,a,r;if(W('('))return ae();if(W('['))return Z();if(W('{'))return te();if(e=ct.type,r=ct,e===Ze.Identifier)a=dt.createIdentifier(O().value);else if(e===Ze.StringLiteral||e===Ze.NumericLiteral)it&&ct.octal&&N(ct,at.StrictOctalLiteral),a=dt.createLiteral(O());else if(e===Ze.Keyword){if(X('function'))return We();X('this')?(O(),a=dt.createThisExpression()):B(O())}else e===Ze.BooleanLiteral?(t=O(),t.value='true'===t.value,a=dt.createLiteral(t)):e===Ze.NullLiteral?(t=O(),t.value=null,a=dt.createLiteral(t)):W('/')||W('/=')?(a='undefined'==typeof ht.tokens?dt.createLiteral(D()):dt.createLiteral(I()),j()):B(O());return dt.markEnd(a,r)}function oe(){var e=[];if(V('('),!W(')'))for(;ut<pt&&(e.push(me()),!W(')'));)V(',');return V(')'),e}function ne(){var e,t;return t=ct,e=O(),R(e)||B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function ie(){return V('.'),ne()}function ue(){var e;return V('['),e=_e(),V(']'),e}function se(){var e,t,a;return a=ct,H('new'),e=pe(),t=W('(')?oe():[],dt.markEnd(dt.createNewExpression(e,t),a)}function le(){var e=gt.allowIn,t,a,r,o;for(o=ct,gt.allowIn=!0,t=X('new')?se():re();;){if(W('.'))r=ie(),t=dt.createMemberExpression('.',t,r);else if(W('('))a=oe(),t=dt.createCallExpression(t,a);else if(W('['))r=ue(),t=dt.createMemberExpression('[',t,r);else break;dt.markEnd(t,o)}return gt.allowIn=e,t}function pe(){var e,a,r;for(t(gt.allowIn,'callee of new expression always allow in keyword.'),r=ct,e=X('new')?se():re();W('.')||W('[');)W('[')?(a=ue(),e=dt.createMemberExpression('[',e,a)):(a=ie(),e=dt.createMemberExpression('.',e,a)),dt.markEnd(e,r);return e}function de(){var e=ct,t,a;return t=le(),ct.type===Ze.Punctuator&&(W('++')||W('--'))&&!U()&&(it&&t.type===et.Identifier&&d(t.name)&&N({},at.StrictLHSPostfix),!Q(t)&&N({},at.InvalidLHSInAssignment),a=O(),t=dt.markEnd(dt.createPostfixExpression(a.value,t),e)),t}function ce(){var e,t,a;return ct.type!==Ze.Punctuator&&ct.type!==Ze.Keyword?t=de():W('++')||W('--')?(a=ct,e=O(),t=ce(),it&&t.type===et.Identifier&&d(t.name)&&N({},at.StrictLHSPrefix),!Q(t)&&N({},at.InvalidLHSInAssignment),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):W('+')||W('-')||W('~')||W('!')?(a=ct,e=O(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):X('delete')||X('void')||X('typeof')?(a=ct,e=O(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a),it&&'delete'===t.operator&&t.argument.type===et.Identifier&&N({},at.StrictDelete)):t=de(),t}function ge(e,t){var a=0;if(e.type!==Ze.Punctuator&&e.type!==Ze.Keyword)return 0;switch(e.value){case'||':a=1;break;case'&&':a=2;break;case'|':a=3;break;case'^':a=4;break;case'&':a=5;break;case'==':case'!=':case'===':case'!==':a=6;break;case'<':case'>':case'<=':case'>=':case'instanceof':a=7;break;case'in':a=t?7:0;break;case'<<':case'>>':case'>>>':a=8;break;case'+':case'-':a=9;break;case'*':case'/':case'%':a=11;break;default:}return a}function he(){var e,t,a,r,o,n,u,s,l,p;if(e=ct,l=ce(),r=ct,o=ge(r,gt.allowIn),0===o)return l;for(r.prec=o,O(),t=[e,ct],u=ce(),n=[l,r,u];0<(o=ge(ct,gt.allowIn));){for(;2<n.length&&o<=n[n.length-2].prec;)u=n.pop(),s=n.pop().value,l=n.pop(),a=dt.createBinaryExpression(s,l,u),t.pop(),e=t[t.length-1],dt.markEnd(a,e),n.push(a);r=O(),r.prec=o,n.push(r),t.push(ct),a=ce(),n.push(a)}for(p=n.length-1,a=n[p],t.pop();1<p;)a=dt.createBinaryExpression(n[p-1].value,n[p-2],a),p-=2,e=t.pop(),dt.markEnd(a,e);return a}function fe(){var e,t,a,r,o;return o=ct,e=he(),W('?')&&(O(),t=gt.allowIn,gt.allowIn=!0,a=me(),gt.allowIn=t,V(':'),r=me(),e=dt.createConditionalExpression(e,a,r),dt.markEnd(e,o)),e}function me(){var e,t,a,r,o;return e=ct,o=ct,r=t=fe(),$()&&(!Q(t)&&N({},at.InvalidLHSInAssignment),it&&t.type===et.Identifier&&d(t.name)&&N(e,at.StrictLHSAssignment),e=O(),a=me(),r=dt.markEnd(dt.createAssignmentExpression(e.value,t,a),o)),r}function _e(){var e=ct,t;if(t=me(),W(',')){for(t=dt.createSequenceExpression([t]);ut<pt&&!!W(',');)O(),t.expressions.push(me());dt.markEnd(t,e)}return t}function ye(){for(var e=[],t;ut<pt&&!W('}')&&!(t=Xe(),'undefined'==typeof t);)e.push(t);return e}function xe(){var e,t;return t=ct,V('{'),e=ye(),V('}'),dt.markEnd(dt.createBlockStatement(e),t)}function ve(){var e,t;return t=ct,e=O(),e.type!==Ze.Identifier&&B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function be(e){var t=null,a,r;return r=ct,a=ve(),it&&d(a.name)&&N({},at.StrictVarName),'const'===e?(V('='),t=me()):W('=')&&(O(),t=me()),dt.markEnd(dt.createVariableDeclarator(a,t),r)}function Se(e){var t=[];do{if(t.push(be(e)),!W(','))break;O()}while(ut<pt);return t}function Pe(){var e;return H('var'),e=Se(),K(),dt.createVariableDeclaration(e,'var')}function Te(e){var t,a;return a=ct,H(e),t=Se(e),K(),dt.markEnd(dt.createVariableDeclaration(t,e),a)}function we(){return V(';'),dt.createEmptyStatement()}function ke(){var e=_e();return K(),dt.createExpressionStatement(e)}function Ce(){var e,t,a;return H('if'),V('('),e=_e(),V(')'),t=Ne(),X('else')?(O(),a=Ne()):a=null,dt.createIfStatement(e,t,a)}function Fe(){var e,t,a;return H('do'),a=gt.inIteration,gt.inIteration=!0,e=Ne(),gt.inIteration=a,H('while'),V('('),t=_e(),V(')'),W(';')&&O(),dt.createDoWhileStatement(e,t)}function Me(){var e,t,a;return H('while'),V('('),e=_e(),V(')'),a=gt.inIteration,gt.inIteration=!0,t=Ne(),gt.inIteration=a,dt.createWhileStatement(e,t)}function De(){var e,t,a;return a=ct,e=O(),t=Se(),dt.markEnd(dt.createVariableDeclaration(t,e.value),a)}function Ie(){var e=gt.allowIn,t,a,r,o,n,i,u;return t=a=r=null,H('for'),V('('),W(';')?O():(X('var')||X('let')?(gt.allowIn=!1,t=De(),gt.allowIn=e,1===t.declarations.length&&X('in')&&(O(),o=t,n=_e(),t=null)):(gt.allowIn=!1,t=_e(),gt.allowIn=e,X('in')&&(!Q(t)&&N({},at.InvalidLHSInForIn),O(),o=t,n=_e(),t=null)),'undefined'==typeof o&&V(';')),'undefined'==typeof o&&(!W(';')&&(a=_e()),V(';'),!W(')')&&(r=_e())),V(')'),u=gt.inIteration,gt.inIteration=!0,i=Ne(),gt.inIteration=u,'undefined'==typeof o?dt.createForStatement(t,a,r,i):dt.createForInStatement(o,n,i)}function Re(){var e=null,t;return(H('continue'),59===nt.charCodeAt(ut))?(O(),gt.inIteration||q({},at.IllegalContinue),dt.createContinueStatement(null)):U()?(gt.inIteration||q({},at.IllegalContinue),dt.createContinueStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(gt.labelSet,t)&&q({},at.UnknownLabel,e.name)),K(),null!==e||gt.inIteration||q({},at.IllegalContinue),dt.createContinueStatement(e))}function Ee(){var e=null,t;return(H('break'),59===nt.charCodeAt(ut))?(O(),gt.inIteration||gt.inSwitch||q({},at.IllegalBreak),dt.createBreakStatement(null)):U()?(gt.inIteration||gt.inSwitch||q({},at.IllegalBreak),dt.createBreakStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(gt.labelSet,t)&&q({},at.UnknownLabel,e.name)),K(),null!==e||gt.inIteration||gt.inSwitch||q({},at.IllegalBreak),dt.createBreakStatement(e))}function Ae(){var e=null;return(H('return'),gt.inFunctionBody||N({},at.IllegalReturn),32===nt.charCodeAt(ut)&&u(nt.charCodeAt(ut+1)))?(e=_e(),K(),dt.createReturnStatement(e)):U()?dt.createReturnStatement(null):(W(';')||W('}')||ct.type===Ze.EOF||(e=_e()),K(),dt.createReturnStatement(e))}function Le(){var e,t;return it&&(m(),N({},at.StrictModeWith)),H('with'),V('('),e=_e(),V(')'),t=Ne(),dt.createWithStatement(e,t)}function Oe(){var e=[],t,a,r;for(r=ct,X('default')?(O(),t=null):(H('case'),t=_e()),V(':');ut<pt&&!(W('}')||X('default')||X('case'));)a=Ne(),e.push(a);return dt.markEnd(dt.createSwitchCase(t,e),r)}function je(){var e,t,a,r,o;if(H('switch'),V('('),e=_e(),V(')'),V('{'),t=[],W('}'))return O(),dt.createSwitchStatement(e,t);for(r=gt.inSwitch,gt.inSwitch=!0,o=!1;ut<pt&&!W('}');)a=Oe(),null===a.test&&(o&&q({},at.MultipleDefaultsInSwitch),o=!0),t.push(a);return gt.inSwitch=r,V('}'),dt.createSwitchStatement(e,t)}function ze(){var e;return H('throw'),U()&&q({},at.NewlineAfterThrow),e=_e(),K(),dt.createThrowStatement(e)}function Ge(){var e,t,a;return a=ct,H('catch'),V('('),W(')')&&B(ct),e=ve(),it&&d(e.name)&&N({},at.StrictCatchVariable),V(')'),t=xe(),dt.markEnd(dt.createCatchClause(e,t),a)}function Ue(){var e=[],t=null,a;return H('try'),a=xe(),X('catch')&&e.push(Ge()),X('finally')&&(O(),t=xe()),0!==e.length||t||q({},at.NoCatchOrFinally),dt.createTryStatement(a,[],e,t)}function qe(){return H('debugger'),K(),dt.createDebuggerStatement()}function Ne(){var e=ct.type,t,a,r,o;if(e===Ze.EOF&&B(ct),e===Ze.Punctuator&&'{'===ct.value)return xe();if(o=ct,e===Ze.Punctuator)switch(ct.value){case';':return dt.markEnd(we(),o);case'(':return dt.markEnd(ke(),o);default:}if(e===Ze.Keyword)switch(ct.value){case'break':return dt.markEnd(Ee(),o);case'continue':return dt.markEnd(Re(),o);case'debugger':return dt.markEnd(qe(),o);case'do':return dt.markEnd(Fe(),o);case'for':return dt.markEnd(Ie(),o);case'function':return dt.markEnd(He(),o);case'if':return dt.markEnd(Ce(),o);case'return':return dt.markEnd(Ae(),o);case'switch':return dt.markEnd(je(),o);case'throw':return dt.markEnd(ze(),o);case'try':return dt.markEnd(Ue(),o);case'var':return dt.markEnd(Pe(),o);case'while':return dt.markEnd(Me(),o);case'with':return dt.markEnd(Le(),o);default:}return(t=_e(),t.type===et.Identifier&&W(':'))?(O(),r='$'+t.name,Object.prototype.hasOwnProperty.call(gt.labelSet,r)&&q({},at.Redeclaration,'Label',t.name),gt.labelSet[r]=!0,a=Ne(),delete gt.labelSet[r],dt.markEnd(dt.createLabeledStatement(t,a),o)):(K(),dt.markEnd(dt.createExpressionStatement(t),o))}function Be(){var e=[],t,a,r,o,n,i,u,s,l;for(l=ct,V('{');ut<pt&&ct.type===Ze.StringLiteral&&(a=ct,t=Xe(),e.push(t),t.expression.type===et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&N(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(n=gt.labelSet,i=gt.inIteration,u=gt.inSwitch,s=gt.inFunctionBody,gt.labelSet={},gt.inIteration=!1,gt.inSwitch=!1,gt.inFunctionBody=!0;ut<pt&&!W('}')&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return V('}'),gt.labelSet=n,gt.inIteration=i,gt.inSwitch=u,gt.inFunctionBody=s,dt.markEnd(dt.createBlockStatement(e),l)}function Ve(e){var t=[],a,r,o,n,i,u;if(V('('),!W(')'))for(n={};ut<pt&&(r=ct,a=ve(),i='$'+r.value,it?(d(r.value)&&(o=r,u=at.StrictParamName),Object.prototype.hasOwnProperty.call(n,i)&&(o=r,u=at.StrictParamDupe)):!e&&(d(r.value)?(e=r,u=at.StrictParamName):p(r.value)?(e=r,u=at.StrictReservedWord):Object.prototype.hasOwnProperty.call(n,i)&&(e=r,u=at.StrictParamDupe)),t.push(a),n[i]=!0,!W(')'));)V(',');return V(')'),{params:t,stricted:o,firstRestricted:e,message:u}}function He(){var e=[],t,a,r,o,n,i,u,s,l;return l=ct,H('function'),r=ct,t=ve(),it?d(r.value)&&N(r,at.StrictFunctionName):d(r.value)?(i=r,u=at.StrictFunctionName):p(r.value)&&(i=r,u=at.StrictReservedWord),n=Ve(i),e=n.params,o=n.stricted,i=n.firstRestricted,n.message&&(u=n.message),s=it,a=Be(),it&&i&&q(i,u),it&&o&&N(o,u),it=s,dt.markEnd(dt.createFunctionDeclaration(t,e,[],a),l)}function We(){var e=null,t=[],a,r,o,n,i,u,s,l;return l=ct,H('function'),W('(')||(a=ct,e=ve(),it?d(a.value)&&N(a,at.StrictFunctionName):d(a.value)?(o=a,n=at.StrictFunctionName):p(a.value)&&(o=a,n=at.StrictReservedWord)),i=Ve(o),t=i.params,r=i.stricted,o=i.firstRestricted,i.message&&(n=i.message),s=it,u=Be(),it&&o&&q(o,n),it&&r&&N(r,n),it=s,dt.markEnd(dt.createFunctionExpression(e,t,[],u),l)}function Xe(){if(ct.type===Ze.Keyword)switch(ct.value){case'const':case'let':return Te(ct.value);case'function':return He();default:return Ne();}return ct.type===Ze.EOF?void 0:Ne()}function $e(){for(var e=[],t,a,r,o;ut<pt&&(a=ct,a.type===Ze.StringLiteral)&&!(t=Xe(),e.push(t),t.expression.type!==et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&N(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(;ut<pt&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return e}function Ke(){var e,t;return m(),j(),t=ct,it=!1,e=$e(),dt.markEnd(dt.createProgram(e),t)}function Qe(){var e=[],t,a,r;for(t=0;t<ht.tokens.length;++t)a=ht.tokens[t],r={type:a.type,value:a.value},ht.range&&(r.range=a.range),ht.loc&&(r.loc=a.loc),e.push(r);ht.tokens=e}var Ze,Ye,Je,et,tt,at,rt,ot,nt,it,ut,st,lt,pt,dt,ct,gt,ht;Ze={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},Ye={},Ye[Ze.BooleanLiteral]='Boolean',Ye[Ze.EOF]='<end>',Ye[Ze.Identifier]='Identifier',Ye[Ze.Keyword]='Keyword',Ye[Ze.NullLiteral]='Null',Ye[Ze.NumericLiteral]='Numeric',Ye[Ze.Punctuator]='Punctuator',Ye[Ze.StringLiteral]='String',Ye[Ze.RegularExpression]='RegularExpression',Je=['(','{','[','in','typeof','instanceof','new','return','case','delete','throw','void','=','+=','-=','*=','/=','%=','<<=','>>=','>>>=','&=','|=','^=',',','+','-','*','/','%','++','--','<<','>>','>>>','&','|','^','!','~','&&','||','?',':','===','==','>=','<=','<','>','!=','!=='],et={AssignmentExpression:'AssignmentExpression',ArrayExpression:'ArrayExpression',BlockStatement:'BlockStatement',BinaryExpression:'BinaryExpression',BreakStatement:'BreakStatement',CallExpression:'CallExpression',CatchClause:'CatchClause',ConditionalExpression:'ConditionalExpression',ContinueStatement:'ContinueStatement',DoWhileStatement:'DoWhileStatement',DebuggerStatement:'DebuggerStatement',EmptyStatement:'EmptyStatement',ExpressionStatement:'ExpressionStatement',ForStatement:'ForStatement',ForInStatement:'ForInStatement',FunctionDeclaration:'FunctionDeclaration',FunctionExpression:'FunctionExpression',Identifier:'Identifier',IfStatement:'IfStatement',Literal:'Literal',LabeledStatement:'LabeledStatement',LogicalExpression:'LogicalExpression',MemberExpression:'MemberExpression',NewExpression:'NewExpression',ObjectExpression:'ObjectExpression',Program:'Program',Property:'Property',ReturnStatement:'ReturnStatement',SequenceExpression:'SequenceExpression',SwitchStatement:'SwitchStatement',SwitchCase:'SwitchCase',ThisExpression:'ThisExpression',ThrowStatement:'ThrowStatement',TryStatement:'TryStatement',UnaryExpression:'UnaryExpression',UpdateExpression:'UpdateExpression',VariableDeclaration:'VariableDeclaration',VariableDeclarator:'VariableDeclarator',WhileStatement:'WhileStatement',WithStatement:'WithStatement'},tt={Data:1,Get:2,Set:4},at={UnexpectedToken:'Unexpected token %0',UnexpectedNumber:'Unexpected number',UnexpectedString:'Unexpected string',UnexpectedIdentifier:'Unexpected identifier',UnexpectedReserved:'Unexpected reserved word',UnexpectedEOS:'Unexpected end of input',NewlineAfterThrow:'Illegal newline after throw',InvalidRegExp:'Invalid regular expression',UnterminatedRegExp:'Invalid regular expression: missing /',InvalidLHSInAssignment:'Invalid left-hand side in assignment',InvalidLHSInForIn:'Invalid left-hand side in for-in',MultipleDefaultsInSwitch:'More than one default clause in switch statement',NoCatchOrFinally:'Missing catch or finally after try',UnknownLabel:'Undefined label \'%0\'',Redeclaration:'%0 \'%1\' has already been declared',IllegalContinue:'Illegal continue statement',IllegalBreak:'Illegal break statement',IllegalReturn:'Illegal return statement',StrictModeWith:'Strict mode code may not include a with statement',StrictCatchVariable:'Catch variable may not be eval or arguments in strict mode',StrictVarName:'Variable name may not be eval or arguments in strict mode',StrictParamName:'Parameter name eval or arguments is not allowed in strict mode',StrictParamDupe:'Strict mode function may not have duplicate parameter names',StrictFunctionName:'Function name may not be eval or arguments in strict mode',StrictOctalLiteral:'Octal literals are not allowed in strict mode.',StrictDelete:'Delete of an unqualified identifier in strict mode.',StrictDuplicateProperty:'Duplicate data property in object literal not allowed in strict mode',AccessorDataProperty:'Object literal may not have data and accessor property with the same name',AccessorGetSet:'Object literal may not have multiple get/set accessors with the same name',StrictLHSAssignment:'Assignment to eval or arguments is not allowed in strict mode',StrictLHSPostfix:'Postfix increment/decrement may not have eval or arguments operand in strict mode',StrictLHSPrefix:'Prefix increment/decrement may not have eval or arguments operand in strict mode',StrictReservedWord:'Use of future reserved word in strict mode'},rt={NonAsciiIdentifierStart:/[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]/,NonAsciiIdentifierPart:/[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]/},ot={name:'SyntaxTree',processComment:function(e){var t,a;if(!(e.type===et.Program&&0<e.body.length)){for(0<ht.trailingComments.length?ht.trailingComments[0].range[0]>=e.range[1]?(a=ht.trailingComments,ht.trailingComments=[]):ht.trailingComments.length=0:0<ht.bottomRightStack.length&&ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments&&ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(a=ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments,delete ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments);0<ht.bottomRightStack.length&&ht.bottomRightStack[ht.bottomRightStack.length-1].range[0]>=e.range[0];)t=ht.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):0<ht.leadingComments.length&&ht.leadingComments[ht.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=ht.leadingComments,ht.leadingComments=[]),a&&(e.trailingComments=a),ht.bottomRightStack.push(e)}},markEnd:function(e,t){return ht.range&&(e.range=[t.start,ut]),ht.loc&&(e.loc=new G(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),st,ut-lt),this.postProcess(e)),ht.attachComment&&this.processComment(e),e},postProcess:function(e){return ht.source&&(e.loc.source=ht.source),e},createArrayExpression:function(e){return{type:et.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,a){return{type:et.AssignmentExpression,operator:e,left:t,right:a}},createBinaryExpression:function(e,t,a){var r='||'===e||'&&'===e?et.LogicalExpression:et.BinaryExpression;return{type:r,operator:e,left:t,right:a}},createBlockStatement:function(e){return{type:et.BlockStatement,body:e}},createBreakStatement:function(e){return{type:et.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:et.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:et.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,a){return{type:et.ConditionalExpression,test:e,consequent:t,alternate:a}},createContinueStatement:function(e){return{type:et.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:et.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:et.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:et.EmptyStatement}},createExpressionStatement:function(e){return{type:et.ExpressionStatement,expression:e}},createForStatement:function(e,t,a,r){return{type:et.ForStatement,init:e,test:t,update:a,body:r}},createForInStatement:function(e,t,a){return{type:et.ForInStatement,left:e,right:t,body:a,each:!1}},createFunctionDeclaration:function(e,t,a,r){return{type:et.FunctionDeclaration,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,a,r){return{type:et.FunctionExpression,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:et.Identifier,name:e}},createIfStatement:function(e,t,a){return{type:et.IfStatement,test:e,consequent:t,alternate:a}},createLabeledStatement:function(e,t){return{type:et.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:et.Literal,value:e.value,raw:nt.slice(e.start,e.end)}},createMemberExpression:function(e,t,a){return{type:et.MemberExpression,computed:'['===e,object:t,property:a}},createNewExpression:function(e,t){return{type:et.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:et.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:et.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:et.Program,body:e}},createProperty:function(e,t,a){return{type:et.Property,key:t,value:a,kind:e}},createReturnStatement:function(e){return{type:et.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:et.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:et.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:et.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:et.ThisExpression}},createThrowStatement:function(e){return{type:et.ThrowStatement,argument:e}},createTryStatement:function(e,t,a,r){return{type:et.TryStatement,block:e,guardedHandlers:t,handlers:a,finalizer:r}},createUnaryExpression:function(e,t){return'++'===e||'--'===e?{type:et.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:et.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:et.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:et.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:et.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:et.WithStatement,object:e,body:t}}},e.version='1.2.5',e.tokenize=function(e,t){var a,r,o;a=String,'string'==typeof e||e instanceof String||(e=a(e)),dt=ot,nt=e,ut=0,st=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,gt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ht={},t=t||{},t.tokens=!0,ht.tokens=[],ht.tokenize=!0,ht.openParenToken=-1,ht.openCurlyToken=-1,ht.range='boolean'==typeof t.range&&t.range,ht.loc='boolean'==typeof t.loc&&t.loc,'boolean'==typeof t.comment&&t.comment&&(ht.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(ht.errors=[]);try{if(j(),ct.type===Ze.EOF)return ht.tokens;for(r=O();ct.type!==Ze.EOF;)try{r=O()}catch(e){if(r=ct,ht.errors){ht.errors.push(e);break}else throw e}Qe(),o=ht.tokens,'undefined'!=typeof ht.comments&&(o.comments=ht.comments),'undefined'!=typeof ht.errors&&(o.errors=ht.errors)}catch(t){throw t}finally{ht={}}return o},e.parse=function(e,t){var a,r;r=String,'string'==typeof e||e instanceof String||(e=r(e)),dt=ot,nt=e,ut=0,st=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,gt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ht={},'undefined'!=typeof t&&(ht.range='boolean'==typeof t.range&&t.range,ht.loc='boolean'==typeof t.loc&&t.loc,ht.attachComment='boolean'==typeof t.attachComment&&t.attachComment,ht.loc&&null!==t.source&&t.source!==void 0&&(ht.source=r(t.source)),'boolean'==typeof t.tokens&&t.tokens&&(ht.tokens=[]),'boolean'==typeof t.comment&&t.comment&&(ht.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(ht.errors=[]),ht.attachComment&&(ht.range=!0,ht.comments=[],ht.bottomRightStack=[],ht.trailingComments=[],ht.leadingComments=[]));try{a=Ke(),'undefined'!=typeof ht.comments&&(a.comments=ht.comments),'undefined'!=typeof ht.tokens&&(Qe(),a.tokens=ht.tokens),'undefined'!=typeof ht.errors&&(a.errors=ht.errors)}catch(t){throw t}finally{ht={}}return a},e.Syntax=function(){var e={},t;for(t in'function'==typeof Object.create&&(e=Object.create(null)),et)et.hasOwnProperty(t)&&(e[t]=et[t]);return'function'==typeof Object.freeze&&Object.freeze(e),e}()})}),Oh=0,jh=Er,zh=['args','body'],Gh=['pre','post','printCode','funcName','blockSize'],Uh=Ar,qh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},a=t.alpha,o=a===void 0?1:a;r(e.tensor,o)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array','scalar'],body:function(e,t){e=Sn(e,0)+t*(_n(bn(e,0))-1)}})});he(qh);var Nh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array','scalar'],body:function(e){e=1.0507009873554805*(Sn(e,0)+1.6732632423543772*(_n(bn(e,0))-1))}})});he(Nh);var Bh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array'],body:function(e){e=mn(_n(e)+1)}})});he(Bh);var Vh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array'],body:function(e){e/=1+Pn(e)}})});he(Vh);var Hh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},a=t.alpha,n=a===void 0?0:a,i=t.maxValue,u=i===void 0?null:i,s;0!==n&&(s=new o.default([],e.tensor.shape),r.default.mins(s.tensor,e.tensor,0),r.default.mulseq(s.tensor,n)),r.default.maxseq(e.tensor,0),u&&r.default.minseq(e.tensor,u),s&&r.default.addeq(e.tensor,s.tensor)};var r=a(Mh),o=a(Rh)});he(Hh);var Wh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array'],body:function(e){e=Math.tanh(e)}})});he(Wh);var Xh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array'],body:function(e){e=1/(1+_n(-e))}})});he(Xh);var $h=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(Uh),r=(0,a.default)({args:['array'],body:function(e){e=0.2*e+0.5,0>=e?e=0:1<=e&&(e=1)}})});he($h);var Kh=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){return e}});he(Kh);var Qh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'softmax',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'elu',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'selu',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'softplus',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'softsign',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'relu',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'tanh',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'sigmoid',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'hard_sigmoid',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'linear',{enumerable:!0,get:function(){return c.default}});var r=a(Ah),o=a(qh),n=a(Nh),i=a(Bh),u=a(Vh),s=a(Hh),l=a(Wh),p=a(Xh),d=a($h),c=a(Kh)});he(Qh);var Zh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='LeakyReLU';var r=e.alpha,o=void 0===r?0.3:r;return a.description='alpha: '+o,a.alpha=o,a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * min(v, 0.0);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=e,(0,Qh.relu)(this.output,{alpha:this.alpha})}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=n});he(Zh);var Yh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Uh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(a,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','array'],body:function(e,t){e=Sn(e,0)+t*bn(e,0)}})}),a.layerClass='PReLU',a.params=['alpha'],a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  vec4 a = texture(alpha, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + a * min(v, 0.0);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=e,this._compute(this.output.tensor,this.weights.alpha.tensor)}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.alpha,name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(Yh);var Jh=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Uh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));u.call(a),a.layerClass='ELU';var r=e.alpha,o=void 0===r?1:r;return a.description='alpha: '+o,a.alpha=o,a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=e,this._compute(this.output.tensor,this.alpha)}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i;var u=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e=Sn(e,0)+t*(_n(bn(e,0))-1)}})})}});he(Jh);var ef=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Uh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));u.call(a),a.layerClass='ThresholdedReLU';var r=e.theta,o=void 0===r?1:r;return a.description='theta: '+o,a.theta=o,a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float theta;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = v * float(greaterThan(v, vec4(theta)));\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=e,this._compute(this.output.tensor,this.theta)}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.theta,type:'float',name:'theta'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i;var u=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e*=+(e>t)}})})}});he(ef);var tf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'LeakyReLU',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'PReLU',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'ELU',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'ThresholdedReLU',{enumerable:!0,get:function(){return i.default}});var r=a(Zh),o=a(Yh),n=a(Jh),i=a(ef)});he(tf);var af=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var r='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n  \n  outColor = vec4('+(0,a.default)(e).map(function(e){return'texelFetch(inputs['+e+'], ivec2(out_x, out_y), 0).r'}).join(' + ')+');\n}\n';return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vh)});he(af);var rf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var r='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n  \n  outColor = vec4(('+(0,a.default)(e).map(function(e){return'texelFetch(inputs['+e+'], ivec2(out_x, out_y), 0).r'}).join(' + ')+') / float('+e+'));\n}\n';return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vh)});he(rf);var of=Lr,nf=Or,uf=jr,sf=zr,lf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,u){var s=t.map(function(e){return e[u]}),l=(0,n.default)(e+1).map(function(e){return(0,o.default)((0,r.default)(s,e))}),p=0===u?'out_y':'out_x',i='\n  int n = 0;\n  int offset = 0;\n  if ('+p+' >= '+l[1]+' && '+p+' < '+l[2]+') {\n    n = 1;\n    offset = '+l[1]+';\n  }';2<e&&(i+=(0,n.default)(2,e).map(function(e){return' else if ('+p+' >= '+l[e]+' && '+p+' < '+l[e+1]+') {\n    n = '+e+';\n    offset = '+l[e]+';\n  }'}).join('')+'\n');var d='outColor = vec4(0.0);';if(0===u||1===u){var c=function(e){return'out_x'+(1===u?' - '+l[e]:'')},g=function(e){return'out_y'+(0===u?' - '+l[e]:'')};d='\n  if (n == 0) {\n    outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r);\n  }'+(0,n.default)(1,e).map(function(e){return' else if (n == '+e+') {\n    outColor = vec4(texelFetch(inputs['+e+'], ivec2('+c(e)+', '+g(e)+'), 0).r);\n  }'}).join('')+'\n'}var h='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+a[0]+') * outTex.y);\n  int out_x = int(float('+a[1]+') * outTex.x);\n'+i+'\n'+d+'\n}\n';return h};var r=a(nf),o=a(sf),n=a(vh)});he(lf);var pf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var a='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n\n  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;\n  for (int i = 1; i < '+e+'; i++) {\n    val = max(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);\n  }\n\n  outColor = vec4(val);\n}\n';return a}});he(pf);var df=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var a='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n\n  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;\n  for (int i = 1; i < '+e+'; i++) {\n    val = min(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);\n  }\n\n  outColor = vec4(val);\n}\n';return a}});he(df);var cf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var r='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs['+e+'];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n\n  outColor = vec4('+(0,a.default)(e).map(function(e){return'texelFetch(inputs['+e+'], ivec2(out_x, out_y), 0).r'}).join(' * ')+');\n}\n';return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vh)});he(cf);var gf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){var a='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D inputs[2];\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+t[0]+') * outTex.y);\n  int out_x = int(float('+t[1]+') * outTex.x);\n  \n  outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r - texelFetch(inputs[1], ivec2(out_x, out_y), 0).r);\n}\n';return a}});he(gf);var hf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){var n=r?'sum += texelFetch(bias, ivec2(out_x, 0), 0).r;':'',i=o?'int fragmentIndex = int(floor(float(rowIndex) / float('+t[0]+')));\n      rowIndex = int(mod(float(rowIndex), float('+t[0]+')));\n      colIndex += fragmentIndex * '+t[1]+';':'',u='#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform sampler2D kernel;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+e[0]+') * outTex.y);\n  int out_x = int(float('+e[1]+') * outTex.x);\n\n  float sum = 0.;\n  for (int i = 0; i < '+a[1]+'; ++i) {\n    int index = texelFetch(indexMap, ivec2(i, out_y), 0).r;    \n    if (index != -1) {\n      int rowIndex = int(floor(float(index) / float('+t[1]+')));\n      int colIndex = int(mod(float(index), float('+t[1]+')));\n      '+i+'\n      sum += texelFetch(x, ivec2(colIndex, rowIndex), 0).r * texelFetch(kernel, ivec2(out_x, i), 0).r;\n    }\n  }\n\n  '+n+'\n  outColor = vec4(sum);\n}   \n';return u}});he(hf);var ff=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){var n=r?'sum += texelFetch(bias, ivec2(out_x, 0), 0).r;':'',i=o?'int fragmentIndex = int(floor(float(rowIndex) / float('+t[0]+')));\n      rowIndex = int(mod(float(rowIndex), float('+t[0]+')));\n      colIndex += fragmentIndex * '+t[1]+';':'',u='#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D matMulResult;\nuniform isampler2D indexMap;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+e[0]+') * outTex.y);\n  int out_x = int(float('+e[1]+') * outTex.x);\n\n  float sum = 0.;\n  for (int n = 0; n < '+a[1]+'; ++n) {\n    int index = texelFetch(indexMap, ivec2(n, out_y), 0).r;\n    if (index != -1) {\n      int rowIndex = int(floor(float(index) / float('+t[1]+')));\n      int colIndex = int(mod(float(index), float('+t[1]+')));\n      '+i+'\n      sum += texelFetch(matMulResult, ivec2(colIndex + out_x, rowIndex), 0).r;\n    }\n  }\n\n  '+n+'\n  outColor = vec4(sum);\n}  \n';return u}});he(ff);var mf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a){var r;return r=a?'#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D featureMaps;\nuniform sampler2D weights;\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+e[0]+') * outTex.y);\n  int out_x = int(float('+e[1]+') * outTex.x);\n\n  int featureMapsRow = out_x + '+e[0]+' * out_y;\n\n  float sum = 0.;\n  for (int k = 0; k < '+t+'; ++k) {\n    float f = texelFetch(featureMaps, ivec2(k, featureMapsRow), 0).r;\n    float w = texelFetch(weights, ivec2(k, 0), 0).r;\n    sum += f * w;\n  }\n\n  outColor = vec4(max(sum, 0.0));\n}  \n':'#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D featureMaps;\nuniform sampler2D weights;\nout vec4 outColor;\n\nvoid main() {\n  int out_y = int(float('+e[0]+') * outTex.y);\n  int out_x = int(float('+e[1]+') * outTex.x);\n\n  float sum = 0.;\n  for (int k = 0; k < '+t+'; ++k) {\n    float f = texelFetch(featureMaps, ivec2(k, out_y), 0).r;\n    float w = texelFetch(weights, ivec2(out_x, k), 0).r;\n    sum += f * w;\n  }\n\n  outColor = vec4(max(sum, 0.0));\n}  \n',r}});he(mf);var _f=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),g=1;g<t;g++)a[g-1]=arguments[g];switch(e){case'add':return(0,r.default).apply(void 0,a);case'average':return(0,o.default).apply(void 0,a);case'concatenate':return(0,n.default).apply(void 0,a);case'maximum':return(0,i.default).apply(void 0,a);case'minimum':return(0,u.default).apply(void 0,a);case'multiply':return(0,s.default).apply(void 0,a);case'subtract':return(0,l.default).apply(void 0,a);case'conv2d':return(0,p.default).apply(void 0,a);case'conv2dTranspose':return(0,d.default).apply(void 0,a);case'cam':return(0,c.default).apply(void 0,a);default:throw new Error('GLSL program not found');}};var r=a(af),o=a(rf),n=a(lf),i=a(pf),u=a(df),s=a(cf),l=a(gf),p=a(hf),d=a(ff),c=a(mf)});he(_f);var yf=Xr,xf=32,vf=Zr,bf={},Sf=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.linear=t.hard_sigmoid=t.sigmoid=t.tanh=t.relu=t.softsign=t.softplus=t.selu=t.elu=t.softmax=void 0;t.softmax='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float maxval = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    if (i == 0 || val > maxval) {\n      maxval = val;\n    }\n  }\n\n  float sum = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    sum += exp(val - maxval);\n  }\n\n  outColor = exp(texture(x, vec2(outTex.x, outTex.y)) - maxval) / sum;\n}\n';t.elu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.0;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n';t.selu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.6732632423543772848170429916717;\n  float scale = 1.0507009873554804934193349852946;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = scale * (max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0));\n}\n';t.softplus='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = log(1.0 + exp(texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.softsign='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v /= 1.0 + abs(v);\n  outColor = v;\n}\n';t.relu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0);\n}\n';t.tanh='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = tanh(v);\n}\n';t.sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = 1.0 / (1.0 + exp(-1.0 * texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.hard_sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v = v * 0.2 + 0.5;\n  v = max(v, 0.0);\n  v = min(v, 1.0);\n  outColor = v;\n}\n';t.linear='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, outTex.y));\n}\n'});he(Sf);var Pf=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),u=r(Rh),n=a(Qh),i=r(_f),s=a(Dh),l=r(Mh),p=r(vf),d=a(Sf),c=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Conv2D';var r=e.filters,o=void 0===r?1:r,i=e.kernel_size,u=void 0===i?[3,3]:i,s=e.strides,l=void 0===s?[1,1]:s,p=e.padding,c=void 0===p?'valid':p,g=e.data_format,h=void 0===g?'channels_last':g,f=e.dilation_rate,m=void 0===f?[1,1]:f,_=e.activation,y=void 0===_?'linear':_,x=e.use_bias;return a.kernelShape=Array.isArray(u)?[o].concat(En(u)):[o,u,u],a.strides=Array.isArray(l)?l:[l,l],'valid'===c||'same'===c?a.padding=c:a.throwError('Invalid padding.'),'channels_last'===h||'channels_first'===h?a.dataFormat=h:a.throwError('Only channels_last and channels_first data formats are allowed.'),a.dilationRate=Array.isArray(m)?m:[m,m],(1!==a.dilationRate[0]||1!==a.dilationRate[1])&&(1!==a.strides[0]||1!==a.strides[1])&&a.throwError('Incompatible combination of dilation_rate with strides.'),a.activation=y,a.activationFunc=n[y],a.useBias=void 0===x||x,a.params=a.useBias?['kernel','bias']:['kernel'],a.description=a.kernelShape[0]+' '+a.kernelShape.slice(1).join('x')+' filters',a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.description+=a.dilationRate.some(function(e){return 1<e})?', '+a.dilationRate.join('x')+' dilation':'',a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),a.mapInputFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(d[a.activation])),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_calcOutputShape',value:function(e){if(!(this.outputShape&&this.inputPadding)){var t=e[0],a=e[1],r=Rn(this.kernelShape,3),o=r[0],n=r[1],i=r[2],u=n+(n-1)*(this.dilationRate[0]-1),s=i+(i-1)*(this.dilationRate[1]-1),l='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-u+this.strides[0])/this.strides[0]),p='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-s+this.strides[1])/this.strides[1]),d='same'===this.padding?Sn(0,fn((l-1)*this.strides[0]+u-t)):0,c='same'===this.padding?Sn(0,fn((p-1)*this.strides[1]+s-a)):0,g=fn(d/2),h=fn(c/2);this.outputShape=[l,p,o],this.inputPadding=[g,d-g,h,c-h]}}},{key:'_padInput',value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if('same'===this.padding){var a=Rn(e.tensor.shape,3),r=a[0],o=a[1],n=a[2],i=Rn(this.inputPadding,4),s=i[0],p=i[1],d=i[2],c=i[3],g=new u.default([],[r+s+p,o+d+c,n]);return 0!==t&&l.default.assigns(g.tensor,t),l.default.assign(g.tensor.hi(r+s,o+d,n).lo(s,d,0),e.tensor),g}return e}},{key:'_im2col',value:function(e){var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],o=t[2],n=this.kernelShape[1],s=this.kernelShape[2],p=this.outputShape[0],d=this.outputShape[1],c=n*s*o,g=n+(n-1)*(this.dilationRate[0]-1),h=s+(s-1)*(this.dilationRate[1]-1);if(this.imColsMat||(this.imColsMat=new u.default([],[p*d,c])),1===g&&1===h&&1===this.strides[0]&&1===this.strides[1])return this.imColsMat.replaceTensorData(e.tensor.data),this.imColsMat;for(var f=new u.default([],[n,s,o]),m=0,_=0;_<=a-g;_+=this.strides[0])for(var i=0;i<=r-h;i+=this.strides[1])l.default.assign(f.tensor,e.tensor.hi(_+g,i+h,o).lo(_,i,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.imColsMat.tensor.data.set(f.tensor.data,m),m+=c;return this.imColsMat}},{key:'_w2row',value:function(){var e=this.weights.kernel.tensor.shape[2],t=Rn(this.kernelShape,3),a=t[0],r=t[1],o=t[2],i=r*o*e;this.wRowsMat=new u.default([],[i,a]);for(var s=new u.default([],[r,o,e]),p=new u.default([],[i]),d=0;d<a;d++)l.default.assign(s.tensor,this.weights.kernel.tensor.pick(null,null,null,d)),p.replaceTensorData(s.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,d),p.tensor);return this.wRowsMat}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);var t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=new u.default([],[a*r,t]);if(this.useBias)for(var i=0;i<t;i++)l.default.assigns(o.tensor.pick(null,i),this.weights.bias.tensor.get(i));(0,p.default)(o.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new u.default([],this.outputShape);for(var n=new u.default([],[a*r]),s=new u.default([],[a,r]),d=0;d<t;d++)l.default.assign(n.tensor,o.tensor.pick(null,d)),s.replaceTensorData(n.tensor.data),l.default.assign(this.output.tensor.pick(null,null,d),s.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_createIndexMap',value:function(e){if(!this.indexMap){var t=Rn(this.inputShape,3),a=t[0],r=t[1],o=t[2],n=new u.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){var s=Rn(this.inputPadding,4),p=s[0],d=s[1],c=s[2],g=s[3];a=a+p+d,r=r+c+g;n=this._padInput(n,-1)}var h=this.kernelShape[1],f=this.kernelShape[2],m=this.outputShape[0],_=this.outputShape[1],y=h*f*o,x=h+(h-1)*(this.dilationRate[0]-1),v=f+(f-1)*(this.dilationRate[1]-1);this.indexMap=new u.default([],[m*_,y],{type:Int32Array});for(var b=new u.default([],[h,f,o]),S=0,P=0,i=a-x;P<=i;P+=this.strides[0])for(var T=0,w=r-v;T<=w;T+=this.strides[1])l.default.assign(b.tensor,n.tensor.hi(P+x,T+v,o).lo(P,T,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.indexMap.tensor.data.set(b.tensor.data,S),S+=y;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){var t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.imColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new u.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new u.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){var a=!!e.glTextureFragments;if(a&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){var r=(0,i.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,a);this.convProgram=gh.webgl2.compileProgram(r)}gh.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'}].concat(En(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])),supportsTextureFragments:!0}),a&&e.removeGLTextureFragmentsAsColStack()}else{var o=[{input:this.imColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&o.push({input:this.weights.bias,name:'C'}),gh.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:o,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&gh.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}]),t}(o.default);t.default=c});he(Pf);var Tf=Yr,wf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Pf),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Dh),u=a(Mh),s=a(Ih),l=a(Tf),p=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Conv1D';var r=e.filters,o=void 0===r?1:r,i=e.kernel_size,u=void 0===i?1:i,s=e.strides,l=void 0===s?1:s,p=e.padding,d=void 0===p?'valid':p,c=e.dilation_rate,g=void 0===c?1:c,h=e.activation,f=void 0===h?'linear':h,m=e.use_bias,_=void 0===m||m;a.description=o+' filters of size '+u+', striding '+l,a.description+='valid'===d?', no border padding':', pad to same borders',a.description+=1<g?', dilation rate '+g:'',a.description+='linear'===f?'':', '+f+' activation','valid'!==d&&'same'!==d&&a.throwError('Invalid padding.'),1!==g&&1!==l&&a.throwError('Incompatible combination of dilation_rate with strides.'),a.use_bias=_,a.params=a.use_bias?['kernel','bias']:['kernel'];var y={filters:o,kernel_size:[u,1],strides:[l,1],padding:d,data_format:'channels_first',dilation_rate:g,activation:f,use_bias:_};return a._conv2dAttrs=y,a._conv2d=new n.default(Object.assign(y,{gpu:e.gpu})),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){e[0].tensor=(0,l.default)(e[0].tensor).transpose(2,1,0,3),this._conv2d.setWeights(e)}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=this,a=new o.default(e.tensor.data,e.tensor.shape);a.tensor=(0,l.default)(a.tensor).transpose(0,2,1);var r=this._conv2d.call(a);this.outputShape=[0,2].map(function(e){return t._conv2d.outputShape[e]}),this.output=new o.default([],this.outputShape),u.default.assign(this.output.tensor,(0,s.default)(r.tensor).transpose(1,0,2))}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});var t=e.tensor.shape,a=new o.default([],t);Object.assign(a,e),a.glTextureShape=t,a.is2DReshaped=!0,a.originalShape=[t[0],1,t[1]],a.indicesForReshaped=i.createIndicesFor2DReshaped(a.originalShape,!1,-1),this.output=this._conv2d.call(a),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=p});he(wf);var kf=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),u=r(Rh),n=a(Qh),i=a(Dh),s=r(Mh),l=r(vf),p=r(Pf),d=a(Sf),c=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Dn(t,e),Fn(t,[{key:'_calcOutputShape',value:function(e){Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_calcOutputShape',this).call(this,e);var a=this.kernelShape[0],r=e[2];this.outputShape[2]=a*r}},{key:'_im2col',value:function(e){var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],o=t[2],n=this.kernelShape[1],l=this.kernelShape[2],p=this.outputShape[0],d=this.outputShape[1],g=n*l;this.imColsMat||(this.imColsMat=new u.default([],[p*d*o,g]));for(var h=new u.default([],[n,l,1]),f=0,m=0;m<o;m++)for(var c=0;c<=a-n;c+=this.strides[0])for(var i=0;i<=r-l;i+=this.strides[1])s.default.assign(h.tensor,e.tensor.hi(c+n,i+l,m+1).lo(c,i,m)),this.imColsMat.tensor.data.set(h.tensor.data,f),f+=g;return this.imColsMat}},{key:'_w2row',value:function(){var e=this.weights.kernel.tensor.shape[2],t=Rn(this.kernelShape,3),a=t[0],r=t[1],o=t[2],i=r*o;this.wRowsMat=new u.default([],[i,a*e]);for(var l=new u.default([],[r,o]),d=new u.default([],[i]),g=0,p=0;p<e;p++)for(var c=0;c<a;c++)s.default.assign(l.tensor,this.weights.kernel.tensor.pick(null,null,p,c)),d.replaceTensorData(l.tensor.data),s.default.assign(this.wRowsMat.tensor.pick(null,g),d.tensor),g+=1;return this.wRowsMat}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);var t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.inputShape[2],i=new u.default([],[a*r*o,t*o]);(0,l.default)(i.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new u.default([],this.outputShape);for(var s=a*r*t*o,p=new Float32Array(s),d=0;d<o;d++)for(var c=d*s+d*t;c<(d+1)*s;c+=t*o)for(var n=0;n<t;n++)p[c+n-d*s]=i.tensor.data[c+n];this.output.replaceTensorData(p)}},{key:'_createIndexMap',value:function(e){if(!this.indexMap){var t=Rn(this.inputShape,3),a=t[0],r=t[1],o=t[2],n=new u.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){var l=Rn(this.inputPadding,4),p=l[0],d=l[1],g=l[2],h=l[3];a=a+p+d,r=r+g+h;n=this._padInput(n,-1)}var f=this.kernelShape[1],m=this.kernelShape[2],_=this.outputShape[0],y=this.outputShape[1],x=f*m;this.indexMap=new u.default([],[_*y*o,x],{type:Int32Array});for(var v=new u.default([],[f,m,1]),b=0,S=0;S<o;S++)for(var c=0,i=a-f;c<=i;c+=this.strides[0])for(var P=0,T=r-m;P<=T;P+=this.strides[1])s.default.assign(v.tensor,n.tensor.hi(c+f,P+m,S+1).lo(c,P,S)),this.indexMap.tensor.data.set(v.tensor.data,b),b+=x;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_createOutputReshapeIndexMap',value:function(){if(!this.reshapeIndexMap){var e=this.kernelShape[0],t=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]],a=new u.default([],t,{type:Int32Array}),r=new u.default([],t,{type:Int32Array});this.reshapeIndexMap=new u.default([],t,{type:Int32Array});for(var o=0;o<t[1];o++)for(var n=0;n<t[0];n++)s.default.assigns(a.tensor.pick(n,o),n+fn(o/e)*t[0]);for(var i=0;i<t[1];i++)s.default.assigns(r.tensor.pick(null,i),i);s.default.muls(this.reshapeIndexMap.tensor,a.tensor,t[1]),s.default.addeq(this.reshapeIndexMap.tensor,r.tensor),this.reshapeIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){if(Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e),this._createOutputReshapeIndexMap(),!this.outputReshaped){var a=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputReshaped=new u.default([],a),this.outputReshaped.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputReshaped.is2DReshaped=!0,this.outputReshaped.originalShape=this.outputShape,this.outputReshaped.indicesForReshaped=i.createIndicesFor2DReshaped(this.outputShape,!1,-1)}this.output.glTextureFragments&&this.output.convert2DRowFragmentedGLTextureToColStack(),gh.webgl2.runProgram({program:this.output.glTextureFragments?this.mapInputFragmentsProgram:this.mapInputProgram,output:this.outputReshaped,inputs:[{input:this.output,name:'x'},{input:this.reshapeIndexMap,name:'indexMap'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),this.output.glTextureFragments&&this.output.removeGLTextureFragmentsAsColStack()}}]),t}(p.default),g=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='SeparableConv2D';var r=e.filters,o=void 0===r?1:r,i=e.kernel_size,u=void 0===i?[1,1]:i,s=e.strides,l=void 0===s?[1,1]:s,p=e.padding,c=void 0===p?'valid':p,g=e.data_format,h=void 0===g?'channels_last':g,f=e.depth_multiplier,m=void 0===f?1:f,_=e.activation,y=void 0===_?'linear':_,x=e.use_bias,v=void 0===x||x;return a.kernelShape=Array.isArray(u)?[o].concat(En(u)):[o,u,u],a.strides=Array.isArray(l)?l:[l,l],'valid'===c||'same'===c?a.padding=c:a.throwError('Invalid padding.'),'channels_last'===h||'channels_first'===h?a.dataFormat=h:a.throwError('Only channels_last and channels_first data formats are allowed.'),a.activation=y,a.activationFunc=n[y],'valid'===c||'same'===c?a.padding=c:a.throwError('Invalid padding.'),a.useBias=v,a.params=a.useBias?['depthwise_kernel','pointwise_kernel','bias']:['depthwise_kernel','pointwise_kernel'],a.depthwiseConvAttrs={filters:m,kernel_size:[a.kernelShape[1],a.kernelShape[2]],strides:a.strides,padding:c,data_format:h,activation:'linear',use_bias:!1,gpu:e.gpu},a.pointwiseConvAttrs={filters:o,kernel_size:[1,1],strides:[1,1],padding:c,data_format:h,activation:'linear',use_bias:v,gpu:e.gpu},a.description=a.kernelShape[0]+' '+a.kernelShape.slice(1).join('x')+' filters',a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.description+=1<m?', depth multiplier: '+m:'',a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.gpu&&(a.activationProgram=gh.webgl2.compileProgram(d[a.activation])),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){this._depthwiseConv=new c(this.depthwiseConvAttrs),this._depthwiseConv.setWeights(e.slice(0,1)),this._pointwiseConv=new p.default(this.pointwiseConvAttrs),this._pointwiseConv.setWeights(e.slice(1,3))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this._depthwiseConv._callCPU(e),this._pointwiseConv._callCPU(this._depthwiseConv.output),this.output=this._pointwiseConv.output,this.activationFunc(this.output)}},{key:'_callGPU',value:function(e){this._depthwiseConv.outbound=[null],this._pointwiseConv.outbound=[null],this._depthwiseConv._callGPU(e),this._pointwiseConv._callGPU(this._depthwiseConv.outputReshaped),'linear'===this.activation?this.output=this._pointwiseConv.output:(!this.output&&(this.output=new u.default([],this._pointwiseConv.output.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this._pointwiseConv.output.originalShape,this.output.indicesForReshaped=i.createIndicesFor2DReshaped(this._pointwiseConv.output.originalShape,!1,-1)),this.outputPreactiv=this._pointwiseConv.output,gh.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0})),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}]),t}(o.default);t.default=g});he(kf);var Cf=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),u=r(Rh),n=a(Qh),i=r(_f),s=a(Dh),l=r(Uh),p=r(Mh),d=r(vf),c=a(Sf),g=(0,l.default)({args:[{blockIndices:-1},'scalar','scalar'],body:function(e,t,a){for(var r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}}),h=(0,l.default)({args:[{blockIndices:-1},'array','scalar'],body:function(e,t,a){for(var r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}}),f=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Conv2DTranspose';var r=e.filters,o=void 0===r?1:r,i=e.kernel_size,u=void 0===i?[3,3]:i,s=e.strides,l=void 0===s?[1,1]:s,p=e.padding,d=void 0===p?'valid':p,g=e.data_format,h=void 0===g?'channels_last':g,f=e.activation,m=void 0===f?'linear':f,_=e.use_bias;return a.kernelShape=Array.isArray(u)?[o].concat(En(u)):[o,u,u],a.strides=Array.isArray(l)?l:[l,l],'valid'===d||'same'===d?a.padding=d:a.throwError('Invalid padding.'),'channels_last'===h||'channels_first'===h?a.dataFormat=h:a.throwError('Only channels_last and channels_first data formats are allowed.'),a.activation=m,a.activationFunc=n[m],a.useBias=void 0===_||_,a.params=a.useBias?['kernel','bias']:['kernel'],a.description=a.kernelShape[0]+' '+a.kernelShape.slice(1).join('x')+' filters',a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.gpu&&(a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(c[a.activation])),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_calcOutputShape',value:function(e){if(!(this.outputShape&&this.outputPadding)){var t=e[0],a=e[1],r=Rn(this.kernelShape,3),o=r[0],n=r[1],i=r[2],u='same'===this.padding?t*this.strides[0]:t*this.strides[0]+Sn(n-this.strides[0],0),s='same'===this.padding?a*this.strides[1]:a*this.strides[1]+Sn(i-this.strides[1],0),l='same'===this.padding?Sn(0,fn((t-1)*this.strides[0]+n-u)):0,p='same'===this.padding?Sn(0,fn((a-1)*this.strides[1]+i-s)):0,d=fn(l/2),c=fn(p/2);this.outputShape=[u,s,o],this.outputPadding=[d,l-d,c,p-c]}}},{key:'_im2col',value:function(e){var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],o=t[2];this.imColsMat||(this.imColsMat=new u.default([],[a*r,o]));for(var n=new u.default([],[a*r]),i=new u.default([],[a,r]),s=0;s<o;s++)p.default.assign(i.tensor,e.tensor.pick(null,null,s)),n.replaceTensorData(i.tensor.data),p.default.assign(this.imColsMat.tensor.pick(null,s),n.tensor);return this.imColsMat}},{key:'_w2row',value:function(){var e=Rn(this.weights.kernel.tensor.shape,4),t=e[0],a=e[1],r=e[2],o=e[3];this.wRowsMat=new u.default([],[o,t*a*r]);for(var n=new u.default([],[t*a*r]),i=new u.default([],[t,a,r]),s=0;s<o;s++)p.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,null,s)),n.replaceTensorData(i.tensor.data),p.default.assign(this.wRowsMat.tensor.pick(s,null),n.tensor);return this.wRowsMat}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e);var t=e.tensor.shape[0],a=e.tensor.shape[1],r=Rn(this.kernelShape,3),o=r[0],s=r[1],l=r[2],c=new u.default([],[t*a,s*l*o]);(0,d.default)(c.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1);var g=Rn(this.outputPadding,4),h=g[0],f=g[1],m=g[2],_=g[3];this.output=new u.default([],this.outputShape);for(var y=new u.default([],[this.outputShape[0]+h+f,this.outputShape[1]+m+_,this.outputShape[2]]),x=[s,l,o],v=new u.default([],x),b=new u.default([],[s*l*o]),S=0,P=0;P<t;P++)for(var i=0;i<a;i++){p.default.assign(b.tensor,c.tensor.pick(S,null)),v.replaceTensorData(b.tensor.data);var T=P*this.strides[0],w=i*this.strides[1];p.default.addeq(y.tensor.hi(T+s,w+l,this.outputShape[2]).lo(T,w,0),v.tensor),S+=1}if(p.default.assign(this.output.tensor,y.tensor.hi(this.outputShape[0]+h,this.outputShape[1]+m,this.outputShape[2]).lo(h,m,0)),this.useBias)for(var k=0;k<o;k++)p.default.addseq(this.output.tensor.pick(null,null,k),this.weights.bias.tensor.get(k));this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_createIndexMap',value:function(){if(!this.indexMap){var e=this.inputShape[0],t=this.inputShape[1],a=Rn(this.kernelShape,3),r=a[0],o=a[1],n=a[2],s=Rn(this.outputPadding,4),l=s[0],d=s[1],c=s[2],f=s[3],m=(o-this.strides[0]+1)*(n-this.strides[1]+1),_=[this.outputShape[0],this.outputShape[1],m],y=[this.outputShape[0]+l+d,this.outputShape[1]+c+f,m],x=new u.default([],_,{type:Int32Array}),v=new u.default([],_,{type:Int32Array}),b=new u.default([],y,{type:Int32Array}),S=new u.default([],y,{type:Int32Array});p.default.assigns(x.tensor,-1),p.default.assigns(v.tensor,-1),p.default.assigns(b.tensor,-1),p.default.assigns(S.tensor,-1);for(var P=new u.default([],[o,n,r],{type:Int32Array}),T=0;T<o*n*r;T++)P.tensor.data[T]=T;for(var i=0;i<e;i++)for(var w=0;w<t;w++){var C=i*t+w,F=i*this.strides[0],M=w*this.strides[1];g(b.tensor.hi(F+o,M+n,m).lo(F,M,0),C,m),h(S.tensor.hi(F+o,M+n,m).lo(F,M,0),P.tensor.pick(null,null,0),m)}p.default.assign(x.tensor,b.tensor.hi(this.outputShape[0]+l,this.outputShape[1]+c,m).lo(l,c,0)),p.default.assign(v.tensor,S.tensor.hi(this.outputShape[0]+l,this.outputShape[1]+c,m).lo(l,c,0));var D=[this.outputShape[0]*this.outputShape[1],m];this.indexMap=new u.default([],D,{type:Int32Array});for(var I=new u.default([],[m],{type:Int32Array}),R=0;R<this.outputShape[0];R++)for(var E=0;E<this.outputShape[1];E++){for(var A=0;A<m;A++){var k=x.tensor.get(R,E,A),L=v.tensor.get(R,E,A);-1!==k&&-1!==L?I.tensor.set(A,k*this.weights.kernel.glTextureShape[1]+L):I.tensor.set(A,-1)}p.default.assign(this.indexMap.tensor.pick(R*this.outputShape[1]+E,null),I.tensor)}this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape)):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));var t=e.is2DReshaped||e.is2DSquareReshaped?e:this.imColsMat;if(!this.matMulResult){var a=[t.glTextureShape[0],this.weights.kernel.glTextureShape[1]];this.matMulResult=new u.default([],a),this.matMulResult.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}if('linear'!==this.activation&&!this.outputPreactiv){var r=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputPreactiv=new u.default([],r),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)}if(!this.output){var o=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.output=new u.default([],o),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)}gh.webgl2.runProgram({program:this.matMulProgram,output:this.matMulResult,inputs:[{input:t,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}],supportsTextureFragments:!0}),this._createIndexMap();var n=!!this.matMulResult.glTextureFragments;if(n&&this.matMulResult.convert2DRowFragmentedGLTextureToColStack(),!this.convTransposeProgram){var l=(0,i.default)('conv2dTranspose',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,this.matMulResult.glTextureFragmentShape?this.matMulResult.glTextureFragmentShape:this.matMulResult.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,n);this.convTransposeProgram=gh.webgl2.compileProgram(l)}gh.webgl2.runProgram({program:this.convTransposeProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:this.matMulResult,name:'matMulResult'},{input:this.indexMap,name:'indexMap'}].concat(En(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])),supportsTextureFragments:!0}),n&&this.matMulResult.removeGLTextureFragmentsAsColStack(),'linear'!==this.activation&&gh.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}]),t}(o.default);t.default=f});he(Cf);var Ff=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),u=r(Rh),n=a(Qh),i=r(_f),s=a(Dh),l=r(Mh),p=r(vf),d=a(Sf),c=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Conv3D';var r=e.filters,o=void 0===r?1:r,i=e.kernel_size,u=void 0===i?[1,1,1]:i,s=e.strides,l=void 0===s?[1,1,1]:s,p=e.padding,c=void 0===p?'valid':p,g=e.data_format,h=void 0===g?'channels_last':g,f=e.dilation_rate,m=void 0===f?[1,1,1]:f,_=e.activation,y=void 0===_?'linear':_,x=e.use_bias;return a.kernelShape=Array.isArray(u)?[o].concat(En(u)):[o,u,u,u],a.strides=Array.isArray(l)?l:[l,l,l],'valid'===c||'same'===c?a.padding=c:a.throwError('Invalid padding.'),'channels_last'===h||'channels_first'===h?a.dataFormat=h:a.throwError('Only channels_last and channels_first data formats are allowed.'),a.dilationRate=Array.isArray(m)?m:[m,m,m],(1!==a.dilationRate[0]||1!==a.dilationRate[1]||1!==a.dilationRate[2])&&(1!==a.strides[0]||1!==a.strides[1]||1!==a.strides[2])&&a.throwError('Incompatible combination of dilation_rate with strides.'),a.activation=y,a.activationFunc=n[y],a.useBias=void 0===x||x,a.params=a.useBias?['kernel','bias']:['kernel'],a.description=a.kernelShape[0]+' '+a.kernelShape.slice(1).join('x')+' filters',a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.description+=a.dilationRate.some(function(e){return 1<e})?', '+a.dilationRate.join('x')+' dilation':'',a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),a.mapInputFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(d[a.activation])),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,4,1,0)),Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_calcOutputShape',value:function(e){if(!(this.outputShape&&this.inputPadding)){var t=e[0],a=e[1],r=e[2],o=Rn(this.kernelShape,4),n=o[0],i=o[1],u=o[2],s=o[3],l=i+(i-1)*(this.dilationRate[0]-1),p=u+(u-1)*(this.dilationRate[1]-1),d=s+(s-1)*(this.dilationRate[2]-1),c='same'===this.padding?fn((t+this.strides[0]-1)/this.strides[0]):fn((t-l+this.strides[0])/this.strides[0]),g='same'===this.padding?fn((a+this.strides[1]-1)/this.strides[1]):fn((a-p+this.strides[1])/this.strides[1]),h='same'===this.padding?fn((r+this.strides[2]-1)/this.strides[2]):fn((r-d+this.strides[2])/this.strides[2]),f='same'===this.padding?Sn(0,fn((c-1)*this.strides[0]+l-t)):0,m='same'===this.padding?Sn(0,fn((g-1)*this.strides[1]+p-a)):0,_='same'===this.padding?Sn(0,fn((h-1)*this.strides[2]+d-r)):0,y=fn(f/2),x=fn(m/2),v=fn(_/2);this.outputShape=[c,g,h,n],this.inputPadding=[y,f-y,x,m-x,v,_-v]}}},{key:'_padInput',value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if('same'===this.padding){var a=Rn(e.tensor.shape,4),r=a[0],o=a[1],n=a[2],i=a[3],s=Rn(this.inputPadding,6),p=s[0],d=s[1],c=s[2],g=s[3],h=s[4],f=s[5],m=new u.default([],[r+p+d,o+c+g,n+h+f,i]);return 0!==t&&l.default.assigns(m.tensor,t),l.default.assign(m.tensor.hi(r+p,o+c,n+h,i).lo(p,c,h,0),e.tensor),m}return e}},{key:'_vol2col',value:function(e){var t=Rn(e.tensor.shape,4),a=t[0],r=t[1],o=t[2],n=t[3],s=this.kernelShape[1],p=this.kernelShape[2],d=this.kernelShape[3],c=this.outputShape[0],g=this.outputShape[1],h=this.outputShape[2],f=s*p*d*n,m=s+(s-1)*(this.dilationRate[0]-1),_=p+(p-1)*(this.dilationRate[1]-1),y=d+(d-1)*(this.dilationRate[2]-1);if(this.volColsMat||(this.volColsMat=new u.default([],[c*g*h,f])),1===m&&1===_&&1===y&&1===this.strides[0]&&1===this.strides[1]&&1===this.strides[2])return this.volColsMat.replaceTensorData(e.tensor.data),this.volColsMat;for(var x=new u.default([],[s,p,d,n]),v=0,b=0;b<=a-m;b+=this.strides[0])for(var i=0;i<=r-_;i+=this.strides[1])for(var S=0;S<=o-y;S+=this.strides[2])l.default.assign(x.tensor,e.tensor.hi(b+m,i+_,S+y,n).lo(b,i,S,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.volColsMat.tensor.data.set(x.tensor.data,v),v+=f;return this.volColsMat}},{key:'_w2row',value:function(){var e=this.weights.kernel.tensor.shape[3],t=Rn(this.kernelShape,4),a=t[0],r=t[1],o=t[2],i=t[3],s=r*o*i*e;this.wRowsMat=new u.default([],[s,a]);for(var p=new u.default([],[r,o,i,e]),d=new u.default([],[s]),c=0;c<a;c++)l.default.assign(p.tensor,this.weights.kernel.tensor.pick(null,null,null,null,c)),d.replaceTensorData(p.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,c),d.tensor);return this.wRowsMat}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e);var t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.outputShape[2],i=new u.default([],[a*r*o,t]);if(this.useBias)for(var s=0;s<t;s++)l.default.assigns(i.tensor.pick(null,s),this.weights.bias.tensor.get(s));(0,p.default)(i.tensor,this.volColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new u.default([],this.outputShape);for(var n=new u.default([],[a*r*o]),d=new u.default([],[a,r,o]),c=0;c<t;c++)l.default.assign(n.tensor,i.tensor.pick(null,c)),d.replaceTensorData(n.tensor.data),l.default.assign(this.output.tensor.pick(null,null,null,c),d.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}},{key:'_createIndexMap',value:function(e){if(!this.indexMap){var t=Rn(this.inputShape,4),a=t[0],r=t[1],o=t[2],n=t[3],s=new u.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){var p=Rn(this.inputPadding,6),d=p[0],c=p[1],g=p[2],h=p[3],f=p[4],m=p[5];a=a+d+c,r=r+g+h,o=o+f+m;s=this._padInput(s,-1)}var _=this.kernelShape[1],y=this.kernelShape[2],x=this.kernelShape[3],v=this.outputShape[0],b=this.outputShape[1],S=this.outputShape[2],P=_*y*x*n,T=_+(_-1)*(this.dilationRate[0]-1),w=y+(y-1)*(this.dilationRate[1]-1),C=x+(x-1)*(this.dilationRate[2]-1);this.indexMap=new u.default([],[v*b*S,P],{type:Int32Array});for(var F=new u.default([],[_,y,x,n]),M=0,D=0,i=a-T;D<=i;D+=this.strides[0])for(var I=0,R=r-w;I<=R;I+=this.strides[1])for(var E=0,k=o-C;E<=k;E+=this.strides[2])l.default.assign(F.tensor,s.tensor.hi(D+T,I+w,E+C,n).lo(D,I,E,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.indexMap.tensor.data.set(F.tensor.data,M),M+=P;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){var t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e),this.volColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.volColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new u.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new u.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){var a=!!e.glTextureFragments;if(a&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){var r=(0,i.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,a);this.convProgram=gh.webgl2.compileProgram(r)}gh.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'}].concat(En(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])),supportsTextureFragments:!0}),a&&e.removeGLTextureFragmentsAsColStack()}else{var o=[{input:this.volColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&o.push({input:this.weights.bias,name:'C'}),gh.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:o,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&gh.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}]),t}(o.default);t.default=c});he(Ff);var Mf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Cropping1D';var r=e.cropping,o=void 0===r?[0,0]:r;return a.cropping=Array.isArray(o)?o:[o,o],a.description=''+JSON.stringify(a.cropping),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[1],this.inputShape[2]).lo(this.cropping[0],0))}},{key:'_createIndexMap',value:function(){var e,t;if(!this.indexMap){for(var a=new o.default([],this.inputShape,{type:Int32Array}),r=new o.default([],this.inputShape,{type:Int32Array}),u=new o.default([],this.inputShape,{type:Int32Array}),s=0;s<this.inputShape[0];s++)n.default.assigns(r.tensor.pick(s,null),s);for(var i=0;i<this.inputShape[1];i++)n.default.assigns(u.tensor.pick(null,i),i);n.default.muls(a.tensor,r.tensor,this.inputShape[1]),n.default.addeq(a.tensor,u.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var l=[this.cropping[0],0],p=[this.inputShape[0]-this.cropping[1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,(e=(t=a.tensor).hi.apply(t,p)).lo.apply(e,l)),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(Mf);var Df=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Cropping2D';var r=e.cropping,o=void 0===r?[[0,0],[0,0]]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.cropping=Array.isArray(o)?Array.isArray(o[0])?o:[[o[0],o[0]],[o[1],o[1]]]:[[o,o],[o,o]],a.dataFormat=i,a.description=''+JSON.stringify(a.cropping),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]).lo(this.cropping[0][0],this.cropping[1][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_createIndexMap',value:function(e,t){var a,r;if(!this.indexMap){var i=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var u='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0]]:[this.cropping[0][0],this.cropping[1][0],0],s='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,(a=(r=i.tensor).hi.apply(r,s)).lo.apply(a,u)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(Df);var If=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Cropping3D';var r=e.cropping,o=void 0===r?[[0,0],[0,0],[0,0]]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.cropping=Array.isArray(o)?Array.isArray(o[0])?o:[[o[0],o[0]],[o[1],o[1]],[o[2],o[2]]]:[[o,o],[o,o],[o,o]],a.dataFormat=i,a.description=''+JSON.stringify(a.cropping),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]).lo(this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}},{key:'_createIndexMap',value:function(e,t){var a,r;if(!this.indexMap){var i=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var u='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0],this.cropping[2][0]]:[this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0],s='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]];n.default.assign(this.indexMap.tensor,(a=(r=i.tensor).hi.apply(r,s)).lo.apply(a,u)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][0]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(If);var Rf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='UpSampling1D';var r=e.size,o=void 0===r?2:r;return a.size=o,a.description='size '+o,a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this.output=new o.default([],this.outputShape);for(var t=0;t<this.size;t++)n.default.assign(this.output.tensor.lo(t,0).step(this.size,1),e.tensor)}},{key:'_createIndexMap',value:function(){if(!this.indexMap){for(var e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array}),r=0;r<this.inputShape[0];r++)n.default.assigns(t.tensor.pick(r,null),r);for(var i=0;i<this.inputShape[1];i++)n.default.assigns(a.tensor.pick(null,i),i);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(var u=0;u<this.size;u++)n.default.assign(this.indexMap.tensor.lo(u,0).step(this.size,1),e.tensor);this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(Rf);var Ef=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='UpSampling2D';var r=e.size,o=void 0===r?[2,2]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.size=Array.isArray(o)?o:[o,o],a.dataFormat=i,a.description='size '+a.size.join('x'),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this.output=new o.default([],this.outputShape);for(var t=0;t<this.size[0];t++)for(var a=0;a<this.size[1];a++)n.default.assign(this.output.tensor.lo(t,a,0).step(this.size[0],this.size[1],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_createIndexMap',value:function(e,t){if(!this.indexMap){var a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(var r=0;r<this.size[0];r++)for(var i=0;i<this.size[1];i++){var u='channels_first'===this.dataFormat?[0,r,i]:[r,i,0],s='channels_first'===this.dataFormat?[1,this.size[0],this.size[1]]:[this.size[0],this.size[1],1],l,p;n.default.assign((l=(p=this.indexMap.tensor).lo.apply(p,u)).step.apply(l,s),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(Ef);var Af=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='UpSampling3D';var r=e.size,o=void 0===r?[2,2,2]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.size=Array.isArray(o)?o:[o,o,o],a.dataFormat=i,a.description='size '+a.size.join('x'),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this.output=new o.default([],this.outputShape);for(var t=0;t<this.size[0];t++)for(var a=0;a<this.size[1];a++)for(var r=0;r<this.size[2];r++)n.default.assign(this.output.tensor.lo(t,a,r,0).step(this.size[0],this.size[1],this.size[2],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}},{key:'_createIndexMap',value:function(e,t){if(!this.indexMap){var a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(var r=0;r<this.size[0];r++)for(var i=0;i<this.size[1];i++)for(var u=0;u<this.size[2];u++){var s='channels_first'===this.dataFormat?[0,r,i,u]:[r,i,u,0],l='channels_first'===this.dataFormat?[1,this.size[0],this.size[1],this.size[2]]:[this.size[0],this.size[1],this.size[2],1],p,d;n.default.assign((p=(d=this.indexMap.tensor).lo.apply(d,s)).step.apply(p,l),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1],this.inputShape[3]*this.size[2]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(Af);var Lf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='ZeroPadding1D';var r=e.padding,o=void 0===r?[1,1]:r;return a.padding=Array.isArray(o)?o:[o,o],a.description=''+JSON.stringify(a.padding),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0],this.inputShape[1]).lo(this.padding[0],0),e.tensor)}},{key:'_createIndexMap',value:function(){var e,t;if(!this.indexMap){for(var a=new o.default([],this.inputShape,{type:Int32Array}),r=new o.default([],this.inputShape,{type:Int32Array}),u=new o.default([],this.inputShape,{type:Int32Array}),s=0;s<this.inputShape[0];s++)n.default.assigns(r.tensor.pick(s,null),s);for(var i=0;i<this.inputShape[1];i++)n.default.assigns(u.tensor.pick(null,i),i);n.default.muls(a.tensor,r.tensor,this.inputShape[1]),n.default.addeq(a.tensor,u.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var l=[this.padding[0],0],p=[this.inputShape[0]+this.padding[0],this.inputShape[1]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign((e=(t=this.indexMap.tensor).hi.apply(t,p)).lo.apply(e,l),a.tensor),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(Lf);var Of=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='ZeroPadding2D';var r=e.padding,o=void 0===r?[[1,1],[1,1]]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.padding=Array.isArray(o)?Array.isArray(o[0])?o:[[o[0],o[0]],[o[1],o[1]]]:[[o,o],[o,o]],a.dataFormat=i,a.description=''+JSON.stringify(a.padding),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]).lo(this.padding[0][0],this.padding[1][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_createIndexMap',value:function(e,t){var a,r;if(!this.indexMap){var i=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var u='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0]]:[this.padding[0][0],this.padding[1][0],0],s='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign((a=(r=this.indexMap.tensor).hi.apply(r,s)).lo.apply(a,u),i.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(Of);var jf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='ZeroPadding3D';var r=e.padding,o=void 0===r?[[1,1],[1,1],[1,1]]:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.padding=Array.isArray(o)?Array.isArray(o[0])?o:[[o[0],o[0]],[o[1],o[1]],[o[2],o[2]]]:[[o,o],[o,o],[o,o]],a.dataFormat=i,a.description=''+JSON.stringify(a.padding),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]).lo(this.padding[0][0],this.padding[1][0],this.padding[2][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}},{key:'_createIndexMap',value:function(e,t){var a,r;if(!this.indexMap){var i=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});var u='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0],this.padding[2][0]]:[this.padding[0][0],this.padding[1][0],this.padding[2][0],0],s='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0],this.inputShape[3]+this.padding[2][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign((a=(r=this.indexMap.tensor).hi.apply(r,s)).lo.apply(a,u),i.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1],this.inputShape[3]+this.padding[2][0]+this.padding[2][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(jf);var zf=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Conv1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Conv2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'SeparableConv2D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Conv2DTranspose',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Conv3D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Cropping1D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Cropping2D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Cropping3D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'UpSampling1D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'UpSampling2D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'UpSampling3D',{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,'ZeroPadding1D',{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,'ZeroPadding2D',{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,'ZeroPadding3D',{enumerable:!0,get:function(){return m.default}});var r=a(wf),o=a(Pf),n=a(kf),i=a(Cf),u=a(Ff),s=a(Mf),l=a(Df),p=a(If),d=a(Rf),c=a(Ef),g=a(Af),h=a(Lf),f=a(Of),m=a(jf)});he(zf);var Gf=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],u=e.offset,s=t.offset,l,i;for(l=e.shape[0]-1;0<=l;l--,u+=o,s+=n)i=a[u],a[u]=r[s],r[s]=i},Uf=function(e,t){var a=t.data,r=t.stride[0],o=t.offset,n;for(n=t.shape[0]-1;0<=n;n--,o+=r)a[o]*=e},qf=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],u=e.offset,s=t.offset,l;for(l=e.shape[0]-1;0<=l;l--,u+=o,s+=n)r[s]=a[u]},Nf=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],u=a.stride[0],s=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,s+=n,l+=u)o[l]+=e*r[s]},Bf=function(e,t){var a=e.data,r=e.stride[0],o=e.offset,n=0,u,i;if(e===t)for(u=e.shape[0]-1;0<=u;u--,o+=r)i=a[o],n+=i*i;else{var s=t.data,l=t.stride[0],p=t.offset;for(u=e.shape[0]-1;0<=u;u--,o+=r,p+=l)n+=s[p]*a[o]}return n},Vf=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],u=a.stride[0],s=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,s+=n,l+=u)o[l]=e*r[s]},Hf=function(e,a){if(0===e&&0===a)return 0;var r=Pn(e),o=Pn(a),n=bn(r,o),t=Sn(r,o);return n/=t,t*Tn(1+n*n)},Wf=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n,i;for(n=e.shape[0]-1;0<=n;n--,r+=a)i=t[r],o=Hf(o,i);return o},Xf=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n;for(n=e.shape[0]-1;0<=n;n--,r+=a)o+=Pn(t[r]);return o},$f=function(e){var t=-Infinity,a=e.data,r=e.stride[0],o=e.offset,n=e.shape[0],u,i,s;for(u=0;u<n;u++,o+=r)i=Pn(a[o]),i>t&&(t=i,s=u);return s};hn=hn||function(e){return e=+e,0===e||isNaN(e)?e:0<e?1:-1};var Kf=function(e,a,o){var n=0,i=0,s=0,r=0,t=0;return 0===a?(n=hn(e),i=0,s=Pn(e)):0===e?(n=0,i=hn(a),s=Pn(a)):Pn(e)>Pn(a)?(r=a/e,t=hn(e)*Tn(1+r*r),n=1/t,i=r*n,s=e*t):(r=e/a,t=hn(e)*Tn(1+r*r),i=1/t,n=r*i,s=a*t),void 0!==o&&2<o.length?void(o[0]=n,o[1]=i,o[2]=s):[n,i,s]},Qf=Gf,Zf=Uf,Yf=qf,Jf=Nf,em=Bf,tm=Vf,am=Wf,rm=Xf,om=$f,nm=Kf,im={swap:Qf,scal:Zf,copy:Yf,axpy:Jf,dot:em,cpsc:tm,nrm2:am,asum:rm,iamax:om,rotg:nm},um=Jr,sm=eo,lm=to,pm=ao,dm=fe(function(e){e.exporst=function(){console.error('SPMV (symmetric packed matrix vector multiply) not yet implemented')}}),cm=ro,gm=oo,hm=no,fm=fe(function(e){e.exporst=function(){console.error('TBSV (triangular banded matrix solver) not yet implemented')}}),mm=io,_m=uo,ym=so,xm=lo,vm=po,bm=co,Sm=fe(function(e){e.exports.gemv=um,e.exports.gbmv=sm,e.exports.symv=lm,e.exports.sbmv=pm,e.exports.spmv=dm,e.exports.trmv=cm,e.exports.tbmv=gm,e.exports.trsv=hm,e.exports.tbsv=fm,e.exports.tpsv=mm,e.exports.ger=_m,e.exports.syr=ym,e.exports.spr=xm,e.exports.syr2=vm,e.exports.spr2=bm,e.exports.trmv_lower=function(t,a){return console.warn('trmv_lower is deprecated. Please use the \'isLower\' flag with trmv.'),e.exports.trmv(t,a,!0)},e.exports.trsv_lower=function(t,a){return console.warn('trsv_lower is deprecated. Please use the \'isLower\' flag with trsv.'),e.exports.trsv(t,a,!0)}}),Pm=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),n=r(Rh),i=a(Qh),u=r(Mh),s=a(Sf),l=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Dense';var r=e.units,o=void 0===r?1:r,n=e.activation,u=void 0===n?'linear':n,l=e.input_dim,p=void 0===l?null:l,d=e.use_bias;return a.description=u+' activation, output dimensions: '+o,a.activation=u,a.activationFunc=i[a.activation],a.units=o,a.input_dim=p,a.use_bias=void 0===d||d,a.params=a.use_bias?['kernel','bias']:['kernel'],a.input_dim&&(a.inputShape=[a.input_dim]),a.gpu&&(a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(s[a.activation])),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=new n.default([],[this.units]),this.use_bias&&u.default.assign(this.output.tensor,this.weights.bias.tensor),(0,Sm.gemv)(1,this.weights.kernel.tensor.transpose(1,0),e.tensor,1,this.output.tensor),this.activationFunc(this.output)}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],[this.units]),this.outputPreactiv.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new n.default([],[this.units]),this.output.createGLTexture({type:'2d',format:'float'}));var t=[{input:e,name:'A'},{input:this.weights.kernel,name:'B'}];this.use_bias&&t.push({input:this.weights.bias,name:'C'}),gh.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:t,uniforms:[{value:this.use_bias?1:0,type:'bool',name:'addC'}]}),'linear'!==this.activation&&gh.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(o.default);t.default=l});he(Pm);var Tm=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hh),n=r(Rh),i=a(Qh),u=a(Sf),s=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Activation';var r=e.activation,o=void 0===r?'linear':r;return a.activation=o,a.activationFunc=i[o],a.description=''+a.activation,a.gpu&&(a.program=gh.webgl2.compileProgram(u[a.activation])),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return'linear'===this.activation?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}},{key:'_callCPU',value:function(e){this.output=new n.default(new e.arrayType(e.tensor.data),e.tensor.shape),this.activationFunc(this.output)}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new n.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(o.default);t.default=s});he(Tm);var wm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Dropout';var r=e.rate,o=void 0===r?0.5:r;return a.description=''+o,a.rate=bn(Sn(0,o),1),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(wm);var km=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='SpatialDropout1D';var r=e.p,o=void 0===r?0.5:r;return a.description=''+o,a.p=bn(Sn(0,o),1),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(km);var Cm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='SpatialDropout2D';var r=e.rate,o=void 0===r?0.5:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.description=''+o,a.rate=bn(Sn(0,o),1),a.dataFormat=i,a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(Cm);var Fm=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='SpatialDropout3D';var r=e.rate,o=void 0===r?0.5:r,n=e.data_format,i=void 0===n?'channels_last':n;return a.description=''+o,a.rate=bn(Sn(0,o),1),a.dataFormat=i,a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(Fm);var Mm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Flatten',a.gpu&&(a.flattenProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int i = int(floor(float(out_x) / float(inputCols)));\n  int j = int(mod(float(out_x), float(inputCols)));\n  outColor = vec4(texelFetch(x, ivec2(j, i), 0).r);\n}\n'),a.flattenFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputRows;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int rowIndex = int(mod(floor(float(out_x) / float(inputCols)), float(inputRows)));\n  int colIndex = int(mod(float(out_x), float(inputCols)));\n  int fragmentIndex = int(floor(float(out_x) / (float(inputRows) * float(inputCols))));\n  colIndex += fragmentIndex * inputCols;\n  outColor = vec4(texelFetch(x, ivec2(colIndex, rowIndex), 0).r);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){1>=e.tensor.shape.length?this.output=e:(this.output=new o.default([],[e.tensor.shape.reduce(function(e,t){return e*t},1)]),this.output.replaceTensorData(e.tensor.data))}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this.output||(this.output=new o.default([],[e.glTextureShape.reduce(function(e,t){return e*t},1)]),this.output.createGLTexture({type:'2d',format:'float'})),e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),gh.webgl2.runProgram({program:this.flattenFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[0],type:'int',name:'inputRows'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):gh.webgl2.runProgram({program:this.flattenProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=n});he(Mm);var Dm=go,Im=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Dm),o=a(hh),n=a(Rh),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Reshape';var r=e.target_shape,o=void 0===r?[]:r;return a.targetShape=o,a.description='target shape: '+JSON.stringify(a.targetShape),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.targetShape.reduce(function(e,t){return e*t},1)!==e.tensor.size&&this.throwError('The total size of new array must be unchanged in reshape layer.'),this.output=new n.default([],this.targetShape),this.output.replaceTensorData(e.tensor.data)}},{key:'_createIndexMap',value:function(){if(!this.indexMap){var e=new n.default([],this.inputShape,{type:Int32Array}),t=new n.default([],this.inputShape,{type:Int32Array}),a=new n.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(var o=0;o<this.inputShape[0];o++)u.default.assigns(t.tensor.pick(o,null),o);else if(3===this.inputShape.length)for(var i=0;i<this.inputShape[0];i++)for(var s=0;s<this.inputShape[1];s++)u.default.assigns(t.tensor.pick(i,s,null),i*this.inputShape[1]+s);else if(4===this.inputShape.length)for(var l=0;l<this.inputShape[0];l++)for(var p=0;p<this.inputShape[1];p++)for(var d=0;d<this.inputShape[2];d++)u.default.assigns(t.tensor.pick(l,p,d,null),l*this.inputShape[1]*this.inputShape[2]+p*this.inputShape[2]+d);for(var g=0;g<(0,r.default)(this.inputShape);g++){var c;u.default.assigns((c=a.tensor).pick.apply(c,En(Array(this.inputShape.length-1).fill(null)).concat([g])),g)}u.default.muls(e.tensor,t.tensor,(0,r.default)(this.inputShape)),u.default.addeq(e.tensor,a.tensor),this.indexMap=new n.default([],this.targetShape,{type:Int32Array}),this.indexMap.replaceTensorData(new Int32Array(e.tensor.data)),2<this.targetShape.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),this.output||(this.output=new n.default([],this.targetShape),2<this.targetShape.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(o.default);t.default=i});he(Im);var Rm=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Dm),o=a(vh),n=a(Od),i=a(hh),u=a(Rh),s=a(Mh),l=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Permute';var r=e.dims,o=void 0===r?[]:r;return a.description=''+JSON.stringify(o),a.dims=o.map(function(e){return e-1}),a.gpu&&(a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return 1>=e.tensor.shape.length||(0,n.default)((0,o.default)(e.tensor.shape.length),this.dims)?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}},{key:'_callCPU',value:function(e){var t;this.dims.length!==e.tensor.shape.length&&this.throwError('The specified dims permutation must match the number of dimensions.');var a=this.dims.map(function(t){return e.tensor.shape[t]});this.output=new u.default([],a),s.default.assign(this.output.tensor,(t=e.tensor).transpose.apply(t,En(this.dims)))}},{key:'_createIndexMap',value:function(){var e=this,t;if(!this.indexMap){var a=new u.default([],this.inputShape,{type:Int32Array}),o=new u.default([],this.inputShape,{type:Int32Array}),n=new u.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(var l=0;l<this.inputShape[0];l++)s.default.assigns(o.tensor.pick(l,null),l);else if(3===this.inputShape.length)for(var i=0;i<this.inputShape[0];i++)for(var p=0;p<this.inputShape[1];p++)s.default.assigns(o.tensor.pick(i,p,null),i*this.inputShape[1]+p);else if(4===this.inputShape.length)for(var d=0;d<this.inputShape[0];d++)for(var g=0;g<this.inputShape[1];g++)for(var h=0;h<this.inputShape[2];h++)s.default.assigns(o.tensor.pick(d,g,h,null),d*this.inputShape[1]*this.inputShape[2]+g*this.inputShape[2]+h);for(var f=0;f<(0,r.default)(this.inputShape);f++){var c;s.default.assigns((c=n.tensor).pick.apply(c,En(Array(this.inputShape.length-1).fill(null)).concat([f])),f)}s.default.muls(a.tensor,o.tensor,(0,r.default)(this.inputShape)),s.default.addeq(a.tensor,n.tensor);var m=this.dims.map(function(t){return e.inputShape[t]});this.indexMap=new u.default([],m,{type:Int32Array}),s.default.assign(this.indexMap.tensor,(t=a.tensor).transpose.apply(t,En(this.dims))),2<m.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}},{key:'_callGPU',value:function(e){var t=this;if(e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),!this.output){var a=this.dims.map(function(e){return t.inputShape[e]});this.output=new u.default([],a),2<a.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})}gh.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(i.default);t.default=l});he(Rm);var Em=32,Am=Em,Lm=2147483647,Om=-1<<Em-1,jm=function(e){return(0<e)-(0>e)},zm=function(e){var t=e>>Em-1;return(e^t)-t},Gm=function(e,t){return t^(e^t)&-(e<t)},Um=function(e,t){return e^(e^t)&-(e<t)},qm=function(e){return!(e&e-1)&&!!e},Nm=function(e){var t,a;return t=(65535<e)<<4,e>>>=t,a=(255<e)<<3,e>>>=a,t|=a,a=(15<e)<<2,e>>>=a,t|=a,a=(3<e)<<1,e>>>=a,t|=a,t|e>>1},Bm=function(e){return 1e9<=e?9:1e8<=e?8:1e7<=e?7:1e6<=e?6:1e5<=e?5:1e4<=e?4:1e3<=e?3:100<=e?2:10<=e?1:0},Vm=function(e){return e-=1431655765&e>>>1,e=(858993459&e)+(858993459&e>>>2),16843009*(252645135&e+(e>>>4))>>>24},Hm=ho,Wm=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1},Xm=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e-(e>>>1)},$m=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,e&=15,1&27030>>>e},Km=Array(256);(function(e){for(var t=0;256>t;++t){var a=t,o=t,r=7;for(a>>>=1;a;a>>>=1)o<<=1,o|=1&a,--r;e[t]=255&o<<r}})(Km);var Qm=function(e){return Km[255&e]<<24|Km[255&e>>>8]<<16|Km[255&e>>>16]<<8|Km[255&e>>>24]},Zm=function(e,t){return e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1},Ym=function(e,t){return e=1431655765&e>>>t,e=858993459&(e|e>>>1),e=252645135&(e|e>>>2),e=16711935&(e|e>>>4),e=65535&(e|e>>>16),e<<16>>16},Jm=function(e,t,a){return e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e|=t<<1,a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),e|a<<2},e_=function(e,t){return e=1227133513&e>>>t,e=3272356035&(e|e>>>2),e=251719695&(e|e>>>4),e=4278190335&(e|e>>>8),e=1023&(e|e>>>16),e<<22>>22},t_=function(e){var a=e|e-1;return a+1|(~a&-~a)-1>>>ho(e)+1},a_={INT_BITS:Am,INT_MAX:Lm,INT_MIN:Om,sign:jm,abs:zm,min:Gm,max:Um,isPow2:qm,log2:Nm,log10:Bm,popCount:Vm,countTrailingZeros:Hm,nextPow2:Wm,prevPow2:Xm,parity:$m,reverse:Qm,interleave2:Zm,deinterleave2:Ym,interleave3:Jm,deinterleave3:e_,nextCombination:t_},r_=_o,o_=fe(function(e,t){function a(e){if(e){var t=e.length||e.byteLength,a=a_.log2(t);_[a].push(e)}}function r(e){var e=a_.nextPow2(e),t=a_.log2(e),a=_[t];return 0<a.length?a.pop():new ArrayBuffer(e)}function o(e){return new Uint8Array(r(e),0,e)}function i(e){return new Uint16Array(r(2*e),0,e)}function u(e){return new Uint32Array(r(4*e),0,e)}function s(e){return new Int8Array(r(e),0,e)}function l(e){return new Int16Array(r(2*e),0,e)}function p(e){return new Int32Array(r(4*e),0,e)}function d(e){return new Float32Array(r(4*e),0,e)}function c(e){return new Float64Array(r(8*e),0,e)}function g(e){return m?new Uint8ClampedArray(r(e),0,e):o(e)}function h(e){return new DataView(r(e),0,e)}function f(e){e=a_.nextPow2(e);var t=a_.log2(e),a=y[t];return 0<a.length?a.pop():new Buffer(e)}Au.__TYPEDARRAY_POOL||(Au.__TYPEDARRAY_POOL={UINT8:r_([32,0]),UINT16:r_([32,0]),UINT32:r_([32,0]),INT8:r_([32,0]),INT16:r_([32,0]),INT32:r_([32,0]),FLOAT:r_([32,0]),DOUBLE:r_([32,0]),DATA:r_([32,0]),UINT8C:r_([32,0]),BUFFER:r_([32,0])});var m='undefined'!=typeof Uint8ClampedArray,n=Au.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=r_([32,0])),n.BUFFER||(n.BUFFER=r_([32,0]));var _=n.DATA,y=n.BUFFER;t.free=function(e){if(Buffer.isBuffer(e))y[a_.log2(e.length)].push(e);else{if('[object ArrayBuffer]'!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,a=0|a_.log2(t);_[a].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){a(e.buffer)},t.freeArrayBuffer=a,t.freeBuffer=function(e){y[a_.log2(e.length)].push(e)},t.malloc=function(e,t){return void 0===t||'arraybuffer'===t?r(e):'uint8'===t?o(e):'uint16'===t?i(e):'uint32'===t?u(e):'int8'===t?s(e):'int16'===t?l(e):'int32'===t?p(e):'float'===t||'float32'===t?d(e):'double'===t||'float64'===t?c(e):'uint8_clamped'===t?g(e):'buffer'===t?f(e):'data'===t||'dataview'===t?h(e):null},t.mallocArrayBuffer=r,t.mallocUint8=o,t.mallocUint16=i,t.mallocUint32=u,t.mallocInt8=s,t.mallocInt16=l,t.mallocInt32=p,t.mallocFloat32=t.mallocFloat=d,t.mallocFloat64=t.mallocDouble=c,t.mallocUint8Clamped=g,t.mallocDataView=h,t.mallocBuffer=f,t.clearCache=function(){for(var e=0;32>e;++e)n.UINT8[e].length=0,n.UINT16[e].length=0,n.UINT32[e].length=0,n.INT8[e].length=0,n.INT16[e].length=0,n.INT32[e].length=0,n.FLOAT[e].length=0,n.DOUBLE[e].length=0,n.UINT8C[e].length=0,_[e].length=0,y[e].length=0}}),n_=yo,i_=xo,u_=vo,s_=bo,l_=So,p_=Po,d_={clone:n_,malloc:i_,free:u_,zeros:s_,ones:l_,eye:p_},c_=To,g_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Tf),i=a(c_),u=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='RepeatVector';var r=e.n,o=void 0===r?1:r;return a.n=o,a.description='n = '+o,a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, 0));\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){1!==e.tensor.shape.length&&this.throwError('Only 1D tensor inputs allowed.'),this.output=new o.default([],[this.n,e.tensor.shape[1]]),this.output.tensor=(0,i.default)((0,n.default)(e.tensor,0),[this.n,1])}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[this.n,e.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=u});he(g_);var h_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Dense',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Activation',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Dropout',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'SpatialDropout1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'SpatialDropout2D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'SpatialDropout3D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Flatten',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Reshape',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'Permute',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'RepeatVector',{enumerable:!0,get:function(){return c.default}});var r=a(Pm),o=a(Tm),n=a(wm),i=a(km),u=a(Cm),s=a(Fm),l=a(Mm),p=a(Im),d=a(Rm),c=a(g_)});he(h_);var f_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Embedding';var r=e.input_dim,o=void 0===r?1:r,n=e.output_dim,i=void 0===n?1:n,u=e.input_length,s=void 0===u?0:u,l=e.mask_zero;return a.description='output dimensions: '+i,a.inputDim=o,a.outputDim=i,a.inputLength=s,a.maskZero=void 0!==l&&l,a.params=['embeddings'],a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D embeddings;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 x_size = textureSize(x, 0);\n  ivec2 embeddings_size = textureSize(embeddings, 0);\n  int out_x = int(float(embeddings_size[0]) * outTex.x);\n  int out_y = int(float(x_size[0]) * outTex.y);\n\n  int index = int(texelFetch(x, ivec2(out_y, 0), 0).r);\n  outColor = texelFetch(embeddings, ivec2(out_x, index), 0);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.output=new o.default([],[e.tensor.shape[0],this.weights.embeddings.tensor.shape[1]]);for(var t=0,a=e.tensor.shape[0];t<a;t++)n.default.assign(this.output.tensor.pick(t,null),this.weights.embeddings.tensor.pick(e.tensor.get(t),null))}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[e.glTextureShape[1],this.weights.embeddings.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.embeddings,name:'embeddings'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(f_);var m_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Embedding',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(f_)});he(m_);var __=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(vh),o=a(Od),n=a(hh),i=a(Rh),u=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='_Merge',a.isMergeLayer=!0,a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){if(this.gpu)this._callGPU(e);else{var t=this._validateInputs(e);t||this.throwError('Invalid inputs to call method.'),this._callCPU(e)}return this.output}},{key:'_validateInputs',value:function(e){var t=e.map(function(e){return e.tensor.shape.slice()});if(-1<['sum','diff','mul','ave','max','min'].indexOf(this.mode)&&!t.every(function(e){return(0,o.default)(e,t[0])})&&this.throwError('All input shapes must be the same for mode '+this.mode+'.'),'dot'===this.mode)2!==e.length&&this.throwError('Exactly 2 inputs required for mode '+this.mode+'.'),0>this.dotAxes[0]&&(this.dotAxes[0]=t[0].length+this.dotAxes[0]),0>this.dotAxes[1]&&(this.dotAxes[1]=t[1].length+this.dotAxes[1]),t[0][this.dotAxes[0]]!==t[1][this.dotAxes[1]]&&this.throwError('Dimensions incompatibility using dot mode.');else if('concat'===this.mode){var a=t.slice(),n=0>this.concatAxis?a[0].length+this.concatAxis:this.concatAxis;0===this.concatAxis&&(n=0),(0,r.default)(a.length).forEach(function(e){a[e].splice(n,1)}),a.every(function(e){return(0,o.default)(e,a[0])})||this.throwError('In concat mode, all shapes must be the same except along the concat axis.')}return!0}},{key:'_callCPU',value:function(){}},{key:'_callGPU',value:function(e){e.forEach(function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}),this.output||(this.output=new i.default([],e[0].glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e[0].is1D?this.output.is1D=e[0].is1D:(e[0].is2DReshaped||e[0].is2DSquareReshaped)&&(e[0].is2DReshaped?this.output.is2DReshaped=e[0].is2DReshaped:e[0].is2DSquareReshaped&&(this.output.is2DSquareReshaped=e[0].is2DSquareReshaped),this.output.originalShape=e[0].originalShape.slice(),this.output.indicesForReshaped=e[0].indicesForReshaped)),gh.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map(function(e,t){return{input:e,name:'inputs['+t+']'}}),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(n.default);t.default=u});he(__);var y_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Add',a.mode='sum',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(var a=0;a<e.length;a++)u.default.addeq(this.output.tensor,e[a].tensor)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('add',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=i});he(y_);var x_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),i=a(Mh),u=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Subtract',a.mode='diff',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){2!==e.length&&this.throwError('Inputs should be an array of 2 Tensors.');var t=e[0].tensor.shape.slice();this.output=new o.default([],t),i.default.sub(this.output.tensor,e[0].tensor,e[1].tensor)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('subtract',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=u});he(x_);var v_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Multiply',a.mode='mul',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice();this.output=new o.default([],t),u.default.assigns(this.output.tensor,1);for(var a=0;a<e.length;a++)u.default.muleq(this.output.tensor,e[a].tensor)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('multiply',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=i});he(v_);var b_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Average',a.mode='ave',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(var a=0;a<e.length;a++)u.default.addeq(this.output.tensor,e[a].tensor);u.default.divseq(this.output.tensor,e.length)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('average',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=i});he(b_);var S_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Maximum',a.mode='max',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice();this.output=new o.default([],t),u.default.assign(this.output.tensor,e[0].tensor);for(var a=1;a<e.length;a++)u.default.maxeq(this.output.tensor,e[a].tensor)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('maximum',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=i});he(S_);var P_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(_f),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='Minimum',a.mode='min',a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice();this.output=new o.default([],t),u.default.assign(this.output.tensor,e[0].tensor);for(var a=1;a<e.length;a++)u.default.mineq(this.output.tensor,e[a].tensor)}},{key:'_callGPU',value:function(e){if(!this.mergeProgram){var a=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,r=(0,n.default)('minimum',e.length,a);this.mergeProgram=gh.webgl2.compileProgram(r)}Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'_callGPU',this).call(this,e)}}]),t}(r.default);t.default=i});he(P_);var T_=wo,w_=ko,k_={dtype:'double'},C_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(sf),o=a(__),n=a(Rh),i=a(_f),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Dh),s=a(w_),l=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Concatenate',a.mode='concat';var r=e.axis,o=void 0===r?-1:r;return a.concatAxis=0>=o?o:o-1,a}return Dn(t,e),Fn(t,[{key:'_callCPU',value:function(e){var t=e[0].tensor.shape.slice(),a=0>this.concatAxis?t.length+this.concatAxis:this.concatAxis;if(e.slice(1,e.length).forEach(function(e){var r=e.tensor.shape.slice()[a];t[a]+=r}),this.output=new n.default([],t),0===a)(0,s.default)(this.output.tensor,e.map(function(e){return e.tensor}));else{for(var r=[a],o=0,i;o<e[0].tensor.shape.length;o++)o!==a&&r.push(o);(0,s.default)((i=this.output.tensor).transpose.apply(i,r),e.map(function(e){var t;return(t=e.tensor).transpose.apply(t,r)}))}}},{key:'_callGPU',value:function(e){e.forEach(function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})});var t=e[0].glTextureShape.slice(),a=1;if(e[0].is2DReshaped?-1===this.concatAxis||this.concatAxis===e[0].originalShape.length-1?a=1:this.throwError('specified axis not supported for now.'):-1===this.concatAxis||1===this.concatAxis?a=1:-2===this.concatAxis||0===this.concatAxis?a=0:this.throwError('specified axis not supported for now.'),t[a]=(0,r.default)(e.map(function(e){return e.glTextureShape[a]})),!this.output)if(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:1==a}),e[0].is1D)this.output.is1D=e[0].is1D;else if(e[0].is2DReshaped){this.output.is2DReshaped=e[0].is2DReshaped,this.output.originalShape=e[0].originalShape.slice();var o=0>this.concatAxis?this.output.originalShape.length+this.concatAxis:this.concatAxis;this.output.originalShape[o]=(0,r.default)(e.map(function(e){return e.originalShape[o]})),this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.output.originalShape,!1,o)}if(!this.mergeProgram){var s=this.output.glTextureFragments?this.output.glTextureFragmentShape:this.output.glTextureShape,l=(0,i.default)('concatenate',e.length,e.map(function(e){return e.glTextureShape}),s,a);this.mergeProgram=gh.webgl2.compileProgram(l)}gh.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map(function(e,t){return{input:e,name:'inputs['+t+']'}}),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(o.default);t.default=l});he(C_);var F_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(__),o=a(Rh),n=a(vf),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Dot',a.mode='dot';var r=e.axes,o=void 0===r?-1:r,n=e.normalize;return a.dotAxes=Array.isArray(o)?[0>=o[0]?o[0]:o[0]-1,0>=o[1]?o[1]:o[1]-1]:[0>=o?o:o-1,0>=o?o:o-1],a.normalize=void 0!==n&&n,a.gpu&&(a.mergeProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D input1;\nuniform sampler2D input2;\nuniform int rows;\nuniform int cols;\nuniform int dotAxis1;\nuniform int dotAxis2;\nuniform int commonDim;\nuniform bool normalize;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(cols) * outTex.x);\n  int out_y = int(float(rows) * outTex.y);\n\n  float sum = 0.;\n  float a = 0.;\n  float b = 0.;\n  float norm1 = 0.;\n  float norm2 = 0.;\n\n  for (int i = 0; i < commonDim; ++i) {\n    if (dotAxis1 == 0 && dotAxis2 == 0) {\n      a = texelFetch(input1, ivec2(out_y, i), 0).r;\n      b = texelFetch(input2, ivec2(out_x, i), 0).r;\n    } else if (dotAxis1 == 1 && dotAxis2 == 1) {\n      a = texelFetch(input1, ivec2(i, out_y), 0).r;\n      b = texelFetch(input2, ivec2(i, out_x), 0).r;\n    }\n\n    sum += a * b;\n\n    if (normalize) {\n      norm1 += a * a;\n      norm2 += b * b;\n    }\n  }\n\n  if (normalize) {\n    sum /= sqrt(norm1) * sqrt(norm2);\n  }\n\n  outColor = vec4(sum);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'_calcOutputShape',value:function(e){var t=e[0].slice(),a=e[1].slice();t.splice(this.dotAxes[0],1),a.splice(this.dotAxes[1],1),this.outputShape=t.concat(a),1===this.outputShape.length&&this.outputShape.push(1)}},{key:'_callCPU',value:function(e){if(this._calcOutputShape([e[0].tensor.shape,e[1].tensor.shape]),this.output=new o.default([],this.outputShape),2!==e[0].tensor.shape.length||2!==e[1].tensor.shape.length)this.throwError('dot mode for 3+ dim tensors not yet implemented.');else if(0===this.dotAxes[0]&&0===this.dotAxes[1]){if(this.normalize){for(var t=0;t<e[0].tensor.shape[1];t++)u.default.divseq(e[0].tensor.pick(null,t),u.default.norm2(e[0].tensor.pick(null,t)));for(var a=0;a<e[1].tensor.shape[1];a++)u.default.divseq(e[1].tensor.pick(null,a),u.default.norm2(e[1].tensor.pick(null,a)))}(0,n.default)(this.output.tensor,e[0].tensor.transpose(1,0),e[1].tensor)}else if(1===this.dotAxes[0]&&1===this.dotAxes[1]){if(this.normalize){for(var r=0;r<e[0].tensor.shape[0];r++)u.default.divseq(e[0].tensor.pick(r,null),u.default.norm2(e[0].tensor.pick(r,null)));for(var i=0;i<e[1].tensor.shape[0];i++)u.default.divseq(e[1].tensor.pick(i,null),u.default.norm2(e[1].tensor.pick(i,null)))}(0,n.default)(this.output.tensor,e[0].tensor,e[1].tensor.transpose(1,0))}}},{key:'_callGPU',value:function(e){e.forEach(function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float'})}),this._calcOutputShape([e[0].glTextureShape,e[1].glTextureShape]),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}));var t=e[0].glTextureShape[this.dotAxes[0]];gh.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:e[0],name:'input1'},{input:e[1],name:'input2'}],uniforms:[{value:this.output.glTextureShape[0],type:'int',name:'rows'},{value:this.output.glTextureShape[1],type:'int',name:'cols'},{value:this.dotAxes[0],type:'int',name:'dotAxis1'},{value:this.dotAxes[1],type:'int',name:'dotAxis2'},{value:t,type:'int',name:'commonDim'},{value:+this.normalize,type:'bool',name:'normalize'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(F_);var M_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Add',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Subtract',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Multiply',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Average',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Maximum',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Minimum',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Concatenate',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Dot',{enumerable:!0,get:function(){return p.default}});var r=a(y_),o=a(x_),n=a(v_),i=a(b_),u=a(S_),s=a(P_),l=a(C_),p=a(F_)});he(M_);var D_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='GaussianDropout';var r=e.rate,o=void 0===r?0.5:r;return a.rate=bn(Sn(0,o),1),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(D_);var I_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hh),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='GaussianNoise';var r=e.stddev,o=void 0===r?0:r;return a.stddev=o,a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.output=e,this.output}}]),t}(a.default);t.default=r});he(I_);var R_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'GaussianDropout',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'GaussianNoise',{enumerable:!0,get:function(){return o.default}});var r=a(D_),o=a(I_)});he(R_);var E_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='BatchNormalization';var r=e.epsilon,o=void 0===r?1e-3:r,n=e.axis,i=void 0===n?-1:n,u=e.center,s=e.scale;return a.epsilon=o,a.center=void 0===u||u,a.scale=void 0===s||s,a.axis=i,a.axisNormalized=!1,a.params=[],a.scale&&a.params.push('gamma'),a.center&&a.params.push('beta'),a.params=a.params.concat(['moving_mean','moving_variance']),a.gpu&&(a.program=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D X;\nuniform isampler2D normAxisIndexMap;\nuniform sampler2D gamma;\nuniform sampler2D beta;\nuniform sampler2D mean;\nuniform sampler2D std;\nuniform float epsilon;\nuniform bool scale;\nuniform bool center;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(X, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\nint normAxisIndex = texelFetch(normAxisIndexMap, ivec2(out_x, out_y), 0).r;\n\n  float _x = texelFetch(X, ivec2(out_x, out_y), 0).r;\n  float _mean = texelFetch(mean, ivec2(normAxisIndex, 0), 0).r;\n  float _std = texelFetch(std, ivec2(normAxisIndex, 0), 0).r;\n\n  float _gamma = 1.0;\n  if (scale) {\n    _gamma = texelFetch(gamma, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float _beta = 0.0;\n  if (center) {\n    _beta = texelFetch(beta, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float sum = _beta + _gamma * (_x - _mean) / sqrt(_std + epsilon);\n\n  outColor = vec4(sum);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.axisNormalized||(this.axis=0>this.axis?e.tensor.shape.length+this.axis:this.axis-1,this.axisNormalized=!0);for(var t=[],a=0;a<e.tensor.shape.length;a++)a===this.axis?t.push(1):t.push(null);for(var r=new o.default([],e.tensor.shape),u=new o.default([],e.tensor.shape),s=0;s<e.tensor.shape[this.axis];s++){if(t[this.axis]=s,this.scale){var i;n.default.assigns((i=r.tensor).pick.apply(i,t),this.weights.gamma.tensor.get(s))}if(this.center){var l;n.default.assigns((l=u.tensor).pick.apply(l,t),this.weights.beta.tensor.get(s))}}for(var p=new o.default([],e.tensor.shape),d=new o.default([],e.tensor.shape),c=0;c<e.tensor.shape[this.axis];c++){var g,h;t[this.axis]=c,n.default.assigns((g=p.tensor).pick.apply(g,t),this.weights.moving_mean.tensor.get(c)),n.default.assigns((h=d.tensor).pick.apply(h,t),this.weights.moving_variance.tensor.get(c)+this.epsilon)}n.default.sqrteq(d.tensor),this.output=new o.default(e.tensor.data,e.tensor.shape),n.default.subeq(this.output.tensor,p.tensor),n.default.diveq(this.output.tensor,d.tensor),this.scale&&n.default.muleq(this.output.tensor,r.tensor),this.center&&n.default.addeq(this.output.tensor,u.tensor)}},{key:'_createIndexMap',value:function(e,t){if(!this.normAxisIndexMap){var a=new o.default([],this.inputShape,{type:Int32Array});this.normAxisIndexMap=new o.default([],e,{type:Int32Array});for(var r=Array(this.inputShape.length).fill(null),u=0;u<this.inputShape[this.axis];u++){var i;r[this.axis]=u,n.default.assigns((i=a.tensor).pick.apply(i,En(r)),u)}if(t)for(var s=0;s<t.data.length;s++)this.normAxisIndexMap.tensor.data[t.data[s]]=a.tensor.data[s];else this.normAxisIndexMap=a;this.normAxisIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){this.axisNormalized||(this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,this.axis=0>this.axis?this.inputShape.length+this.axis:this.axis-1,this.axisNormalized=!0),e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this._createIndexMap(e.glTextureShape,e.indicesForReshaped),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped));var t=[{input:e,name:'X'},{input:this.normAxisIndexMap,name:'normAxisIndexMap'}];this.scale&&t.push({input:this.weights.gamma,name:'gamma'}),this.center&&t.push({input:this.weights.beta,name:'beta'}),t.push({input:this.weights.moving_mean,name:'mean'}),t.push({input:this.weights.moving_variance,name:'std'});var a=[{value:this.epsilon,type:'float',name:'epsilon'},{value:+this.scale,type:'bool',name:'scale'},{value:+this.center,type:'bool',name:'center'}];gh.webgl2.runProgram({program:this.program,output:this.output,inputs:t,uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=i});he(E_);var A_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'BatchNormalization',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(E_)});he(A_);var L_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_Pooling1D';var r=e.pool_size,o=void 0===r?2:r,n=e.strides,i=void 0===n?null:n,u=e.padding,s=void 0===u?'valid':u;return a.poolSize=o,a.strides=null===i?a.poolSize:i,a.padding=s,a.poolingFunc='max',a.description='pool size '+a.poolSize,a.description+=1<a.strides?', striding '+a.strides+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),a.poolingFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t='valid'===this.padding?fn((e.tensor.shape[0]-this.poolSize+this.strides)/this.strides):fn((e.tensor.shape[0]+this.strides-1)/this.strides);this.output=new o.default([],[t,e.tensor.shape[1]]);for(var a=new o.default([],[e.tensor.shape[1]]),r='valid'===this.padding?0:bn(0,xn((e.tensor.shape[0]-(t-1)*this.strides-this.poolSize)/2)),u=0;u<t;u++){var i=Sn(0,r),s=this.poolSize+bn(0,r);n.default.assign(a.tensor,e.tensor.pick(i,null));for(var l=1,p=1;p<s&&!(i+p>e.tensor.shape[0]-1);p++)'max'===this.poolingFunc?n.default.maxeq(a.tensor,e.tensor.pick(i+p,null)):'average'===this.poolingFunc&&n.default.addeq(a.tensor,e.tensor.pick(i+p,null)),l+=1;'average'===this.poolingFunc&&n.default.divseq(a.tensor,l),n.default.assign(this.output.tensor.pick(u,null),a.tensor),r+=this.strides}}},{key:'_createIndexMap',value:function(){if(!this.poolIndexMap){var e='valid'===this.padding?fn((this.inputShape[0]-this.poolSize+this.strides)/this.strides):fn((this.inputShape[0]+this.strides-1)/this.strides);this.outputShape=[e,this.inputShape[1]],this.poolIndexMap=new o.default([],[e,this.poolSize],{type:Int32Array}),n.default.assigns(this.poolIndexMap.tensor,-1);for(var t='valid'===this.padding?0:bn(0,xn((this.inputShape[0]-(e-1)*this.strides-this.poolSize)/2)),a=0;a<e;a++){var r=Sn(0,t),i=this.poolSize+bn(0,t),u=r;this.poolIndexMap.tensor.set(a,0,u);for(var s=1;s<i&&(u=r+s,u<=this.inputShape[0]-1);s++)this.poolIndexMap.tensor.set(a,s,u);t+=this.strides}this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.inputShape=e.tensor.shape,this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));var t='max'===this.poolingFunc,a=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:this.poolSize,type:'int',name:'poolSize'},{value:+t,type:'bool',name:'isMaxPooling'}];e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),gh.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(L_);var O_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(L_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='MaxPooling1D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(O_);var j_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Dh),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_Pooling2D';var r=e.pool_size,o=void 0===r?[2,2]:r,n=e.strides,i=void 0===n?null:n,u=e.padding,s=void 0===u?'valid':u,l=e.data_format,p=void 0===l?'channels_last':l;return a.poolSize=Array.isArray(o)?o:[o,o],a.strides=Array.isArray(i)?i:null===i?a.poolSize:[i,i],a.padding=s,a.dataFormat=p,a.poolingFunc='max',a.description='pool size '+a.poolSize.join('x'),a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),a.poolingFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_calcOutputShape',value:function(e){if(!(this.outputShape&&this.inputPadding)){var t=Rn(e,3),a=t[0],r=t[1],o=t[2],n=Rn(this.poolSize,2),i=n[0],u=n[1],s='same'===this.padding?fn((a+this.strides[0]-1)/this.strides[0]):fn((a-i+this.strides[0])/this.strides[0]),l='same'===this.padding?fn((r+this.strides[1]-1)/this.strides[1]):fn((r-u+this.strides[1])/this.strides[1]),p='same'===this.padding?Sn(0,fn((s-1)*this.strides[0]+i-a)):0,d='same'===this.padding?Sn(0,fn((l-1)*this.strides[1]+u-r)):0,c=fn(p/2),g=fn(d/2);this.outputShape=[s,l,o],this.inputPadding=[c,p-c,g,d-g]}}},{key:'_padInput',value:function(e){if('same'===this.padding){var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],n=t[2],i=Rn(this.inputPadding,4),s=i[0],l=i[1],p=i[2],d=i[3],c=new o.default([],[a+s+l,r+p+d,n]);return'max'===this.poolingFunc&&u.default.assigns(c.tensor,Number.NEGATIVE_INFINITY),u.default.assign(c.tensor.hi(a+s,r+p,n).lo(s,p,0),e.tensor),c}return e}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],n=t[2],s=Rn(this.poolSize,2),l=s[0],p=s[1];this.output=new o.default([],this.outputShape);for(var d=new o.default([],[l,p,n]),g=Rn(this.inputPadding,4),h=g[0],f=g[1],m=g[2],_=g[3],y=0,i=0,x;y<=a-l;y+=this.strides[0],i++){x=0,y<h?x=h-y:y+l>a-f&&(x=y+l-(a-f));for(var v=0,b=0,S;v<=r-p;v+=this.strides[1],b++){S=0,v<m?S=m-v:v+p>r-_&&(S=v+p-(r-_));var P=(l-x)*(p-S);u.default.assign(d.tensor,e.tensor.hi(y+l,v+p,n).lo(y,v,0));for(var T=0;T<n;T++)'max'===this.poolingFunc?this.output.tensor.set(i,b,T,u.default.sup(d.tensor.pick(null,null,T))):'average'===this.poolingFunc&&this.output.tensor.set(i,b,T,u.default.sum(d.tensor.pick(null,null,T))/P)}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}},{key:'_im2col',value:function(e){var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],n=t[2];this.tiledInput||(this.tiledInput=new o.default([],[a*r,n]));for(var i=new o.default([],[a,r]),s=new o.default([],[a*r]),l=0;l<n;l++)u.default.assign(i.tensor,e.tensor.pick(null,null,l)),s.replaceTensorData(i.tensor.data),u.default.assign(this.tiledInput.tensor.pick(null,l),s.tensor);return this.tiledInput}},{key:'_createIndexMap',value:function(){if(!this.poolIndexMap){for(var e=this.inputShape[0],t=this.inputShape[1],a=new o.default([],[e,t]),r=0,n=0;n<e;n++)for(var i=0;i<t;i++)a.tensor.set(n,i,r),r+=1;if('same'===this.padding){var s=Rn(this.inputPadding,4),l=s[0],p=s[1],d=s[2],c=s[3];e=e+l+p,t=t+d+c;var g=new o.default([],[e,t]);u.default.assigns(g.tensor,-1),u.default.assign(g.tensor.hi(this.inputShape[0]+l,this.inputShape[1]+d).lo(l,d),a.tensor),a.tensor=g.tensor}var h=Rn(this.poolSize,2),f=h[0],m=h[1],_=this.outputShape[0],y=this.outputShape[1];this.poolIndexMap=new o.default([],[_*y,f*m],{type:Int32Array});for(var x=new o.default([],[f,m]),v=0,b=0,S=e-f;b<=S;b+=this.strides[0])for(var P=0,T=t-m;P<=T;P+=this.strides[1])u.default.assign(x.tensor,a.tensor.hi(b+f,P+m).lo(b,P)),this.poolIndexMap.tensor.data.set(x.tensor.data,v),v+=f*m;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this._im2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){var t=Rn(this.outputShape,3),a=t[0],r=t[1],i=t[2];this.output=new o.default([],[a*r,i]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}var u=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,s=this.poolSize[0]*this.poolSize[1],l='max'===this.poolingFunc,p=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:s,type:'int',name:'poolSize'},{value:+l,type:'bool',name:'isMaxPooling'}];u.glTextureFragments?(u.convert2DRowFragmentedGLTextureToColStack(),gh.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:u,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:p,supportsTextureFragments:!0}),u.removeGLTextureFragmentsAsColStack()):gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:u,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:p,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}]),t}(r.default);t.default=i});he(j_);var z_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(j_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='MaxPooling2D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(z_);var G_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(Dh),u=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_Pooling3D';var r=e.pool_size,o=void 0===r?[2,2,2]:r,n=e.strides,i=void 0===n?null:n,u=e.padding,s=void 0===u?'valid':u,l=e.data_format,p=void 0===l?'channels_last':l;return a.poolSize=Array.isArray(o)?o:[o,o,o],a.strides=Array.isArray(i)?i:null===i?a.poolSize:[i,i,i],a.padding=s,a.dataFormat=p,a.poolingFunc='max',a.description='pool size '+a.poolSize.join('x'),a.description+=a.strides.some(function(e){return 1<e})?', '+a.strides.join('x')+' striding':'',a.description+='valid'===a.padding?', no border padding':', pad to same borders',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),a.poolingFragmentsProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_calcOutputShape',value:function(e){if(!(this.outputShape&&this.inputPadding)){var t=Rn(e,4),a=t[0],r=t[1],o=t[2],n=t[3],i=Rn(this.poolSize,3),u=i[0],s=i[1],l=i[2],p='same'===this.padding?fn((a+this.strides[0]-1)/this.strides[0]):fn((a-u+this.strides[0])/this.strides[0]),d='same'===this.padding?fn((r+this.strides[1]-1)/this.strides[1]):fn((r-s+this.strides[1])/this.strides[1]),c='same'===this.padding?fn((o+this.strides[2]-1)/this.strides[2]):fn((o-l+this.strides[2])/this.strides[2]),g='same'===this.padding?Sn(0,fn((p-1)*this.strides[0]+u-a)):0,h='same'===this.padding?Sn(0,fn((d-1)*this.strides[1]+s-r)):0,f='same'===this.padding?Sn(0,fn((c-1)*this.strides[2]+l-o)):0,m=fn(g/2),_=fn(h/2),y=fn(f/2);this.outputShape=[p,d,c,n],this.inputPadding=[m,g-m,_,h-_,y,f-y]}}},{key:'_padInput',value:function(e){if('same'===this.padding){var t=Rn(e.tensor.shape,4),a=t[0],r=t[1],n=t[2],i=t[3],s=Rn(this.inputPadding,6),l=s[0],p=s[1],d=s[2],c=s[3],g=s[4],h=s[5],f=new o.default([],[a+l+p,r+d+c,n+g+h,i]);return'max'===this.poolingFunc&&u.default.assigns(f.tensor,Number.NEGATIVE_INFINITY),u.default.assign(f.tensor.hi(a+l,r+d,n+g,i).lo(l,d,g,0),e.tensor),f}return e}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);var t=Rn(e.tensor.shape,4),a=t[0],r=t[1],n=t[2],s=t[3],l=Rn(this.poolSize,3),p=l[0],d=l[1],g=l[2];this.output=new o.default([],this.outputShape);for(var h=new o.default([],[p,d,g,s]),f=Rn(this.inputPadding,6),m=f[0],_=f[1],y=f[2],x=f[3],v=f[4],b=f[5],S=0,i=0,P;S<=a-p;S+=this.strides[0],i++){P=0,S<m?P=m-S:S+p>a-_&&(P=S+p-(a-_));for(var T=0,w=0,C;T<=r-d;T+=this.strides[1],w++){C=0,T<y?C=y-T:T+d>r-x&&(C=T+d-(r-x));for(var F=0,k=0,M;F<=n-g;F+=this.strides[2],k++){M=0,F<v?M=v-F:F+g>n-b&&(M=F+g-(n-b));var D=(p-P)*(d-C)*(g-M);u.default.assign(h.tensor,e.tensor.hi(S+p,T+d,F+g,s).lo(S,T,F,0));for(var I=0;I<s;I++)'max'===this.poolingFunc?this.output.tensor.set(i,w,k,I,u.default.sup(h.tensor.pick(null,null,null,I))):'average'===this.poolingFunc&&this.output.tensor.set(i,w,k,I,u.default.sum(h.tensor.pick(null,null,null,I))/D)}}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}},{key:'_vol2col',value:function(e){var t=Rn(e.tensor.shape,4),a=t[0],r=t[1],n=t[2],i=t[3];this.tiledInput||(this.tiledInput=new o.default([],[a*r*n,i]));for(var s=new o.default([],[a,r,n]),l=new o.default([],[a*r*n]),p=0;p<i;p++)u.default.assign(s.tensor,e.tensor.pick(null,null,null,p)),l.replaceTensorData(s.tensor.data),u.default.assign(this.tiledInput.tensor.pick(null,p),l.tensor);return this.tiledInput}},{key:'_createIndexMap',value:function(){if(!this.poolIndexMap){for(var e=this.inputShape[0],t=this.inputShape[1],a=this.inputShape[2],r=new o.default([],[e,t,a]),n=0,s=0;s<e;s++)for(var i=0;i<t;i++)for(var l=0;l<a;l++)r.tensor.set(s,i,l,n),n+=1;if('same'===this.padding){var p=Rn(this.inputPadding,6),d=p[0],c=p[1],g=p[2],h=p[3],f=p[4],m=p[5];e=e+d+c,t=t+g+h,a=a+f+m;var _=new o.default([],[e,t,a]);u.default.assigns(_.tensor,-1),u.default.assign(_.tensor.hi(this.inputShape[0]+d,this.inputShape[1]+g,this.inputShape[2]+f).lo(d,g,f),r.tensor),r.tensor=_.tensor}var y=Rn(this.poolSize,3),x=y[0],v=y[1],b=y[2],S=this.outputShape[0],P=this.outputShape[1],T=this.outputShape[2];this.poolIndexMap=new o.default([],[S*P*T,x*v*b],{type:Int32Array});for(var w=new o.default([],[x,v,b]),k=0,C=0,F=e-x;C<=F;C+=this.strides[0])for(var M=0,D=t-v;M<=D;M+=this.strides[1])for(var I=0,R=a-b;I<=R;I+=this.strides[2])u.default.assign(w.tensor,r.tensor.hi(C+x,M+v,I+b).lo(C,M,I)),this.poolIndexMap.tensor.data.set(w.tensor.data,k),k+=x*v*b;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}},{key:'_callGPU',value:function(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this._vol2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){var t=Rn(this.outputShape,4),a=t[0],r=t[1],i=t[2],u=t[3];this.output=new o.default([],[a*r*i,u]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}var s=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,l=this.poolSize[0]*this.poolSize[1]*this.poolSize[2],p='max'===this.poolingFunc,d=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:l,type:'int',name:'poolSize'},{value:+p,type:'bool',name:'isMaxPooling'}];s.glTextureFragments?(s.convert2DRowFragmentedGLTextureToColStack(),gh.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:s,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:d,supportsTextureFragments:!0}),s.removeGLTextureFragmentsAsColStack()):gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:s,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:d}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}]),t}(r.default);t.default=i});he(G_);var U_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(G_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='MaxPooling3D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(U_);var q_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(L_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='AveragePooling1D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(q_);var N_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(j_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='AveragePooling2D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(N_);var B_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(G_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='AveragePooling3D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(B_);var V_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_GlobalPooling1D';var r=e.data_format,o=void 0===r?'channels_last':r;return a.dataFormat=o,a.poolingFunc='max',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=Rn(e.tensor.shape,2),a=t[0],r=t[1];this.output=new o.default([],[r]);for(var u=0;u<r;u++)'max'===this.poolingFunc?this.output.tensor.set(u,n.default.sup(e.tensor.pick(null,u))):'average'===this.poolingFunc&&this.output.tensor.set(u,n.default.sum(e.tensor.pick(null,u))/a)}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.output||(this.output=new o.default([],[this.inputShape[1]]),this.output.createGLTexture({type:'2d',format:'float'}));var t='max'===this.poolingFunc;gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(V_);var H_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(V_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalMaxPooling1D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(H_);var W_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_GlobalPooling2D';var r=e.data_format,o=void 0===r?'channels_last':r;return a.dataFormat=o,a.poolingFunc='max',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0));var t=Rn(e.tensor.shape,3),a=t[0],r=t[1],u=t[2];this.output=new o.default([],[u]);for(var s=0;s<u;s++)'max'===this.poolingFunc?this.output.tensor.set(s,n.default.sup(e.tensor.pick(null,null,s))):'average'===this.poolingFunc&&this.output.tensor.set(s,n.default.sum(e.tensor.pick(null,null,s))/(a*r))}},{key:'_callGPU',value:function(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[2]]),this.output.createGLTexture({type:'2d',format:'float'}));var t='max'===this.poolingFunc;gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he(W_);var X_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(W_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalMaxPooling2D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(X_);var $_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='_GlobalPooling3D';var r=e.data_format,o=void 0===r?'channels_last':r;return a.dataFormat=o,a.poolingFunc='max',a.gpu&&(a.poolingProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0));var t=Rn(e.tensor.shape,4),a=t[0],r=t[1],u=t[2],s=t[3];this.output=new o.default([],[s]);for(var l=0;l<s;l++)'max'===this.poolingFunc?this.output.tensor.set(l,n.default.sup(e.tensor.pick(null,null,null,l))):'average'===this.poolingFunc&&this.output.tensor.set(l,n.default.sum(e.tensor.pick(null,null,null,l))/(a*r*u))}},{key:'_callGPU',value:function(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[3]]),this.output.createGLTexture({type:'2d',format:'float'}));var t='max'===this.poolingFunc;gh.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1]*this.inputShape[2],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=i});he($_);var K_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}($_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalMaxPooling3D',a.poolingFunc='max',a}return Dn(t,e),t}(a.default);t.default=r});he(K_);var Q_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(V_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalAveragePooling1D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(Q_);var Z_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(W_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalAveragePooling2D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(Z_);var Y_=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}($_),r=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.layerClass='GlobalAveragePooling3D',a.poolingFunc='average',a}return Dn(t,e),t}(a.default);t.default=r});he(Y_);var J_=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'MaxPooling1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'MaxPooling2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'MaxPooling3D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'AveragePooling1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'AveragePooling2D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'AveragePooling3D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'GlobalMaxPooling1D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'GlobalMaxPooling2D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'GlobalMaxPooling3D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'GlobalAveragePooling1D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'GlobalAveragePooling2D',{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,'GlobalAveragePooling3D',{enumerable:!0,get:function(){return h.default}});var r=a(O_),o=a(z_),n=a(U_),i=a(q_),u=a(N_),s=a(B_),l=a(H_),p=a(X_),d=a(K_),c=a(Q_),g=a(Z_),h=a(Y_)});he(J_);var ey=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(Qh),n=a(Rh),i=a(hh),u=a(Mh),s=a(Uh),l=r(Sf),p=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));Object.defineProperty(a,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,s.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),a.layerClass='SimpleRNN';var r=e.units,n=void 0===r?1:r,i=e.activation,u=void 0===i?'tanh':i,p=e.use_bias,d=e.return_sequences,c=e.go_backwards,g=e.stateful;return a.units=n,a.activation=u,a.activationFunc=o[u],a.use_bias=void 0===p||p,a.returnSequences=void 0!==d&&d,a.goBackwards=void 0!==c&&c,a.stateful=void 0!==g&&g,a.params=a.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],a.description='output dimensions: '+a.units,a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.description+=a.returnSequences?', return sequences':'',a.description+=a.goBackwards?', backward direction':'',a.description+=a.stateful?', stateful':'',a.gpu&&(a.copyTextureProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(l[a.activation]),a.gateSummationProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),a.timestepReadProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),a.timestepWriteProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e),this.use_bias||(this.weights.bias=new n.default([],[this.units]),this.gpu&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=this,a=this.units,r=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[a]),o=new n.default([],[a]),s=new n.default([],[a]),l=new n.default([],[a]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],a]);for(var p=new n.default([],[e.tensor.shape[1]]),d=function(){u.default.assign(l.tensor,r.tensor),(0,Sm.gemv)(1,t.weights.kernel.tensor.transpose(1,0),p.tensor,1,o.tensor),(0,Sm.gemv)(1,t.weights.recurrent_kernel.tensor.transpose(1,0),l.tensor,1,s.tensor),t._combine(r.tensor,o.tensor,s.tensor,t.weights.bias.tensor),t.activationFunc(r)},c=0,i=e.tensor.shape[0],g;c<i;c++){g=this.goBackwards?i-c-1:c,u.default.assign(p.tensor,e.tensor.pick(g,null));[o,s].forEach(function(e){return u.default.assigns(e.tensor,0)}),d(),this.returnSequences&&u.default.assign(this.hiddenStateSequence.tensor.pick(c,null),r.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:r,this.stateful&&(this.currentHiddenState=r)}},{key:'_stepGPU',value:function(){gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.recurrent_kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.bias,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:gh.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]})}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});var t=this.units;this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[t]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[t]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[t]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[t]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[t]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(var a=0,r=e.glTextureShape[0],o;a<r;a++)o=this.goBackwards?r-a-1:a,gh.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:o,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gh.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:a,type:'int',name:'index'}]}));this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(i.default);t.default=p});he(ey);var ty=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(Qh),n=a(Rh),i=a(hh),u=a(Mh),s=a(Uh),l=r(Sf),p=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));Object.defineProperty(a,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,s.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(a,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,s.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=e*a+t*r}})}),a.layerClass='LSTM';var r=e.units,n=void 0===r?1:r,i=e.activation,u=void 0===i?'tanh':i,p=e.use_bias,d=e.recurrent_activation,c=void 0===d?'hard_sigmoid':d,g=e.return_sequences,h=e.go_backwards,f=e.stateful;return a.units=n,a.activation=u,a.recurrentActivation=c,a.activationFunc=o[u],a.recurrentActivationFunc=o[c],a.use_bias=void 0===p||p,a.returnSequences=void 0!==g&&g,a.goBackwards=void 0!==h&&h,a.stateful=void 0!==f&&f,a.params=a.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],a.description='output dimensions: '+a.units,a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.description+='linear'===a.recurrentActivation?'':', '+a.recurrentActivation+' recurrent activation',a.description+=a.returnSequences?', return sequences':'',a.description+=a.goBackwards?', backward direction':'',a.description+=a.stateful?', stateful':'',a.gpu&&(a.copyTextureProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(l[a.activation]),a.recurrentActivationProgram=gh.webgl2.compileProgram(l[a.recurrentActivation]),a.gateSummationProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),a.gateProductProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),a.timestepReadProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),a.timestepWriteProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),a.updateProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D c;\nuniform sampler2D ctm1;\nuniform sampler2D i;\nuniform sampler2D f;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(c, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float c_val = texelFetch(c, ivec2(out_x, out_y), 0).r;\n  float ctm1_val = texelFetch(ctm1, ivec2(out_x, out_y), 0).r;\n  float i_val = texelFetch(i, ivec2(out_x, out_y), 0).r;\n  float f_val = texelFetch(f, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(c_val * i_val + ctm1_val * f_val);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){var a=this;Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e);var r=this.weights.kernel.tensor.shape;this.weights.W_i=new n.default([],[r[0],this.units]),this.weights.W_f=new n.default([],[r[0],this.units]),this.weights.W_c=new n.default([],[r[0],this.units]),this.weights.W_o=new n.default([],[r[0],this.units]),u.default.assign(this.weights.W_i.tensor,this.weights.kernel.tensor.hi(r[0],this.units).lo(0,0)),u.default.assign(this.weights.W_f.tensor,this.weights.kernel.tensor.hi(r[0],2*this.units).lo(0,this.units)),u.default.assign(this.weights.W_c.tensor,this.weights.kernel.tensor.hi(r[0],3*this.units).lo(0,2*this.units)),u.default.assign(this.weights.W_o.tensor,this.weights.kernel.tensor.hi(r[0],4*this.units).lo(0,3*this.units));var o=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_i=new n.default([],[o[0],this.units]),this.weights.U_f=new n.default([],[o[0],this.units]),this.weights.U_c=new n.default([],[o[0],this.units]),this.weights.U_o=new n.default([],[o[0],this.units]),u.default.assign(this.weights.U_i.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],this.units).lo(0,0)),u.default.assign(this.weights.U_f.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],2*this.units).lo(0,this.units)),u.default.assign(this.weights.U_c.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],3*this.units).lo(0,2*this.units)),u.default.assign(this.weights.U_o.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],4*this.units).lo(0,3*this.units)),this.weights.b_i=new n.default([],[this.units]),this.weights.b_f=new n.default([],[this.units]),this.weights.b_c=new n.default([],[this.units]),this.weights.b_o=new n.default([],[this.units]),this.use_bias&&(u.default.assign(this.weights.b_i.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),u.default.assign(this.weights.b_f.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),u.default.assign(this.weights.b_c.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units)),u.default.assign(this.weights.b_o.tensor,this.weights.bias.tensor.hi(4*this.units).lo(3*this.units))),this.gpu){['W_i','W_f','W_c','W_o','U_i','U_f','U_c','U_o','b_i','b_f','b_c','b_o'].forEach(function(e){a.weights[e].createGLTexture({type:'2d',format:'float'})})}}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=this,a=this.weights.b_i.tensor.shape[0],r=this.weights.b_c.tensor.shape[0],o=this.weights.b_f.tensor.shape[0],s=this.weights.b_o.tensor.shape[0],l=new n.default([],[a]),p=new n.default([],[a]),d=new n.default([],[a]),c=new n.default([],[o]),g=new n.default([],[o]),h=new n.default([],[o]),f=new n.default([],[s]),m=new n.default([],[s]),_=new n.default([],[s]),y=new n.default([],[r]),x=new n.default([],[r]),v=new n.default([],[r]),b=this.stateful&&this.previousCandidate?this.previousCandidate:new n.default([],[r]),S=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[r]),P=new n.default([],[r]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],r]);for(var T=new n.default([],[e.tensor.shape[1]]),w=function(){u.default.assign(P.tensor,S.tensor),(0,Sm.gemv)(1,t.weights.W_i.tensor.transpose(1,0),T.tensor,1,p.tensor),(0,Sm.gemv)(1,t.weights.U_i.tensor.transpose(1,0),P.tensor,1,d.tensor),t._combine(l.tensor,p.tensor,d.tensor,t.weights.b_i.tensor),t.recurrentActivationFunc(l),(0,Sm.gemv)(1,t.weights.W_f.tensor.transpose(1,0),T.tensor,1,g.tensor),(0,Sm.gemv)(1,t.weights.U_f.tensor.transpose(1,0),P.tensor,1,h.tensor),t._combine(c.tensor,g.tensor,h.tensor,t.weights.b_f.tensor),t.recurrentActivationFunc(c),(0,Sm.gemv)(1,t.weights.W_o.tensor.transpose(1,0),T.tensor,1,m.tensor),(0,Sm.gemv)(1,t.weights.U_o.tensor.transpose(1,0),P.tensor,1,_.tensor),t._combine(f.tensor,m.tensor,_.tensor,t.weights.b_o.tensor),t.recurrentActivationFunc(f),(0,Sm.gemv)(1,t.weights.W_c.tensor.transpose(1,0),T.tensor,1,x.tensor),(0,Sm.gemv)(1,t.weights.U_c.tensor.transpose(1,0),P.tensor,1,v.tensor),t._combine(y.tensor,x.tensor,v.tensor,t.weights.b_c.tensor),t.activationFunc(y),t._update(y.tensor,b.tensor,l.tensor,c.tensor),u.default.assign(b.tensor,y.tensor),t.activationFunc(y),u.default.mul(S.tensor,f.tensor,y.tensor)},k=0,i=e.tensor.shape[0],C;k<i;k++){C=this.goBackwards?i-k-1:k,u.default.assign(T.tensor,e.tensor.pick(C,null));[p,d,g,h,m,_,x,v].forEach(function(e){return u.default.assigns(e.tensor,0)}),w(),u.default.assign(this.hiddenStateSequence.tensor.pick(k,null),S.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:S,this.stateful&&(this.previousCandidate=b,this.currentHiddenState=S)}},{key:'_stepGPU',value:function(){gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXI,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHI,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentInputGateStatePreactiv,inputs:[{input:this.tempXI,name:'t1'},{input:this.tempHI,name:'t2'},{input:this.weights.b_i,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentInputGateState=this.currentInputGateStatePreactiv:gh.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentInputGateState,inputs:[{input:this.currentInputGateStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXF,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHF,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentForgetGateStatePreactiv,inputs:[{input:this.tempXF,name:'t1'},{input:this.tempHF,name:'t2'},{input:this.weights.b_f,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentForgetGateState=this.currentForgetGateStatePreactiv:gh.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentForgetGateState,inputs:[{input:this.currentForgetGateStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXO,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHO,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentOutputGateStatePreactiv,inputs:[{input:this.tempXO,name:'t1'},{input:this.tempHO,name:'t2'},{input:this.weights.b_o,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentOutputGateState=this.currentOutputGateStatePreactiv:gh.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentOutputGateState,inputs:[{input:this.currentOutputGateStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXC,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHC,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.tempXC,name:'t1'},{input:this.tempHC,name:'t2'},{input:this.weights.b_c,name:'bias'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:gh.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidateCopy,inputs:[{input:this.currentCandidate,name:'source'}]}),gh.webgl2.runProgram({program:this.updateProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidateCopy,name:'c'},{input:this.previousCandidate,name:'ctm1'},{input:this.currentInputGateState,name:'i'},{input:this.currentForgetGateState,name:'f'}]}),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousCandidate,inputs:[{input:this.currentCandidate,name:'source'}]}),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.currentCandidate,name:'source'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:gh.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.gateProductProgram,output:this.currentHiddenState,inputs:[{input:this.currentOutputGateState,name:'t1'},{input:this.currentCandidate,name:'t2'}]})}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});var t=this.weights.b_i.glTextureShape[1],a=this.weights.b_c.glTextureShape[1],r=this.weights.b_f.glTextureShape[1],o=this.weights.b_o.glTextureShape[1];this.currentInputGateState||(this.currentInputGateState=new n.default([],[t]),this.currentInputGateState.createGLTexture({type:'2d',format:'float'})),this.currentInputGateStatePreactiv||(this.currentInputGateStatePreactiv=new n.default([],[t]),this.currentInputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXI||(this.tempXI=new n.default([],[t]),this.tempXI.createGLTexture({type:'2d',format:'float'})),this.tempHI||(this.tempHI=new n.default([],[t]),this.tempHI.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateState||(this.currentForgetGateState=new n.default([],[r]),this.currentForgetGateState.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateStatePreactiv||(this.currentForgetGateStatePreactiv=new n.default([],[r]),this.currentForgetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXF||(this.tempXF=new n.default([],[r]),this.tempXF.createGLTexture({type:'2d',format:'float'})),this.tempHF||(this.tempHF=new n.default([],[r]),this.tempHF.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateState||(this.currentOutputGateState=new n.default([],[o]),this.currentOutputGateState.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateStatePreactiv||(this.currentOutputGateStatePreactiv=new n.default([],[o]),this.currentOutputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXO||(this.tempXO=new n.default([],[o]),this.tempXO.createGLTexture({type:'2d',format:'float'})),this.tempHO||(this.tempHO=new n.default([],[o]),this.tempHO.createGLTexture({type:'2d',format:'float'})),this.currentCandidate||(this.currentCandidate=new n.default([],[a]),this.currentCandidate.createGLTexture({type:'2d',format:'float'})),this.currentCandidateCopy||(this.currentCandidateCopy=new n.default([],[a]),this.currentCandidateCopy.createGLTexture({type:'2d',format:'float'})),this.currentCandidatePreactiv||(this.currentCandidatePreactiv=new n.default([],[a]),this.currentCandidatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXC||(this.tempXC=new n.default([],[a]),this.tempXC.createGLTexture({type:'2d',format:'float'})),this.tempHC||(this.tempHC=new n.default([],[a]),this.tempHC.createGLTexture({type:'2d',format:'float'})),this.previousCandidate&&this.stateful||(this.previousCandidate=new n.default([],[a]),this.previousCandidate.createGLTexture({type:'2d',format:'float'})),this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[a]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[a]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(var u=0,s=e.glTextureShape[0],l;u<s;u++)l=this.goBackwards?s-u-1:u,gh.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:l,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gh.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:u,type:'int',name:'index'}]}));this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(i.default);t.default=p});he(ty);var ay=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(Qh),n=a(Rh),i=a(hh),u=a(Mh),s=a(Uh),l=r(Sf),p=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));Object.defineProperty(a,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,s.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(a,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,s.default)({args:['array','array','array'],body:function(e,t,a){e=e*(1-a)+t*a}})}),a.layerClass='GRU';var r=e.units,n=void 0===r?1:r,i=e.activation,u=void 0===i?'tanh':i,p=e.use_bias,d=e.recurrent_activation,c=void 0===d?'hard_sigmoid':d,g=e.return_sequences,h=e.go_backwards,f=e.stateful;return a.units=n,a.activation=u,a.recurrentActivation=c,a.activationFunc=o[u],a.recurrentActivationFunc=o[c],a.use_bias=void 0===p||p,a.returnSequences=void 0!==g&&g,a.goBackwards=void 0!==h&&h,a.stateful=void 0!==f&&f,a.params=a.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],a.description='output dimensions: '+a.units,a.description+='linear'===a.activation?'':', '+a.activation+' activation',a.description+='linear'===a.recurrentActivation?'':', '+a.recurrentActivation+' recurrent activation',a.description+=a.returnSequences?', return sequences':'',a.description+=a.goBackwards?', backward direction':'',a.description+=a.stateful?', stateful':'',a.gpu&&(a.copyTextureProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),a.matMulProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),a.activationProgram=gh.webgl2.compileProgram(l[a.activation]),a.recurrentActivationProgram=gh.webgl2.compileProgram(l[a.recurrentActivation]),a.gateSummationProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),a.gateProductProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),a.timestepReadProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),a.timestepWriteProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),a.updateProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D h;\nuniform sampler2D htm1;\nuniform sampler2D z;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(h, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float h_val = texelFetch(h, ivec2(out_x, out_y), 0).r;\n  float htm1_val = texelFetch(htm1, ivec2(out_x, out_y), 0).r;\n  float z_val = texelFetch(z, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(h_val * (float(1.0) - z_val) + htm1_val * z_val);\n}\n')),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){var a=this;Mn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),'setWeights',this).call(this,e);var r=this.weights.kernel.tensor.shape;this.weights.W_z=new n.default([],[r[0],this.units]),this.weights.W_r=new n.default([],[r[0],this.units]),this.weights.W_h=new n.default([],[r[0],this.units]),u.default.assign(this.weights.W_z.tensor,this.weights.kernel.tensor.hi(r[0],this.units).lo(0,0)),u.default.assign(this.weights.W_r.tensor,this.weights.kernel.tensor.hi(r[0],2*this.units).lo(0,this.units)),u.default.assign(this.weights.W_h.tensor,this.weights.kernel.tensor.hi(r[0],3*this.units).lo(0,2*this.units));var o=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_z=new n.default([],[o[0],this.units]),this.weights.U_r=new n.default([],[o[0],this.units]),this.weights.U_h=new n.default([],[o[0],this.units]),u.default.assign(this.weights.U_z.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],this.units).lo(0,0)),u.default.assign(this.weights.U_r.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],2*this.units).lo(0,this.units)),u.default.assign(this.weights.U_h.tensor,this.weights.recurrent_kernel.tensor.hi(o[0],3*this.units).lo(0,2*this.units)),this.weights.b_z=new n.default([],[this.units]),this.weights.b_r=new n.default([],[this.units]),this.weights.b_h=new n.default([],[this.units]),this.use_bias&&(u.default.assign(this.weights.b_z.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),u.default.assign(this.weights.b_r.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),u.default.assign(this.weights.b_h.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units))),this.gpu){['W_z','W_r','W_h','U_z','U_r','U_h','b_z','b_r','b_h'].forEach(function(e){a.weights[e].createGLTexture({type:'2d',format:'float'})})}}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=this,a=this.weights.b_z.tensor.shape[0],r=this.weights.b_r.tensor.shape[0],o=this.weights.b_h.tensor.shape[0],s=new n.default([],[a]),l=new n.default([],[a]),p=new n.default([],[a]),d=new n.default([],[r]),c=new n.default([],[r]),g=new n.default([],[r]),h=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[o]),f=new n.default([],[o]),m=new n.default([],[o]),_=new n.default([],[o]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],o]);for(var y=new n.default([],[e.tensor.shape[1]]),x=function(){u.default.assign(_.tensor,h.tensor),(0,Sm.gemv)(1,t.weights.W_z.tensor.transpose(1,0),y.tensor,1,l.tensor),(0,Sm.gemv)(1,t.weights.U_z.tensor.transpose(1,0),_.tensor,1,p.tensor),t._combine(s.tensor,l.tensor,p.tensor,t.weights.b_z.tensor),t.recurrentActivationFunc(s),(0,Sm.gemv)(1,t.weights.W_r.tensor.transpose(1,0),y.tensor,1,c.tensor),(0,Sm.gemv)(1,t.weights.U_r.tensor.transpose(1,0),_.tensor,1,g.tensor),t._combine(d.tensor,c.tensor,g.tensor,t.weights.b_r.tensor),t.recurrentActivationFunc(d),u.default.muleq(d.tensor,_.tensor),(0,Sm.gemv)(1,t.weights.W_h.tensor.transpose(1,0),y.tensor,1,f.tensor),(0,Sm.gemv)(1,t.weights.U_h.tensor.transpose(1,0),d.tensor,1,m.tensor),t._combine(h.tensor,f.tensor,m.tensor,t.weights.b_h.tensor),t.activationFunc(h),t._update(h.tensor,_.tensor,s.tensor)},v=0,i=e.tensor.shape[0],b;v<i;v++){b=this.goBackwards?i-v-1:v,u.default.assign(y.tensor,e.tensor.pick(b,null));[l,p,c,g,f,m].forEach(function(e){return u.default.assigns(e.tensor,0)}),x(),this.returnSequences&&u.default.assign(this.hiddenStateSequence.tensor.pick(v,null),h.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:h,this.stateful&&(this.currentHiddenState=h)}},{key:'_stepGPU',value:function(){gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXZ,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHZ,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentUpdateGateStatePreactiv,inputs:[{input:this.tempXZ,name:'t1'},{input:this.tempHZ,name:'t2'},{input:this.weights.b_z,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentUpdateGateState=this.currentUpdateGateStatePreactiv:gh.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentUpdateGateState,inputs:[{input:this.currentUpdateGateStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXR,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHR,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentResetGateStatePreactiv,inputs:[{input:this.tempXR,name:'t1'},{input:this.tempHR,name:'t2'},{input:this.weights.b_r,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentResetGateState=this.currentResetGateStatePreactiv:gh.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentResetGateStateCopy,inputs:[{input:this.currentResetGateState,name:'source'}]}),gh.webgl2.runProgram({program:this.gateProductProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStateCopy,name:'t1'},{input:this.previousHiddenState,name:'t2'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.currentResetGateState,name:'A'},{input:this.weights.U_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gh.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.b_h,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:gh.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]}),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentHiddenStateCopy,inputs:[{input:this.currentHiddenState,name:'source'}]}),gh.webgl2.runProgram({program:this.updateProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStateCopy,name:'h'},{input:this.previousHiddenState,name:'htm1'},{input:this.currentUpdateGateState,name:'z'}]})}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});var t=this.weights.b_z.glTextureShape[1],a=this.weights.b_r.glTextureShape[1],r=this.weights.b_h.glTextureShape[1];this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[r]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStateCopy||(this.currentHiddenStateCopy=new n.default([],[r]),this.currentHiddenStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[r]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateState||(this.currentUpdateGateState=new n.default([],[t]),this.currentUpdateGateState.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateStatePreactiv||(this.currentUpdateGateStatePreactiv=new n.default([],[t]),this.currentUpdateGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXZ||(this.tempXZ=new n.default([],[t]),this.tempXZ.createGLTexture({type:'2d',format:'float'})),this.tempHZ||(this.tempHZ=new n.default([],[t]),this.tempHZ.createGLTexture({type:'2d',format:'float'})),this.currentResetGateState||(this.currentResetGateState=new n.default([],[a]),this.currentResetGateState.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStateCopy||(this.currentResetGateStateCopy=new n.default([],[a]),this.currentResetGateStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStatePreactiv||(this.currentResetGateStatePreactiv=new n.default([],[a]),this.currentResetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXR||(this.tempXR=new n.default([],[a]),this.tempXR.createGLTexture({type:'2d',format:'float'})),this.tempHR||(this.tempHR=new n.default([],[a]),this.tempHR.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[r]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[r]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[r]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(var o=0,u=e.glTextureShape[0],s;o<u;o++)s=this.goBackwards?u-o-1:o,gh.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:s,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gh.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:o,type:'int',name:'index'}]}));this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(i.default);t.default=p});he(ay);var ry=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'SimpleRNN',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'LSTM',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'GRU',{enumerable:!0,get:function(){return n.default}});var r=a(ey),o=a(ty),n=a(ay)});he(ry);var oy=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(uy),u=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='TimeDistributed';var r=e.layer;r||a.throwError('wrapped layer is undefined.');var o=Object.assign({},r.config,{gpu:e.gpu});return a.wrappedLayer=new i[r.class_name](o),a.wrappedLayer.outbound=[null],a.gpu&&(a.copyTextureProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),a.mapInputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),a.selectSliceProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int t;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, t), 0).r);\n}\n'),a.copySliceOutputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform int t;\nuniform int timesteps;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(sliceOutput, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(timesteps) * outTex.y);\n\n  if (t == out_y) {\n    outColor = vec4(texelFetch(sliceOutput, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n'),a.mapSliceOutputProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform isampler2D indexMap;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(outputCopy, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(textureSize(sliceOutput, 0)[0])));\n    int colIndex = int(mod(float(index), float(textureSize(sliceOutput, 0)[0])));\n    float val = texelFetch(sliceOutput, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n')),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){this.wrappedLayer.setWeights(e)}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){var t=[].concat(En(e.tensor.shape.slice(1))),a=new o.default([],t),r,u;n.default.assign(a.tensor,(r=e.tensor).pick.apply(r,[0].concat(En(Array(t.length).fill(null)))));var s=this.wrappedLayer.call(a),l=s.tensor.shape.slice();this.output=new o.default([],[e.tensor.shape[0]].concat(En(l))),n.default.assign((u=this.output.tensor).pick.apply(u,[0].concat(En(Array(l.length).fill(null)))),s.tensor);for(var p=1,i=e.tensor.shape[0];p<i;p++){var d,c;n.default.assign(a.tensor,(d=e.tensor).pick.apply(d,[p].concat(En(Array(t.length).fill(null))))),s=this.wrappedLayer.call(a),n.default.assign((c=this.output.tensor).pick.apply(c,[p].concat(En(Array(l.length).fill(null)))),s.tensor)}}},{key:'_createIndexMap',value:function(e){if(!this.indexMaps){var a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMaps=[];for(var r=this.inputShape[0],i=this.inputShape.slice(1),u=0;u<r;u++){var t=new o.default([],i,{type:Int32Array}),s;n.default.assign(t.tensor,(s=a.tensor).pick.apply(s,[u].concat(En(Array(i.length).fill(null))))),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.indexMaps.push(t)}}}},{key:'_createOutputIndexMap',value:function(e){if(!this.outputIndexMaps){var a=new o.default(e.data,e.shape,{type:Int32Array});this.outputIndexMaps=[];for(var r=this.outputShape[0],i=this.outputShape.slice(1),u=0;u<r;u++){var t=new o.default([],this.outputShape,{type:Int32Array}),s;n.default.assigns(t.tensor,-1),n.default.assign((s=t.tensor).pick.apply(s,[u].concat(En(Array(i.length).fill(null)))),a.tensor),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.outputIndexMaps.push(t)}}}},{key:'_callGPU',value:function(e){this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'}))),2<this.inputShape.length&&this._createIndexMap(e.indicesForReshaped);var t=this.inputShape[0],a=this.inputShape.slice(1);this.slice||(this.slice=new o.default([],a),2>=a.length?this.slice.createGLTexture({type:'2d',format:'float'}):(this.slice.reshapeTo2DSquare(),this.slice.createGLTexture({type:'2d',format:'float'}))),2>=this.inputShape.length?gh.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:0,type:'int',name:'t'}]}):gh.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[0],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,this.output||(2>=this.inputShape.length?(this.outputShape=[t,this.sliceOutput.glTextureShape[1]],this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'})):(this.outputShape=[t].concat(En(this.sliceOutput.originalShape)),this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.reshapeTo2DSquare(),this.outputCopy.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'}),this._createOutputIndexMap(this.sliceOutput.indicesForReshaped))),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?gh.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:0,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):gh.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[0],name:'indexMap'}]});for(var r=1;r<t;r++)2>=this.inputShape.length?gh.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'t'}]}):gh.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[r],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?gh.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:r,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):gh.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[r],name:'indexMap'}]});0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}]),t}(r.default);t.default=u});he(oy);var ny=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hh),o=a(Rh),n=a(Mh),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(ry),u=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.layerClass='Bidirectional';var r=e.layer,o=e.merge_mode,n=void 0===o?'concat':o;r||a.throwError('wrapped layer is undefined.'),['SimpleRNN','GRU','LSTM'].includes(r.class_name)||a.throwError('cannot wrap '+r.class_name+' layer.'),['concat','sum','mul','ave'].includes(n)||a.throwError('merge_mode '+n+' not supported.');var u=Object.assign({},r.config,{gpu:e.gpu}),s=Object.assign({},r.config,{gpu:e.gpu});return s.go_backwards=!s.go_backwards,a.forwardLayer=new i[r.class_name](u),a.backwardLayer=new i[r.class_name](s),a.forwardLayer.outbound=[null],a.backwardLayer.outbound=[null],a.mergeMode=n,a.returnSequences=r.config.return_sequences,a.gpu&&(a.copyTextureProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),'concat'===a.mergeMode?a.mergeProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0] * 2) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_x >= 0 && out_x < size[0]) {\n    outColor = vec4(texelFetch(forward, ivec2(out_x, out_y), 0).r);\n  } else {\n    outColor = vec4(texelFetch(backward, ivec2(out_x - size[0], size[1] - out_y - 1), 0).r);\n  }\n}\n'):'sum'===a.mergeMode?a.mergeProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val + backward_val);\n}\n'):'mul'===a.mergeMode?a.mergeProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val * backward_val);\n}\n'):'ave'===a.mergeMode&&(a.mergeProgram=gh.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(0.5 * (forward_val + backward_val));\n}\n'))),a}return Dn(t,e),Fn(t,[{key:'setWeights',value:function(e){this.forwardLayer.setWeights(e.slice(0,e.length/2)),this.backwardLayer.setWeights(e.slice(e.length/2))}},{key:'call',value:function(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}},{key:'_callCPU',value:function(e){this.forwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape)),this.backwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape));var t=this.forwardLayer.output,a=this.backwardLayer.output;this.returnSequences&&(a.tensor=a.tensor.step(-1));var r=t.tensor.shape.slice();'concat'===this.mergeMode&&(r[r.length-1]+=a.tensor.shape[r.length-1]),this.output=new o.default([],r),'concat'===this.mergeMode?this.returnSequences?(n.default.assign(this.output.tensor.hi(r[0],t.tensor.shape[1]).lo(0,0),t.tensor),n.default.assign(this.output.tensor.hi(r[0],r[1]).lo(0,t.tensor.shape[1]),a.tensor)):(n.default.assign(this.output.tensor.hi(t.tensor.shape[0]).lo(0),t.tensor),n.default.assign(this.output.tensor.hi(r[0]).lo(t.tensor.shape[0]),a.tensor)):'sum'===this.mergeMode?(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor)):'mul'===this.mergeMode?(n.default.assigns(this.output.tensor,1),n.default.muleq(this.output.tensor,t.tensor),n.default.muleq(this.output.tensor,a.tensor)):'ave'===this.mergeMode&&(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor),n.default.divseq(this.output.tensor,2))}},{key:'_callGPU',value:function(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputCopy||(this.inputCopy=new o.default([],e.glTextureShape),this.inputCopy.createGLTexture({type:'2d',format:'float'})),gh.webgl2.runProgram({program:this.copyTextureProgram,output:this.inputCopy,inputs:[{input:e,name:'source'}]}),this.forwardLayer._callGPU(e),this.backwardLayer._callGPU(this.inputCopy);var t=this.forwardLayer.output,a=this.backwardLayer.output,r=t.glTextureShape.slice();'concat'===this.mergeMode&&(r[1]+=a.glTextureShape[1]),this.output||(this.output=new o.default([],r),this.output.createGLTexture({type:'2d',format:'float'}),!this.returnSequences&&(this.output.is1D=!0)),gh.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:t,name:'forward'},{input:a,name:'backward'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}]),t}(r.default);t.default=u});he(ny);var iy=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'TimeDistributed',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Bidirectional',{enumerable:!0,get:function(){return o.default}});var r=a(oy),o=a(ny)});he(iy);var uy=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0});var a={InputLayer:!0};Object.defineProperty(t,'InputLayer',{enumerable:!0,get:function(){return r.default}});var r=function(e){return e&&e.__esModule?e:{default:e}}(Eh);Object.keys(tf).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return tf[e]}})}),Object.keys(zf).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return zf[e]}})}),Object.keys(h_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h_[e]}})}),Object.keys(m_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m_[e]}})}),Object.keys(M_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return M_[e]}})}),Object.keys(R_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R_[e]}})}),Object.keys(A_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return A_[e]}})}),Object.keys(J_).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return J_[e]}})}),Object.keys(ry).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return ry[e]}})}),Object.keys(iy).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return iy[e]}})})});he(uy);var sy=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Rh),o=a(Mh),n=a(vf),i=a(_f),u=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(Cn(this,e),this.modelLayersMap=t.modelLayersMap,this.gpu=t.gpu,!this.modelLayersMap)throw new Error('[CAM] modelLayersMap is required')}return Fn(e,[{key:'initialize',value:function(){var e=this;if(this.modelLayersMap.forEach(function(t){'GlobalAveragePooling2D'===t.layerClass&&(e.enabled=!0,e.poolLayer=t)}),this.enabled&&!this.data){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output;var t=this.poolLayer;for(t.outbound.length||(this.weights=this.poolLayer.output);t.outbound.length;)t=this.modelLayersMap.get(t.outbound[0]),this.weights=t.weights.kernel?t.weights.kernel:this.poolLayer.output;if(this.inputShape=this.featureMaps.is2DReshaped?this.featureMaps.originalShape.slice(0,2):this.featureMaps.tensor.shape.slice(0,2),1===this.weights.tensor.shape.length)this.shape=this.inputShape;else{var a=this.weights.tensor.shape[1];this.shape=[].concat(En(this.inputShape),[a])}this.data=new Float32Array(this.shape.reduce(function(e,t){return e*t},1))}}},{key:'update',value:function(){if(this.enabled){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output,this.gpu?this._updateGPU():this._updateCPU();var e=o.default.inf(this.output.tensor),t=o.default.sup(this.output.tensor);o.default.divseq(o.default.subseq(this.output.tensor,e),t-e),this.data=this.output.tensor.data}}},{key:'_updateCPU',value:function(){if(this.featureMaps.is2DReshaped||this.featureMaps.reshapeTo2D(),1===this.weights.tensor.shape.length){this.output||(this.output=new r.default([],this.shape));var e=new r.default([],[this.shape[0]*this.shape[1]]);(0,Sm.gemv)(1,this.featureMaps.tensor,this.weights.tensor,1,e.tensor),this.output.replaceTensorData(e.tensor.data)}else this.output||(this.output=new r.default([],this.shape)),this.output.reshapeTo2D(),(0,n.default)(this.output.tensor,this.featureMaps.tensor,this.weights.tensor,1,1),this.output.reshapeFrom2D();o.default.maxseq(this.output.tensor,0),this.featureMaps.is2DReshaped&&this.featureMaps.reshapeFrom2D()}},{key:'_updateGPU',value:function(){this.output||(this.output=new r.default([],this.shape));var e=this.weights.is1D;!this.output.glTexture&&e?this.output.createGLTexture({type:'2d',format:'float'}):(this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'}));var t=e?this.weights.glTextureShape[1]:this.weights.glTextureShape[0];if(!this.program){var a=(0,i.default)('cam',this.output.glTextureShape,t,e);this.program=gh.webgl2.compileProgram(a)}gh.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:this.featureMaps,name:'featureMaps'},{input:this.weights,name:'weights'}]}),this.output.transferFromGLTexture(),this.output.is2DReshaped&&this.output.reshapeFrom2D()}}]),e}();t.default=u});he(sy);var ly=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'CAM',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(sy)});he(ly);var py=Co,dy=fe(function(e,t){var a=t;a.length=function(e){var t=e.length;if(!t)return 0;for(var a=0;1<--t%4&&'='===e.charAt(t);)++a;return xn(3*e.length)/4-a};for(var r=Array(64),o=Array(123),n=0;64>n;)o[r[n]=26>n?n+65:52>n?n+71:62>n?n-4:43|n-59]=n++;a.encode=function(e,a,o){for(var n=null,u=[],s=0,i=0,l,t;a<o;)t=e[a++],0==i?(u[s++]=r[t>>2],l=(3&t)<<4,i=1):1==i?(u[s++]=r[l|t>>4],l=(15&t)<<2,i=2):2==i?(u[s++]=r[l|t>>6],u[s++]=r[63&t],i=0):void 0,8191<s&&((n||(n=[])).push(yn.apply(String,u)),s=0);return i&&(u[s++]=r[l],u[s++]=61,1==i&&(u[s++]=61)),n?(s&&n.push(yn.apply(String,u.slice(0,s))),n.join('')):yn.apply(String,u.slice(0,s))};var u='invalid encoding';a.decode=function(e,a,r){for(var n=r,s=0,l=0,i,t;l<e.length&&(t=e.charCodeAt(l++),!(61===t&&1<s));){if(void 0===(t=o[t]))throw Error(u);0==s?(i=t,s=1):1==s?(a[r++]=i<<2|(48&t)>>4,i=t,s=2):2==s?(a[r++]=(15&i)<<4|(60&t)>>2,i=t,s=3):3==s?(a[r++]=(3&i)<<6|t,s=0):void 0}if(1==s)throw Error(u);return r-n},a.test=function(e){return /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}),cy=Fo;Fo.prototype.on=function(e,t,a){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:a||this}),this},Fo.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var a=this._listeners[e],r=0;r<a.length;)a[r].fn===t?a.splice(r,1):++r;return this},Fo.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var a=[],r=1;r<arguments.length;)a.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,a)}return this};var gy=Mo(Mo),hy=Ao,fy=fe(function(e,t){var a=t;a.length=function(e){for(var t=0,a=0,r=0;r<e.length;++r)a=e.charCodeAt(r),128>a?t+=1:2048>a?t+=2:55296==(64512&a)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},a.read=function(e,a,r){var o=r-a;if(1>o)return'';for(var n=null,u=[],s=0,i;a<r;)i=e[a++],128>i?u[s++]=i:191<i&&224>i?u[s++]=(31&i)<<6|63&e[a++]:239<i&&365>i?(i=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536,u[s++]=55296+(i>>10),u[s++]=56320+(1023&i)):u[s++]=(15&i)<<12|(63&e[a++])<<6|63&e[a++],8191<s&&((n||(n=[])).push(yn.apply(String,u)),s=0);return n?(s&&n.push(yn.apply(String,u.slice(0,s))),n.join('')):yn.apply(String,u.slice(0,s))},a.write=function(e,t,a){for(var r=a,o=0,n,i;o<e.length;++o)n=e.charCodeAt(o),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>6,t[a++]=128|63&n):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,t[a++]=240|n>>18,t[a++]=128|63&n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n):(t[a++]=224|n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n);return a-r}}),my=Lo,_y=Oo,yy=Oo.zero=new Oo(0,0);yy.toNumber=function(){return 0},yy.zzEncode=yy.zzDecode=function(){return this},yy.length=function(){return 1};var xy=Oo.zeroHash='\0\0\0\0\0\0\0\0';Oo.fromNumber=function(e){if(0===e)return yy;var t=0>e;t&&(e=-e);var a=e>>>0,r=(e-a)/4294967296>>>0;return t&&(r=~r>>>0,a=~a>>>0,4294967295<++a&&(a=0,4294967295<++r&&(r=0))),new Oo(a,r)},Oo.from=function(e){if('number'==typeof e)return Oo.fromNumber(e);if(by.isString(e))if(by.Long)e=by.Long.fromString(e);else return Oo.fromNumber(parseInt(e,10));return e.low||e.high?new Oo(e.low>>>0,e.high>>>0):yy},Oo.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,a=~this.hi>>>0;return t||(a=a+1>>>0),-(t+4294967296*a)}return this.lo+4294967296*this.hi},Oo.prototype.toLong=function(e){return by.Long?new by.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var vy=String.prototype.charCodeAt;Oo.fromHash=function(e){return e===xy?yy:new Oo((vy.call(e,0)|vy.call(e,1)<<8|vy.call(e,2)<<16|vy.call(e,3)<<24)>>>0,(vy.call(e,4)|vy.call(e,5)<<8|vy.call(e,6)<<16|vy.call(e,7)<<24)>>>0)},Oo.prototype.toHash=function(){return yn(255&this.lo,255&this.lo>>>8,255&this.lo>>>16,this.lo>>>24,255&this.hi,255&this.hi>>>8,255&this.hi>>>16,this.hi>>>24)},Oo.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Oo.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Oo.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,a=this.hi>>>24;return 0==a?0==t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>a?9:10};var by=fe(function(e,t){function a(e,t,a){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&a||(e[r[o]]=t[r[o]]);return e}function r(e){function t(e,r){return this instanceof t?void(Object.defineProperty(this,'message',{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,'stack',{value:new Error().stack||''}),r&&a(this,r)):new t(e,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,'name',{get:function(){return e}}),t.prototype.toString=function(){return this.name+': '+this.message},t}var o=t;o.asPromise=py,o.base64=dy,o.EventEmitter=cy,o.float=gy,o.inquire=hy,o.utf8=fy,o.pool=my,o.LongBits=_y,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isNode=!!(Au.process&&Au.process.versions&&Au.process.versions.node),o.isInteger=Number.isInteger||function(e){return'number'==typeof e&&isFinite(e)&&fn(e)===e},o.isString=function(e){return'string'==typeof e||e instanceof String},o.isObject=function(e){return e&&'object'===('undefined'==typeof e?'undefined':kn(e))},o.isset=o.isSet=function(e,t){var a=e[t];return null!=a&&e.hasOwnProperty(t)&&('object'!==('undefined'==typeof a?'undefined':kn(a))||0<(Array.isArray(a)?a.length:Object.keys(a).length))},o.Buffer=function(){try{var e=o.inquire('buffer').Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(e){return'number'==typeof e?o.Buffer?o._Buffer_allocUnsafe(e):new o.Array(e):o.Buffer?o._Buffer_from(e):'undefined'==typeof Uint8Array?e:new Uint8Array(e)},o.Array='undefined'==typeof Uint8Array?Array:Uint8Array,o.Long=Au.dcodeIO&&Au.dcodeIO.Long||o.inquire('long'),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(e){return e?o.LongBits.from(e).toHash():o.LongBits.zeroHash},o.longFromHash=function(e,t){var a=o.LongBits.fromHash(e);return o.Long?o.Long.fromBits(a.lo,a.hi,t):a.toNumber(!!t)},o.merge=a,o.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},o.newError=r,o.ProtocolError=r('ProtocolError'),o.oneOfGetter=function(e){for(var t={},a=0;a<e.length;++a)t[e[a]]=1;return function(){for(var e=Object.keys(this),a=e.length-1;-1<a;--a)if(1===t[e[a]]&&this[e[a]]!==void 0&&null!==this[e[a]])return e[a]}},o.oneOfSetter=function(e){return function(t){for(var a=0;a<e.length;++a)e[a]!==t&&delete this[e[a]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var e=o.Buffer;return e?void(o._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,a){return new e(t,a)},o._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):void(o._Buffer_from=o._Buffer_allocUnsafe=null)}}),Sy=Uo,Py=by.LongBits,Ty=by.base64,wy=by.utf8,ky;Uo.create=by.Buffer?function(){return(Uo.create=function(){return new ky})()}:function(){return new Uo},Uo.alloc=function(e){return new by.Array(e)},by.Array!==Array&&(Uo.alloc=by.pool(Uo.alloc,by.Array.prototype.subarray)),Uo.prototype._push=function(e,t,a){return this.tail=this.tail.next=new jo(e,t,a),this.len+=t,this},Bo.prototype=Object.create(jo.prototype),Bo.prototype.fn=No,Uo.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Bo(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},Uo.prototype.int32=function(e){return 0>e?this._push(Vo,10,Py.fromNumber(e)):this.uint32(e)},Uo.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Uo.prototype.uint64=function(e){var t=Py.from(e);return this._push(Vo,t.length(),t)},Uo.prototype.int64=Uo.prototype.uint64,Uo.prototype.sint64=function(e){var t=Py.from(e).zzEncode();return this._push(Vo,t.length(),t)},Uo.prototype.bool=function(e){return this._push(qo,1,e?1:0)},Uo.prototype.fixed32=function(e){return this._push(Ho,4,e>>>0)},Uo.prototype.sfixed32=Uo.prototype.fixed32,Uo.prototype.fixed64=function(e){var t=Py.from(e);return this._push(Ho,4,t.lo)._push(Ho,4,t.hi)},Uo.prototype.sfixed64=Uo.prototype.fixed64,Uo.prototype.float=function(e){return this._push(by.float.writeFloatLE,4,e)},Uo.prototype.double=function(e){return this._push(by.float.writeDoubleLE,8,e)};var Cy=by.Array.prototype.set?function(e,t,a){t.set(e,a)}:function(e,t,a){for(var r=0;r<e.length;++r)t[a+r]=e[r]};Uo.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(qo,1,0);if(by.isString(e)){var a=Uo.alloc(t=Ty.length(e));Ty.decode(e,a,0),e=a}return this.uint32(t)._push(Cy,t,e)},Uo.prototype.string=function(e){var t=wy.length(e);return t?this.uint32(t)._push(wy.write,t,e):this._push(qo,1,0)},Uo.prototype.fork=function(){return this.states=new Go(this),this.head=this.tail=new jo(zo,0,0),this.len=0,this},Uo.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new jo(zo,0,0),this.len=0),this},Uo.prototype.ldelim=function(){var e=this.head,t=this.tail,a=this.len;return this.reset().uint32(a),a&&(this.tail.next=e.next,this.tail=t,this.len+=a),this},Uo.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),a=0;e;)e.fn(e.val,t,a),a+=e.len,e=e.next;return t},Uo._configure=function(e){ky=e};var Fy=Wo;(Wo.prototype=Object.create(Sy.prototype)).constructor=Wo;var My=by.Buffer;Wo.alloc=function(e){return(Wo.alloc=by._Buffer_allocUnsafe)(e)};var Dy=My&&My.prototype instanceof Uint8Array&&'set'===My.prototype.set.name?function(e,t,a){t.set(e,a)}:function(e,t,a){if(e.copy)e.copy(t,a,0,e.length);else for(var r=0;r<e.length;)t[a++]=e[r++]};Wo.prototype.bytes=function(e){by.isString(e)&&(e=by._Buffer_from(e,'base64'));var t=e.length>>>0;return this.uint32(t),t&&this._push(Dy,t,e),this},Wo.prototype.string=function(e){var t=My.byteLength(e);return this.uint32(t),t&&this._push(Xo,t,e),this};var Iy=Ko,Ry=by.LongBits,Ey=by.utf8,Ay='undefined'==typeof Uint8Array?function(e){if(Array.isArray(e))return new Ko(e);throw Error('illegal buffer')}:function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ko(e);throw Error('illegal buffer')},Ly;Ko.create=by.Buffer?function(e){return(Ko.create=function(e){return by.Buffer.isBuffer(e)?new Ly(e):Ay(e)})(e)}:Ay,Ko.prototype._slice=by.Array.prototype.subarray||by.Array.prototype.slice,Ko.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,$o(this,10);return e}}(),Ko.prototype.int32=function(){return 0|this.uint32()},Ko.prototype.sint32=function(){var e=this.uint32();return 0|e>>>1^-(1&e)},Ko.prototype.bool=function(){return 0!==this.uint32()},Ko.prototype.fixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return Zo(this.buf,this.pos+=4)},Ko.prototype.sfixed32=function(){if(this.pos+4>this.len)throw $o(this,4);return 0|Zo(this.buf,this.pos+=4)},Ko.prototype.float=function(){if(this.pos+4>this.len)throw $o(this,4);var e=by.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Ko.prototype.double=function(){if(this.pos+8>this.len)throw $o(this,4);var e=by.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Ko.prototype.bytes=function(){var e=this.uint32(),t=this.pos,a=this.pos+e;if(a>this.len)throw $o(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,a):t===a?new this.buf.constructor(0):this._slice.call(this.buf,t,a)},Ko.prototype.string=function(){var e=this.bytes();return Ey.read(e,0,e.length)},Ko.prototype.skip=function(e){if('number'==typeof e){if(this.pos+e>this.len)throw $o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw $o(this);while(128&this.buf[this.pos++]);return this},Ko.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:do{if(4==(e=7&this.uint32()))break;this.skipType(e)}while(!0);break;case 5:this.skip(4);break;default:throw Error('invalid wire type '+e+' at offset '+this.pos);}return this},Ko._configure=function(e){Ly=e;var t=by.Long?'toLong':'toNumber';by.merge(Ko.prototype,{int64:function(){return Qo.call(this)[t](!1)},uint64:function(){return Qo.call(this)[t](!0)},sint64:function(){return Qo.call(this).zzDecode()[t](!1)},fixed64:function(){return Yo.call(this)[t](!0)},sfixed64:function(){return Yo.call(this)[t](!1)}})};var Oy=Jo;(Jo.prototype=Object.create(Iy.prototype)).constructor=Jo,by.Buffer&&(Jo.prototype._slice=by.Buffer.prototype.slice),Jo.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=bn(this.pos+e,this.len))};var jy=en;(en.prototype=Object.create(by.EventEmitter.prototype)).constructor=en,en.prototype.rpcCall=function e(t,a,r,o,n){if(!o)throw TypeError('request must be specified');var i=this;if(!n)return by.asPromise(e,i,t,a,r,o);if(!i.rpcImpl)return void setTimeout(function(){n(Error('already ended'))},0);try{return i.rpcImpl(t,a[i.requestDelimited?'encodeDelimited':'encode'](o).finish(),function(e,a){if(e)return i.emit('error',e,t),n(e);if(null===a)return void i.end(!0);if(!(a instanceof r))try{a=r[i.responseDelimited?'decodeDelimited':'decode'](a)}catch(e){return i.emit('error',e,t),n(e)}return i.emit('data',a,t),n(null,a)})}catch(e){return i.emit('error',e,t),void setTimeout(function(){n(e)},0)}},en.prototype.end=function(e){return this.rpcImpl&&(!e&&this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit('end').off()),this};var zy=fe(function(e,t){t.Service=jy}),Gy={},Uy=fe(function(e,t){function a(){r.Reader._configure(r.BufferReader),r.util._configure()}var r=t;r.build='minimal',r.Writer=Sy,r.BufferWriter=Fy,r.Reader=Iy,r.BufferReader=Oy,r.util=by,r.rpc=zy,r.roots=Gy,r.configure=a,r.Writer._configure(r.BufferWriter),a()}),qy=Uy,Ny=fe(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=t.Model=t.Weights=void 0;var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(qy),r=a.Reader,o=a.Writer,n=a.util,u=a.roots['default']||(a.roots['default']={});t.default=u;var i=u.Weights=function(){function e(e){if(this.shape=[],e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.layerName='',e.prototype.weightName='',e.prototype.shape=n.emptyArray,e.prototype.type='',e.prototype.data=n.newBuffer([]),e.prototype.quantizeMin=0,e.prototype.quantizeMax=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.layerName&&e.hasOwnProperty('layerName')&&t.uint32(10).string(e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&t.uint32(18).string(e.weightName),null!=e.shape&&e.shape.length){t.uint32(26).fork();for(var a=0;a<e.shape.length;++a)t.uint32(e.shape[a]);t.ldelim()}return null!=e.type&&e.hasOwnProperty('type')&&t.uint32(34).string(e.type),null!=e.data&&e.hasOwnProperty('data')&&t.uint32(42).bytes(e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&t.uint32(53).float(e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&t.uint32(61).float(e.quantizeMax),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var a=void 0===t?e.len:e.pos+t,o=new u.Weights,n;e.pos<a;)switch(n=e.uint32(),n>>>3){case 1:o.layerName=e.string();break;case 2:o.weightName=e.string();break;case 3:if(o.shape&&o.shape.length||(o.shape=[]),2==(7&n))for(var i=e.uint32()+e.pos;e.pos<i;)o.shape.push(e.uint32());else o.shape.push(e.uint32());break;case 4:o.type=e.string();break;case 5:o.data=e.bytes();break;case 6:o.quantizeMin=e.float();break;case 7:o.quantizeMax=e.float();break;default:e.skipType(7&n);}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!==('undefined'==typeof e?'undefined':kn(e))||null===e)return'object expected';if(null!=e.layerName&&e.hasOwnProperty('layerName')&&!n.isString(e.layerName))return'layerName: string expected';if(null!=e.weightName&&e.hasOwnProperty('weightName')&&!n.isString(e.weightName))return'weightName: string expected';if(null!=e.shape&&e.hasOwnProperty('shape')){if(!Array.isArray(e.shape))return'shape: array expected';for(var t=0;t<e.shape.length;++t)if(!n.isInteger(e.shape[t]))return'shape: integer[] expected'}return null!=e.type&&e.hasOwnProperty('type')&&!n.isString(e.type)?'type: string expected':null!=e.data&&e.hasOwnProperty('data')&&!(e.data&&'number'==typeof e.data.length||n.isString(e.data))?'data: buffer expected':null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&'number'!=typeof e.quantizeMin?'quantizeMin: number expected':null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&'number'!=typeof e.quantizeMax?'quantizeMax: number expected':null},e.fromObject=function(e){if(e instanceof u.Weights)return e;var t=new u.Weights;if(null!=e.layerName&&(t.layerName=e.layerName+''),null!=e.weightName&&(t.weightName=e.weightName+''),e.shape){if(!Array.isArray(e.shape))throw TypeError('.Weights.shape: array expected');t.shape=[];for(var a=0;a<e.shape.length;++a)t.shape[a]=e.shape[a]>>>0}return null!=e.type&&(t.type=e.type+''),null!=e.data&&('string'==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.quantizeMin&&(t.quantizeMin=+e.quantizeMin),null!=e.quantizeMax&&(t.quantizeMax=+e.quantizeMax),t},e.toObject=function(e,t){t||(t={});var a={};if((t.arrays||t.defaults)&&(a.shape=[]),t.defaults&&(a.layerName='',a.weightName='',a.type='',a.data=t.bytes===String?'':[],a.quantizeMin=0,a.quantizeMax=0),null!=e.layerName&&e.hasOwnProperty('layerName')&&(a.layerName=e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&(a.weightName=e.weightName),e.shape&&e.shape.length){a.shape=[];for(var r=0;r<e.shape.length;++r)a.shape[r]=e.shape[r]}return null!=e.type&&e.hasOwnProperty('type')&&(a.type=e.type),null!=e.data&&e.hasOwnProperty('data')&&(a.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&(a.quantizeMin=t.json&&!isFinite(e.quantizeMin)?e.quantizeMin+'':e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&(a.quantizeMax=t.json&&!isFinite(e.quantizeMax)?e.quantizeMax+'':e.quantizeMax),a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}();t.Weights=i;var s=u.Model=function(){function e(e){if(this.modelWeights=[],e)for(var t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.id='',e.prototype.name='',e.prototype.kerasVersion='',e.prototype.backend='',e.prototype.modelConfig='',e.prototype.modelWeights=n.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.id&&e.hasOwnProperty('id')&&t.uint32(10).string(e.id),null!=e.name&&e.hasOwnProperty('name')&&t.uint32(18).string(e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&t.uint32(26).string(e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&t.uint32(34).string(e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&t.uint32(42).string(e.modelConfig),null!=e.modelWeights&&e.modelWeights.length)for(var a=0;a<e.modelWeights.length;++a)u.Weights.encode(e.modelWeights[a],t.uint32(50).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var a=void 0===t?e.len:e.pos+t,o=new u.Model,n;e.pos<a;)switch(n=e.uint32(),n>>>3){case 1:o.id=e.string();break;case 2:o.name=e.string();break;case 3:o.kerasVersion=e.string();break;case 4:o.backend=e.string();break;case 5:o.modelConfig=e.string();break;case 6:o.modelWeights&&o.modelWeights.length||(o.modelWeights=[]),o.modelWeights.push(u.Weights.decode(e,e.uint32()));break;default:e.skipType(7&n);}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!==('undefined'==typeof e?'undefined':kn(e))||null===e)return'object expected';if(null!=e.id&&e.hasOwnProperty('id')&&!n.isString(e.id))return'id: string expected';if(null!=e.name&&e.hasOwnProperty('name')&&!n.isString(e.name))return'name: string expected';if(null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&!n.isString(e.kerasVersion))return'kerasVersion: string expected';if(null!=e.backend&&e.hasOwnProperty('backend')&&!n.isString(e.backend))return'backend: string expected';if(null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&!n.isString(e.modelConfig))return'modelConfig: string expected';if(null!=e.modelWeights&&e.hasOwnProperty('modelWeights')){if(!Array.isArray(e.modelWeights))return'modelWeights: array expected';for(var t=0,a;t<e.modelWeights.length;++t)if(a=u.Weights.verify(e.modelWeights[t]),a)return'modelWeights.'+a}return null},e.fromObject=function(e){if(e instanceof u.Model)return e;var t=new u.Model;if(null!=e.id&&(t.id=e.id+''),null!=e.name&&(t.name=e.name+''),null!=e.kerasVersion&&(t.kerasVersion=e.kerasVersion+''),null!=e.backend&&(t.backend=e.backend+''),null!=e.modelConfig&&(t.modelConfig=e.modelConfig+''),e.modelWeights){if(!Array.isArray(e.modelWeights))throw TypeError('.Model.modelWeights: array expected');t.modelWeights=[];for(var a=0;a<e.modelWeights.length;++a){if('object'!==kn(e.modelWeights[a]))throw TypeError('.Model.modelWeights: object expected');t.modelWeights[a]=u.Weights.fromObject(e.modelWeights[a])}}return t},e.toObject=function(e,t){t||(t={});var a={};if((t.arrays||t.defaults)&&(a.modelWeights=[]),t.defaults&&(a.id='',a.name='',a.kerasVersion='',a.backend='',a.modelConfig=''),null!=e.id&&e.hasOwnProperty('id')&&(a.id=e.id),null!=e.name&&e.hasOwnProperty('name')&&(a.name=e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&(a.kerasVersion=e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&(a.backend=e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&(a.modelConfig=e.modelConfig),e.modelWeights&&e.modelWeights.length){a.modelWeights=[];for(var r=0;r<e.modelWeights.length;++r)a.modelWeights[r]=u.Weights.toObject(e.modelWeights[r],t)}return a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}();t.Model=s});he(Ny);var By={},Vy=Object.freeze({default:By}),Hy=Vy&&By||Vy,Wy=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(gl),n=r(Od),i=r(Ac),u=r(zc),s=r(tg),l=r(Mg),p=r(Dg),d=r(ph),c=r(dh),g=a(uy),h=a(ly),f=r(Rh),m=r(Ny),_=d.default.CancelToken.source(),y=function(){function e(){var t=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Cn(this,e);var r=a.filepath,o=void 0===r?null:r,n=a.headers,i=void 0===n?{}:n,u=a.filesystem,s=a.gpu,l=a.transferLayerOutputs,p=a.pauseAfterLayerCalls,d=a.visualizations,c=void 0===d?[]:d;if(!o)throw new Error('[Model] path to protobuf-serialized model definition file is missing.');this.filepath=o,this.headers=i,this.filesystem='undefined'==typeof window&&void 0!==u&&u,this.events=new ch.EventEmitter,this.id=null,this.name=null,this.kerasVersion=null,this.backend=null,this.modelConfig={},this.modelWeights=[],this.gpu='undefined'!=typeof window&&gh.webgl2.isSupported&&void 0!==s&&s,this.transferLayerOutputs=void 0!==l&&l,this.pauseAfterLayerCalls=void 0!==p&&p,this.modelLayersInfo=[],this.modelLayersMap=new Map,this.inputTensorsMap=new Map,this.inputLayerNames=[],this.outputLayerNames=[],this.finishedLayerNames=[],this.isRunning=!1,this.runningProgress=0,this.predictStats={},this.visMap=new Map,c.forEach(function(e){if(e in h){var a=new h[e]({modelLayersMap:t.modelLayersMap,gpu:t.gpu});t.visMap.set(e,a)}}),this._ready=this._initialize()}return Fn(e,[{key:'checkGPUSupport',value:function(){return gh.webgl2.isSupported}},{key:'ready',value:function(){return this._ready}},{key:'_interrupt',value:function(){_.cancel()}},{key:'_initialize',value:async function(){var e=this;this.events.emit('loadingProgress',0);try{var t=this.filesystem?this._dataRequestFS():this._dataRequestHTTP(this.headers);await t}catch(e){console.log(e),this._interrupt()}this.events.emit('loadingProgress',100),this._buildDAG(),this.inputLayerNames.forEach(function(t){var a=e.modelLayersMap.get(t);a.call(e.inputTensorsMap.get(t)),a.hasOutput=!0,a.visited=!0});var a=this.pauseAfterLayerCalls;return this.pauseAfterLayerCalls=!0,this.runningProgress=0,this.events.emit('initProgress',0),await this._traverseDAG(this.inputLayerNames,'initProgress'),this.pauseAfterLayerCalls=a,this.finishedLayerNames=[],this.modelLayersMap.forEach(function(e){e.hasOutput=!1,e.visited=!1}),this.visMap.forEach(function(e){e.initialize()}),this.events.emit('initProgress',100),!0}},{key:'_dataRequestHTTP',value:async function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};try{var a=await d.default.get(this.filepath,{responseType:'arraybuffer',headers:e,onDownloadProgress:function(a){if(a.lengthComputable){var e=vn(100*a.loaded/a.total);t.events.emit('loadingProgress',e)}},cancelToken:_.token});this._decodeProtobuf(new Uint8Array(a.data))}catch(e){if(d.default.isCancel(e))console.log('[Model] Data request canceled',e.message);else throw e}}},{key:'_dataRequestFS',value:async function(){var e=p.default.promisify(Hy.readFile);try{var t=await e(this.filepath);this._decodeProtobuf(t)}catch(e){throw e}}},{key:'_decodeProtobuf',value:function(e){var t=m.default.Model.verify(e);if(t)throw new Error('[Model] Invalid model - check protobuf serialization: {err}');var a=m.default.Model.decode(e);this.id=a.id,this.name=a.name,this.kerasVersion=a.kerasVersion,this.backend=a.backend,this.modelConfig=JSON.parse(a.modelConfig),this.modelWeights=a.modelWeights}},{key:'toggleGPU',value:function(e){var t=this;this.gpu='undefined'==typeof e?!this.gpu:e,this.modelLayersMap.forEach(function(e){e.toggleGPU(t.gpu)}),this.visMap.forEach(function(e){e.gpu=t.gpu}),this.resetInputTensors()}},{key:'resetInputTensors',value:function(){var e=this;this.inputLayerNames.forEach(function(t){var a=e.modelLayersMap.get(t);e.inputTensorsMap.set(t,new f.default([],a.shape))})}},{key:'_buildDAG',value:function(){var e=this,t=this.modelConfig.class_name,a=[];if('Sequential'===t?a=this.modelConfig.config:'Model'===t&&(a=this.modelConfig.config.layers),!(Array.isArray(a)&&a.length))throw new Error('[Model] Model configuration does not contain any layers.');a.forEach(function(r,o){var n=r.class_name,i=r.config;if('Model'===t&&'Sequential'===n)i.forEach(function(t,a){var o=t.class_name,n=t.config,u=0===a?r.inbound_nodes[0].map(function(e){return e[0]}):[i[a-1].config.name];e._createLayer(o,n,u)});else if(!(n in g))throw new Error('[Model] Layer '+n+' specified in model configuration is not implemented!');else{if('Sequential'===t&&0===o){var u='input',s=i.batch_input_shape.slice(1),l=new g.InputLayer({name:u,shape:s,gpu:e.gpu});e.modelLayersMap.set(u,l),e.inputTensorsMap.set(u,new f.default([],s)),e.inputLayerNames.push(u)}else if('Model'===t&&'InputLayer'===n){var p=i.batch_input_shape.slice(1);e.inputTensorsMap.set(i.name,new f.default([],p)),e.inputLayerNames.push(i.name)}var d=[];if('Sequential'===t)d=0===o?['input']:[a[o-1].config.name];else if('Model'===t){var c=r.inbound_nodes;c&&c.length&&(d=c[0].map(function(e){return e[0]}))}e._createLayer(n,i,d)}}),this.modelLayersMap.forEach(function(t){e.modelLayersInfo.push((0,l.default)(t,['name','description','layerClass','inbound','outbound'])),0===t.outbound.length&&e.outputLayerNames.push(t.name)}),this.inputLayerNames.sort(),this.outputLayerNames.sort()}},{key:'_createLayer',value:function(e,t,a){var r=this,o=new g[e](Object.assign({},t,{gpu:this.gpu})),n=[];if('Bidirectional'===e){var i=o.forwardLayer.params.map(function(e){return t.name+'/forward_'+t.layer.config.name+'/'+e}),u=o.backwardLayer.params.map(function(e){return t.name+'/backward_'+t.layer.config.name+'/'+e});n=i.concat(u)}else n='TimeDistributed'===e?o.layer.params.map(function(e){return t.name+'/'+e}):o.params.map(function(e){return t.name+'/'+e});if(n&&n.length){var l=n.map(function(e){var t=(0,s.default)(r.modelWeights,function(t){var a=new RegExp('^.*'+e);return a.test(t.weightName)});if(!t)throw new Error('[Model] error loading weights.');var a=t.data,o=t.shape,n=t.type,u=new ArrayBuffer(a.byteLength),l=new Uint8Array(u);if(l.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),'uint8'===n){for(var p=t.quantizeMin,d=t.quantizeMax,c=new Float32Array(l),g=0,i=c.length;g<i;g++)c[g]*=(d-p)/255,c[g]+=p;return new f.default(c,o)}return new f.default(new Float32Array(u),o)});o.setWeights(l)}this.modelLayersMap.set(t.name,o),a.forEach(function(e){r.modelLayersMap.get(t.name).inbound.push(e),r.modelLayersMap.get(e).outbound.push(t.name)})}},{key:'_traverseDAG',value:async function(e,t){var a=this;if(0===e.length)return this.runningProgress=100,this.events.emit(t,100),!0;if(1===e.length){var r=e[0],o=this.modelLayersMap.get(r);if('InputLayer'===o.layerClass)this.finishedLayerNames.push(this.modelLayersMap.get(r).name);else{var n=this.modelLayersMap.get(r);if(n.visited)return!1;var s=n.inbound.map(function(e){return a.modelLayersMap.get(e)});if(!(0,u.default)((0,i.default)(s,'hasOutput')))return!1;n.isMergeLayer?n.call((0,i.default)(s,'output')):n.call(s[0].output),n.hasOutput=!0,n.visited=!0,this.finishedLayerNames.push(n.name),this.pauseAfterLayerCalls&&(await p.default.delay(0))}this.runningProgress+=100/this.modelLayersMap.size,this.events.emit(t,this.runningProgress),await this._traverseDAG(o.outbound,t)}else await p.default.all(e.map(function(e){return a._traverseDAG([e],t)}))}},{key:'_maybeTransferIntermediateOutputs',value:function(){this.gpu&&this.transferLayerOutputs&&this.modelLayersMap.forEach(function(e){e.output&&e.output.glTexture&&(gh.webgl2.bindOutputTexture(e.output.glTexture,e.output.glTextureShape),e.output.transferFromGLTexture(),e.output.is2DReshaped&&e.output.reshapeFrom2D())})}},{key:'loadData',value:function(e){var t=this;this.inputLayerNames.forEach(function(a){var r=t.modelLayersMap.get(a);t.inputTensorsMap.get(a).replaceTensorData(e[a]),r.call(t.inputTensorsMap.get(a)),r.hasOutput=!0,r.visited=!0})}},{key:'predict',value:async function(e){var t=this;if(this.isRunning=!0,this.runningProgress=0,this.events.emit('predictProgress',0),!(0,n.default)((0,o.default)(e).sort(),this.inputLayerNames))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the keys are the named inputs of the model: '+JSON.stringify(this.inputLayerNames));if(!(0,u.default)(this.inputLayerNames,function(t){return e[t]instanceof Float32Array}))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the values are the flattened data as Float32Array.');this.finishedLayerNames=[],this.modelLayersMap.forEach(function(e){e.hasOutput=!1,e.visited=!1});var a=(0,c.default)();this.loadData(e),this.predictStats.loadData=(0,c.default)()-a,a=(0,c.default)(),await this._traverseDAG(this.inputLayerNames,'predictProgress'),this.predictStats.forwardPass=(0,c.default)()-a,this._maybeTransferIntermediateOutputs();var r=this.modelConfig.class_name,i={};if('Sequential'===r){var s=this.modelLayersMap.get(this.outputLayerNames[0]);i.output=s.output.tensor.data}else'Model'===r&&this.outputLayerNames.forEach(function(e){var a=t.modelLayersMap.get(e);i[e]=a.output.tensor.data});return a=(0,c.default)(),this.visMap.forEach(function(e){e.update()}),this.predictStats.visualizations=(0,c.default)()-a,this.isRunning=!1,this.events.emit('predictProgress',100),i}},{key:'layerCall',value:function(e,t){if(this.modelLayersMap.has(e)){var a=t instanceof f.default?t:new f.default(t.data,t.shape);var r=this.modelLayersMap.get(e);return r.call(a)}}},{key:'cleanup',value:function(){gh.webgl2.clearRefs(),this.modelLayersMap.clear(),this.inputTensorsMap.clear(),this.visMap.clear(),delete this.modelWeights}}]),e}();t.default=y});he(Wy);var Xy=Uu.isFinite,$y=tn,Ky=1/0,Qy=an,Zy=Uh({args:['array','scalar','index'],body:function(e,t,a){var r=t,o;for(o=0;o<a.length-1;++o)r=r[a[o]];r[a[a.length-1]]=e}}),Yy=function(e){var t=r_(e.shape);return Zy(e,t),t},Jy=fe(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.approxEquals=function(e,t){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e-4,s=(0,o.default)((0,n.default)(e)),a=t;if(s.length!==a.length)return!1;for(var l=0;l<s.length;l++){if(!(0,r.default)(s[l]))return!1;if(s[l]<a[l]-u||s[l]>a[l]+u)return!1}return!0};var r=a($y),o=a(Qy),n=a(Yy)});he(Jy);var ex=fe(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Model',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Tensor',{enumerable:!0,get:function(){return n.default}}),t.testUtils=t.layers=t.activations=t.default=t.GPU_SUPPORT=void 0;var o=r(Wy),n=r(Rh),i=a(Qh);t.activations=i;var u=a(uy);t.layers=u;var s=a(Jy);t.testUtils=s;var l=gh.webgl2.isSupported;t.GPU_SUPPORT=l;var p={Model:o.default,Tensor:n.default,GPU_SUPPORT:l,activations:i,layers:u,testUtils:s};t.default=p}),tx=he(ex),ax=function(e,t,a,r){return new(a||(a=Promise))(function(o,n){function i(e){try{s(r.next(e))}catch(t){n(t)}}function u(e){try{s(r['throw'](e))}catch(t){n(t)}}function s(e){e.done?o(e.value):new a(function(t){t(e.value)}).then(i,u)}s((r=r.apply(e,t||[])).next())})},rx=!1;try{rx='[object process]'===Object.prototype.toString.call(global.process)}catch(t){}var ox=r('MODEL_PATH')||'/dist/model.bin',nx=new tx.Model({filepath:rx?__dirname+'/model.bin':ox,gpu:!1,filesystem:rx}),ix=function(e){function t(e){Cn(this,t);var a=In(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.values=e,a}return Dn(t,e),t}(Un);(function(e){e[e.TD=0]='TD',e[e.IHS=1]='IHS',e[e.HS=2]='HS',e[e.TU=3]='TU',e[e.DT=4]='DT',e[e.DB=5]='DB'})(e.AvailablePatterns||(e.AvailablePatterns={}));var ux=function(e){function t(){return Cn(this,t),In(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Dn(t,e),t}(qn);ux.predictPattern=nn,ux.hasDoubleBottom=un,ux.hasDoubleTop=sn,ux.hasHeadAndShoulder=ln,ux.hasInverseHeadAndShoulder=pn,ux.isTrendingUp=dn,ux.isTrendingDown=cn;var sx=gn();e.getAvailableIndicators=gn,e.AvailableIndicators=sx,e.FixedSizeLinkedList=On,e.CandleData=jn,e.CandleList=zn,e.sma=n,e.SMA=Bn,e.ema=i,e.EMA=Vn,e.wma=u,e.WMA=Hn,e.wema=s,e.WEMA=Wn,e.macd=l,e.MACD=$n,e.rsi=c,e.RSI=ei,e.bollingerbands=h,e.BollingerBands=ni,e.adx=_,e.ADX=fi,e.atr=y,e.ATR=_i,e.truerange=m,e.TrueRange=ci,e.roc=x,e.ROC=xi,e.kst=v,e.KST=bi,e.psar=b,e.PSAR=Pi,e.stochastic=S,e.Stochastic=wi,e.williamsr=P,e.WilliamsR=Ci,e.adl=T,e.ADL=Mi,e.obv=w,e.OBV=Ii,e.trix=k,e.TRIX=Ei,e.forceindex=C,e.ForceIndex=Li,e.cci=F,e.CCI=ji,e.awesomeoscillator=M,e.AwesomeOscillator=Gi,e.vwap=D,e.VWAP=qi,e.volumeprofile=R,e.VolumeProfile=Bi,e.mfi=L,e.MFI=Xi,e.stochasticrsi=O,e.StochasticRSI=Ki,e.averagegain=p,e.AverageGain=Qn,e.averageloss=d,e.AverageLoss=Yn,e.sd=g,e.SD=ai,e.highest=j,e.Highest=Zi,e.lowest=z,e.Lowest=Ji,e.sum=G,e.Sum=tu,e.renko=U,e.HeikinAshi=nu,e.heikinashi=q,e.bullish=Y,e.bearish=ie,e.abandonedbaby=ue,e.doji=W,e.bearishengulfingpattern=J,e.bullishengulfingpattern=B,e.darkcloudcover=se,e.downsidetasukigap=$,e.dragonflydoji=le,e.gravestonedoji=pe,e.bullishharami=V,e.bearishharami=ee,e.bullishharamicross=H,e.bearishharamicross=te,e.eveningdojistar=ae,e.eveningstar=re,e.morningdojistar=X,e.morningstar=N,e.bullishmarubozu=K,e.bearishmarubozu=oe,e.piercingline=Q,e.bullishspinningtop=de,e.bearishspinningtop=ce,e.threeblackcrows=ne,e.threewhitesoldiers=Z,e.fibonacciretracement=ge,e.predictPattern=nn,e.PatternDetector=ux,e.hasDoubleBottom=un,e.hasDoubleTop=sn,e.hasHeadAndShoulder=ln,e.hasInverseHeadAndShoulder=pn,e.isTrendingUp=dn,e.isTrendingDown=cn,e.setConfig=a,e.getConfig=r})(this.window=this.window||{},window);
//# sourceMappingURL=browser.js.map
